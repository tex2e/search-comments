1 if to avoid warning
1 year since leap day
30 significant digits
:method: after_action
@example 'LineLength'
Aborts a transaction.
Acts as tree example:
Add bin/rails options
And in another place:
Begins a transaction.
Called by content_for
Coming from web form.
ConditionalGet + Etag
Convenience accessor.
Default is +Marshal+.
Default is no prefix.
Define the essentials
Do a manual insertion
Equivalent to +to_s+.
Eval the given block.
Example for deleting:
Handle child elements
Including fractionals
Keep our eyes peeled.
Keys must be strings.
No need to deprecate.
Overwrite with false.
Person.sum("2 * age")
Rollback the changes:
Run a command in git.
Set the config option
Simple Token example:
Simulate `db:migrate`
Tabs are not allowed.
The HTTP status code.
The Unicode codepoint
This cop checks the .
This is a nice long',
This is equivalent to
This is not the case.
Valid ASCII byte, low
Valid ASCII byte, mid
allow safe assignment
and in an application
but is a TimeWithZone
check expanding paths
checking using the db
clear the inflections
create a new session.
data_sources instead.
def initialize(*) end
disappear before read
dynamic finder method
equivalent to 1AM DST
getting a slice of it
has not changed jamis
incremented only once
js is not part of all
module ActionDispatch
never checked back in
or, for a single case
preload table schemas
redirect_to login_url
regexp metacharacters
relies on code_length
relies on simple text
removes one at a time
require "test_helper"
require 'test_helper'
skip postgresql casts
standard offset -0300
standard offset -0500
use loaded (no query)
while (something) end
:method: around_action
:ported: compatibility
All files ever loaded.
Allows sort on objects
Always returns a hash.
An email was received.
Annoying hack warnings
Before and After hooks
Blog::Engine.load_seed
By default this is id.
COLLECTION CHECK BOXES
Combined if and unless
Commits a transaction.
Configuration options:
Create a csv renderer:
Defaults to +:random+.
Do nothing by default.
Each YAML fixture (ie.
FIXME: this seems bad.
Find the fifth record.
Find the third record.
First case 0..1 minute
For optimistic locking
Generic data download:
Ignore empty literals.
It's definitely a bug.
LATIN CAPITAL LETTER D
Models uploaded files.
Normal hash conditions
Otherwise, return nil.
Override in subclasses
Process extra options.
Quite straightforward.
Quotes the table name.
See also +demodulize+.
So we'll just skip it.
The love zone is UTC+0
The rest is unchanged.
These collections are:
This comment is fine',
This is equivalent to:
Use the named concerns
Valid ASCII byte, high
Variants make it easy.
Wraps code with filter
Your first attempt is:
any other escaped char
assert_response :found
can be send, zsuper...
disappear before write
don't count this query
else retry end end end
has the same effect as
if 20 do_something end
inherited from somegem
investigate method' do
key:: Key to be added.
leap day plus one year
person.pets.delete_all
return the whole match
select_minute(my_time)
select_second(my_time)
should still be unsafe
simple escapes (above)
springs forward to 3AM
to can be combined" do
twz is created for 3AM
we haven't checked yet
with_backend block" do
wouldn't update roles.
1 hour before TZ change
24 hours up to 42 hours
:bar key isn't provided
Adds a new foreign key.
An email was delivered.
An email was generated.
Assume given controller
Clears the query cache.
Connect to the database
Creates a number field.
Defaults to +:integer+.
Defaults to no quoting.
Delimiter was set to ""
Drops a MySQL database.
Ensure sensible umask.'
Exception file-blaming.
Expect original salary.
FIXME: stop using mocha
FOR UPDATE or somesuch.
Find the fourth record.
Find the second record.
Get messages for +key+.
Handlers are inherited.
Here's a basic example:
Here's a quick example:
INNER JOIN comments ...
It is 'on' per default.
Mysql gem compatibility
Object identifier types
Private utility method.
Quotes the column name.
Returns the class name.
Returns the macro type.
So this would be wrong:
Some just fix the data:
Suppress status output"
Takes a connection URL.
Takes a path to a file.
Test basic dispatching.
Test locked eager find.
The default is +false+.
The keys are unchanged.
There are three styles:
Track the last warning.
Try with relative path.
Two offenses are found.
Used for proxy classes.
Used in number_to_human
With the above example:
aliases telephone_field
assert digest is stored
attr_accessor :name end
belongs_to :account end
consume any exception',
def foo def bar end end
discard other scenarios
documentation comment',
does not have a .format
extended unicode escape
followed by no text' do
foo_url(bar, baz, bang)
has_and_belongs_to_many
migrate down to 0 again
module ClassMethods ...
module Fred extend self
module Test extend self
need for variable scope
non existent key passed
number of captures seen
output_hash as JSON' do
overridden in local.yml
parameterize("Donald E.
person.pets.destroy_all
relies on on_method_def
reloads the environment
report_as_with_mark' do
report_file_as_mark' do
reset the schema change
t.foreign_key(:authors)
test polymorphic routes
token   - String token.
warm up the habtm cache
without include_seconds
xmlschema date notation
( should not be remove )
* Validation is skipped.
+nil+ is not duplicable:
1 year ago from leap day
A simple string literal.
AlterTableMigrationsTest
Available behaviors are:
Available callbacks are:
By default this is +id+.
COLLECTION RADIO BUTTONS
Can be string or symbol.
Clears the entire cache.
Consider this situation:
Converts value to string
Copyright 2015 Acme Inc.
Creates a label element.
Creates new flash types.
Defaults to "text/html".
Disable color in output.
Expect temporary salary.
Extra spacing only here.
Full hash Configuration.
If block should not fire
Initiate a manual reload
Needed only for testing.
New record - no changes.
Non-optimized url helper
OK let's get our test on
Otherwise returns +nil+.
Returns the Arel engine.
SQL vs Model Load/Exists
Same value - no changes.
Set default test helper.
Specifies a new acronym.
Start of 4-byte sequence
Style/SpaceBeforeComment
TODO: Add an else clause
TODO: Make configurable.
Test assert_select_email
The primary options are:
This can be achieved as:
To get the tests to pass
Unloads the association.
Used for our test suite.
Without a file extension
You will need to either:
allow thread 1 to finish
apple: id: 1 name: apple
body was not initialized
can't compute range size
cause instead.", caller)
check that it gets reset
customer.projects.to_xml
def self.method3 end end
def test_simple_redirect
do_something(/pattern/i)
don't let it be negative
else do_this do_that end
errors from loading file
grape: id: 3 name: grape
note: escapes table_name
other kinds of alignment
save all the inflections
select_month(Date.today)
send_file '/path/to.zip'
so the when nodes count.
t.column(:name, :string)
t.timestamps null: false
take all the connections
take format into account
throw the count off by 1
(This is just an example.
+true+ is not duplicable:
1 second before DST start
90 minutes up to 24 hours
:nodoc: No Date is blank:
:nodoc: No Time is blank:
Cache or yield the block.
Charset defaults to utf8.
Clear the error messages.
Consider such a scenario:
Consider this controller:
DB2 is not case-sensitive
Decrement a cached value.
Discard operator methods.
INNER JOIN categories ...
Ignore implicit literals.
Increment a cached value.
Increment symbol counter.
It works for both inline:
Modules get a plain hash.
MyJob.perform_now("mike")
Nil values can be cached.
Now update the timestamp.
Or if the format is json:
Remove first to avoid it.
Removes the reference(s).
Removes the source range.
Returns all message keys.
See also +deconstantize+.
See delete for more info.
Setup i18n configuration.
Style/SpaceInsideBrackets
The following statements:
The values are unchanged.
This defaults to +false+.
This is a "shallow" copy.
This is true, by default.
Threadsafe template cache
To remove a csv renderer:
Use Rails default banner.
Used in number_to_rounded
We corrected some errors.
Which then will result in
With this, you simply do:
Works in two unique ways.
around_create :log_status
attr_accessor :name, :age
called on the type symbol
checks when target loaded
clean up the other thread
clear :all clear :plurals
clear all the inflections
common controller actions
cookies.delete :user_name
dashboard has to_a method
distance_of_time_in_words
do not delete this line',
eat the comma on the left
handle cycles in the tree
link to GitHub, SDoc flag
mac + darwinports + mysql
next iteration fixes this
not used for method calls
only "Kotori" is created.
override in derived class
should wake up all group1
t.timestamps(null: false)
this is a sad parse error
to_s in interpolation' do
twz is created for 3:30AM
used by all associations.
validate :must_be_friends
which spans a few lines',
wouldn't update the flag.
* A Rails TimeZone object.
+false+ is not duplicable:
--- post test clean up end
2 minutes up to 45 minutes
2AM springs forward to 3AM
:method: skip_after_action
:nodoc: The Routing table.
@example bad User.all.each
@see RuboCop::Cop::Offense
Add bin/ to source control
All methods are reentrant.
All the unicode whitespace
Allows explicit splatting:
Another case is `binding`:
Any kind of variable name.
Array of different objects
Avoids infinite recursion.
Builds equality condition.
Cache the template digest.
Calculate the details key.
Clears out internal caches
Common logic for UI texts.
Defaults to table quoting.
Define methods on fixture.
Delete messages for +key+.
Doesn't handle time zones.
Expected to be a +String+.
GET /books GET /books.json
Handles templates caching.
Hash keys must be strings.
Initialize the application
Instantiate the generator.
It accepts a headers hash.
Make sure to include them.
Modify the template digest
MyEngine::Engine.load_seed
Push a job onto the queue.
Reset original acronym set
Reset the current session.
Returns +false+ otherwise.
Returns the locked record.
SHOW VARIABLES LIKE 'name'
See destroy for more info.
Sets the HTTP status code.
Should be used with order.
Stay backwards compatible.
Style/SpaceAroundOperators
The Accept header to send.
The code is equivalent to:
The final result would be:
The reverse of +camelize+.
These currently consist of
This class is thread safe.
This is database specific.
To unregister a MIME type:
Try to get stored content.
Used in number_to_currency
as we are testing API here
attr_accessor :name , :age
character classes, anchors
class Host include Bar end
commas are just whitespace
default max pool size to 5
don't flag `break(1)`, etc
em-hiredis is warning-rich
ensure any data is present
ensure travel_to re-raises
if methods are redefined).
if running just this test.
include Routes.url_helpers
loading a specific fixture
mac + darwinports + mysql4
mac + darwinports + mysql5
only defined in normal.yml
orange: id: 2 name: orange
overridden in .rubocop.yml
overwrite the default type
preheat arel's table cache
prevent json unmarshalling
relies on configurable_max
remove_column(:account_id)
restore the old definition
stream_from "some_channel"
the response can be built.
there is no ambiguity here
+try+ calls can be chained:
- +format+: Request format.
/some/file /some/other/file
3) Set view_context to self
45 minutes up to 90 minutes
:method: skip_around_action
:method: skip_before_action
:nodoc: No number is blank:
@example 'Line is too long.
Access the mailer instance.
Add +element+ to the queue.
All files currently loaded.
And now it will look up at:
BigDecimals are duplicable:
Callbacks are not executed.
Checks the following cases:
Convert Arel node to string
Converts an arel AST to SQL
Cookie shouldn't be changed
Create `end` ladder end end
Creates a new job instance.
Defaults to +lock_version+.
Disable network connections
Encrypt and sign a message.
Equivalent to +delete_all+.
Firm was saved to database.
For example, something like
For example, the following:
Happens by default on save.
Helpers that builds a path.
Hidden, excluded by default
Increment the current level
Memcache keys are binaries.
MemoryStore is thread-safe.
Methods are not duplicable:
Normalize args and options.
Now use the Rails insertion
Numbers are not duplicable:
Or a collection to be used:
Performs a joins on +args+.
Regression test for 21c75e5
Renders the given template.
Returns +false+ by default.
Returns all message values.
See +get+ for more details.
See `Mime::Type.register`."
See that class for details.
Separate many using commas:
Set a session in the cache.
Sets the HTTP content type.
Sets the Rails environment.
Sets the primary key value.
Show a JPEG in the browser:
Simple memory backed cache.
Student.where(grade: 9..12)
Symbols are not duplicable:
Symbols:: A method to call.
Table names + table aliases
Tests for uncountable names
The above allows you to do:
This command can be nested.
Unwrap Constraints objects.
Used only to speed up tests
Valid isolation levels are:
When the block returns true
Write to a file atomically.
`self` is only needed when:
ascends to grandparent node
b is indented relative to a
checking via the collection
followed by optional spaces
forcing to load all clients
frozen_string_literal: true
i.e. type of the violation.
if it's set to nil or false
it's not in the test itself
make sure 'foo' was written
max is 1024, plus some room
objectify_options(options))
or in a scope or namespace:
private IPv4 range 10.x.x.x
private IPv6 range fc00::/7
prove join table is updated
relies on surrounding_space
restore all the inflections
rubocop:disable Lint/Eval',
rubocop:disable Style/Tab",
significant forced to false
so block binding catches it
stub the authenticity token
taking from loaded Relation
to_time_in_current_zone' do
validates_presence_of :name
wait for the events to fire
wrong mtime from the future
* A TZInfo::Timezone object.
- SQL standard is an integer
--- post test clean up start
:method: append_after_action
:nodoc: Normalizes URI path.
A viable multi-line element.
Access the message instance.
ActiveRecord::FixtureSet.new
Also detects duplicated IDs.
An instance of a view class.
Asserts a given file exists.
Copyright (c) 2015 Acme Inc.
Count all records using SQL.
Create route get 'baz/index'
Creates a file upload field.
Default implementation used.
Defaults to the current URL.
Destructive +reverse_merge+.
Discard attr writer methods.
Drops a PostgreSQL database.
Enable per-form CSRF tokens.
Escape question mark if any.
Example for SQLite database:
FOR UPDATE on an outer join.
For backwards compatibility.
For example, for PostgreSQL:
Forcible conversion to UTF-8
Given a pair +key+, +value+:
Guides generation from gems.
Here, have a monkey fixture:
If not found, returns +nil+.
Just 1, 2 is not valid Ruby.
Just cut off the first part.
Locking a record reloads it.
Module includes this module.
Most jQuery plugins do this.
MyJob.new(*args).perform_now
No need to handle exception.
OPTIMIZE: For faster testing
Object includes this module.
Open a new session instance.
POST /books POST /books.json
POST create PATCH/PUT update
Performs the actual request.
Please use only for reading.
Prints a list of generators.
Private, for the test suite.
Process the rendered format.
Provides a custom rake task.
Read on for an introduction.
Renames a column in a table.
Renames an index of a table.
Returns a deep copy of hash.
Returns size of the records.
Returns the first character.
Returns the frozen instance.
Returns the session as Hash.
See the +:weak_etag+ option.
Session shouldn't be changed
Sets header when not present
Sets the HTTP character set.
Short-hand for years_ago(1).
Shortcut when limit is zero.
Stack of files being loaded.
Store existing prefix/suffix
String, Array, Range, etc.).
Style/SpaceBeforeBlockBraces
Style/SpaceInsideBlockBraces
TODO: Room for optimization.
The Atom spec copyright date
The charset of the response.
The result is the following:
This is +:usec+, by default.
This should not exceed 0.25.
Used in filtering callbacks.
Used in number_to_human_size
Used in number_to_percentage
When the block returns false
When the method returns true
Write an entry to the cache.
add_index(:suppliers, :name)
after_validation :set_status
and a matching closing quote
assert recursion is possible
assert_equal 200, status end
attr_accessor :name, :status
b for bytes and k for kbytes
before_destroy :log_children
change the column definition
checks something o-related',
checks when target no loaded
clear topic timestamp values
create all to avoid warnings
daylight saving offset -0200
def index fetching posts end
def save do persistence work
existing public class method
handle strings like __FILE__
in layout, jumps to some DIV
index name can't be the same
inserts the primary resource
matches YAML-formatted dates
module Foo class Bar end end
no cop in wrong type listing
owner is in Object, so raise
redirect_to root_url end end
rubocop:disable LineLength',
rubocop:disable Style/Loop',
set default delimiter to '_'
skip the comparison instance
special.yml takes precedence
this triggers action_methods
transmit message end end end
try loading the class/module
x_sendfile_header middleware
(send (const nil :Hash) :new)
* Capitalizes the first word.
/page/:id(/:action)(.:format)
:method: append_around_action
:method: append_before_action
:method: prepend_after_action
A duck-type assistant method.
A scaffold for concrete cops.
Accepts only keys as strings.
Add nil to an existing header
Alias for +middleware_stack+.
An array of arrays of scopes.
And use it on initialization:
And, like this (xml-encoded):
Assuming the following setup:
Avoid failure on version bump
But could be a generic Queue.
By default, it will be UTF-8.
Column storage size in bytes.
Convert XML document to hash.
Creates a range form element.
Deal with it later in caller.
Decrypt and verify a message.
Default is "" (i.e. nothing).
Don't override this directly.
Example usage is given below:
FIXME: lifted from Rack-Test.
Find the forty-second record.
Finds engine with given path.
Firebird cannot rename tables
For example "private def ..."
Forces reloading of relation.
Gateway to RemoteConnections.
Get a session from the cache.
Get original file permissions
Here are some basic examples:
INNER JOIN parents_mixins ...
In a controller, for example:
In the authentication filter:
It checks for code like this:
Let's look at the code below:
Load fixtures for every test.
Load fixtures from the engine
Must be a :redirect response.
No counter_cache option given
No-one needs Floats that big.
Note: Fixtures are unordered.
One-liner, no newline needed.
Ordered by desc offense count
Otherwise, +nil+ is returned.
Otherwise, false is returned.
Otherwise, raise an exception
Override to provide your own.
Performs the job immediately.
Pick the frameworks you want:
Read an entry from the cache.
Remove any ASC/DESC modifiers
Remove the color from output.
Remove the head of the queue.
Returns a deep copy of array.
Returns name of the database.
Returns the deleted messages.
Returns the migrations paths.
Returns true if table exists.
Set the client message level.
Sets the cookie named +name+.
Setup and teardown callbacks.
Short-hand for months_ago(1).
Short-hand for months_ago(3).
Shortcut for +tempfile.open+.
Shortcut for +tempfile.path+.
Shortcut for +tempfile.read+.
Shortcut for +tempfile.size+.
Should have rewound the body.
Should preserve default value
Some documentation comment...
Start of 2-byte sequence, low
Start of 2-byte sequence, mid
Start of 3-byte sequence, low
Start of 3-byte sequence, mid
Such calls always return `0`.
The default threshold is 16K.
The latter is a shortcut for:
Then the action is performed.
This controller, for example:
This should not be destroyed.
Threadsafe, fair, FIFO queue.
When the method returns false
Which would provide you with:
apple: eater: george (Monkey)
begin main rescue resbody end
check the change from 0 to ''
check the change from 1 to ''
clear_changes_information end
concern :EventTracking do ...
def fry(temperature: 300) ...
def goodbye 'goodbye' end end
def length super / 60 end end
def test return something end
define_attribute_method :name
delete text_xml from the list
duped has no timestamp values
existing private class method
first dump primary key column
get ":controller/:action/:id"
include TodoEventTracking end
interpolate the fixture label
leading spaces are on purpose
no need to check empty arrays
number that's bigger than int
passes an empty list if *args
protected def deny_access ...
ranges are sorted by position
remove_timestamps(:suppliers)
resources :user, param: :name
select_datetime(my_date_time)
t.rename(:description, :name)
taking from unloaded Relation
to_s useful for debugging' do
true, false, or :no_instances
would produce something like:
(send (const nil :Array) :new)
- Type is an OID::Type object.
:method: prepend_around_action
:method: prepend_before_action
A hash is blank if it's empty:
Abstract subclass of AR::Base.
Address.includes(:addressable)
Adds a new index to the table.
Always expect original salary.
An abstract cache store class.
And the final result would be:
ApplicationController.renderer
Available transformations are:
Basic mail usage without block
Concrete subclass of AR::Base.
Consider the following schema:
Continuation byte, low (cp125)
Continuation byte, mid (cp125)
Convert to a formatted string.
Decompresses a gzipped string.
Defines the primary key field.
Deletes an entry in the cache.
Example of a simple migration:
FIXME: this is a horrible name
Find the third-to-last record.
First post is with title scope
For collections rendered such:
GET /books/1 GET /books/1.json
Generate new controller class.
Get headers for this response.
Hidden but explicitly included
In this case, if you use this:
It can not use cached results.
It will be treated as String."
It's automatically configured.
It's much better to swap that:
JSON or Ruby code block errors
Load Rails Rakefile extensions
Load actionpack sqlite3 tables
Lock this job for this worker.
Makes the +new+ method public.
Mime::Type.unregister(:mobile)
Module:: No further processing
Not this cop's job to fix end.
Note: +:id+ is always present.
Note: only supported by MySQL.
Performs a destructive squish.
PostgreSQL protests SELECT ...
Queries the primary key value.
Quite strange, but legal ruby.
Rails, Sinatra, etc.) process.
Relinquish the exclusive lock.
Returns a Time.utc() instance.
Returns the name of the macro.
Returns the primary key value.
Returns true if schema exists.
Sanitizes a block of CSS code.
Serializes a set of arguments.
Short-hand for months_since(3)
Short-hand for years_since(1).
Shortcut for +tempfile.close+.
Skip a callback after actions.
Skip files that already exist"
Start of 2-byte sequence, high
Start of 3-byte sequence, high
Test if :formats, :locale etc.
The code might look like this:
The options for atom_feed are:
The result after rendering is:
This option is off by default.
Where possible, prefer +wrap+.
Wraps info about the brackets.
You can nest arbitrarily deep:
You can override this default:
You can set it up in two ways:
You can set that as an option:
`nil` *should* be changed to 0
advance the time by a fraction
all cops in their type listing
before_create AnotherClass end
block thread 2 for zzz seconds
but on cloned object should be
causing the collection to load
check the change from nil to 0
company already has one client
conditions on the source table
def some_method(foo) super end
define_attribute_methods :name
define_method(:method2) do end
empty block won't perform jobs
errors from ActiveRecord setup
faye-websocket is warning-rich
int 3 is 4 bytes in postgresql
prevent showing negative zeros
private def track_creation ...
rake notes rake notes:optimize
return if any branch is empty.
right wins if there is no left
runs first time, not asserting
same value as an existing enum
silence verbose schema loading
simulate application existence
simulate normalizing PATH_INFO
skip_before_action :fire_flash
test "verify something" do ...
test2 Copyright 2015 Acme Inc.
to load all instances of bulbs
use Ruby's default start value
validate :instance_validations
wake up any remaining sleepers
(send (const nil :String) :new)
1 sec before midnight Jan 1 EST
1 sec before midnight Jan 2 EST
:move: test this in Action View
@person.try(:spouse).try(:name)
A default can also be provided.
A scaffold for concrete forces.
Accepts an array of conditions.
Add nil to a nonexistent header
Also, make it output to STDERR.
An Array with a compile method.
And an instance method _routes.
And it's finally registered as:
Avoid error messages on console
Base controller for these tests
Checks if the entry is expired.
Clients were saved to database.
Close the WebSocket connection.
Compresses a string using gzip.
Consider the following example:
Continuation byte, high (cp125)
Converts to a formatted string.
Copy validators on inheritance.
Default format used by Builder.
Defaults to a new empty string.
Delete an entry from the cache.
Delimiter "," and separator "."
Disabling comments still apply.
FIXME: Apparently JK uses this.
Find the second-to-last record.
Firm was not saved to database.
Grouped choices look like this:
Helpers take that into account:
Holds generators configuration:
Hooks invoked by VariableTable.
If +nil+, no selection is made.
It may be larger in the future.
Last configurable block to run.
Make the string respond to read
Marks a string as trusted safe.
Marks this record as read only.
New rules are added at the top.
No offense registered for this.
Originally this expression was:
Pass `wait: false` to continue.
Pass seed guaranteeing failure.
Remove a previously added hook.
Render the templates and blocks
Returned hash keys are strings:
Returns translated month names.
Round trip a job in memory only
Set configure delivery behavior
Sets the controller class name.
Sets the table name explicitly.
Short-hand for months_since(1).
Shortcut for +tempfile.rewind+.
Show a 404 page in the browser:
Sidekiq is not warning-clean :(
Simulate a real Rails app boot.
Skip a callback around actions.
Skip a callback before actions.
Skip a previously set callback.
Strips indentation in heredocs.
Synchronize calls to the cache.
TODO: Tests demonstrating this.
The default format is ISO 8601.
The output is machine-parsable.
The possible config values are:
The scope for this association.
There are two different styles.
This + is not a unary operator.
This cop checks for END blocks.
This has no layout and it works
This is set to :utc by default.
To define an Active Job object:
Use the new Rails 5 executables
Validate our unmarshalled data.
We prefer find_all over select.
Write until the buffer is full.
account for our own connections
add a before destroy to student
add_reference(:products, :user)
alternate_helpers/foo_helper.rb
and is in the current Time.zone
but there's a crash in one cop.
class Person has_many :pets end
conditions on the through table
create a new array avoiding dup
create table without migrations
delegate :hello, to: :class end
depending on the format string.
ensure that scoping is restored
ensure thread 1 tx starts first
existing protected class method
http://rubular.com/r/CvpbxkcTzy
let's just rely on the template
make sure we are in correct dir
match ":controller/:action/:id"
nested, fixed in next iteration
person.pets.replace(other_pets)
public class method on AR::Base
put transaction in broken state
relies on cyclomatic_complexity
run_callbacks :save do save end
shift ARGV so IRB doesn't freak
shouldn't matter -- 0 max queue
test merging in both directions
tests the use of dup in url_for
"test_unit:awesome", "test_unit"
* +db_dir+: your +db+ directory.
...and Builder (RXML) templates.
@example bad def bar foo.bar end
@example bad while true work end
A mixin to break up ConfigLoader
An array is blank if it's empty:
And changes the original string:
Another longer example would be:
Append a callback after actions.
Arguments can be passed as well.
Assigns a new value to the hash:
Both express a 1-1 relationship.
Colon follows directly after key
Constant time string comparison.
Convert an enumerable to a hash.
Defaults to column name quoting.
Define a controller as abstract.
Define the rest of the connector
Deserializes a set of arguments.
Desperately overcommented regexp
Drops a table from the database.
Duck-types as a Date-like class.
Duck-types as a Time-like class.
Duplicates the value in a class.
Ensure view path cache is primed
Executes the truncate statement.
FIXME: Remove this class as well
FIXME: another integration test.
FOR UPDATE and other lock types.
First configurable block to run.
For example you can't dup +nil+:
For example, to add a condition:
Gracefully stop processing jobs.
Hidden, not included by wildcard
If in your I18n locale you have:
Instantiate a new mailer object.
Leaving the response body blank.
Let Mail do the delivery actions
Let's use labels instead of IDs:
Load data from db/seeds.rb file.
NOTE: This method is deprecated.
No offense if line break inside.
Note the filename is not stored.
Release old working directory.',
Remove a session from the cache.
Remove nils from the params hash
Require all the stubs and models
Returns +nil+ if there's no row.
Returns an array of child nodes.
Returns the Mail::Message object
Returns the class for the macro.
Returns the class of the target.
Returns the current proxy class.
Returns the current schema name.
Routes can generate pretty URLs.
Run but do not make any changes"
See Module::Concerning for more.
Singleton instance of the server
Storage units output formatting.
Style/SpaceAroundBlockParameters
The API depends on four methods:
The argument can take six forms:
Third configurable block to run.
This replaces mod_rewrite rules.
This will later be JSON encoded.
Track all generators subclasses.
Unicode whitespace is supported:
We check that optimization here.
When using the `new_line` style:
Which is not the desired lookup.
You can also just pass a record.
add_index :posts, :author_id end
after_bundle do git add: '.' end
alias_attribute :nickname, :name
class Comment has_many :tags end
class Post attr_accessor :to_key
def method puts 'hi' end end end
def self.statuses() statuses end
drop_table :distributors end end
expire_fragment('name_of_cache')
force drop posts table for test.
is equivalent to something like:
no more than 2 decimals reported
pass target value as an argument
private class method on AR::Base
private_class_method :method end
range_with_surrounding_comma' do
range_with_surrounding_space' do
redirect_to(person_list_url) end
remove locales external to Rails
require 'active_support/concern'
rollbacks are silently swallowed
validates :name, title: true end
...and send them all in one query
@example always bad method(1, 2,)
A typical module looks like this:
Access the contents of the flash.
Add a value to an existing header
Add the given source to +Gemfile+
Adds fallbacks to the view paths.
Append a callback around actions.
Append a callback before actions.
Asserts a given migration exists.
Assigns a value to a given +key+.
Auto-correction needs a full run.
Builds and returns output string.
By default, the group is :default
Channel instances are long-lived.
Checks to see if a column exists.
Checks to see if an index exists.
Clears out the association cache.
Close then reopen the connection.
Composite primary key is ignored.
Contains all routes for a system.
Copied from default configuration
Create a new PostgreSQL database.
Deletes all items from the cache.
Do all the stuff from other tests
Don't check the same `end` again.
Fields can be symbols or strings.
Finally, we can expire the cache.
For example, given the following:
Get-and-show and do-and-redirect.
However, those can be customized:
ID optionally provided by adapter
If omitted, +:before+ is assumed.
In which case, define them below.
Initialize the Rails application.
It allows us to do the following:
Join models are directly deleted.
Lists the valid migration options
Loading listen triggers warnings.
Loop through the requirements AST
Mimic Active Record notifications
Must be called within synchronize
MySQL can't roll back ddl changes
Obtain a row lock on this record.
Or even to render a special view:
Oracle saves empty string as NULL
People should not use this class.
Person.undefine_attribute_methods
Please use that approach instead.
Post.includes(:approved_comments)
Prepend a callback after actions.
Procs will be evaluated by merge:
Removes fragments from the cache.
Returns a new validator instance.
Returns an array of schema names.
Returns true if the email exists.
Runs the given migration classes.
Second configurable block to run.
So they update the counter cache.
So what can be written like this:
The response code of the request.
This cop checks for BEGIN blocks.
This method also accepts a block.
This parameter can be any one of:
This script generates the guides.
To add a route to the collection:
Translate a file path into a key.
Translate a key into a file path.
Try fallbacks for the given base.
Turn off Bundler's stub generator
Use N processes (N defaults to 4)
Use i for Fixnum and f for Float.
User.offset(10).order("name ASC")
Waits for termination by default.
When using the `same_line` style:
Wraps gem entries inside a group.
add index sort order if supported
alias_method_chain :foo, :feature
assert_no_file "config/random.rb"
asserting default value is a hash
color output explicitly forced on
creates both "Kotori" and "Nemu".
def self.method puts 'hi' end end
end end include EventTracking end
explicitly check for false vs nil
filter out super and zsuper nodes
params.require(:user).permit(...)
resources :posts, module: "admin"
rubocop:disable Style/ClassVars',
should wake up everyone remaining
strip out any leading schema name
time_select("article", "sunrise")
we care only about `call` methods
(no need to include all cops here)
+key+ can take one of three forms:
:nodoc: No DateTime is ever blank:
A minimal implementation could be:
A prefix before the opening brace.
Add +records+ to this association.
Allows to specify a HAVING clause.
An error message can be specified.
Can accept other relation objects.
Complete this in-flight execution.
Converts a string to a Date value.
Converts a string to a Time value.
Defaults to / on the current host.
Defaults to `require_parentheses`.
Direct dispatch to the controller.
Filters run first, then silencers.
First request accesses the session
Flush all log_subscribers' logger.
Follow a single redirect response.
For example, given a form builder:
For example, you can also do this:
Given this sub template rendering:
In an autoloaded user.rb like this
Indents the lines in the receiver:
Initialize a new MessageEncryptor.
It honors the +:dependent+ option.
Just reopening it, not defining it
Look into those before using this.
Main body of rescue is always run:
Most recently modified file first.
NOTE: "size" is reserved in Oracle
Or even multiple scope parameters.
Otherwise, we need to use an alias
Prefixes a key with the namespace.
Prepend a callback around actions.
Prepend a callback before actions.
ProcessPhotoJob.perform_now(photo)
Redirect any path to another path:
Regression test, see GH issue 2671
Remove content node if it is blank
Remove leading/trailing separator.
Remove partially loaded constants.
Returns a list of character lists.
Returns a message verifier object.
Returns just a table's primary key
Returns the current database name.
Returns the kind of the validator.
Returns true if relation is blank.
Set messages for +key+ to +value+.
Set up gems listed in the Gemfile.
Should preserve the default value.
So, any mass-assignment idiom like
Style/SpaceInsideHashLiteralBraces
Such queries should not be cached.
The block form supports filtering.
The following symbols are special:
The form's authenticity parameter.
The nonce is opaque to the client.
The reincarnation of syntax cop :)
There are two ways to unsubscribe.
This class is then used like this:
This does not destroy the objects.
This is the default queue adapter.
To specify a queue adapter to use:
Use InnoDB, MaxDB, or NDB instead.
Useful for building virtual paths.
When dealing with decimal columns:
You can also give extra arguments.
You can send parameters like this:
`-' interpreted as argument prefix
add_index :authors, :name, :unique
arbitrary_object.dup rescue object
assert that the block did not fail
assigned but unused variable - foo
color output explicitly forced off
commands have no explicit receiver
ensure it's using the DATABASE_URL
heredocs are ignored at the moment
if some_condition do_something end
lambda.() does not have a selector
make sure tables get reinitialized
make sure we didn't break count...
only count belongs_to associations
private def some_complex_logic ...
redefined class method on AR::Base
redirect_to show_item_path(id: 25)
remove_index :accounts, :branch_id
resources :posts, path: 'postings'
rubocop:disable Metrics/LineLength
rubocop:disable NumericLiterals ')
set_callback :save, :before_method
should not do 1 query per subclass
silence libxml, exceptions will do
sqlite3 defaults to UTF-8 encoding
test including post_types together
"test_unit:controller", "test_unit"
(the above is from the unit tests).
* +false+ - Returns always +false+.
+nil+ is returned if none is found.
:call-seq: skip_after_action(names)
@example bad 3.day.ago 1.months.ago
@example bad if a + b something end
A local variable fixes the problem.
Add a value to a nonexistent header
Alternatively a block can be given.
Benchmark realtime in milliseconds.
Boolean for if changes are detected
By default, this parameter is true.
Calculates a sum from the elements.
Called after frameworks initialize.
Called by Rack to setup the server.
Can be set to +nil+ for no logging.
Check for suspicious argument names
Class level API with method missing
Clients were not saved to database.
Converts relation objects to Array.
Converts strings to UpperCamelCase.
Creates a check box form input tag.
Creates a text field of type "tel".
Creates a text field of type "url".
DateTimes aren't aware of DST rules
Define a new concern and mix it in.
Defines ActiveSupport::Deprecation.
Defines the routes for this engine.
Deletes given key from the session.
Direct access to partial rendering.
Disable `should_receive` and `stub`
Don't add multiple subscribers (eg.
Don't validate RuboCop's own files.
Encapsulates the common pattern of:
Ensure STI is respected in the join
Ensure readers methods get compiled
Execute the block given if updated.
Extra indentation step after these.
Find the longest line of condition.
I18n is forced to raise by default.
It does not save the parent either.
Just run the capify command in root
Load the file at the provided path.
Locate a specific time zone object.
Necessary to load A::B for the test
OPTIMIZE: Makes these specs faster.
Optionally removes a +type+ column.
Otherwise +size+ is more efficient.
Otherwise it returns an empty hash.
Overwrite files that already exist"
Parser token "text" may be a Fixnum
Pick an asset host for this source.
Please choose another plugin name."
Prefix multi and heredoc with this.
Public method visibility by default
Queue in which the job will reside.
Remove all elements from the queue.
Respect object when object is false
Returns +nil+ if no token is found.
Returns a hash of where conditions.
Returns a shallow copy of the hash.
Returns a text_field of type "tel".
Returns a text_field of type "url".
Returns adapter for specified name.
Returns all mailer preview classes.
Returns an array of ancestor nodes.
Returns default value if specified.
Returns the backend queue provider.
Returns the current database ctype.
Returns the database character set.
Returns the name of current mailer.
Returns the size of the collection.
Returns the time zone abbreviation.
Returns true if the preview exists.
Returns: an AbstractAdapter object.
See +destroy+ for more information.
Set correct permissions on new file
Silences the logger within a block.
So we group by the classes as well.
Specify the backend queue provider.
Strings:: Some content to evaluate.
Stylesheets (should not be removed)
The +defaults+ parameter is unused.
The Proc should take two arguments:
The following options are accepted:
The maximum length is configurable.
This is a collection of formatters.
This is actually an unmasked token.
This jar is only meant for writing.
This makes chaining methods easier.
This works on MySQL and PostgreSQL.
Time to give our monkey some fruit.
Turn on request forgery protection.
Use symbols as procs when possible.
Wait notifications to be published.
We care only for the last argument.
Works with any kind of association.
add_foreign_key :articles, :authors
assert_file "config/environment.rb"
attr_accessor :name, :age, :awesome
avoid overflow for the highest unit
before_create :action_before_create
class Person include HairColors end
commit These writes will be ignored
connection is OK with a nil timeout
datetime with fractions of a second
def goes_to_login get login_url ...
don't flag `rescue(ExceptionClass)`
drain the only available connection
generate a primary key if necessary
inflect.uncountable 'equipment' end
make sure the association is loaded
make sure the response is committed
merge in order_values from relation
mount SomeRackApp, at: "some_route"
one of the parse strategies blew up
or must be structurally compatible.
rake ENGINE_NAME:install:migrations
rename_table('octopuses', 'octopi')
return to skip all descendant nodes
rubocop:disable Metrics/ClassLength
select_day(5, prompt: 'Choose day')
set the association by id, directly
test "the truth" do assert true end
we care only for single line blocks
wouldn't update the +avatar+ field.
* Removes a "_id" suffix if present.
:call-seq: skip_around_action(names)
:call-seq: skip_before_action(names)
:nodoc: holds compiled template code
@overload each_node Yield all nodes.
A cached lookup for table existence.
A module may or may not have a name.
Access the message attachments list.
All namespaces that are eager loaded
Allows to specify a group attribute:
Allows you to configure the railtie.
Also indicates there's a line break.
An Arel::Table for the active_record
And both aliases are set up for you.
Anonymous modules aren't autoloaded.
Asserts a given file does not exist.
Broadcasts logs to multiple loggers.
Called before frameworks initialize.
Clears the cache which maps classes.
Compares two relations for equality.
Convert range to a formatted string.
Copyright (c) 2010-2015 James Coglan
Copyright (c) 2012-2014 Arnau Siches
Creates a new ConnectionPool object.
Creates a text field of type "date".
Creates a text field of type "time".
Creates a text field of type "week".
DELETE /books/1 DELETE /books/1.json
Define the Rack API for this engine.
Direct access to template rendering.
Ensure the type cast value is cached
Find the max configured line length.
Formats can have different variants.
Given the following spec-style test:
Guides generation in the Rails repo.
Holds common methods for migrations.
INNER JOIN mixins childrens_mixins_2
Indicates if the model is persisted.
It's purely an online queue, though.
Keeps the number's precision if nil.
Merges the caller into +other_hash+.
Message.all.to_xml(skip_types: true)
No currency conversion is performed.
Only rules for English are provided.
Opaque based on digest of secret key
Otherwise fall back to double quotes
Otherwise it returns an empty array.
Otherwise, this method does nothing.
Overwrite if you want custom lookup.
Person.where(age: 0..18).destroy_all
Print generator's options and usage"
ProcessPhotoJob.perform_later(photo)
Providing a custom Loofah::Scrubber:
Quotes strings for use in SQL input.
Rails own autoload, eager_load, etc.
Register danish language for testing
Restore view_paths to previous value
Returns a single value from a record
Returns a text_field of type "date".
Returns a text_field of type "time".
Returns a text_field of type "week".
Returns the kind for this validator.
Returns the list of enabled formats.
Returns the number of affected rows.
Returns the number of rows affected.
Returns the offset value in seconds.
Set the message to be shown in logs.
Sets the value of inheritance_column
Should preserve class for subclasses
So, any strong parameters idiom like
Specifies a one-to-many association.
Stored value shouldn't be accessible
Style/SpaceInsideStringInterpolation
The following options are supported:
The value is truncated word by word.
There are two basic forms of output:
This array is processed recursively.
This cop checks for `rand(1)` calls.
This cop checks for inline comments.
This cop checks hash literal syntax.
This generates the following routes:
This time we will change the locale.
Thus, any mass-assignment idiom like
To generate the valid message below:
Updates the session with given Hash.
Use the time in UTC for comparisons.
Verify the setting has been applied.
Verify the setting has been cleared.
Wait on the execution of all threads
You can also pass a list of modules:
account for multiline range literals
add_source "http://gems.github.com/"
and lets all the `when` nodes count.
backburner dasherizes the queue name
belongs_to :eater, polymorphic: true
both attributes differ from defaults
class Foo def self.hello "world" end
date_select("article", "written_on")
def base_uri user_path(self) end end
def evaluate_velocity(developer) ...
def show render json: record end end
discard modifier ifs and ternary_ops
don't add before first visible field
element:: XML element to be checked.
find_by_credit_limit has been cached
if cond then a elsif cond then b end
make sure to use a non-UTC time zone
make sure we get the gem, not stdlib
position in multi-line method calls.
return the only available connection
rubocop:disable Metrics/LineLength',
rubocop:enable Lint/HandleExceptions
temporary change to the topic object
this branch is reached by two tests:
to make sure layouts don't interfere
uses "nulls first" like construction
we still have 3 columns in the cache
+validates_each+ uses this validator.
8 bits per byte with one bit for sign
:call-seq: after_action(names, block)
@example bad while a .b something end
ActiveRecord::ExplainRegistry.queries
Adds a new column to the named table.
Allows to specify an order attribute:
Also available through the alias j().
Also known as accessing "the reddit".
Attach the subscriber to a namespace.
Behavior specific to functional tests
Cap primary key sequences to max(pk).
Clears the prepared statements cache.
Copyright (c) 2015-2016 Basecamp, LLC
Creates a text field of type "color".
Creates a text field of type "email".
Creates a text field of type "month".
Creates the hidden UTF8 enforcer tag.
Defaults to `180.days` (recommended).
Each row is an array of field values.
Enclosing modules are not considered.
Ensure we actually are testing a UUID
Exclude entries from source directory
FROM posts INNER JOIN comments ON ...
Fake it out with a big varchar below.
Gather up all of the SET variables...
Hold configured generators fallbacks.
If false, it would just be +product+.
If we add it to the previous example:
Implement for PostgreSQL, Oracle, ...
Internal links (anchors) are checked.
It reports the default value as null.
Let's make the HABTM fixture go away.
Map ActiveRecords param names to PGs.
Maps asset types to public directory.
Mime::Type.register "image/jpg", :jpg
Nested hash conditions with same keys
Ni-ho-nn-go in UTF-8, means Japanese.
Not all migrations change the schema.
Only ifs without else are considered.
Oracle does not have a TIME datatype.
Otherwise, the default will be +nil+.
Outputs a deprecation warning message
Populate the HTTP method lookup cache
Reloads the record from the database.
Remove the connection for this class.
Renames the given index on the table.
Render but returns a valid Rack body.
Replace progress reporter for colors.
Returns +nil+ for invalid time zones.
Returns a hash with non +nil+ values.
Returns a text_field of type "color".
Returns a text_field of type "email".
Returns a text_field of type "month".
Returns all registered helpers paths.
Returns an array of descendant nodes.
Returns an input tag of type "range".
Returns keys of the session as Array.
Returns the class name for the macro.
Returns the endpoint for this engine.
Returns the number of error messages.
Returns the size of the cached value.
Returns true if there are no records.
See ActiveModel::AttributeAssignment.
Sending attachment in emails is easy:
Some local variables fix the problem.
Store a reference to a class +klass+.
TODO use regexp instead of Date.parse
TODO: Add support for other encodings
That's why a JSON string is returned.
The HTML generated for this would be:
The available paths in an engine are:
The current iteration of the partial.
The following are all valid examples:
The hooks lookup is similar as above:
This code represents the normal case.
This cop checks for .times.map calls.
This cop checks for unreachable code.
This is what child classes implement.
This sets the foreign keys to +NULL+.
This will not affect other platforms:
Tries to behave as if it were an ORM.
Turn the session id into a cache key.
Useful for Rails::Railtie subclasses.
We only want to deal with AR objects.
Whitelisted types are returned as-is.
You must use Time.zone.today instead.
aref assignment, attribute assignment
assert_field_type :date, :date_select
assert_not foo, 'foo should be false'
asserting default value is empty hash
attr_accessor :first_name, :last_name
before_validation :remove_whitespaces
break the vanilla firm_id foreign key
class A def test puts 'hello' end end
count always trigger the COUNT query.
def self.titles pluck(:title) end end
def test_jobs assert_performed_jobs 0
def unfollow stop_all_streams end end
default wildcard match to end of list
george: id: 1 name: George the Monkey
hash:: Hash to add key/value pair to.
if true make sure every write flushes
ignore limit, use precision and scale
ignores significant it precision is 0
inflect.irregular 'octopus', 'octopi'
is then equivalent to something like:
require 'active_support/configurable'
resources :posts, path: "admin/posts"
rubocop:disable Lint/HandleExceptions
rubocop:disable Style/MutableConstant
set the q value to the max of the two
t.rename_index(:user_id, :account_id)
test including all post types at once
then dump all non-primary key columns
touch the app so the logger is set up
validates_length_of :name, maximum: 6
wait for first_thread to get in queue
wait for stuck_thread to get in queue
*  by changing renderer defaults, like
* Deletes leading underscores, if any.
* Downcases all words except acronyms.
:call-seq: around_action(names, block)
:call-seq: before_action(names, block)
:nodoc: Future people who read this...
Actions not specified are not changed.
Adds +:array+ as a valid migration key
Adds a filter from the block provided.
Asserts that no emails have been sent.
Be sure to stringify the id for routes
Checks to see if a foreign key exists.
Consider the following loop for names:
Converts a string to a DateTime value.
Creates a text field of type "search".
Define a routing concern using a name.
Delete empty directories in the cache.
Empty lines should make no difference.
Engines can have their own migrations.
Entry point for the application logic.
Extract the table from the insert sql.
Generic Active Record exception class.
How much the prefix bonus is weighted.
I18n.locale to be used during the job.
If "SSL" was defined to be an acronym:
If arel is locked this is a SELECT ...
Inner class to DeprecatedClassMethods.
It is not used in the Rails internals.
Keep track of the state of the source.
Make sure no circular dependency error
Mark the given constant as unloadable.
Name of gem where method is deprecated
Now it _is_ removed from the database:
Numeric values are treated as seconds.
Opposite to register_template_handler.
Overwrite original file with temp file
Overwrite process to setup I18n proxy.
Pass in +name+ to reset a named cycle.
Performs a left outer joins on +args+:
Possibly following a method call chain
Recognizes the route for a given path.
Recover lost connections for the pool.
Regexp filtering copied from Minitest.
Reschedules the job to be re-executed.
Returns +true+ if an entry is deleted.
Returns a hash of rows to be inserted.
Returns a hash representing the model.
Returns an input tag of type "number".
Returns the active schema search path.
Returns the application's KeyGenerator
Returns the class of the new constant.
Returns the column of the given range.
Returns the current Rails environment.
Returns the name of the mailer object.
Returns true if there are any records.
Reverse operation of unpack_graphemes.
Reverses all characters in the string.
Scopes routes to a specific namespace.
See +delete_all+ for more information.
See ActiveRecord::AutosaveAssociation.
See ActiveSupport::Inflector.pluralize
See Broadcasting for more information.
See DATE_FORMATS for built-in formats.
See http://www.json.org for more info.
See internal_methods for more details.
Serializes the relation objects Array.
Sets a new default value for a column.
Sets a new default value for a column:
Sets an HTTP 1.1 Cache-Control header.
Sets the dependency loading mechanism.
Sets which generator should be tested:
Should grab each of the splatted keys.
Slicing filters out non-declared keys.
Specify either an argument or a block.
Specifying an empty T part is invalid.
Style/IndentationWidth will handle it.
Subclasses must implement this method.
The +String+ MIME type of the request.
The Cop class is meant to be extended.
The autocorrect loop will handle that.
The cache is supposed to never expire.
The default can be changed as follows:
The hostname used in the last request.
The test will have the following name:
There are two method call chains here.
This cop checks symbol literal syntax.
This cop is used to identify usages of
This is intended to be used as mix-in.
This lets you access the variables as:
This was the default for Rails 3 apps.
To do that, use the +endpoint+ method:
Two styles are supported for this cop.
Type casts a value for schema dumping.
Used for running a specific migration.
We're only checking predicate methods.
When *not* to use transactional tests:
When the evaluated string returns true
You can also set an array of variants:
You can also use block initialization:
add_timestamps(:suppliers, null: true)
allow mass assignment when using splat
and cloned instance should behave same
and now the "real" setup for our test:
apple_george: fruit_id: 1 monkey_id: 1
async_exec in the PostgreSQL adapter.)
base table, through table, clubs table
brings setup, teardown, and some tests
checkin n connections back to the pool
create_join_table(:assemblies, :parts)
def attributes instance_values end end
def index redirect_to root_url end end
def index render "hello/index" end end
def test_jobs assert_no_performed_jobs
encoded_masked_token is invalid Base64
engines apparently don't have this set
for each of before, after, and around.
give threads time to do their business
grape_george: fruit_id: 3 monkey_id: 1
https://bugs.ruby-lang.org/issues/7166
make sure readers methods get compiled
make sure we have an active connection
module M extend ActiveSupport::Concern
rename tables with reserved-word names
resources :posts, path: "/admin/posts"
scope "/admin" do resources :posts end
select_date(my_date, prefix: 'payday')
select_day(my_date, field_name: 'due')
select_hour(13, prompt: 'Choose hour')
select_year(14, prompt: 'Choose year')
some of the listeners might have state
test if the attributes have been duped
this thing was done because of a bug',
use indent from Style/IndentationWidth
wait for second_thread to get in queue
with_backend should be thread-safe" do
*_action is the same as append_*_action
-- this is unfortunately not concurrent
:nodoc: needed for rails `rails routes`
@bad method1(method2 arg, method3, arg)
A basic wrapper around Parser's tokens.
A string is required as a return value.
Add caching behavior on top of Details.
Adds +:array+ option to the default set
Aligned with start of line where do is:
Also allow options hash, so you can do:
Also, brings two convenience accessors:
An object is present if it's not blank.
And the expected template will be used.
Appends the contents for the given key.
But doesn't modify the original string:
Called before any initializers are run.
Checks for comma (,) preceded by space.
Checks the spacing around the keywords.
Clear attributes and changed_attributes
Common functionality for modifier cops.
Concrete subclass of an abstract class.
Cookies can typically store 4096 bytes.
Currently it checks for code like this:
Default form builder for the controller
Defaults to 'application/octet-stream'.
Define log for backwards compatibility.
Enable origin-checking CSRF mitigation.
Encapsulates the notion of a mime type.
For example, with the following models:
For instance, take the following tests:
For more information check to_i method.
For single line ranges, this is simple.
If it's not duplicable, returns +self+.
If provided, prepends application path.
If there are none to keep, returns nil.
Imagine a list with two types of users:
Includes +url_for+ into the host class.
Inner if, case, rescue, or ensure node.
Install a callback for the given event.
Instantiates a new column in the table.
Keep it for indexing materialized views
Make sure we're not deleting everything
MySQL doesn't support DDL transactions.
Necessary to get rerun-snippts working.
New comment creates a new Notification.
No: The job is run in the same process.
Normalize both text and status options.
Not a one-liner, so this is an offense.
Only permitted scalars pass the filter.
Oracle UPDATE does not support ORDER BY
Other data types need to be serialized.
Otherwise, an exception will be raised.
Otherwise, it returns the current time.
Performs the actual template rendering.
Provides methods for traversing an AST.
Raised on attempt to save stale record.
Regional_Indicator X Regional_Indicator
Remove leading slashes from controllers
Removes the given index from the table.
Removes the named method, if it exists.
Return a recursive merge of two hashes.
Returns a derived key suitable for use.
Returns nil if nothing should be added.
Returns sql statement for the relation.
Returns string to use for params names.
Returns the +i18n_scope+ for the class.
Returns the current database collation.
Returns the primary key previous value.
Returns true if the date/time is today.
Returns true if the number is negative.
Returns true if the number is positive.
Returns values of the session as Array.
Ruby 1.9 only supports basic whitespace
Runs the callbacks for the given event.
Scope all queries to the current scope.
See QueueAdapters for more information.
See the class hierarchy in Association.
Set a prefix/suffix we can test against
Set the specified association instance.
Set the view flow to support streaming.
So +associations+ could look like this:
So there is no need to eager load them.
Specify trim mode for the ERB compiler.
Split the class from its module nesting
Stores the default scope for the class.
Style/LambdaCall checks for this syntax
The +options+ hash is passed downwards:
The alias for the active_record's table
The basename of the file in the client.
The default 'now'::date is CURRENT_DATE
The request body is an IO input stream.
The serialization is done through YAML.
The specifics differ between databases.
This cop mirrors a warning in Ruby 2.2.
This interceptor is enabled by default.
This is different from non STI classes:
This method also does namespace lookup.
This method is redefined by subclasses.
This should be a lambda to be executed.
Title order scope should not apply here
Turn unwanted chars into the separator.
Unregistered MIME Type can't be parsed.
Usually a database-dependent operation.
We should push this separation upstream
When the evaluated string returns false
Workers are forked webserver processes.
class Base class_attribute :setting end
class Person include ActiveModel::Dirty
config.middleware.use Magical::Unicorns
confirm the custom sequence got dropped
def down drop_table :job_levels end end
define_model_callbacks :create, :update
dummy config for a generic cop instance
foo_url(bar, baz, bang, sort_by: 'baz')
foo_url(bar: bar, baz: baz, bang: bang)
get_header "HTTP_ACCEPT_CHARSET".freeze
hash_for_location for :location key' do
https://bugs.ruby-lang.org/issues/10856
ignore Java interop code like Java::int
options - optional Hash of the options.
orange_george: fruit_id: 2 monkey_id: 1
records are quoted as their primary key
remove_foreign_key :accounts, :branches
returns empty hash if no query present.
t.string(:goat) t.string(:goat, :sheep)
the variable could evaluate to an array
-- This class defines several callbacks:
@overload each_ancestor Yield all nodes.
A block for changing columns in +table+.
A string with the MIME type of the file.
Accept any node type for top level scope
ActionController::Renderers.remove(:csv)
Adds a silencer from the block provided.
Asserts that no jobs have been enqueued.
Attributes must be strings, not symbols.
Build a list of candidates to search for
Checks for spaces inside range literals.
Comment lines can optionally be ignored.
Compare this time zone to the parameter.
Compute extname to append to asset path.
Computes asset path to public directory.
Create a new file in the lib/ directory.
Creates a text field of type "datetime".
Declare a controller method as a helper.
Decrement an integer value in the cache.
Default warning behaviors per Rails.env.
Defaults to the root of the application.
Delegates to the class' ::action_methods
Delete the initializers unless requested
Enable the query cache within the block.
Expands a connection string into a hash.
If it's zero, we can have our table_name
If the key is not found nothing is done.
Ignore that the client has disconnected.
In any case the status flag is returned.
Increment an integer value in the cache.
Instantiates a new column for the table.
Instead, use RemoteConnections for that.
It can only be called with dot notation.
It should never be called on user input.
Let's explain with a full-stack example:
Load routes.rb if it hasn't been loaded.
Make list points stand on their own line
Make sure squish returns what we expect:
Mixing any of Y, M, D with W is invalid.
Most objects are cloneable, but not all.
Note: No Lint/UselessAssignment offense.
Notifier.welcome(User.first).deliver_now
Otherwise the root element is "objects":
Please choose another application name."
Providing a custom Rails::Html scrubber:
Raised when an attribute is not defined.
Raw rendering of a template to a string.
Read the request body by parsing params.
Removes the specified key from the hash.
Reset hash and Assign the new session id
Returns a parameter for the given +key+.
Returns a text_field of type "datetime".
Returns the database collation strategy.
Returns the next date in this time zone.
Returns true if the collection is empty.
See +start_exclusive+ for other options.
See ActiveSupport::Inflector.constantize
See DATE_FORMATS for predefined formats.
See PostgresqlCompositeWithCustomOIDTest
See calculate for examples with options.
Set the authorized user for this session
Set the inverse association, if possible
Sets the destination of generator files:
Sets the name of the primary key column.
Skip a before, after or around callback.
Store for all cops with helper functions
Symbol representing current environment.
TODO: Remove once this is fully in place
The RubyGems version, if it's installed.
The list of rescued classes is an array.
The maximum line length is configurable.
This class handles command line options.
This cop checks for empty interpolation.
This fixture file includes two fixtures.
This is the default starting in Rails 4.
This means we can get the template back.
This test requires a block that is empty
Turned off by default only in test mode.
Whether to print a message (silent mode)
Which will then result in the following:
Will throw an error, but this will work:
You may pass HTML options there as well.
You never instantiate your mailer class.
assert_threads_not_stuck can now proceed
assuming the associated person has ID 1.
class Todo Other todo implementation ...
datetime_select("article", "written_on")
def volume_adjustment super.to_i end end
delegate :env, :request, to: :controller
element:: XML element to merge into hash
ensure that railties are not added twice
finally, the dependency name of interest
generate(:authenticated, "user session")
https://github.com/jruby/jruby/pull/2562
introspect table with reserved word name
message is deprecated and has no effect.
namespace :admin do resources :posts end
remove the column +name+ from the table.
returned conn needs to be already leased
rubocop:disable LineLength,ClassLength',
rubocop:disable Lint/UselessAssignment',
rubocop:disable Style/IndentationWidth',
rubocop:enable Style/ZeroLengthPredicate
select_date(my_date, discard_type: true)
select_month(14, prompt: 'Choose month')
use timezone which does not observe DST.
value:: Value to be associated with key.
with anything inside, captured as STATIC
-- Defines the standard inflection rules.
-- Must be called in a synchronize block.
@example This is considered bad practice:
@example bad def set_attribute(value) ...
A low-cruft shortcut to define a concern.
A sample controller could look like this:
Add the submit button for the given form.
Allows to set the name of current mailer.
Also accepts an array of possible values.
An engine can also be a rack application.
And a database.yml that looked like this:
Another round of autocorrection is needed
Arbitrary Ruby objects are not supported.
Asserts a given migration does not exist.
Asserts that an expression is not truthy.
Asserts that no jobs have been performed.
Avoid introspection queries during tests.
Basically there are two different styles:
By default, save always runs validations.
Cache the templates returned by the block
Check if any of the entries were updated.
Checks for spaces inside square brackets.
Common functionality for safe assignment.
Construct the source code for the braces.
Consult the Rails Testing Guide for more.
Convenience method for SecureRandom.uuid.
Conversation.active Conversation.archived
Declares a concern but doesn't include it
Decrements an integer value in the cache.
Default to enabled, with default options.
Delegates to the class' ::controller_path
Disable the query cache within the block.
Discard modifier forms of if/while/until.
Download a dynamically-generated tarball:
Ensure this is above your JavaScript tag:
Example: drop_database 'matt_development'
Extracts options from a set of arguments.
FIXME: Test behavior, not implementation.
Force loading the collection from the db.
Generate the special pages like the home.
Get the reference for class named +name+.
Ignore it when generating English guides.
Increments an integer value in the cache.
Inserts the given fixture into the table.
Load fixtures once and begin transaction.
Looks up month names by number (1-based):
Loop body nodes need to be scanned first.
Method call with dot on a string literal.
More lazy-loading to keep load time down.
NOTE: It's not possible to set the order.
No lexical context is taken into account:
One layer deep hash of connection values.
Only check method calls with dot operator
Only files with annotations are included.
Procs::   A proc to call with the object.
Raise AbstractController::ActionNotFound.
Receives a hash returned from +serialize+
Reloads the collection from the database.
Returns a new ActiveModel::Name instance.
Returns a serialized hash of your object.
Returns an ActiveRecord::Result instance.
Returns an array of all TimeZone objects.
Returns fully resolved connection hashes.
Returns the current client message level.
Returns the inverse of the given command.
Returns the last character of the string.
Say we're a Time to thwart type checking.
See RANGE_FORMATS for predefined formats.
Set the lookup ancestors for ActiveModel.
Sets the +permitted+ attribute to +true+.
Sets the behavior to the specified value.
Singular names are not handled correctly:
Something like this should look familiar:
Sources may be paths to JavaScript files.
Specify the layout to use for this class.
TODO: handle non-decimal literals as well
The child process may exit before we wait
The default sum of an empty list is zero.
The method for the form defaults to POST.
The remote_addr used in the last request.
There are a few caveats with this module.
There would be false positives otherwise.
This can be overwritten when invoking it.
This can be used to pass mass assignment.
This cop checks for empty `ensure` blocks
This is a class to fix I18n global state.
This is checked by Style/SpaceAfterComma.
This method accepts any of the following:
To support these, we must use a subquery.
Unpack the string at grapheme boundaries.
Use a numeric with precision 0 instead.")
Validates each attribute against a block.
We merge in these scopes for two reasons:
We need to avoid the following situation:
Will search for the following generators:
attr_accessor :connection_handler end end
attr_accessor :name attr_reader   :errors
avoid name clashes between temp variables
call format block with variants collector
check_class_collision suffix: "Decorator"
creates the migration file for the model.
data:: XML Document string or IO to parse
deals with case-insensitive file systems.
def my_method 'some complex call' end end
default_scope without a block is removed.
discard cases with argument destructuring
eager_autoload do autoload :Cache end end
https://github.com/jruby/jruby/issues/405
must use value to prevent double-escaping
name is explicitly set in the controller.
only the last concatenation is an offense
other - The ActiveModel::Errors instance.
populate the cache with the SELECT result
reginald: id: 2 name: Reginald the Pirate
registry.value_for(:current_scope, Board)
remove_column(:suppliers, :qualification)
restarg and kwrestarg would have no name:
rubocop:disable Style/ZeroLengthPredicate
select_date(my_date, date_separator: '/')
select_time(my_time, time_separator: ':')
should update when assigning a new record
tables is deprecated without replacement.
test/unit backwards compatibility methods
the attribute may be an aliased attribute
use normal delegation to record the block
uses sql function with multiple arguments
validates_associated :pages, :library end
(So 'puts' is not dangerous but 'new' is.)
(if (lvar :foo) nil (lvasgn :foo (int 1)))
+titleize+ is also aliased as +titlecase+.
- +action+: The controller action to call.
- OID is an integer representing the type.
@example Bad raise RuntimeError, 'message'
@good if condition do_x else do_y end do_z
@overload each_child_node Yield all nodes.
@overload each_descendant Yield all nodes.
@see http://rubydoc.info/gems/ast/AST/Sexp
Adapter used for all streams/broadcasting.
Allows you to make aliases for attributes.
Also accepts an Array of attribute hashes:
And retrieved again through the same hash:
CREATE INDEX by_name ON accounts(name(10))
Calls the given block for each child node.
Changing file ownership failed, moving on.
DatabaseTasks.create_current('production')
Declare that a method has been deprecated.
Emails do not support relative path links.
Encode the given object into a JSON string
FROM posts INNER JOIN categories_posts ...
For example, the following database.yml...
Handles adding and checking ignored nodes.
Hangul character boundaries and properties
INNER JOIN comments special_comments_posts
In those cases, we'll set up a simple mock
It is not applied while updating a record.
It mainly supports the methods on Numeric.
Joins that are also marked for preloading.
Leaving the hash off gives the wrong link:
Make sure a file path's directories exist.
Most of the time it returns a +nil+ match.
NOTE: Discarded selects will default to 1.
Nested hash conditions with different keys
Note: SQLite doesn't support index length.
ON DELETE RESTRICT is the default on MySQL
PATCH/PUT /books/1 PATCH/PUT /books/1.json
Remove the file path from the loaded list.
Returns +true+ if the collection is empty.
Returns +true+ if the record is read only.
Returns a hash containing  the given keys.
Returns an array with the deleted records.
Returns an array with the removed records.
Returns fully resolved configurations hash
Returns the human name of the column name.
Same as +deep_merge+, but modifies +self+.
Second request does not access the session
See ERB documentation for suitable values.
See rubocop/cop/style/block_delimiters.rb.
Selected adapters support index sort order
Sets the precision of encoded time values.
Should convert to a Hash with String keys.
That's what you want the bulk of the time.
The +source+ can be a full path or a file.
The cycle helper depends on this behavior.
The driver calls +env+, +url+, and +write+
The methods which wrap a form helper call.
The precise error is added in the message.
This cop checks for interpolated literals.
This cop checks for redundant parentheses.
This example places a string in the flash.
This is called for each scope recursively.
This is the historical behaviour for true.
This is used in the StatementCache object.
This method is also aliased as +to_param+.
This method is defined to be able to write
This method is the opposite of add method.
This method should not be called directly.
Timestamp when the job should be performed
Timestamping can be turned off by setting:
Transmit a hash of data to the subscriber.
UUIDs are RFC 4122 version 5 SHA-1 hashes.
WARNING: content_for is ignored in caches.
We are able to call the methods like this:
Zero parts are removed as not significant.
adding 1 sec springs forward to 3:00AM EDT
advance the time by a fraction of a second
allow thread 2 to finish but hold thread 1
change_column_default(:users, :email, nil)
development: secret_key_base: 'secret key'
find all migration keys used in this table
https://github.com/jeffkreeftmeijer/fuubar
https://github.com/rails/rails/issues/8442
no destroy-filters should have been called
posts.first will be ordered using id only.
preload instance variables before freezing
rails generate controller Account --webrat
receiver and selector are on the same line
regression test, from problem in Locatable
remove_index :accounts, column: :branch_id
resources :magazines do resources :ads end
select_day(5, use_two_digit_numbers: true)
select_hour(my_time, field_name: 'stride')
some important methods on Module and Class
ten: one: Ten other: Tens hundred: Hundred
test generating engine's route from engine
threads that successfully got a connection
we haven't observed any specific style yet
(So 'puts' is not dangerous but 'save' is.)
* Replaces underscores with spaces, if any.
+message+ is treated the same as for +add+.
- +env+: Additional env to pass, as a Hash.
@example EnforcedStyle: assign_to_condition
@good class C def self.method puts 'hi' end
A single entry in the routing file, such as
Aligned with start of the whole expression:
Allow code like `raise Ex.new(arg1, arg2)`.
Also removes a +type+ column if one exists.
By default this behavior is an ajax submit.
By default, the prefix is the empty string.
By default, the suffix is the empty string.
Coerces time to a string for JSON encoding.
Common functionality for checking if nodes.
ConfigLoader.load_file will validate config
Convert to a regular hash with string keys.
Creates a schema for the given schema name.
Destructively converts all keys to strings.
Developers are ordered 'name DESC, id DESC'
Don't check method calls with dot operator.
Drops the schema for the given schema name.
Establishes the connection to the database.
FROM posts INNER JOIN comments_posts ON ...
Functional tests are written as follows: 1.
Get a list of the constants that were added
Gets a new instance of a controller object.
Hashes and Arrays can also be used as keys.
Here we go back an indentation level again.
Holds accessors for the registered details.
If in the "about" action, it will render...
If the match fails, `nil` will be returned.
If they are both set, it means that either:
Initialized with URL configuration strings.
Instrumenters are stored in a thread local.
LITERAL_REGEX takes all that into account.)
Mark the matching character as already used
More information can be found in Arguments.
N/A: The adapter does not support queueing.
Need to remove unnecessary encoding comment
No EnforcedStyle can allow both alignments:
No more than one of the separator in a row.
No rails cops include app/views by default.
Normalizes +controller_class+ before using.
Options can be passed in the last argument.
Otherwise, returns the result of the block.
Otherwise, the key +:name+ is filtered out.
Part of any hash containing the :layout key
Performs composition on all the characters.
Performs validation on the supplied record.
Precision inherited and significant was set
Quotes column names for use in SQL queries.
Quotes schema names for use in SQL queries.
Rack doesn't handle multipart/mixed for us.
Rename :minute and :second to :min and :sec
Replace this collection with +other_array+.
Replaces the hash with only the given keys.
Returns an HTML audio tag for the +source+.
Returns an HTML image tag for the +source+.
Returns the current date in this time zone.
Returns the file mtime from the filesystem.
Returns the id attribute for the input tag.
Returns the maximum length of a table name.
Returns the maximum length of an SQL query.
Sanity check, make sure other columns exist
See if it's actually a masked token or not.
See method_for_action for more information.
Sends the given binary data to the browser.
Set controller variables on initialization.
Sets the HTTP response's content MIME type.
Sets the order in which test cases are run.
TODO: This is currently handled inside ERB.
Tests the controller dispatching happy path
The default view class is ActionView::Base.
The maximum allowed length is configurable.
The option symbols for setting cookies are:
The time is parsed using Time.parse method.
There could be a custom cop with this name.
This cop checks for unused block arguments.
This cop checks for uses of *and* and *or*.
This helper works just like normal helpers.
This is the inverse of +assert_recognizes+.
This is the main entry point for rendering.
This method is opposite of register method.
This operation will affect filesystem ACL's
This will create 1000 very simple fixtures.
This write will block, and eventually raise
To instrument an event you just need to do:
Useful for performing authorization checks.
You can also use a block and a module list:
You can reload routes if you feel you must:
You still need to set up model validations.
`format.html.phone` - variant inline syntax
account for edge case of Constant::CONSTANT
alias_method :after_initialize, :after_save
assert_redirected_to page_url(title: 'foo')
asserting that there was an argument at all
before_destroy :log_children, prepend: true
change_column_null(:users, :nickname, true)
class Film include ActiveModel::Validations
class Person extend ActiveModel::Naming end
clear cache possibly created by other tests
cookies.delete(:name, domain: 'domain.com')
create_generated_attribute(:string, 'name')
def action_before_create Your code here end
def test one two three return something end
ensure that bin/rails has proper dummy_path
if it's a hangul syllable starter character
leave other tests as unaffected as possible
minus 2 because node.loc.line is zero-based
module MyLib extend ActiveSupport::Autoload
optional opening paren surrounded by spaces
pop the first welcome message off the stack
precondition, make sure there are comments.
select_minute(14, prompt: 'Choose minutes')
select_second(14, prompt: 'Choose seconds')
select_time(my_time, include_seconds: true)
should update when assigning a saved record
to see if strip_insignificant_zeros is true
to work in contexts like rspec before(:all)
to_s with arguments in an interpolation' do
validate :instance_validations, on: :create
wait until the 'other process' has the lock
* +updated_at+/+updated_on+ are not updated.
2 is for spaces on left and right of keyword
4 significant digits, so only 1 decimal here
:builder, etc, shouldn't be added to options
:call-seq: append_after_action(names, block)
A list of all available normalization forms.
AbstractController::Base is a low-level API.
Add files that should be watched for change.
Also, IP address spoofing is not that hard.)
Apparently it will be changed in the future.
ApplicationController.render template: '...'
Both 'files' and 'fuubar' start with an 'f'.
By default address is equal localhost:11211.
By default, the value is "schema_migrations"
Called by _layout_for to read stored values.
Calling +try+ on +nil+ always returns +nil+.
Changes the default value of a table column.
Check for cross-origin JavaScript responses.
Classes and ids for CSS are easy to produce:
Common Active Support usage in Action Mailer
Consider a Member model that has one Avatar:
Create a new +RemoteIp+ middleware instance.
Create a scope and build a fixture rails app
Defaults to true for development environment
Do not escape templates of these mime types.
Example: rename_table('octopuses', 'octopi')
Expands key to be a consistent string value.
FIXME: tt.eclosure is not needed for the GTG
For example, lines like "else do_something".
For example, the call above is converted to:
Force to clear the transaction record state.
Freeze so changes aren't accidentally pushed
Guard clause is for nodes nested within mlhs
Holds static data from the Unicode database.
If something went wrong, revert the version.
If you want to disable color in console, do:
Insert node hash into parent hash correctly.
Invoked at the end of inspecting each files.
Invoked once before any files are inspected.
It accepts two parameters on initialization.
Matches a url pattern to one or more routes.
Most actions are variations on these themes.
Most useful for unit and functional testing.
Note: only supported by PostgreSQL and MySQL
Oracle needs primary key value from sequence
Oracle/SQLServer supports precision up to 38
Otherwise, +to_param+ method will be called.
Part of any hash containing the :partial key
Provide some controller to run the tests on.
Quote date/time values for use in SQL input.
Raised when a given database does not exist.
Raised when a required parameter is missing.
Replaces current hash with non +nil+ values.
Replaces this collection with +other_array+.
Response headers start out with the defaults
Restore prefix/suffix to its previous values
Returns +true+ if string has utf_8 encoding.
Returns +true+ if the record could be saved.
Returns all of the available email previews.
Returns an HTML video tag for the +sources+.
Returns an array of column names as strings.
Returns secrets added to config/secrets.yml.
Returns the maximum length of a column name.
Returns the maximum length of a table alias.
Returns the maximum length of an index name.
Returns the previous date in this time zone.
Returns true if there is exactly one record.
Rollback changes if a transaction is active.
See +ClassMethods.set_callback+ for details.
See _insert_callbacks for parameter details.
Set the i18n scope to overwrite ActiveModel.
Sets the defaults through app configuration:
Show help message with available generators.
So pass the file name without the extension.
So you'd have a concern something like this:
The first pair is always considered correct.
The prefixes used in render "foo" shortcuts.
The response can be committed multiple times
The underlying body, as a streamable object.
The upwards search is stopped at this level.
There are two ways to mitigate this problem.
These arguments can be a String or a Symbol.
This allows us per-connection tailored tags.
This can be done by overwriting this method.
This cop checks for unncessary array splats.
This cop checks for unused method arguments.
This cop checks for uses of class variables.
This is an exercise in Ruby hyperrealism :).
This is commonly needed for tree structures.
This is only slow if it's being listened to.
This processes the action in a child thread.
Those points are going to be addressed soon.
Use a local cache for the duration of block.
Used to drop all cache query plans in tests.
We assume these things about the IP headers:
Will be corrected by IndentationConsistency.
Writes an entry to the cache implementation.
Writes the value to the cache, with the key.
You can also pass a string which will expand
You can also use custom deprecator instance:
You may choose to set the following options:
Your database does not support transactions.
`private_class_method` can be used for that.
change_column_null(:users, :nickname, false)
check if the line has layout key declaration
check that we have usual block or block pass
def capitalized_name name.capitalize end end
def down drop_table :system_settings end end
eat the entire comment and following newline
encoding: utf-8 Copyright (c) 2015 Acme Inc.
hash:: Hash to add the converted element to.
helpers/abc_helper.rb should not be included
http://www.iana.org/assignments/media-types/
look inside parentheses around the condition
module Current thread_mattr_reader :user end
module Current thread_mattr_writer :user end
resources :photos do resources :comments end
select_minute(my_time, field_name: 'moment')
select_year(Date.today, field_name: 'birth')
should be all good w/ a custom sequence name
subtracting 1 sec goes back to 1:59:59AM EDT
test if the attribute values have been duped
you define a class that extends this module:
+schema+ is nil if not specified in +string+.
- SQLite3 stores a float, in violation of SQL
:call-seq: append_around_action(names, block)
:call-seq: append_before_action(names, block)
:call-seq: prepend_after_action(names, block)
A similar thing happens with the other cases.
Adjust indentation of `lines` to match `node`
An empty array is returned if none are found.
By default, they output XHTML compliant tags.
Clears all of the validators and validations.
Close should put the adapter back in the pool
Common functionality for checking hash nodes.
Consider a member that has a number of posts:
Conventionally named column for counter_cache
Create and initialize a new Session instance.
Creates a +model_name+ method on your object.
Creates a foreign key name from a class name.
Customer.where(balance: Money.new(20, "USD"))
Define a route that only recognizes HTTP GET.
Define a route that only recognizes HTTP PUT.
Defunct wrapper class kept for compatibility.
Encoding comments will override this setting.
Ensure backward compatibility with Minitest 4
Execute this migration in the named direction
Files with a mtime in the future are ignored.
For namespaced routes, like +admin_post_url+:
Handle *_before_type_cast for method_missing.
Helpful when using currency formats like INR.
If an order is supplied it will be respected.
If it's not, it will execute the given block.
If the +phrase+ isn't found, nil is returned.
In strict mode, column.default should be nil.
In which case we should just eager load them.
It allows setting your own resolving pattern.
It is also possible to supply a custom value:
It's just an alternative to if/elsif/elsif...
Let's make our predicate matchers read better
Load console and invoke the registered hooks.
Loads the ORM::Generators::ActiveModel class.
Note about replacing already defined headers:
Note that the request method is not verified.
Note: SSEs are not currently supported by IE.
Only makes sense for number-based attributes.
Prevent CSRF attacks by raising an exception.
Reads an entry from the cache implementation.
Reads multiple values at once from the cache.
Rely on OpenSSL for the initialization vector
Remove a connection from the connection pool.
Remove all set callbacks for the given event.
Removes the column from the table definition.
Removes the given foreign key from the table.
Require `belongs_to` associations by default.
Returns +nil+ if there are no key attributes.
Returns +true+ if Active Record is connected.
Returns a full message for a given attribute.
Returns the current ID of a table's sequence.
Returns the current database encoding format.
Returns the name attribute for the input tag.
Returns the number of days in the given year.
Returns the number of seconds since 00:00:00.
Returns the number of seconds until 23:59:59.
Returns the source of the through reflection.
Returns true if relation needs eager loading.
Returns true if the collections is not empty.
Returns true if the date/time is in the past.
Runs the generator configured for this class.
Same as +transform_keys+ but modifies +self+.
Saving is not subjected to validation checks.
See ActiveSupport::Inflector.safe_constantize
Set the column to use for optimistic locking.
Set the config option which will be overriden
Set the host name to use in the next request.
Sets the owner attributes on the given record
Sets the token value for the current session.
Should only need to load the association once
Simulate loading an existing user from the DB
Slices a hash to include only the given keys.
Spaces are stripped from the resulting string
Specifically, performs these transformations:
Specify default_formats that can be rendered.
Style/SpaceBeforeComma, Style/SpaceAfterComma
Superclass for all database execution errors.
Technically other types of keys are accepted:
That's how you typically work with resources.
That's the case with our +balance+ attribute.
The application's location on the filesystem.
The default ConnectionPool maximum size is 5.
The following call would generate such a tag:
The following code will resolve the constant:
The format of a fixture file looks like this:
The location header we'll be responding with.
The name of the key on the associated records
The table names appear in alphabetical order.
The two main methods for testing your routes:
Then the new value is appended to that Array.
There's no limit to the depth of the nesting.
These concerns are used in Resources routing:
This cop checks for calls to debugger or pry.
This cop checks for redundant `begin` blocks.
This cop checks for redundant uses of `self`.
This cop looks for uses of flip flop operator
This cop uses them as dividers in rails mode.
This cops checks the indentation of comments.
This cops looks for uses of global variables.
This generates the following comments routes:
This is a sync queue, so there is no waiting.
This is a thread locals registry for EXPLAIN.
This is for clearing cache on the reflection.
This mapping belongs to the public interface.
This method needs to create a temporary file.
This will match if, case, begin, blocks, etc.
Value Object to hold a schema qualified name.
Verify the connection param has been applied.
When a job will stop after the allotted time.
When using the `symmetrical` (default) style:
Which means that the given method is private.
Wraps the parameters hash into a nested hash.
X-Special-Domain-Specific-Header: SecretValue
You can also search for specific attachments:
You can pass a symbol or an array of symbols.
You can set the variant in a +before_action+:
You can then broadcast to this channel using:
You can then use that variable anywhere else.
`format.html` - just a format, call its block
add_index(:developers, :name, using: 'btree')
characters with no special meaning whatsoever
class Account thread_mattr_accessor :user end
class BlogPost extend ActiveModel::Naming end
class Person include ActiveModel::Validations
class Pet validates :name, presence: true end
constraints(Iphone) do resources :iphones end
dispatches to the *method*, not the attribute
don't rely on the return value of the handler
get rid of it so Student is still like it was
hash_for_offense values for :offenses key' do
hold the lock open until we tested everything
namespace :posts do concerns :commentable end
not all valid keys are required to be present
original values should be in previous_changes
prepare the reload statement in a transaction
resources :posts do concerns :commentable end
scope module: "admin" do resources :posts end
select_month(Date.today, field_name: 'start')
skip_before_action :verify_authenticity_token
this modifies the passed request_env directly
track any join tables we need to insert later
unicorn_rails --config-file unicorn.config.rb
validates_presence_of :name, strict: true end
when out of range of Time, returns a DateTime
"rails:webrat", "webrat:integration", "webrat"
* +env+: current environment (like Rails.env).
* session: Objects being saved in the session.
+permitted+ state is kept on the duped object.
:call-seq: prepend_around_action(names, block)
:call-seq: prepend_before_action(names, block)
:nodoc: Rails does not generate anything here.
:nodoc: Scopes routes to a specific controller
A suffix for the line after the closing brace.
Actually, that exposure is automatically done.
Adds a new key/value pair to an existing Hash.
All other types are serialized using GlobalID.
Also an offense since previous was multi-line:
An abstract definition of a column in a table.
Assign the rendered format to look up context.
Association name or counter name can be given.
Be warned that your attributes are not copied.
Can be used at render time, for example, with:
Checks for uses of semicolon in if statements.
Clear the new record state and id of a record.
Common functionality for handling parentheses.
Consider using the exec_query wrapper instead.
Convert an XML element and merge into the hash
Creates a text field of type "datetime-local".
Default concurrency setting: enabled, but safe
Define a route that only recognizes HTTP POST.
Destroy all the records from this association.
Display an image Active Record in the browser:
Do nothing, even if we know this is dangerous.
Ensures the time cannot be modified by client.
Example: javascript_tag "alert('All is good')"
Extracts the first line out of the description
Get the statistics from the memcached servers.
Helper to define a test method using a String.
Hidden subdirectories should also be excluded.
INNER JOIN comments special_comments_posts ...
If nil is passed, current time in UTC is used.
If no id is found, prefix with "new_" instead.
Including in a class uses an inheritable hash.
Initialize an empty model object from +coder+.
Initializes and connects a PostgreSQL adapter.
Inserts new code after the given source range.
It can also be used with an explicit receiver:
It is also possible to supply a custom prefix.
Let's break out some more monkeys and pirates.
Loop prevention for validation of associations
Make sure the pool marks the connection in use
Mark the provided constant name for unloading.
Match the class name against the given regexp.
MySQL does not allow default values for blobs.
Note that this is not just a usage suggestion.
Note: This assertion is simply a shortcut for:
Nothing will be appended to the errors object.
Notice that :stream only works with templates.
Oracle doesn't differentiate between date/time
Override methods to perform custom processing.
Payment.order("created_on").find_by_amount(50)
Performs parameters wrapping upon the request.
Provides helper methods for testing Active Job
Raised when attribute values are out of range.
Resolves a constant from a minitest spec name.
Returns +self+ so method calls may be chained.
Returns +true+ if the collection is not empty.
Returns a formatted string ready to be logged.
Returns a new date/time representing tomorrow.
Returns a text_field of type "datetime-local".
Returns all rails groups for loading based on:
Returns the number of days in the given month.
Returns the order in which test cases are run.
Returns the original name for the alias +name+
Returns the tail of the array from +position+.
Returns the underlying TZInfo::TimezonePeriod.
Returns true if there is more than one record.
Same as +stringify_keys+, but modifies +self+.
Same as +symbolize_keys+, but modifies +self+.
See Time::DATE_FORMATS for predefined formats.
See the docs of the method `converted_arrays`.
Silence deprecation warnings within the block.
That means it does not have headers or a body.
The autofixer will default to `start_of_line`.
The current set of inflection rules is frozen.
The prefix is a generation timestamp (in UTC).
These will be added to all created paragraphs.
This class is used to represent cache entries.
This cop checks for nested method definitions.
This cops checks for inconsistent indentation.
This method is invoked when a log event occurs
This method outputs without escaping a string.
This method should return a hash with assigns.
This reduces the total number of queries to 3.
Treat begin..rescue..end with retry as a loop.
Types should not need to override this method.
User-Agent: curl/7.43.0 X_Custom_Header: token
We indicate the position after the left brace.
You can also set the answer format, like this:
You can change it by providing the :as option:
You can use any queue implementation you want.
_fixture: model_class: User david: name: David
a little duplication to construct less strings
add_index(:developers, :name, type: :fulltext)
add_reference(:products, :user, type: :string)
assert_field_default_value :string, "MyString"
class Account include ActiveSupport::Callbacks
class BookCover extend ActiveModel::Naming end
class Comment include ActiveModel::Validations
class MyClass include ActiveModel::Validations
config.middleware.delete ActionDispatch::Flash
def decrypt(value) Secrecy is unveiled end end
def some_method(foo) do_something(binding) end
define_attribute_methods :name, :age, :address
fk_test_has_fk should be before fk_test_has_pk
https://github.com/bbatsov/rubocop/issues/1115
let's wait a bit to ensure there's a new mtime
make sure our thread is in the timeout section
only predicate methods are handled differently
options are passed correctly to the resolvers.
pool allows for concurrent connection creation
rakefile('seed.rake', 'puts "Planting seeds"')
remove_index :accounts, name: :by_branch_party
rename_column(:suppliers, :description, :name)
search(options.slice(:mass, :velocity, :time))
see: https://github.com/rails/rails/pull/12185
select_second(my_time, field_name: 'interval')
simulate bad fixture or column with no default
strip create_definitions and partition_options
test both has_many and has_and_belongs_to_many
this should be overridden by concrete adapters
we will catch this in the `casgn` branch above
* A flat collection (see +options_for_select+).
+DateTime+ objects have their time set to 0:00.
+name+ The name of the attribute being defined.
+titleize+ is meant for creating pretty output.
- The block will be run without doing anything.
:nodoc: Returns the target association's class.
@bad rand 1 Kernel.rand(-1) rand 1.0 rand(-1.0)
@davey_mcdave doesn't have any author_favorites
@example bad def bake(pie: pie) pie.heat_up end
@example bad def test if something work end end
A hook to be overridden by association modules.
A sample metal controller might look like this:
Abstract representation of a column definition.
An in-memory backend suitable only for testing.
Any cleanup needed when channel is unsubscribed
As you see the proc takes a +source+ parameter.
Assigns the given +value+ to the +params+ hash.
By default, the value is "ar_internal_metadata"
Calculates the average value on a given column.
Calculates the maximum value on a given column.
Calculates the minimum value on a given column.
Calculates the sum of values on a given column.
Check ActiveModel::Naming for more information.
Checks for uses of if with a negated condition.
Clean the +Errors+ object if instance is duped.
Cleanups the cache by removing expired entries.
Computes the path to asset in public directory.
Configure generators for API only applications.
Controls whether a CSRF failure logs a warning.
Converts characters in the string to lowercase.
Converts characters in the string to uppercase.
Converts just the first character to uppercase.
Count the number of authors for approved topics
Creates a new table with the name +table_name+.
Custom sanitization rules can also be provided.
Defaults to the polymorphic_url for the record.
Define a route that only recognizes HTTP PATCH.
Define the configuration object for the engine.
Defines an attribute with a type on this model.
Deletes an entry from the cache implementation.
Disable dependency loading during request cycle
Doesn't overwrite existing ClassMethods module.
Don't cache statements if they are not prepared
ERB::Util can mask some helpers like textilize.
Example: drop_database('sebastian_development')
Examples of using the default rails validators:
Extract handler, formats and variant from path.
First, if we DO find a template, it's rendered.
For example the +params+ hash in Ruby on Rails.
For testing layouts which are set automatically
Generates a writer method for this association.
Generators names must end with "_generator.rb".
If the beat fails, we automatically disconnect.
In other cases, it won't match any style at all
Inserts new code before the given source range.
It can be used in to load engines' seeds, e.g.:
It is internal to Rails and can change anytime.
Load schema information so we don't query below
Merge all the texts of an element into the hash
MySQL forbids defaults on blob and text columns
Now verify it's identical to a JSON round trip.
Oracle adapter truncates alias to 30 characters
Overwrite get to send SessionSecret in env hash
Overwrite run validations to include callbacks.
Pass an ActiveRecord::Relation object instead."
PostgreSQL does not use type strings for lookup
Primarily used by the grapheme cluster support.
Reload and register danish language for testing
Removes the foreign key on +accounts.owner_id+.
Replaces underscores with dashes in the string.
Rescue exceptions raised in controller actions.
Reset cache to make finds on the new table work
Return a bind param hash with format as binary.
Return true if a valid version is not provided.
Return true if we got the lock, otherwise false
Returns a chainable relation with zero records.
Returns a list of helper names in a given path.
Returns a new date/time representing yesterday.
Returns a string of the object's date and time.
Returns an ActiveModel::Name object for module.
Returns an ActiveRecord::Relation scope object.
Returns the IP address of client as a +String+.
Returns the accepted MIME type for the request.
Returns the complete URL used for this request.
Returns the default layout for this controller.
Returns the fraction of a second as nanoseconds
Returns the hash of options used for the macro.
Returns the human-readable name of the adapter.
Returns the original request URL as a +String+.
Returns the path which was unable to be loaded.
Returns the primary key value before type cast.
Returns true if record contains the foreign_key
Returns true if the application is initialized.
Returns true if the date/time is in the future.
Returns true or false if a request is verified.
Same as +transform_values+ but modifies +self+.
See ActiveRecord::Inheritance for more details.
Sets default arguments on generator invocation.
Sets the model +attributes+ from a JSON string.
Sets the value to the global or compile default
Should replace the hash without the given keys.
Some of these gems do not call to_s implicitly.
Specifies locking settings (default to +true+).
Stores the current environment in the database.
TODO: limit: nil should work with all adapters.
Temporary skip passing the details_key forward.
The allowed range of precision is from 0 to 6")
The exact number varies by browser and version.
The following example demonstrates the problem:
The proxy class returned when calling mb_chars.
The request that the response is responding to.
The version column used for optimistic locking.
This cop checks for the use of the send method.
This cop checks for uses of `fail` and `raise`.
This means you can define tables, indexes, etc.
This method also supports multi-line arguments.
To use the csv renderer in a controller action:
Useful in cases when you are rendering a :file.
Uses the same rules as ActiveRecord::Base.find.
Using pluralization (Ten/Tens and Tenth/Tenths)
Valid options are :json, :marshal, and :hybrid.
Values can be single values, arrays, or ranges.
Wraps the original exception raised as +cause+.
Wraps the underlying database error as +cause+.
Writes given value to given key of the session.
You can also pass a +block+ to define criteria.
You may also pass it multiple classes, like so:
add column type definition to our format string
added last but here is loaded before api engine
and represents time values adjusted accordingly
assert_file "db/migrate/003_create_products.rb"
asserting last argument is an optional argument
can't re-create table referenced by foreign key
class MyModel extend ActiveModel::Callbacks end
class Person include ActiveModel::Serialization
class setup method should only happen in parent
compatible thread is now able to squeak through
concern :commentable do resources :comments end
element:: The document element to be collapsed.
ensure this test can run independently of order
find_by_namespace :webrat, :rails, :integration
get 'hello', to: HelloController.action(:index)
https://github.com/whitequark/parser/issues/283
included do self.method_injected_by_foo end end
module HairColors mattr_reader :hair_colors end
module HairColors mattr_writer :hair_colors end
precision is 2, significant should be inherited
realm      - String realm to use in the header.
remove_foreign_key :accounts, column: :owner_id
remove_reference(:products, :user, index: true)
select_month(Date.today, use_short_month: true)
so fixtures aren't loaded into that environment
tables currently returns both tables and views.
test generating application's route from engine
test generating engine's route from application
the column doesn't have to be declared NOT NULL
* +fixtures_path+: a path to fixtures directory.
* +root+: a path to the root of the application.
+DateTime+ objects will have a time set to 0:00.
+command+ should be a method name and arguments.
+table_name+ may either be a String or a Symbol.
...but if in the "index" action, it will render:
@api private This is just for debugging purpose.
A common mistake -- we meant to call 'validates'
A good default is the year you created the feed.
A list of all internal methods for a controller.
A resolver that loads files from the filesystem.
Acceptable values are strings as well as regexp.
ActiveRecord::RuntimeRegistry.connection_handler
All hooks come with switches for user interface.
All implementations may not support this method.
All other types are deserialized using GlobalID.
Also look at the example for config to contrast.
Appends a column or columns of a specified type.
Arrays/Hashes are serialized element by element.
Assigns the given attributes to the association.
Autoloading recursion, expected to be discarded.
Builds hidden input tag for date part and value.
Cache fragments of a view if +condition+ is true
Can also be written as follows using references:
Check that the destroy callback on Reference ran
Checks for simple usages of parallel assignment.
Checks if we should perform parameters wrapping.
Clear the entire cache on all memcached servers.
Clears all files and directories in destination.
Common Active Support usage in Action Controller
Configure your secret key in config/secrets.yml:
Copyright (c) 2004-2016 David Heinemeier Hansson
Copyright (c) 2005-2016 David Heinemeier Hansson
Copyright (c) 2014-2016 David Heinemeier Hansson
Create a new +ParamsParser+ middleware instance.
Create a reference which is not linked to a job.
Define a new model to ensure there are no caches
Define a route that only recognizes HTTP DELETE.
Disable controller / rendering threads in tests.
Disable the transaction wrapping this migration.
First try the password as a ha1 digest password.
For instance, if we have the following template:
For the simple, default case, just copy it over.
Ignored by non-text columns (+true+ by default).
Initializes a new model with the given +params+.
It is dramatically faster than the alternatives.
It is inherited by JoinBase and JoinAssociation.
Keep a duplicate pool so we do not bother others
Load the message, which calls the mailer method.
Load the new sid to be written with the response
Loads the fixtures from the YAML file at +path+.
MySQL cannot have defaults on text/blob columns.
Nested elements yield an +AtomBuilder+ instance.
Note that this returns a string and not a class.
Order is the same as that returned by +columns+.
Otherwise, the +to_param+ method will be called.
Provides functionality for caching rubocop runs.
Raw source checksum for tracking infinite loops.
Reloads the record to obtain the requested lock.
Removes the column(s) from the table definition.
Removes the foreign key on +accounts.branch_id+.
Removes the given keys from hash and returns it.
Rendering :json or :xml with :stream won't work.
Returns +nil+ if any intermediate step is +nil+.
Returns a hash with the defined local variables.
Returns all the full error messages in an array.
Returns an array of indexes for the given table.
Returns an empty Hash if node has no attributes.
Returns the content of the response as a string.
Returns the fraction of a second as a +Rational+
Returns the fraction of a second as microseconds
Returns the maximum number of columns per table.
Returns the maximum number of indexes per table.
SQLite supports index names up to 64 characters.
See +request_via_redirect+ for more information.
See ActiveRecord::Callbacks for further details.
See active_support/core_ext/time/conversions.rb.
See http://www.unicode.org/reports/tr15, Table 1
Should return a new hash without the given keys.
Support for ClassMethods and the included macro.
TODO: These should be defined on the initializer
Test inflections with different starting letters
The +ip_spoofing_check+ option is on by default.
The Formatter class is used for formatting URLs.
The default queue adapter is the +:async+ queue.
The default value for +include_root+ is +false+.
The lookup will happen on the name of the class.
The new instance is yielded to the passed block.
The owner is passed as a parameter to the block.
The penalty for the rest of strings is marginal.
The receiver is not contained within the result.
The test adapter should be used only in testing.
These caches are keyed by klass.name, NOT klass.
These will be offenses for the EmptyLiteral cop.
This class defines the interface for a renderer.
This cop checks for inheritance from Struct.new.
This cop checks for tabs inside the source code.
This cops checks the alignment of else keywords.
This formatter saves the output as an html file.
This is a place where local variables belong to.
This is actually not a cop and inspects nothing.
This statement is one character too long to fit.
This will be overwritten by _write_layout_method
This will load all comments with a single query.
To create a renderer pass it a name and a block.
To use Qu set the queue_adapter config to +:qu+.
Updates a single attribute and saves the record.
Used in number_to_human_size and number_to_human
Usually this model is not saved to the database.
WARNING: this helper only works with valid JSON.
We are testing that a dirty read does not happen
We want crashes to show up the same in each run.
We won't check modifier or ternary conditionals.
We're looking for (block (send nil :lambda) ...)
Which allows you to quickly change your code to:
You can add HTML attributes using the +options+.
You can also set your own table name explicitly:
alias_method can't be used with global variables
allows them to be +NULL+ (drops the constraint).
assert_migration "db/migrate/create_products.rb"
class MyClass include ActiveModel::Serialization
class Person include ActiveModel::Conversion end
discard ternary ops and modifier if/unless nodes
don't let UrlFor override the url_options method
ensure we have a schema_migrations table to dump
george: name: George the Monkey pirate: reginald
hash:: Hash to merge the converted element into.
http://dev.mysql.com/doc/refman/5.6/en/call.html
iterates over all namespaces and opens up blocks
methods for test_sweep_after_halted_action_chain
other_topics fixture should not be included here
plus a singleton class method called _routes ...
post_nesting_incompatible_thread can now proceed
reversible method to define reversible behavior.
strategy for building urls to send to the client
support polymorphic belongs_to as "label (Type)"
test generating engine's route from other engine
test if saved clone object differs from original
use indentation with from Style/IndentationWidth
we check if the prev and current lines are empty
we correctly register "Foo" as being autoloaded.
* Applies human inflection rules to the argument.
+new_value+ will be the current, type cast value.
A minimal implementation including JSON would be:
Active Record supports multiple database systems.
Add to it the scope from this reflection (if any)
Allows to set defaults through app configuration:
Almost a duplicate from ActionController::Helpers
Also makes sure proper dependencies are required.
And the lookup is exactly the same as previously:
Any fixture labeled "DEFAULTS" is safely ignored.
Any routing helpers can be used inside a concern.
Application logic should not go into url_options.
Be conservative and return true if we're not sure
Build ISO 8601 Duration string for this duration.
Build full select tag from date type and options.
Built-in global variables are allowed by default.
But it's in a hidden directory, so it's not read.
But you can also set a class-specific connection.
Common functionality for checking modifier nodes.
Converts the given URL to a full connection hash.
DateTime objects have their time set to 23:59:59.
Defines both class and instance config accessors.
Determines if a document element has text content
Enabled by default for apps that use Action View.
Executes the block with the collect flag enabled.
Fetches data from the cache, using the given key.
Fix duplicate node by prefix with its parent node
GET show GET edit PATCH/PUT update DELETE destroy
Handles `EnforcedStyle` configuration parameters.
If _n_ is not specified or is nil, 16 is assumed.
If the error message is a string it can be empty.
If true, use ISO 8601 format for dates and times.
Initializing Codepoint object with default values
Instantiate fixtures for every test if requested.
Instead of polluting the thread locals namespace:
It is heavily inspired by delayed_job and Resque.
JSON, YAML, Marshal are supported out of the box.
Let's take for example this non-persisted object.
Locate the connection of the nearest super class.
Minitest `stub` expects the method to be defined.
Namespace and key will be delimited with a colon.
Needed when counting objects with the ObjectSpace
Only the middleware method should construct them.
Oracle adapter returns count() as Fixnum or Float
Otherwise the string contains just line and text.
Otherwise, the extra cop will affect other specs.
Performs a GET request with the given parameters.
Performs a PUT request with the given parameters.
Pointless condition to force single-query loading
Possible authenticity tokens sent in the request.
Post.transaction(isolation: :serializable) do ...
Prepend the command, so Rake knows how to run it.
Providing custom whitelisted tags and attributes:
Raised when storing more than 4K of session data.
Raises an +ArgumentError+ for invalid time zones.
Raises an exception if a validation error occurs.
Read cookie using POST request without CSRF token
Removes all filters, but leaves in the silencers.
Removes all silencers, but leaves in the filters.
Removes the named singleton method, if it exists.
Returns a CDATA section with the given +content+.
Returns a deep copy of object if it's duplicable.
Returns false on a valid response, true otherwise
Returns the mail object for the given email name.
Returns the number of records in this collection.
Returns true when the node is an access modifier.
Runs in all validation contexts by default (nil).
Sets the token parameter name for RequestForgery.
Several rails cops include app/models by default.
Should replace the hash with only the given keys.
Simple formatter which only displays the message.
Simple, efficient background processing for Ruby.
Simulate a GET request with the given parameters.
Spawn a new thread to serve up the controller in.
State should be one of :new_record or :destroyed.
Streaming should work out of the box on Rainbows.
Superclass for ActionController functional tests.
Syntax isn't a real cop and it can't be disabled.
TODO: Find the correct position of the semicolon.
Take for instance Active Record subscriber tests:
Testing that the before_update callbacks have run
Tests if render or redirect has already happened.
The maximum number of parameters is configurable.
The migrations module handles this automatically.
The other `when` nodes get 0.2 complexity points.
They are in any case removed from the collection.
This can be used to implement new template types.
This cop checks for *rescue* blocks with no body.
This cop checks for extra/unnecessary whitespace.
This cop is designed to help upgrade to Ruby 3.0.
This is faster and simpler than the method above.
This is not a guaranteed performance improvement.
This is why we are tolerant to unknown constants.
This means that an inheritance looking like this:
This method is robust to non-reachable constants.
This mutator is protected in the class definition
This would render "advertiser/_account.html.erb".
To setup your validator override the constructor.
Use the logger configured for ActionMailer::Base.
Using self.x to distinguish from local variable x
Vendors the full, link and white list sanitizers.
Verifies existence of an index with a given name.
We can't cache Post.find_by(author: david) ...yet
We emulate Unix on the former but not the latter.
Will have different object id than One::Constant1
accepts_nested_attributes_for :author, :pages end
and a final valid identifier, captured as DYNAMIC
assert_file "config/environment.rb", /initialize/
blank or nil parsed values are represented by nil
but in a regex, it's an anchor on a word boundary
change column, make it nullable and clear default
create DateTime value with local time zone offset
data_sources instead" Get the columns for a table
define_model_callbacks :initializer, only: :after
don't clobber if we already have a starting paren
dup should not preserve the timestamps if present
element:: XML element to extract attributes from.
expect only Invoke db:structure:dump (first_time)
handle `if (something rescue something_else) ...`
has_one association with reserved-word table name
layout key in either old or new style hash syntax
module HairColors mattr_accessor :hair_colors end
offenses are registered on the `block.call` nodes
periodically :transmit_progress, every: 5.seconds
private def log_children Child processing end end
require 'rubocop/rake_task' RuboCop::RakeTask.new
running tests again won't trigger a schema update
select_hour(my_time, start_hour: 2, end_hour: 14)
select_month(Date.today, add_month_numbers: true)
select_month(Date.today, use_month_numbers: true)
the author id of the post should be the id we set
there can only be one group of optional arguments
time-stamp H(time-stamp ":" ETag ":" private-key)
use a timeout to prevent it stalling indefinitely
use indentation width from Style/IndentationWidth
validates :title, presence: true, title: true end
* +:date+ - The date to say the email was sent on.
* ActiveRecord::ConnectionAdapters::Mysql2Adapter.
* The TillController does not use a layout at all.
+new_value+ The current value, after type casting.
26  LineLength 3   OneLineConditional -- 29  Total
A +Tempfile+ object with the actual uploaded file.
A newly instantiated +Person+ object is unchanged:
A utility method for escaping HTML tag characters.
ActiveSupport::Deprecation.new('2.0', 'MyLibrary')
ActiveSupport::Notifications.unsubscribe("render")
Add directories that should be watched for change.
Adds an entry into +Gemfile+ for the supplied gem.
Adds support for +setup+ and +teardown+ callbacks.
An Optimized resolver for Rails' most common case.
And check that these changes are reflected in dump
Arrays/Hashes are deserialized element by element.
Assumed to be an instance of +Money+ in this case.
Attribute writer methods only accept one argument.
Be conservative and return false if we're not sure
Big savings in request time and network bandwidth.
Characterizing when :before_add callback is called
Checks for uses of while with a negated condition.
Checks to see if a column exists in a given table.
Configuration examples (FileStore is the default):
Consider the following loop using the class above:
Creates a new Chars instance by wrapping _string_.
Creates a new cache entry for the specified value.
DateTime objects will have a time set to 23:59:59.
Don't include the same location twice for one cop.
Engine name is set by default based on class name.
Example object structure for use with this method:
Expose database runtime to controller for logging.
FROM mixins INNER JOIN mixins childrens_mixins ...
Failure to do this will produce undesired results.
Fetches data from the cache, using the given keys.
For adapters which support microsecond resolution.
For instance, "1 minute" is actually 30s to 1m29s.
For more see the explanation in ThroughReflection.
For now, we assume that lists are 2 items or less.
Generates a signed message for the provided value.
Here is an example which demonstrates the problem:
However it fails on Rubinius 2.2.9 due to its bug:
If no block is given, an `Enumerator` is returned.
If the callback chain was halted, returns +false+.
If the end is on its own line, there is no offense
If you need unescaped contents, set this to false.
In Ruby 2, source code encoding defaults to UTF-8.
In the normal case the loop is only executed once.
Inspired by the Quiet Backtrace gem by thoughtbot.
InstrumentationRegistry.instrumenter_for(notifier)
Invoked at the beginning of inspecting each files.
Just discard the source if we have a virtual path.
Load Rails runner and invoke the registered hooks.
Multiple delegates to the same target are allowed:
Need to write coverage result under different name
Other namespaces can be added to the root element:
Performs a HEAD request with the given parameters.
Performs a POST request with the given parameters.
PostgreSQL doesn't support limits on text columns.
Provides behavior for enqueuing and retrying jobs.
Read session using POST request without CSRF token
Removes the namespaces and get the generator name.
Restore an offense object loaded from a JSON file.
Returning +nil+ will cause authentication to fail.
Returns a Rack endpoint for the given action name.
Returns a new date/time at the end of the quarter.
Returns a new date/time at the start of the month.
Returns a new date/time representing the next day.
Returns maximum number of joins in a single query.
Returns the URL for the set of +options+ provided.
Returns the column object for the named attribute.
Returns the plural form of the word in the string.
Returns true for an absolute Unix or Windows path.
Returns true if we have the lock, false otherwise.
Reverse the existing order clause on the relation.
STI subclasses always use their superclass' table.
See ActiveSupport::Cache::Store for documentation.
Should return a new hash with only the given keys.
Silences the logger for the duration of the block.
So for example you may use a named route directly.
Special features: - Clustering and load balancing.
Specifies the `environment` that Puma will run in.
StatementInvalid wraps the original exception now.
Supported options are: -h         This message ...
Take the following route definition as an example:
Test if the queue currently contains any elements.
The algorithm counts decision points and adds one.
The capture method can be used in ERB templates...
The constant is no longer reachable, just skip it.
The former is used to mark parameters as required.
The headers will be merged into the Rack env hash.
The lookup in this case for test_unit as input is:
The option is ignored for collection associations.
The other settings from default.yml are unchanged.
The resulting string will be stripped in any case.
They will however still be marked for destruction.
This cop checks for nested ternary op expressions.
This formatter formats report data in clang style.
This is a shorthand for `node.each_ancestor.to_a`.
This is expensive for large sets of fixtured data.
This may be seconds, minutes, hours, or even days.
This module holds the RuboCop version information.
This small step has some wonderful ripple effects.
This will display the wrapped hash in the log file
To use Que set the queue_adapter config to +:que+.
Tweaks an attribute name for display to end users.
We must not change indentation of heredoc strings.
Write cookie using POST request without CSRF token
You don't have to rely on the automated rendering.
activerecord: attributes: post: cost: "Total cost"
alias_method can't be used in instance_eval blocks
avoid duplicating an enumerable object in the loop
can recreate referenced table with force: :cascade
class A def test puts 'hello' puts 'world' end end
class Person include ActiveModel::AttributeMethods
class User include ActiveSupport::Configurable end
create tables with reserved-word names and columns
def after_leaving_scope(scope, variable_table) end
george: id: 1 name: George the Monkey pirate_id: 1
make sure app_xml is ahead of text_xml in the list
module EventTracking extend ActiveSupport::Concern
one for loading post, and another one merged query
partial key in either old or new style hash syntax
reginald: name: Reginald the Pirate monkey: george
select_datetime(my_date_time, date_separator: '/')
send_data generate_tgz('dir'), filename: 'dir.tgz'
sponsorable_type column might be declared NOT NULL
to_run -- Run before a work run that is reloading.
user.update_columns(last_request_at: Time.current)
* ActiveRecord::ConnectionAdapters::SQLite3Adapter.
* Integer - Finds the record with this primary key.
+DateTime+ objects have their time set to 23:59:59.
+const_paths+ is a set of qualified constant names.
- +headers+: Additional headers to pass, as a Hash.
:nodoc: Default and i18n option namespace per class
:nodoc: We don't have cache keys for this stuff yet
A module, class, symbol, or string may be provided.
A string with the headers of the multipart request.
A transaction acts on a single database connection.
Adds the following methods for retrieval and query:
All queues can run within a single application (eg.
Allows you to add attachments to an email, like so:
An arbitrary expression is passed in and evaluated.
Any fixtures labeled "_fixture" are safely ignored.
By default the +:id+ parameter doesn't accept dots.
Changes '::' to '/' to convert namespaces to paths.
Check if this is the last iteration of the partial.
Check the connection back in to the connection pool
Checks if the controller allows forgery protection.
Class for storing and registering the local caches.
Common functionality for checking assignment nodes.
Common functionality for handling percent literals.
Compose decomposed characters to the composed form.
Create a dependency tree for template named +name+.
Create a new test request with default `env` values
Create new hashes so we don't modify parent classes
Creates a job preconfigured with the given options.
Defaults to 3 (equivalent to millisecond precision)
Deletes all entries with keys matching the pattern.
Disconnects from the database if already connected.
Dumps objects in JSON (JavaScript Object Notation).
For example, setting the IDs of a child collection.
Forward only valid config params to PGconn.connect.
Frozen string literals will be default in Ruby 3.0.
Global: The adapter has a global number of retries.
Hence need to put a restriction on password length.
If it was being `require`d, they will be discarded.
If the key is not found, returns the default value.
If the subnet mask is equal to /32, don't output it
Initialize the application passing the given group.
Instead, you provide the names and values manually.
It does three jobs to enforce secure HTTP requests:
It is impossible to properly test read uncommitted.
Make sure to expand all symlinks in the path first.
Makes it dead easy to do HTTP Token authentication.
Orphan in Foo::ClassMethods, not Bar::ClassMethods.
Otherwise SerializationTypeMismatch will be raised.
Otherwise overridden in Railtie to use Rails.cache.
Performs a PATCH request with the given parameters.
Please also note that +try+ is defined on +Object+.
Proxy to to_param if the object will respond to it.
Replaces the contents of this hash with other_hash.
Requests can opt-out of redirection with `exclude`:
Returns +nil+ if the message is not Base64-encoded.
Returns +true+ if +self+ is a +has_one+ reflection.
Returns a JavaScript tag with the +content+ inside.
Returns a hash with the data for each of the names.
Returns a new array of objects from the collection.
Returns a textual representation of this time zone.
Returns an object that is able to render templates.
Returns string to use while generating route names.
Returns the initialized object if validation fails.
Returns the name of the module containing this one.
Returns the plural class name of a record or class.
See +loadable_constants_for_path+ for more details.
See ActiveRecord::Type::Value for the expected API.
See ActiveRecord::Validations for more information.
Set by the Rack web server, this is a single value.
Sets readonly attributes for the returned relation.
Should return any option accepted by +redirect_to+.
Since the order is incomplete nothing will be shown
So it's unneeded whether there are offenses or not.
Some cache implementation may optimize this method.
Some configuration can be passed through +options+.
The +subscribe+ method returns a subscriber object:
The regexp that matches blank strings is expensive.
This also applies to MySQL apps but not with SQLite
This class represents each reference of a variable.
This cop checks for redundant `return` expressions.
This cop checks for single-line method definitions.
This gives access to the environment, cookies, etc.
This is a thread locals registry for Active Record.
This is analogous to nesting models in a migration.
This is overridden by Associations::CollectionProxy
This makes it easy to extract specific information:
This should be a no-op that does not raise an error
Thus, we lazy load it and disable warnings locally.
To use this adapter, set queue adapter to +:async+:
Unfreeze name in case it's given as a frozen string
Values longer than 20 characters will be truncated.
WebSocket message transfer encoding is always JSON.
When called, this middleware renders an error page.
Which are then automatically available to the view:
Write session using POST request without CSRF token
You can customize the format in the +options+ hash.
You can use named cycles to allow nesting in loops.
You may use this to also restrict other parameters:
`eval` need for raise native SyntaxError at runtime
allow turning off autocorrect on a cop by cop basis
assert_no_migration "db/migrate/create_products.rb"
attr_accessor :name validates_presence_of :name end
class Person include ActiveModel::Serializers::JSON
def after_entering_scope(scope, variable_table) end
def before_leaving_scope(scope, variable_table) end
def model_name OpenStruct.new param_key: 'post' end
even though there's no explicitly set content-type,
frozen_string_literal: true Disable colors in specs
generates a query with 'ORDER BY id ASC, name ASC'.
make sure there is going to be a duplicate PK error
original_exception is deprecated and has no effect.
passes because Man does have the correct inverse_of
private def encrypt(value) Secrecy is committed end
tests WidgetController tests :widget tests 'widget'
time_zone_select( "user", 'time_zone', /Australia/)
where MyNewMigration is the name of your migration.
* The ExchangeController uses the "exchange" layout.
* flash: The flash objects currently in the session.
*Now* we actually need the collection so it's loaded
+DateTime+ objects will have a time set to 23:59:59.
11 ids with limit 3, offset 9 should give 2 results.
@path_cache maps directories to configuration paths.
@private Builds Ruby code which implements a pattern
A Variable represents existence of a local variable.
A full-length RSS example actually used on Basecamp:
A helper class for building the report summary text.
A reaper with nil time should never reap connections
ActiveRecord::Base.establish_connection(:production)
ActiveRecord::LogSubscriber.attach_to :active_record
ActiveSupport::Notifications.unsubscribe(subscriber)
Actually call the method associated with the action.
Add new inflection rules using the following format.
Adds another Duration or a Numeric to this Duration.
Aliasing twice issues a warning "discarding old...".
Allows +nil+ by default if not used with +:minimum+.
Alternatively you can use one of the other syntaxes:
An internal class for correcting parallel assignment
And then you have content pages that look like this:
Applying values to a relation has some side effects.
Authenticate with HTTP Digest, returns true or false
Begins the transaction with the isolation level set.
By default it uses Marshal to serialize the message.
By default, there's no reason to avoid auto-correct.
CREATE INDEX suppliers_name_index ON suppliers(name)
Cache fragments of a view unless +condition+ is true
Callbacks configured after the ones has_one sets up.
Called once a consumer has cut its cable connection.
Can't modify options hash as it's frozen by default.
Check if this is the first iteration of the partial.
Checks for spaces inside ordinary round parentheses.
Combine the 3 parts to generate complete route entry
Common code for indenting literal arrays and hashes.
Common functionality for checking surrounding space.
Common functionality related to annotation comments.
Common methods and behaviors for dealing with paths.
Composites are mapped to `OID::Identity` by default.
Contains helpers that help you test passage of time.
Create "label" locale for testing I18n label helpers
Creates a field set for grouping HTML form elements.
Declares helper accessors for controller attributes.
Determines if a hash contains a truthy _destroy key.
Determines the version number of the next migration.
Distances are reported based on the following table:
Do not compute the size of statically sized objects.
Does not run if +config.cache_classes+ set to false.
Ensure to_prepare callbacks are not run when defined
Example from issue 346 of bbatsov/rubocop on github:
Example from issue 393 of bbatsov/rubocop on github:
Example from issue 447 of bbatsov/rubocop on github:
FROM posts INNER JOIN comments comments_posts ON ...
File fixtures are represented as +Pathname+ objects.
FileUtils.copy(actual_html_path, expected_html_path)
Find a mailer preview by its underscored class name.
For APIs, you may want to use :null_session instead.
For example, in the controller you could write this:
Forward all undefined methods to the wrapped string.
Gets the helper methods available to the controller.
Hence the inherited default for `if` key is ignored.
IRB inspects the return value of "MyModel.allocate".
If no order is defined it will order by primary key.
If the String is valid, return the encoding we found
If the favicon changes it is hard to get it updated.
If this fails, then try it as a plain text password.
In both cases, nil is returned if there is no match.
Integration tests have their own setup and teardown.
Invoice::Lineitem becomes "myapp_invoice_lineitems".
Just change it from its default "localhost" setting.
Lastly, simple content can be passed as a parameter:
Merges the given configuration with the default one.
Moreover, it gracefully handles module dependencies.
Only allow a trusted parameter "white list" through.
Override locale to return a symbol instead of array.
Override negative format if format options are given
Partials can have their own layouts applied to them.
Performs a DELETE request with the given parameters.
Queue: The timeout is set for all jobs on the queue.
Re-order codepoints so the string becomes canonical.
Removes `size` characters prior to the source range.
Removes the given columns from the table definition.
Replace accented chars with their ASCII equivalents.
Replace with any object that responds to +sanitize+.
Report class name as 'Time' to thwart type checking.
Return true if we released the lock, otherwise false
Returns a comment stored in database for given table
Returns a hash with database connection information.
Returns a new date/time at the start of the quarter.
Returns an HTML time tag for the given date or time.
Returns an array with the direct children of +self+.
Returns the beginning of the array up to +position+.
Returns true if the cache is currently being pruned.
Returns true if the current time zone is set to UTC.
Scopes a set of routes to the given default options.
Send a start notification with +name+ and +payload+.
Send the file stored at +path+ as the response body.
Separator and value are not corrected in 'key' mode.
Set to +:cascade+ to drop dependent objects as well.
Severity class is simple value object about severity
Strong ETags are considered byte-for-byte identical.
The +sql+ parameter is a full SQL query as a string.
The alias +path_to_image+ is provided to avoid that.
The default Action View context is ActionView::Base.
The inclusion pattern has pages that look like this:
The number of arguments in the signature must match.
The result is returned as a new TimeWithZone object.
The struct's attributes are prefix, base and suffix.
Then the cop treats it as an `if`/`elsif`/`elsif`...
Then, if you want webrat to be invoked, just supply:
They happen if there are headers with the same text.
This can be done with a symbol pointing to a method:
This class represents each assignment of a variable.
This cop checks for *return* from an *ensure* block.
This cop checks for use of the lambda.(args) syntax.
This file contains configuration for an unknown cop.
This is a shorthand for `node.each_child_node.to_a`.
This is a shorthand for `node.each_descendant.to_a`.
This is extremely bad, but should be possible to do.
This means any callbacks added before are run first.
This model can now be used with a nested fields_for.
This regex string is treated as an unanchored regex.
Time.at can be called with a time or numerical value
To turn off HSTS, omitting the header is not enough.
UTF-8 is the default internal and external encoding.
We are given a source with an encoding of ASCII-8BIT
When passing paths, the ".js" extension is optional.
Whether to print a backtrace along with the warning.
Will deadlock due to lack of Monitor timeouts in 1.9
You can add your own to the Time::DATE_FORMATS hash.
You can even use Action View helpers in these views.
You can modify the LINK tag itself in +tag_options+.
You can overwrite this configuration per controller.
You need to check the instructions for each of them.
You will have to rewrite those to the explicit form:
`elsif` branches show up in the `node` as an `else`.
allow mass assignment as the return of a method call
assert framework trace that threw the error is first
belongs_to association with reserved-word table name
can also be written as follows using the short-hand:
class ContactMessage include ActiveModel::Conversion
def before_entering_scope(scope, variable_table) end
followed by optional letters, numbers or underscores
if it is an IO we need to go back to read the object
library_db: database: library host: some.library.org
make sure all associated objects have been validated
module Bar extend ActiveSupport::Concern include Foo
namespace "admin" do resources :posts, :comments end
regression tests against improper inflection regexes
remove_foreign_key :accounts, name: :special_fk_name
resources :photos do member do get 'preview' end end
test resetting sequences in odd tables in PostgreSQL
the debug_assets params isn't used if compile is off
the following functions were added to DRY test cases
use the faster _get when dealing with OrderedOptions
we want to make sure nobody is sneaking a netmask in
'sqlite3:/foo' is absolute, because that makes sense.
(Default nil, which means don't schedule the Reaper).
* +verifier_name+ - the name of the message verifier.
+old_value+ and +new_value+ will always be type-cast.
+value+ The raw input, as provided from the database.
-- This class is heavily based on faye-websocket-ruby
-- This class wraps up local storage for middlewares.
:nodoc: The reflection of the association represented
:nodoc: create a 2D array representing the result set
@see http://rubydoc.info/gems/ast/AST/Node:initialize
A call that tries to eager load the addressable model
ALL Set to "1" to force the generation of all guides.
Access modifiers should be surrounded by blank lines.
Action View templates can be written in several ways.
Activate the gem you are reporting the issue against.
After rounding, the number of digits may have changed
ApplicationController.renderer.render template: '...'
Arguments are assumed to be relative to the receiver.
Asserts the given method exists in the given content.
Attaches the stored job data to the current instance.
Build select option HTML from date value and options.
By default, each controller will include all helpers.
Callbacks configured before the ones has_one sets up.
Check "when" body against "when" keyword indentation.
Check for parentheses around stabby lambda arguments.
Checks for uses of if/then/else/end on a single line.
Checks to make sure that the arguments are not blank.
Clear out internal caches for the data source +name+.
Configure SSL options to enable HSTS with subdomains.
Converts the query parameters of the URI into a hash.
Correct the encoding of the source as we expect UTF-8
Create a new Money object with the new value instead.
Decompose composed characters to the decomposed form.
Defined in a method to instantiate it only if needed.
Doesn't overwrite previous class_methods definitions.
Don't allow synchronizing since it isn't thread safe.
E.g. interpolation might take place for where values.
Event.title has limit 5, but SQLite doesn't truncate.
Executes a SELECT query and returns an array of rows.
For example, these two snippets have the same output:
For this, you need to create a config file as follow:
Holds data about a codepoint in the Unicode database.
If the record is new or it has changed, returns true.
If the result is true then check for the select case.
If you want ordered fixtures, use the omap YAML type.
If you've set specific values, they'll be left alone.
In a great majority of cases, this is what is wanted.
In the future, this might become an optional require.
In this case "kind" is "before" and "name" is "save".
Increase timeout so the server doesn't disconnect us.
Invoke source_root so the default_source_root is set.
It also checks for lines terminated with a semicolon.
It can also be used to return exceptional conditions:
It seems to be fixed on the current master (0a92c3c).
JRuby will return the value before typecast as string
Lets create a model so we have something to play with
Load securerandom only when has_secure_token is used.
Look inside parentheses around the condition, if any.
Minitest passes through Interrupt, catch it manually.
Most hash keys can be matched against a simple regex.
MySQL doesn't allow defaults on TEXT or BLOB columns.
No + to space in URI escaping, only for query params.
Normal ActiveRecord::Base classes are entity objects.
Not aligned according to `indent` or `outdent` style:
Not all web servers support streaming out-of-the-box.
Offense occurs in 2 files, limit is 1, so no Exclude.
Only the eyebrow fanciers club has a sponsored_member
Oracle does not support boolean expressions in SELECT
Otherwise, it will yield all descendants which match.
Please note that these options *are not thread-safe*.
Provide your own forgery protection strategy instead.
Provides a full validation framework to your objects.
Raises an error when the store class cannot be found.
Restore all previous data of the provided attributes.
Returns +true+ if +other+ is equal to current object.
Returns +true+ if _obj_ responds to the given method.
Returns Content-Type of rendered content :api: public
Returns a new date/time at the beginning of the year.
Returns a table's primary key and belonging sequence.
Returns an array of foreign keys for the given table.
Returns the Arel object associated with the relation.
Returns the base root for a common set of generators.
Returns the maximum allowed length for an index name.
Returns the name of the queue the job will be run on.
Returns the separator for a given datetime component.
Returns the singular class name of a record or class.
Returns true if a connection has already been opened.
Runs the supplied rake task (invoked with 'rake ...')
SecureRandom.base58 generates a random base58 string.
See the comment at the end of file for this behavior.
Send a finish notification with +name+ and +payload+.
Strips all HTML tags from +html+, including comments.
Style/SpaceBeforeSemicolon, Style/SpaceAfterSemicolon
Test for dirty reads among simultaneous transactions.
The +src+ argument is meant to be an image file path.
The maximum level of nesting allowed is configurable.
The namespace can be either a static value or a Proc.
The order will depend on the database implementation.
The path is calculated like the +src+ of +image_tag+.
The type detected by Active Record can be overridden.
There are some places where an Engine's name is used:
These samples are derived from Apache Lucene project.
This calculates aggregate values in the given column.
This can be customized with two options: :in and :as.
This cookie-based session store is the Rails default.
This cop checks for END blocks in method definitions.
This cop checks for duplicated keys in hash literals.
This cop checks for methods with too many parameters.
This cop checks for trailing comma in argument lists.
This cop mirrors a warning produced by MRI since 2.2.
This feature can be turned off completely by setting:
This is not an issue in utf-8, so it must be ignored.
This is similar to the way sinatra renders templates.
This means it can be used in association definitions:
This must be defined before the inherited hook, below
To mitigate this problem, we use a few strategies: 1.
To use, pass an attribute name (as string or symbol).
To use, pass attribute names (as strings or symbols).
Use the model's own prefix/suffix if a model is given
Useful if the name can't be inferred from test class.
VIEW TODO: View tests should not require a controller
Valid values are 'inline' and 'attachment' (default).
Verifies the existence of an index with a given name.
We can't use the instance variable inside the lambda.
Will be called automatically by the metal call stack.
You can also use +permit+ on nested parameters, like:
You can use strings in order to customize your joins:
You're testing whether a transaction works correctly.
`RuboCop::Node` is a subclass of `Parser::AST::Node`.
all group1 threads start waiting before any in group2
create_table(:suppliers) Add a column to 'suppliers'.
define attr_reader methods for the instance variables
development: database: my_application host: localhost
google: id: 2 name: Google url: http://www.google.com
has_and_belongs_to_many with reserved-word table name
if a symbol is given we prepend the quoted table name
javascript_tag "alert('All is good')", defer: 'defer'
optional global, instance or class variable indicator
override any order specified in the original relation
qu_job can be nil depending on the configured backend
rails generate controller Account --no-test-framework
reconstruct the scope now that we know the owner's id
sanity check to make sure that this file never exists
select_month(Date.today, use_two_digit_numbers: true)
subtracting 1 second takes goes back to 1:59:59AM EST
to_s in an interpolation with several expressions' do
to_xml and passes the options, where :root is key" do
url_for, you must include routing helpers explicitly.
use only cops that link to a style guide if requested
"rails:test_unit", "test_unit:controller", "test_unit"
* ActiveRecord::ConnectionAdapters::PostgreSQLAdapter.
* If the argument is +nil+ an empty array is returned.
+cast_type+ The type object to use for this attribute.
- +flash+: A hash of parameters to store in the flash.
- +params+: The HTTP parameters that you want to pass.
- an Array which specifies multiple association names.
:nodoc: A valid Rack::Body (i.e. it responds to each).
A :begin node inside a :dstr node is an interpolation.
A hook invoked every time a before callback is halted.
A running counter of the number of requests processed.
Adds a new renderer to call within controller actions.
Adjust the given time to the simultaneous time in UTC.
All elements of path_parameters should use Symbol keys
Autoload and eager load conveniences for your library.
Both instance and class/singleton methods are checked.
But for the indented style, it doesn't come into play.
By default, Rails generates migrations that look like:
Common code for cops that deal with preferred methods.
Common functionality for checking minimum body length.
Create "submit" locale for testing I18n submit helpers
Creates a migration template at the given destination.
Defaults to "tag:localhost,2005:/posts", in this case.
Define a method which applies a pattern to an AST node
Don't infer yaks, let's not go down that road again...
Dont call routes, if there is an error on _routes call
Drops the join table specified by the given arguments.
Dummy to force column loads so query counts are clean.
Encoding Infinity or NaN to JSON should return "null".
Enqueues the email to be delivered through Active Job.
Enqueues the job to be performed by the queue adapter.
Ensure nested hashes are not HashWithIndiffereneAccess
Ensures with check for nil, not for a falseish target.
FIXME: Remove this when we better serialize attributes
Find and render a template based on the options given.
For example the following migration is not reversible.
For example, imagine the following +dashboard+ action:
For example, the following behavior may be surprising:
For example, this method could generate the following:
Helpers for defining methods based on a pattern string
If false, never save or destroy the associated object.
If no year is specified, it will use the current year.
In case of nil parameter it sets the charset to utf-8.
In some cases, you may want to provide a boolean hook.
Invokes +cache_key+ if object responds to +cache_key+.
It optionally takes a deprecator as the last argument.
It's also possible to specify the instance to be used:
It's not possible to halt the validate callback chain.
Load Rails generators and invoke the registered hooks.
Load bcrypt gem only when has_secure_password is used.
Loading nested relationships is possible using a Hash:
Make sure file name doesn't exceed file system limits.
Maps logical Rails types to MySQL-specific data types.
Most databases don't support true nested transactions.
Note that some of its interface is available directly.
Now yield to the code that is to define new constants.
Otherwise, serialization bugs may creep in undetected.
Override this method in a helper to customize the tag.
Parse an XML Document string or IO into a simple hash.
Please give a name which does not start with numbers."
Redirects are used to move from one action to another.
Returns +true+ if +self+ is a +belongs_to+ reflection.
Returns +true+ if the attributes hash has been frozen.
Returns a hash containing the removed key/value pairs.
Returns a new date/time representing the next weekday.
Returns a new date/time representing the previous day.
Returns a new hash with all keys converted to strings.
Returns the KC normalization of the string by default.
Returns the default source root for a given generator.
Returns the name of the table of the associated class:
Returns the number of grapheme clusters in the string.
Returns the port number of this request as an integer.
Returns the priority that the job will be created with
Returns true if the collection has more than 1 record.
Returns values that were assigned to the given +keys+.
Runs all the validations within the specified context.
Runs the supplied rake task (invoked with 'rails ...')
See RFC 3986, section 3.3 for allowed path characters.
Set International negative format if it does not exist
Sets the +value+ for a given +scope_type+ and +model+.
Some commands like +remove_column+ cannot be reversed.
Specifies a one-to-one association with another class.
Specifies the name of the queue to process the job on.
Specifies whether the records should be unique or not.
Specify +options+ with additional translating options.
The callback is unsubscribed automatically after that.
The class methods proxy to said thread local instance.
The method can also be called with multiple arguments.
The quantifiers don't need to be a continuous sequence
Therefore the sti column value will still be the same.
They are especially useful for generating XML content.
This class provides a TestCase for testing generators.
This cop checks for multi-line ternary op expressions.
This cop checks the args passed to `fail` and `raise`.
This cops checks for use of `extend self` in a module.
This formatter formats the report data in JSON format.
This is for handlers that handle encoding but screw up
This is helpful when you're fragment-caching the form.
This is the proxy that handles a has many association.
This test-case serves as a reminder for this use-case.
This will validate the association itself, not the id.
To customize this helper's name, use the +:as+ option:
Valid values are +:member+, +:collection+, and +:new+.
We have to reprocess the source to pickup the changes.
We need to do that processing and can not use caching.
Yields the attribute and the error for that attribute.
You can only declare one template dependency per line.
account for edge cases using one variable with a comma
activerecord model class with reserved-word table name
add_reference(:products, :supplier, foreign_key: true)
check if this value matches the one stored in the temp
date_select("article", "written_on", start_year: 1995)
def down remove_column :accounts, :ssl_enabled end end
def help render action: "help", layout: "help" end end
def read_attribute_for_validation(attr) send(attr) end
end_range starts with the final newline of the if body
gem_group :development, :test do gem "rspec-rails" end
keep the names short to make Oracle and similar behave
method in block must be invoked on a lvar without args
reginald: id: 1 name: Reginald the Pirate monkey_id: 1
reinstate the constants that we undefined in the setup
related bug http://jira.codehaus.org/browse/JRUBY-7194
require_relative '20121212123456_tenderlove_migration'
the last child node determines the value of the parent
to_complete -- Run after a work run that has reloaded.
* Otherwise accepts the same options as text_field_tag.
+attributes+ will be passed to the class's constructor.
:nodoc: Adds a validation method or block to the class.
:nodoc: This method is invoked when a log event occurs.
A boolean toggle that allows/disallows new connections.
A chain of reflections from this one back to the owner.
A simple helper class used in parsing the accept header
Account.transaction do select * from accounts where ...
Add more helper methods to be used by all tests here...
Also converts downcase url encoded string to uppercase.
Alternative styles are 'consistent' and 'align_braces'.
An example broadcasting for this channel looks like so:
Another common use case is optimistic locking handling:
Assertion that the block should not raise an exception.
Asserts that no emails are enqueued for later delivery.
Begins the transaction (and turns off auto-committing).
By default, Rails loads generators from your load path.
Cast a +value+ to a type that the database understands.
Changes the comment for a table or removes it if +nil+.
Commits the transaction (and turns on auto-committing).
Converts characters in the string to the opposite case.
Determine the wrapper model from the controller's name.
Does not quote function default values for UUID columns
Embed in a String to clear all previous ANSI sequences.
Escapes binary strings for bytea input to the database.
Essentially the inverse of +masked_authenticity_token+.
Example calling +create+ action and sending two params:
Finally, the +Path+ object also provides a few helpers:
For options, see +match+, as +root+ uses it internally.
For the default 'aes-256-cbc' cipher, this is 256 bits.
Get the reference for class named +name+ if one exists.
Go down the ancestors to check if it is owned directly.
HTML is understood, but there are .xml rules in the CSS
How to complete the streaming when an exception occurs.
If database hasn't UTF-8 character set, this test fails
If false, never save or destroy the associated objects.
If the given +keys+ don't exist, returns an empty hash.
If the hour and minute is passed, then sec is set to 0.
In invalid cases, an error from the database is thrown.
Let's first just optimize it for retrieving the author:
MRI and JRuby return slightly different error messages.
Manually update the 'name' attribute in the DB directly
Maybe it got loaded while we were waiting for our lock:
MyEngine::Engine.routes.draw do resources :articles end
Nested NoMethodError is the same name as the delegation
Note that it handles both ASCII and Unicode whitespace.
Note, however, the extra bit at the top of that action:
Obtains the value for a given +scope_type+ and +model+.
One reason is that editors, such as Emacs, expect this.
Perform the work in the supplied block as an execution.
Performs canonical decomposition on all the characters.
Provide separate templates for each format and variant:
Query if the following named route was already defined.
Raises an exception if referenced class does not exist.
Range datatypes weren't introduced until PostgreSQL 9.2
Remove changes information for the provided attributes.
Render a head response, but don't touch default headers
Reset columns/indexes cache as we're changing the table
Return a source buffer that has a UTF-8 encoded source.
Returns +true+ if errors were added, +false+ otherwise.
Returns +true+ if there is no match, otherwise +false+.
Returns a Hash of attributes with their error messages.
Returns an array of arrays containing the field values.
Returns an array of ranges that should not be reported.
Returns an array of view names defined in the database.
Returns the association for the parent being destroyed.
Returns the host for this request, such as example.com.
Returns the index of the receiver node in its siblings.
Returns the list of all column definitions for a table.
Returns the lowercase name of the HTTP server software.
Returns the version of the connected PostgreSQL server.
Returns true if the session has the given key or false.
Returns whether this class is an abstract class or not.
Returns whether this request is using the standard port
See Rack::Utils::SYMBOL_TO_STATUS_CODE for a full list.
Should be destroyed since the association is dependent.
Should fail without FirmOnTheFly in the type condition.
Some arguments may be passed via environment variables:
Specifies a new pluralization rule and its replacement.
Specifies table from which the records will be fetched.
Specify relationships to be included in the result set.
Split the comma-separated list into an array of strings
Test if any threads are currently waiting on the queue.
The attribute name must be a valid method name in Ruby.
The contents of the nonce are implementation dependent.
The controller specifies a form builder as its default:
The order clause takes precedence over the informed ids
The output embedding writes it to the current template.
The savepoint is now gone and we can't remove it again.
The tables for these classes could look something like:
These are covered by Style/FirstMethodArgumentLineBreak
These collections can be used just like any other hash:
These determine which controller and action are called.
This can lead to unexpected behavior and is deprecated.
This cop checks for methods called on a do...end block.
This cop checks the length of lines in the source code.
This cop looks for uses of Perl-style global variables.
This cop makes sure that predicates are named properly.
This is however a feature to be used with some caution.
This is needed for correctly setting up the middleware.
This may be better if you don't need to lock every row.
This method is equivalent to the `raw` helper in views.
This option is implemented as a +before_save+ callback.
To do so, simply raise +WrongEncodingError+ as follows:
Use mixed case - one can always use downcase if needed.
Used internally by +audio_tag+ to build the audio path.
Used internally by +image_tag+ to build the image path:
Used internally by +video_tag+ to build the video path.
Used to avoid updating the counter cache unnecessarily.
Uses the internal channel to disconnect the connection.
Valid values are +:nullify+, +:cascade+ and +:restrict+
We cheat here and dump everything into the same bucket.
You can also specify multiple relationships, like this:
You can mix it with +to+ method and do fun things like:
You can use symbols or strings for the attribute names.
aliased to avoid conflicts with an font_url named route
apple: id: 1 name: apple eater_id: 1 eater_type: Monkey
assert first source view (hidden) that throws the error
assert_not_nil Book.find_by(title: "Love Hina") end end
bad.explicit_checking_method 'T'.mb_chars.downcase.to_s
class ApplicationController fragment_cache_key "v1" end
don't run these test because we aren't running in JRuby
fails because Interest does have the correct inverse_of
if the cond node is literal we obviously have a problem
include a module to get around thor's method_added hook
rails generate controller Account --skip-test-framework
reference the global "app" instance, created on demand.
remove_columns(:suppliers, :qualification, :experience)
resources :photos do collection do get 'search' end end
still valid because validation only applies on 'create'
we do an argument count check to reduce false positives
"Indent when as deep as case" is the job of another cop.
+mb_chars+ is a multibyte safe proxy for string methods.
:nodoc: Sidekiq::Client does not support symbols as keys
@good def method yield end def another yield 1, 2, 3 end
A session store that uses MemCache to implement storage.
Action template sets variable that's picked up by layout
Adds a class method for retrieving and querying objects.
Adds simple access to sample files called file fixtures.
Also, this is the server instance used for broadcasting.
Append rescue at the bottom to wrap as much as possible.
Asserts that the response is one of the following types:
Assigning the same value leaves the attribute unchanged:
Bear in mind that GET and HEAD requests are not checked.
Because of line breaks, we will only find the beginning.
Changes the comment for a column or removes it if +nil+.
Check Rails::Application::Configuration to see them all.
Check that the destroy callback on Reference did not run
Checks for colon (:) not followed by some kind of space.
Checks for comma (,) not followed by some kind of space.
Common functionality for cops handling unused arguments.
Convenience method for uuid_from_hash using Digest::MD5.
Cops track offenses and can autocorrect them on the fly.
Count the number of distinct authors for approved Topics
DisplayCopNames: false inherited from config/default.yml
Dummies to force column loads so query counts are clean.
Execute the supplied block while holding the Share lock.
Executes an INSERT query and returns the new record's ID
For example, the previous example could be rewritten as:
For options, see +match+, as +mount+ uses it internally.
Here are a few examples of things that can't be derived:
Ideally, we calculate this relative to the project root.
If calling +method+ returns +nil+, no selection is made.
If omitted, any number of associations can be processed.
Instances may overwrite the class value in the same way:
Invoke the helper using the controller name (pluralized)
It has predicate methods for every node type, like this:
It just pushes events to all registered log subscribers.
Override Rack's GET method to support indifferent access
Override to return the quoted table name for assignment.
Person.find(5).cache_key(:updated_at, :last_reviewed_at)
Raise an error if the class_option :orm was not defined.
Raises +ArgumentError+ if +fixture_name+ can't be found.
Redirect the existing request to use the HTTPS protocol.
Remove old files so that the cache doesn't grow too big.
Return pair of duration's parts and whole duration sign.
Returns +true+ if this does not need STI type condition.
Returns a new, unsaved instance of the associated class.
Returns a response that has no content (merely headers).
Returns an array of table names defined in the database.
Returns an array of the values at the specified indices:
Returns the content length of the request as an integer.
Returns the filename for the data file for this version.
Returns the underlying rack application for this engine.
Returns true if the collection has more than one record.
Returns true if this object is included in the argument.
Second level and higher order associations work as well:
See table_name for the full rules on table/class naming.
Sessions allow you to store objects in between requests.
Set escape to false to disable attribute value escaping.
Set the sequence to the max value of the table's column.
Should merge defaults into options, creating a new hash.
Specifies a limit for the number of records to retrieve.
TODO: Create an object that has caching read/write on it
The existing source is immutable so we need a new object
The masking is used to mitigate SSL attacks like BREACH.
The match will always use the default encoding or ASCII.
The parent of top-level and anonymous modules is Object.
The rule can either be a string or a regular expression.
The valid arguments are given in VALID_UNSCOPING_VALUES.
Then your library can be eager loaded by simply calling:
There are two ways to build a many-to-many relationship.
These helpers are available to all templates by default.
This ambiguity cannot be resolved at this stage anymore.
This can lead to unwanted changes to the inspected code.
This can make for more readable code in complex queries.
This cop checks for comparison of something with itself.
This cop checks for uses of rescue in its modifier form.
This is a special case that has caused double reporting.
This method can be overloaded to customize the behavior.
This method is useful for reporting file sizes to users.
This method returns the output printed by the generator.
This setting overrides the default select over find_all.
This should execute a query that does not raise an error
To do that, you simply need to call +isolate_namespace+.
To find all callbacks in the before_save callback chain:
To include a deep hierarchy of associations, use a hash:
To use Action Mailer, you need to create a mailer model.
To use Resque set the queue_adapter config to +:resque+.
Trigger a Rack parse so that env caches the query params
Type casts a value from user input (e.g. from a setter).
Use +build_association+ or +create_association+ instead.
Use the format name as the hash key and a Proc instance.
Uses ActiveSupport::Callbacks as the base functionality.
Usually key value pairs are handled something like this:
We are testing that a nonrepeatable read does not happen
We do as little as possible on the server's main thread.
We need to recursively iterate over all `else` branches.
You are guaranteed that the key is returned as a string:
You can also add database specific timezone aware types.
You can provide a configuration hash as second argument.
You can specify unicode character routes in your router:
add_foreign_key :articles, :authors, on_delete: :cascade
add_index(:accounts, :name, name: 'by_name', length: 10)
aliased to avoid conflicts with an asset_url named route
assert connection has been forcefully taken away from us
assignments inside blocks are not what we're looking for
generates a scope that conflicts with an AR class method
has_one through Source: has_one through Through: has_one
index(:account_id, name: 'index_projects_on_account_id')
methods starting with a capital letter should be skipped
skip safe assignment nodes if safe assignment is allowed
* +attr_name+ - The field name that should be serialized.
* +counters+ - One or more association counters to reset.
* A nested collection (see +grouped_options_for_select+).
+name+ is logged along with the executed +sql+ statement.
+secret+ must be at least as long as the cipher key size.
- +method+: Request method used to send the HTTP request.
:nodoc: A JoinPart represents a part of a JoinDependency.
:nodoc: Convert nested Hash to HashWithIndifferentAccess.
:nodoc: Properly nests namespaces passed into a generator
@example Good if EnforcedStyle is no_space, bad if space.
@watching is a stack of lists of constants being watched.
A basic formatter that displays only files with offenses.
A list of method names that should be considered actions.
A scope instance holds a scope node and variable entries.
A string representing the layout can be supplied as well.
Accepts a custom Rack environment to render templates in.
Accepts a subclass of +ActionView::Helpers::FormBuilder+.
Active Job provides hooks during the life cycle of a job.
Add an extension to the given name based on the platform.
Allows you to manually set or override the response body.
Also note that this implicitly sets :discard_day to true.
Alternative styles are 'consistent' and 'align_brackets'.
An example of calling where query method on the relation:
An instance of ActiveSupport::TimeWithZone is never blank
An optional namespace can be passed to enclose key names:
Appends a primary key definition to the table definition.
Builds select tag from date type and HTML select options.
Checks if uses of quotes match the configured preference.
Compare the realpath in case either of them has symlinks.
Convenience method for uuid_from_hash using Digest::SHA1.
Convert an enumerable to an array based on the given key.
Convert attributes array into GeneratedAttribute objects.
Create the rack app just inside after initialize callback
Defines some test assertions to test against SQL queries.
Detect the subclass from the inheritance column of attrs.
Each of them is responsible for their own initialization.
Eager loading is supported with polymorphic associations.
Finds an object in the collection responding to the +id+.
Finds the first record matching the specified conditions.
For now, the user has to synchronize the schema manually.
Full paths from the document root will be passed through.
However, this does not allow for LIMIT, OFFSET and ORDER.
If you do not want to use any test framework, you can do:
In MySQL 5.6, CLIENT_MULTI_RESULTS is enabled by default.
It also provides a convenient way to access source lines.
It also searches for a key specific for the given object:
It can also calculate the sum without the use of a block.
Let ActiveSupport::ProxyObject at least raise exceptions.
Markdown generates headers with IDs computed from titles.
More than one error can be added to the same +attribute+.
Most of the queries here are happening in the controller.
Nest FirmOnTheFly in Firm where Dependencies will see it.
No: Does not allow the priority of jobs to be configured.
Nobody should call this method except in Rails internals.
Now, let's try a file with an extension, really a dot (.)
Otherwise keep moving upwards in search of an executable.
Otherwise, fall back to the Active Support legacy format.
Otherwise, returns true after the lock has been acquired.
Override Rack's POST method to support indifferent access
Please renumber your migrations to resolve the conflict."
Please use ActionDispatch::IntegrationTest going forward.
Priority that the job will have (lower is more priority).
Querying logic can instead be passed to the `count` call.
Represents the schema of an SQL table in an abstract way.
Returns +true+ if no errors are found, +false+ otherwise.
Returns +true+ if the enumerable has more than 1 element.
Returns Integer and Arel::Nodes::SqlLiteral limits as is.
Returns a new date/time representing the end of the year.
Returns a new date/time the specified number of days ago.
Returns an array of generator namespaces that are hidden.
Returns the directory in which the data files are stored.
Returns the domain part of a host given the domain level.
Returns the list of all tables in the schema search path.
Returns the offset of this time zone from UTC in seconds.
Returns the path component of a URL for the given record.
Returns true if the current object's time is in the past.
Returns true if the node has round/square/curly brackets.
Returns true when the node looks like an access modifier.
Scopes can also be used while creating/building a record.
See http://yaml.org/type/omap.html for the specification.
See the valid options in the documentation for +url_for+.
Should use validation from base class (which is abstract)
Specifies a many-to-many relationship with another class.
Specifies a new singularization rule and its replacement.
Surround string with single quotes if there is no quotes.
Takes raw_params and turns it into an array of parameters
Tests for names where .plural.singular doesn't round-trip
The +form+ can be either :utc or :local (default :local).
The +options+ hash is passed to each annotation's +to_s+.
The default sanitizer is Rails::Html::WhiteListSanitizer.
The details are changed, so a new cache key is generated.
The last point is easily explained with some enumerables:
The requirements for implementing ActiveModel::Dirty are:
The return value is the relation itself, not the records.
The returned relation implements the Null Object pattern.
The routing module provides URL rewriting in native Ruby.
These five are to override number.format and are optional
This causes some false positives for the comparison here.
This cop checks for the use of Time methods without zone.
This cops checks for two or more consecutive blank lines.
This is a class that abstracts away an asserted response.
This is messed up, but it's how Ruby works at the moment.
This is the case when the join table has no fixtures file
This is the low level API which sits beneath +attribute+.
This method does not remove the newlines from the +text+.
This module contains help texts for command line options.
This module provides approximate string matching methods.
This will cause a warning if content is processed as HTML
UTF-8 leading byte followed by too few continuation bytes
Unicorn supports streaming but it needs to be configured.
Use +html_options+ to modify every select tag in the set.
Use AR::Base's prefix/suffix if string or symbol is given
Useful for inspecting an object at the time of rendering.
We should decouple this from the AR::Base implementation.
You can mix it with +from+ method and do fun things like:
You will obtain whatever was defined in +some_new_scope+.
assert source view line is the call to method_that_raises
class MyModel include ActiveModel::Validations::Callbacks
def save run_callbacks :save do puts "- save" end end end
def send_to_jail get '/jail' assert_response :success end
discard ternary ops, if/else and modifier if/unless nodes
file fixtures/_top_level_partial_only (not fixtures/test)
has_many through Source: has_one Through: has_one through
has_many through Source: has_one through Through: has_one
helpers: label: post: body: "Write your entire text here"
in place of the older more verbose, non-resource-oriented
remove_reference(:products, :supplier, polymorphic: true)
returns a connection handler local to the current thread.
rubocop: enable Metrics/LineLength,Style/StringLiterals',
select_year(Date.today, start_year: 1992, end_year: 2007)
select_year(Date.today, start_year: 2005, end_year: 1900)
unwrap the negated portion of the condition (a send node)
we should only check core Date class (`Date` or `::Date`)
(See +time_zone_options_for_select+ for more information.)
* +id+ - Can be either an Integer or an Array of Integers.
* :except - Apply this layout to all actions but this one.
* Any other key creates standard HTML options for the tag.
- +session+: A hash of parameters to store in the session.
- With no block, but one capture: the capture is returned.
@good method(str.match(/regex/)) return regex.match('str')
A Scope represents a context of local variable visibility.
A subclass of +AbstractController::Base+ may return false.
A valid YAML file is not necessarily a value Fixture file.
Adds to the supplied attribute the supplied error message.
By default, +camelize+ converts strings to UpperCamelCase.
By default, only instances of Hash itself are extractable.
Called by each renderer object to set the layout contents.
Can also be a hash if disabled values are to be specified.
Can be much shorter if the Stale directive is implemented.
Capitalizes the first letter of every word, when possible.
Check Rails::Generators::ActiveModel for more information.
Check if the range between the tokens starts with a space.
Checks the hash for a key matching the argument passed in:
Common functionality for checking length of code segments.
Consider for example the following code that form of post:
Construct a piece of source code for brace layout testing.
Creates a _layout method to be called by _default_layout .
Creates a new Store object according to the given options.
Database is queried when +to_a+ is called on the relation.
Decrement a numeric field by one, via a direct SQL update.
Determines whether a value has changed for dirty checking.
Displays an image which when clicked will submit the form.
Do not halt callback chains when a callback returns false.
Event.title has limit 5, but does SQLite doesn't truncate.
Fallback cache store if Action View is used without Rails.
Fixtures that don't specify an ID get some extra features:
For instance, let's store all "render" events in an array:
For instance, the template above using +provide+ would be:
For ranges with line breaks, we look a the last code line.
Functions for checking the alignment of the `end` keyword.
Future versions of the sqlite3 adapter will return numeric
Here's the same action, with web-service support baked in:
If all parts are negative - let's make a negative duration
If day was done first we would jump to 2010-04-01 instead.
If day was done first we would jump to 2012-03-01 instead.
If the association has a counter cache it gets that value.
If type wasn't provided, try guessing from file extension.
If you need a float that big, something is wrong with you.
In your integration tests, you can do something like this:
Increment a numeric field by one, via a direct SQL update.
It can optionally accept single-line methods with no body.
It does not report offenses for built-in global variables.
It requires you to give a physical path on initialization.
It will be merged with ActionController::Renderer.defaults
Like +titleize+, this is meant for creating pretty output.
Load Rake, railties tasks and invoke the registered hooks.
Make sure that counter incrementing doesn't cause problems
Note that Interest and Man have the :inverse_of option set
Note: You can also use Rails' i18n functionality for this.
Obtains the path to where the object's partial is located.
Only block scope allows referencing outer scope variables.
Options are passed to the underlying cache implementation.
Otherwise, the method re-raises the first exception found:
Performs a GET request, following any subsequent redirect.
Performs a PUT request, following any subsequent redirect.
Please do resolve them, if any, so guides are valid XHTML.
Plucking an SQL fragment returns String values by default.
Raised when a non-existing controller action is triggered.
Raises any error raised while decoding the signed message.
Release the unload lock if it has been previously obtained
Removes the module part from the expression in the string.
Repair all fixture connections so other tests won't break.
Returns +false+ if STI type condition needs to be applied.
Returns +true+ if attr_name is changed, +false+ otherwise.
Returns +true+ when the proxy class can handle the string.
Returns a hash that includes everything except given keys.
Returns a new date/time representing the end of the month.
Returns a new date/time representing the previous weekday.
Returns a new date/time the specified number of weeks ago.
Returns a new date/time the specified number of years ago.
Returns whether the underlying handler supports streaming.
Rolls back the transaction (and turns on auto-committing).
Same as +indent+, except it indents the receiver in-place.
See ActionView::Helpers::CacheHelper for more information.
Set +escape+ to false to disable attribute value escaping.
Sets up instance variables needed for rendering a partial.
Setup content type, reapply charset and handle parts order
The +null+ flag indicates whether the value can be +NULL+.
The HTML generated for this would be (modulus formatting):
The argument to the method can also be an array of fields.
The instance of ActionView::Base that is used by +render+.
The internal PostgreSQL identifier of the money data type.
The message is signed with the +MessageVerifier+'s secret.
The number of iterations that will be done by the partial.
There's also a related idiom that uses the splat operator:
These is a "broken" inverse_of for the purposes of testing
These options mean something to all cache implementations.
This also works with polymorphic belongs_to relationships:
This code is performance critical as it is called per row.
This cop could have its own IndentationWidth configuration
This cop looks for trailing whitespace in the source code.
This default style is called 'special_inside_parentheses'.
This is used to dynamically guess the default source root.
This means the first example above can also be written as:
This means, we do not change them to become more complete.
This module is mixed in if layout conditions are provided.
To get the type conditions for any STI models in the chain
To use Sidekiq set the queue_adapter config to +:sidekiq+.
Unwrap the negated portion of the condition (a send node).
Used by +sanitize+ when it comes across a style attribute.
Will be called automatically when the module is inherited.
You can set and reuse defaults in your fixtures YAML file.
You can use the block form or the regular form, like this:
You simply pass the irregular in singular and plural form.
allow a standard key to be used for doing defaults in YAML
base is the base class on which operation is taking place.
check out all connections so our threads start out waiting
class TranslatedPerson extend ActiveModel::Translation end
date_select("article", "written_on", selected: Date.today)
datetime_select("article", "written_on", start_year: 1995)
def after_declaring_variable(variable, variable_table) end
def perform(video_id) Video.find(video_id).process end end
each_node/visit_descendants_with_types with :skip_children
eat following spaces up to EOL, but not the newline itself
every line with more than 1 expression on it is an offense
figure out the lengths for each column based on above keys
find the post, then find the author, then find the address
has_many through Source: has_many Through: has_one through
has_many through Source: has_many through Through: has_one
irregular 'octopus', 'octopi' irregular 'person', 'people'
optional hash, up to the partial or layout key declaration
or you can remove the entire session with +reset_session+.
resources :posts, shallow: true do resources :comments end
returns the collected queries local to the current thread.
sets a connection handler local to the current thread, and
* Updates all the attributes that are dirty in this object.
+value+ The raw input, as provided to the attribute setter.
@example If statements can contain `then` on the same line:
@example bad class SomeClass def SomeClass.class_method ...
@example no offense Time.zone.today Time.zone.today - 1.day
A list of supported adapters can be found in QueueAdapters.
A pattern can also map wildcard segments (globs) to params:
A separate offense is registered for each problematic pair.
Add and remove callbacks tests for association collections.
Alternatively you may ask for a second parameter +request+.
Always make sure we return a String in the default_internal
An array of qualified constant names that have been loaded.
An expected place for this code would be +lib/constraints+.
Applies inflection rules for +singularize+ and +pluralize+.
Asserts the given class method exists in the given content.
Assigns the given attributes to the collection association.
Avoid CORS issues when API is called from the frontend app.
But you don't have to restrict yourself to static includes.
By default, warnings are not silenced and debugging is off.
CREATE TABLE tags ( id varchar PRIMARY KEY, label varchar )
Cache entries have a value and an optional expiration time.
Checks the spacing inside and after block parameters pipes.
Compatible with both Ruby's own +Logger+ and Log4r loggers.
Discount the leap year days when calculating year distance.
Encode a "jsonified" Ruby data structure using the JSON gem
Encoding regular expression modifiers are silently ignored.
Except for root cases, where the latter is the correct one.
Finally, when a block is given, it yields the file content:
Finds the correct table name given an Active Record object.
For any other value of +count+ the plural will be returned.
For older versions you can use the queue_classic-later gem.
If +element+ is in the queue, remove and return it, or nil.
If we get here, it means that NoMethodError was not raised.
In the example above, if the format is xml, it will render:
Includes the +perform_later+ method for job initialization.
It also allows you to update the avatar through the member:
It will include all of the helpers from engine's directory.
It will override the type of existing attributes if needed.
Load the configs so the require()s are done for custom cops
Maps logical Rails types to PostgreSQL-specific data types.
Note that it always returns +true+ with boolean attributes.
Note that the model is _not_ yet removed from the database:
Only test this if the underlying Time.at raises a TypeError
Oracle adapter returns floating point value 636.0 after SUM
Others remove columns when they migrate up instead of down:
Overwrite if you use another logger in your log subscriber.
Performs a POST request, following any subsequent redirect.
Provide support for raw values in the local cache strategy.
Provides access to the request's HTTP headers, for example:
Record history *after* loading so first load gets warnings.
Redirects the browser to the target specified in +options+.
Remove content node if it is blank and there are child tags
Returns +self+, so several appends may be chained together.
Returns a ColumnDefinition for the column with name +name+.
Returns a copy of the Array without the specified elements.
Returns a new Time representing the start of the day (0:00)
Returns a new date/time the specified number of months ago.
Returns an xml formatted representation of the Errors hash.
Returns nil if the initial offset falls outside the string.
Returns the connection currently associated with the class.
Returns true if the current object's time is in the future.
Setting the default to +nil+ effectively drops the default:
Specifies the number of rows to skip before returning rows.
Specifies the priority of the queue to create the job with.
Stream the file's contents if Rack::Sendfile isn't present.
Subtracts another Duration or a Numeric from this Duration.
The +class_name+ of the +attachable+ is passed as a String.
The Async adapter runs jobs with an in-process thread pool.
The Unicode version that is supported by the implementation
The checksum of the rubocop program running the inspection.
The first argument is an array like command line arguments:
The quality of the implementation depends on a good choice.
The second value can be a nested array of text-value pairs.
The timezone can be either :local or :utc (default :local).
Then, in another view, you could to do something like this:
Then, one asserts whether the current state is as expected.
These classes will be loaded when associations are created.
This associates two classes via an intermediate join table.
This can only be used for strings, not regular expressions.
This code example is allowed by AllowURI feature itself :).
This cop checks for uses of "*" as a substitute for *join*.
This helps to keep the nesting level from getting too deep.
This is particularly helpful in JavaScript responses, like:
This is useful for routes requiring a specific HTTP method.
This is useful when the options tag has complex attributes.
This marks every template in the directory as a dependency.
This method accepts both a single key and an array of keys.
This method allows negative parts to be present in pattern.
This method is also being used as a path for a view lookup.
This parser allows negative parts to be present in pattern.
This pulls :controller, :action, and :id out of the recall.
Topic.select('title').from('posts') SELECT title FROM posts
URL generation functionality is centralized in this module.
Unlike index, the create action will not render a template.
Until this point, we assume that the source is BINARY data.
Use this class to sense if migrations have gone up or down.
Using +OrderedOptions+, the above code could be reduced to:
Using the multiline modifier will raise an +ArgumentError+.
Wait a full second so we have time for changes to propagate
We can't cache results from code which is piped in to stdin
We only need the contents of the branch, not the condition.
We want to change the preferred delimiters for word arrays.
We're looking for (block (send (const nil :Proc) :new) ...)
When a block is given, it yields the content of the method.
When nothing is tagged with `:focus`, all examples get run.
Works great alongside individual template fragment caching.
You can also apply a layout to a block within any template:
You can declare as many identification indexes as you like.
You can modify this object before sending the HTTP request.
You can use them just like you use an application's routes:
You'll read permanent cookies through the regular accessor.
before_create :track_creation after_destroy :track_deletion
customer_with_no_projects.projects.to_xml(root: 'projects')
def alternative_message(diagnostic) 'My custom message' end
def before_declaring_variable(variable, variable_table) end
def instance_validations validates_with MyValidator end end
find the max length for the 'type' column, which is special
followed by an optional chain of zero-argument method calls
has_many through Source: has_many Through: has_many through
has_many through Source: has_many through Through: has_many
has_one through Source: belongs_to Through: has_one through
instantiate the delegate object after initialize is defined
necessary to trigger the has_transactional_callbacks branch
returns false if the then or else children are conditionals
returns the connection handler local to the current thread.
sees that a method is already defined, so doesn't intervene
should not try to assign and persist created_at, updated_at
sqlite dose not support CREATE, INSERT, and DELETE for VIEW
this should wake up the waiting threads one by one in order
this tests that this job class doesn't get its adapter set.
time_select("article", "start_time", include_seconds: true)
* SerializationError - Error class for serialization errors.
A list of all of the default view paths for this controller.
A utility method for escaping HTML entities in JSON strings.
Active Job has adapters for the following queueing backends:
Add a new +type+ column named +column_name+ to +table_name+.
Add event subscribers for all existing methods on the class.
All other asset *_path helpers delegate through this method.
Also note that +form_for+ doesn't create an exclusive scope.
An array may be used in the hash to use the SQL IN operator:
An array of expressions can also be passed in and evaluated.
An offense represents a style violation detected by RuboCop.
Any other file name will raise an IllegalMigrationNameError.
Append a path to the list of view paths for this controller.
Arguments and blocks are forwarded to the method if invoked:
Attempts to find the inverse association name automatically.
But the Rack app can still respond to its own HEAD requests.
By default, it will underscore then humanize the class name.
Check that a copyright notice was given in each source file.
Clears all dirty data: current changes and previous changes.
Common functionality for cops checking single/double quotes.
ConnectionHandler is a collection of ConnectionPool objects.
Convenience method to get the namespace from the class name.
Converts the attributes array of an XML element into a hash.
Create a new TimeZone object with the given name and offset.
Create new CLI instance to avoid using cached configuration.
Delegate unhandled messages to the current session instance.
Enable or disable mailer previews through app configuration:
Enables more predictable duck-typing on String-like classes.
Ensures all the resolver information is set in the template.
Except for public instance methods of Base and its ancestors
Execute the supplied block while holding the Exclusive lock.
File tree: file1 dir/.rubocop.yml dir/file2 dir/subdir/file3
For example, if the user invoke the controller generator as:
Force a row to have a database NULL instead of a JSON "null"
Force sprockets to be skipped when generating API only apps.
Generate something using a generator from Rails or a plugin.
Generator namespaces may be hidden for a variety of reasons.
If A extends ActiveRecord::Base, A.base_class will return A.
If a block is given to routes, it is appended to the engine.
If not specified, 2005 is used (as an "I don't care" value).
If we get here a root directory is not an ascendant of path.
If you want to expose your action to both GET and POST, use:
IfUnlessModifier depends on the configuration of LineLength.
Implements methods that allow rendering from a view context.
Includes the ability to override the default queue priority.
It's also important to treat the value objects as immutable.
Make sure the source is in the encoding of the returned code
NOTE - not sure that we can actually cope with inverses here
Nested NoMethodError is a different name from the delegation
Nested classes are prefixed with singular parent table name.
Normalizes the arguments and passes it on to find_templates.
Now you can have different transliterations for each locale:
Otherwise, the redirect is performed on the location header.
Overridden by the MySQL adapter for supporting index lengths
Performs a PATCH request, following any subsequent redirect.
Plugin can run without Rails loaded, check before filtering.
PostgreSQL doesn't support limits on binary (bytea) columns.
Regression, see https://github.com/rails/rails/issues/16468.
Reload application routes regardless if they changed or not.
Rescuable module adds support for easier exception handling.
Returns a TimeZone instance matching the time zone provided.
Returns a new Time representing the start of the hour (x:00)
Returns a set of HTML select-tags (one for hour and minute).
Returns a struct representing the matching attribute method.
Returns the amount of seconds a duration covers as a string.
Returns the number of seconds that this Duration represents.
Returns the offset from current time to UTC time in seconds.
Returns true if the date/time falls on a Saturday or Sunday.
Returns true if the given attribute exists, otherwise false.
See ActiveRecord::Attributes::ClassMethods for documentation
See _insert_callbacks for details on the allowed parameters.
Sends the +isolate_namespace+ method up to the class method.
Set color by using a symbol or one of the defined constants.
Show backtraces for deprecated behavior for quicker cleanup.
So if no month select is available, January will be assumed.
Specifies the number of `workers` to boot in clustered mode.
Strips all link tags from +html+ leaving just the link text.
Superclass for the evaluation contexts used by ERB fixtures.
Template's mime type is used if no content_type is specified
The class has a block comment within, so it's not corrected.
The join should match SpecialComment and its subclasses only
The method returns true if at least one element is the same.
The offense on line 4 is corrected, affecting lines 4 to 11.
The options are :table_name and :table_name_with_underscore.
Think of creating routes as drawing a map for your requests.
This class is used to store and access paths in Action View.
This class provides helper methods used in the ERB template.
This cop checks for case statements with an empty condition.
This cop checks for whitespace within string interpolations.
This cop enforces the use the shorthand for self-assignment.
This cop looks for *unless* expressions with *else* clauses.
This is done by passing a hash with a single key-value pair.
This is useful in combination with the +rescue_from+ option.
This is usually overwritten by helpers to add more behavior.
This method finds the options and details and extracts them.
This method will overwrite an existing Cache-Control header.
This module contains a collection of useful utility methods.
To solve this, a 3 second heartbeat runs on all connections.
To use Sneakers set the queue_adapter config to +:sneakers+.
To use the Inline set the queue_adapter config to +:inline+.
To use the test adapter set queue_adapter config to +:test+.
Use it only if that name can't be inferred from the part id.
User.order('email DESC').reorder('id ASC').order('name ASC')
We already have one so the existing record will be returned.
We can also pass in the symbol arguments instead of strings.
Whether the given cookie is to be deleted by this CookieJar.
and invoke the declared instance accessors as class methods.
config.action_mailer.preview_interceptors :css_inline_styler
config.middleware.insert_after Rack::Head, Magical::Unicorns
datetime_select("article", "written_on", discard_type: true)
def self.latest_article order('published_at desc').first end
don't touch anything unless we are sure it is a method call.
find the author, then find the posts, then find the comments
holds source read in from stdin, when --stdin option is used
operator (like FileUtils::rmdir instead of FileUtils.rmdir).
production: adapter: sqlite3 database: db/production.sqlite3
test a normal before_destroy doesn't destroy the habtm joins
"comments/comments" 'comments/comments' ('comments/comments')
(i.e. `do_something./(pattern)./(i)`) do_something /pattern/i
* +id+ - The id of the object you wish to reset a counter on.
* Any other key creates standard HTML attributes for the tag.
* If the argument responds to +to_ary+ the method is invoked.
* Support streaming from child templates, partials and so on.
+column_name+ can be a single Symbol, or an Array of Symbols.
+default+ The default value to use when no value is provided.
2 queries: one DELETE and another to update the counter cache
@example bad case foo when *condition bar when baz foobar end
@overload each_node(type) Yield only nodes matching the type.
A BigDecimal would be naturally represented as a JSON number.
A Time-like class that can represent a time in any time zone.
A lambda or a list of lambdas can be passed in and evaluated:
A module gets a name when it is first assigned to a constant.
A reference to the request instance used by the last request.
A share/exclusive lock, otherwise known as a read/write lock.
A shortcut to define a toplevel concern, not within a module.
A string is blank if it's empty or contains whitespaces only:
Also, we are not going to build a new array object per fetch.
An ActiveRecord::TransactionIsolationError will be raised if:
And of course, you can put as many as you like at a time too.
Asserts the given attribute type gets a proper default value:
Base class for AggregateReflection and AssociationReflection.
Builder templates are a more programmatic alternative to ERB.
Called when running tests with spring, let through unscathed.
Changes the column's definition according to the new options.
Checks to see if the view +view_name+ exists on the database.
Common functionality for dealing with frozen string literals.
Concrete subclass of a concrete class but has no type column.
Configure `config.ssl_options` with `hsts: false` to disable.
Connections must be leased while holding the main pool mutex.
Controls whether an action should be rendered using a layout.
Create 'namespace' ladder namespace :foo do namespace :bar do
Destructively converts all keys by using the block operation.
Destructively converts all keys using the +block+ operations.
Detect whether the codepoint is in a certain character class.
Disable extra failure output after a run if output is inline.
Disconnects all connections in the pool, and clears the pool.
Doing so will cut down the number of queries from 201 to 102.
Executes the SQL statement in the context of this connection.
I *think* they were just being defensive, but I have no idea.
If +candidates+ collection is not given, method returns true.
If +form+ is :local, then the time is in the system timezone.
If it's a string, it compares the file with the given string:
If so, we tell +attribute_missing+ to dispatch the attribute.
If the class has an initializer, it must accept no arguments.
If true, +to_time+ preserves the timezone offset of receiver.
If we got any syntax errors, return only the syntax offenses.
If you don't specify a pattern then the default will be used.
In all cases, we transcode the resulting String to the UTF-8.
Includes methods for executing and performing jobs instantly.
Indicates whether the table associated with this class exists
It's possible to stack callbacks by passing them as an array.
Keys are Rails TimeZone names, values are TZInfo identifiers.
Let's look at some examples using the +simple_format+ method:
Loops can be said to have an exit condition, so they add one.
Must uniq since instantiating with inner joins will get dupes
Or a string containing an i18n scope where to find this hash.
PRECONDITION: make sure ordering results in different results
Parser will produce str nodes for constants such as __FILE__.
Performs a DELETE request, following any subsequent redirect.
Prepend a path to the list of view paths for this controller.
Records are not instantiated and callbacks will not be fired.
Removes from the query the condition(s) specified in +skips+.
Render output including the HTTP Digest authentication header
Replaces the code of the source range `range` with `content`.
Returns +self+ if the password is correct, otherwise +false+.
Returns +true+ if the collection does not include the object.
Returns a cache key that can be used to identify this record.
Returns a module with all the helpers defined for the engine.
Returns a new Time representing the middle of the day (12:00)
Returns false if there is a +destroy_flag+ on the attributes.
Returns the maximum number of columns in a multicolumn index.
Returns the receiver if it's present otherwise returns +nil+.
Returns the table comment that's stored in database metadata.
Returns true if the string does not include the other string.
See http://en.wikipedia.org/wiki/Private_network for details.
Set proper cache control and transfer encoding when streaming
So we consider it's used to suppress false positive offenses.
Suppose that you have the following two Active Record models:
Technically this method can be used to fetch terminal values:
Test that MySQL allows multiple results for stored procedures
The constant WidgetsController can be resolved from the name.
The deprecated constant now returns the value of the new one.
The frozen string literal comment is only valid in Ruby 2.3+.
The last example above can be alternatively written this way:
The most versatile and common is the rendering of a template.
The name of the database adapter for the current environment.
The second run (and possibly the first) should hit the cache.
The stub returns the same config path for dir and dir/subdir.
These hash keys are nested attributes implementation details.
This allows plugins to hook into association object creation.
This connection will do for database-independent bug reports.
This cop checks for extra underscores in variable assignment.
This cop checks for non-ascii characters in identifier names.
This cop makes sure that accessor methods are named properly.
This cops checks for indentation that doesn't use two spaces.
This model can now be used with a nested fields_for, like so:
This takes precedence over configs located in any directories
To enqueue a job to be processed at some point in the future:
To implement, just extend ActiveModel::Naming in your object:
To use a custom separator, override the `separator` argument.
Unary + doesn't appear as a token and needs special handling.
Use an alternate output buffer for the duration of the block.
Used to allow arbitrary constants to be marked for unloading.
User.group(:name) SELECT "users".* FROM "users" GROUP BY name
When the job runs it will send the email using +deliver_now+.
Wrap the real socket to minimize the externally-presented API
You can supply a hash with a :prefix or :suffix to be tested.
add_source "http://gems.github.com/" do gem "rspec-rails" end
at least one uppercase letter, lowercase letter or underscore
attr_accessor :name validates_presence_of :name, on: :new end
change_column_default(:posts, :state, from: nil, to: "draft")
class_eval on an object acts like singleton_class.class_eval.
concerns also work in any routes helper that you want to use:
config.middleware.insert_before Rack::Head, Magical::Unicorns
define_callbacks :save set_callback :save, :before, Audit.new
has_many through Source: belongs_to Through: has_many through
has_many through Source: has_many through Through: belongs_to
joins is the list of all string join commands and arel nodes.
non reachable, hack to be able to stub exec in the test suite
only the correctly associated client should have been deleted
reordered to store upper right corner then bottom left corner
replace our new session_id with our old, pre-reset session_id
the first query is triggered because there are no topics yet.
2AM does not exist because at 2AM, time springs forward to 3AM
:nodoc: Force an attribute to have a particular "before" value
:nodoc: initialize cache at class definition for thread safety
A reference to the response instance used by the last request.
A simple integration test that exercises multiple controllers:
Abstract subclass of a concrete class which has a type column.
ActiveSupport::Notifications.instrument('wait') do sleep 1 end
Adds event subscribers for all new methods added to the class.
After that all the processes will start getting the new value.
All other options provided are forwarded to +asset_path+ call.
All public instance methods of this class, including ancestors
Alters the string by removing all occurrences of the patterns.
An arbitrary positive or negative difference can be specified.
Anything *not* in this set is provided by the English library.
Attempts to pluralize the +singular+ word unless +count+ is 1.
Avoid having to pass an open file handle as the response body.
By default, only save associated objects that are new records.
Called once a consumer has become a subscriber of the channel.
Check whether the integer is evenly divisible by the argument.
Checks for `if` expressions that do not have an `else` branch.
Concrete subclasses an abstract class which has a type column.
Defines an attributes writer for the specified association(s).
Destroy an object (or multiple objects) that has the given id.
Determine if the given constant has been automatically loaded.
Determine the template to be rendered using the given options.
Don't autocorrect if this would change the meaning of the code
Each line in the backtrace will be mapped against this filter.
FIXME: get following tests to pass on jruby, currently skipped
If +sources+ is a string, a single video tag will be returned.
If +value+ is +nil+ an attribute "nil" set to "true" is added.
If no config.beginning_of_week was specified, returns :monday.
If the key is a Hash, then keys will be sorted alphabetically.
In a few cases, the helper proxies to 'controller' or request.
In that case, +type+ and +options+ will be used by add_column.
Invoked after all files are inspected, or interrupted by user.
Keeps all information about view path and builds virtual path.
Loads all the given data into +records+ for the +association+.
Look for and parse json strings that look like ISO 8601 times.
Makes it easy to check whether a token is one of the brackets.
NOTE: queue_classic supports job scheduling since version 3.1.
Only public methods on actual controllers are callable actions
Only the function calls are affected by EnforcedStyle setting.
Parses a JSON string (JavaScript Object Notation) into a hash.
Passing a template handler in the template name is deprecated.
Rails finds namespaces similar to thor, it only adds one rule:
Raised when forbidden attributes are used for mass assignment.
Redirect url doesn't care that it wasn't a :redirect response.
Remember that this is a global setting for all Active Records.
Remove string values that aren't constants or subclasses of AR
Removes and returns the head of the queue if possible, or nil.
Returns a +Pathname+ to the fixture file named +fixture_name+.
Returns a hash mapping the names provided to the values found.
Returns a hash of parameters with all sensitive data replaced.
Returns a string suitable for an HTML image tag alt attribute.
Returns an HTML script tag for each of the +sources+ provided.
Returns an instance of DateTime with the timezone's UTC offset
Returns the number of threads currently waiting on this queue.
Returns the version of the currently loaded Rails as a string.
RuboCop must be in control of where its cached data is stored.
See ActionView::Helpers::FormHelper::fields_for for more info.
See ActiveRecord::Aggregations::ClassMethods for documentation
Set the location of mailer previews through app configuration:
Skip views, helpers and assets when generating a new resource.
So, we define the constant first, and load dependencies later.
Specify a serializer for the signed and encrypted cookie jars.
Such pattern can be a glob string supported by some variables.
TODO: Figure out what to do about literal encoding handling...
Takes the arguments that will be passed to the perform method.
Takes the environment such as +:production+ or +:development+.
Test if this Ruby supports each_object against singleton_class
The authenticity token is taken from the meta tag in this case
The cache key generated from this call will be something like:
The easiest thing for you to do is to simply ignore encodings.
The hard limit is 1GB, according to section 8.3 in the manual.
The next iteration will find the offense again and correct it.
The other keys' indentations are handled by the AlignHash cop.
The thread pool size maxes out at 4 worker threads by default.
The two are compared first on their offsets, and then by name.
This can be returned by a health check against the connection.
This cookie will be deleted when the user's browser is closed.
This cop checks for trailing comma in array and hash literals.
This cop checks whether the end keywords are aligned properly.
This feature is provided by the unobtrusive JavaScript driver.
This may lead to undesirable behavior such as a double DELETE.
This method is not intended to be called directly by the user.
This should be not be called manually but set in database.yml.
This should never leave the database in an inconsistent state.
To restart PostgreSQL 9.1 on OS X, installed via MacPorts, ...
Transform the model name into a more human format, using I18n.
Use true if you want to assign generic styles for select tags.
User.order('name') SELECT "users".* FROM "users" ORDER BY name
User.select(:name) Might return two records with the same name
User.select(:name).distinct Returns 1 record per distinct name
We need to sign the message in order to avoid padding attacks.
Wraps the +text+ into lines no longer than +line_width+ width.
You can also build forms using a customized FormBuilder class.
You can check the real cause for the exception in your logger.
You'll need to use a special comment format to call those out:
attribute has non-nil default value, so treated as not changed
create a first_thread and let it get into the FIFO queue first
datetime_select("trip", "departing", default: 3.days.from_now)
destination File.expand_path("../tmp", File.dirname(__FILE__))
development: adapter: sqlite3 database: db/development.sqlite3
frozen_string_literal: true rubocop:disable Metrics/LineLength
mail(template_path: 'notifications', template_name: 'another')
mock out self.columns so no pesky db is needed for these tests
says nicknames cannot be +NULL+ (adds the constraint), whereas
setting time_zone_aware_attributes causes the types to change.
support methods for deep transforming nested hashes and arrays
t.references(:user) t.belongs_to(:supplier, foreign_key: true)
t.remove(:qualification) t.remove(:qualification, :experience)
to_json is being invoked directly, use ActiveSupport's encoder
"WidgetsController::index::authenticated user::returns widgets"
* +:reply_to+ - Who to set the Reply-To header of the email to.
+attr_name+ The name of the attribute to retrieve the type for.
+link_to+ can also produce links with anchors or query strings:
Add HTML attributes by passing an attributes hash to +options+.
Adds instrumentation to several ends in ActionController::Base.
Adds methods to set and authenticate against a BCrypt password.
An else branch does not, since it doesn't add a decision point.
An equivalent way of setting up this association this would be:
And finally they can also be removed from the stack completely:
Any change is instantly reflected in the Active Record objects.
Any further options are used as connection parameters to libpq.
Any options not seen here are passed on as params with the url.
ApplicationController.renderer.new(method: 'post', https: true)
BigDecimals need to be put in a non-normalized form and quoted.
By default +text+ is sanitized to prevent possible XSS attacks.
CREATE INDEX by_name_surname ON accounts(name(10), surname(15))
Call render_body if we are streaming instead of usual +render+.
Check ActiveRecord::Railties::ControllerRuntime for an example.
Checks for uses of `do` in multi-line `while/until` statements.
Checks if the action name is valid and returns false otherwise.
Checks to see if the data source +name+ exists on the database.
Checks to see if the table +table_name+ exists on the database.
Code can be specified in a block or a data string can be given.
Connecting to the DB is done outside main synchronized section.
Corrector to correct conditional assignment in `if` statements.
Create a new renderer instance for a specific controller class.
Creates a new job instance from a hash created with +serialize+
Defines both class and instance accessors for class attributes.
Destructively converts all values using the +block+ operations.
Don't cache the association - we would only be caching a subset
Don't limit below 21, because that's the header of the testfile
Don't limit below 38, because that's the header of the testfile
Either a class or a string can be passed in as the Interceptor.
Every time rake runs this task is instantiated as all the rest.
Extracts the value from a PostgreSQL column default definition.
Forces eager loading by performing a LEFT OUTER JOIN on +args+:
If a namespace is defined, it will be prefixed on to every key.
If it's a Symbol, we figure out what its corresponding code is.
If we call 'options' with it unset, we get double help banners.
In the last case, the following paths map to +PostsController+:
In this case, there must be a +type+ column in the posts table.
In those cases, you can resort to named bind variables instead.
It will register a separate offense for each misaligned *when*.
It's not possible to derive all render calls like that, though.
Job: The timeout can be set for each instance of the job class.
Keys are always translated into Strings and are case sensitive.
Merges the default options with ones specific to a method call.
One recommendation is to simply be explicit in a comment, like:
Parses number which can be a float with either comma or period.
PostgreSQL changes the default order if no order clause is used
Provides options for converting numbers into formatted strings.
Provides precise Date calculations for years, months, and days.
RAILS_ENV needs to be set before config/application is required
Remove all of the comments and blank lines from the routes file
Returns a Range representing the whole day of the current time.
Returns a hash of request.env with all sensitive data replaced.
Returns a link tag for a favicon managed by the asset pipeline.
Returns the maximum number of elements in an IN (x,y,z) clause.
Returns true for lines that shall not be included in the count.
Run the supplied block as a work unit, reloading code as needed
See ActiveRecord::Associations::ClassMethods for documentation.
See ActiveRecord::Transactions::ClassMethods for documentation.
See active_record/lib/relation/batches.rb for more information.
Serves as a point for accessing the objects in the association.
Set the current directory as base for the inherited generators.
Set the view path to an application view structure with layouts
Should not be destroyed since the association is not dependent.
Signal that the thread is finished with the current connection.
Some special arrangements have to be made for operator methods.
Strips off trailing slash and ensures there is a leading slash.
Tags are declared in the server but computed in the connection.
The +options+ argument must be a hash whose keys are *symbols*.
The +type+ and +options+ parameters will be ignored if present.
The CommandRecorder knows how to invert the following commands:
The actual before_action that is used to verify the CSRF token.
The basic idea for this cop was from the warning of `ruby -cw`:
The comment will be added below a shebang and encoding comment.
The name of the key on the model which declares the association
The number of times a specific job is enqueued can be asserted.
The only necessary method to implement is the "perform" method.
Then we can skip decode+encode if we're just proxying messages.
There are cops/forces that require their own custom processing.
This class method is the single entry point for the rake tasks.
This cop checks for RuntimeError as the argument of raise/fail.
This cop checks for the use of output calls like puts and print
This cop checks for uses of the deprecated class method usages.
This cop enforces the consistent use of action filters methods.
This cop looks for uses of the *for* keyword, or *each* method.
This inserts a badge and changes the preamble of the home page.
This is an internal method and should not be accessed directly.
This is the same logging logic as in ShowExceptions middleware.
This method is private, as we are hoping to remove it entirely.
Updates all records in the current relation with details given.
Use `next` to skip iteration instead of a condition at the end.
We are running without transactional tests and need to cleanup.
We silently rollback this transaction without telling the user.
What can be written like this with the regular calls to column:
When your JavaScript response loads on their site, it executes.
You can also pass a type object directly, in place of a symbol.
You need to start a memcached server inorder to run these tests
`when` nodes contain the entire branch including the condition.
config.middleware.swap ActionDispatch::Flash, Magical::Unicorns
def save run_callbacks :save do puts 'save in main' end end end
if structure is not loaded correctly, exception would be raised
skip this test if default_dir is the only directory on Gem.path
* +id+ - This should be the id or an array of ids to be updated.
* ConnectionNotEstablished - No connection has been established.
* DeserializationError - Error class for deserialization errors.
- +params+: The hash with HTTP parameters that you want to pass.
:nodoc: create a subset of the hash by applying :only or :except
A range may be used in the hash to use the SQL BETWEEN operator:
A reference to the controller instance used by the last request.
ActiveSupport.run_load_hooks(:active_record, ActiveRecord::Base)
Actually converts an XML document element into a data structure.
Adds comment for given table or drops it if +comment+ is a +nil+
All the normal String methods are also implemented on the proxy.
Allows the use of per-connection tags against the server logger.
An action may contain only a single render or a single redirect.
An object is blank if it's false, empty, or a whitespace string.
Any class that includes this module will get all named routes...
Apply charset at the beginning so all fields are properly quoted
As you see, we use the output embeddings for the render methods.
Asserts that the number of emails sent matches the given number.
At the beginning, do not consider class default for content_type
Calls the action going through the entire action dispatch stack.
Common functionality for checking length of classes and modules.
Computes the table name, (re)sets it internally, and returns it.
Controls whether request forgery protection is turned on or not.
Decodes the signed message using the +MessageVerifier+'s secret.
Determine if a record was created or destroyed in a transaction.
Don't check indentation if the line doesn't start with the body.
Example sending parameters, session and setting a flash message:
Example usage of DatabaseTasks outside Rails could look as such:
Expands all paths against the root and return all unique values.
FIXME: shush Sass warning spam, not relevant to testing Railties
For scope names which contain spaces this approach doesn't work.
Generally it can be any wrapper that provides +load+ and +dump+.
Holds the class which implements the request forgery protection.
Hook method defining how an attribute value should be retrieved.
However you can still overwrite individual conventions, such as:
If false, removes all subdomains from the host part of the link.
If no error is present, the method should return an empty array.
If you have secret_key_base set, your cookies will be encrypted.
Includes microseconds if the value is a Time responding to usec.
Individual cache implementations may support additional options.
It can also optionally accept the current object as an argument.
It can be asserted that no jobs of a specific kind are enqueued:
Make sure the second save gets the after_create callback called.
Mark for removal entries that were kept, and delete unkept ones.
Most of the methods in the adapter are useful during migrations.
Only use it if the name cannot be inferred from the association.
Optionally raises an exception if the layout could not be found.
Oracle sometimes sorts differently if WHERE condition is changed
Other indentation shall be the same regardless of EnforcedStyle.
Override this method in a module to change the default behavior.
Parser knows whether the foo is a variable or method invocation.
Passing in an array of attributes to group by is also supported.
Please note the fourth argument does not set a column's default.
Possible values are +:random+, +:parallel+, +:alpha+, +:sorted+.
PostgreSQL-specific extensions to column definitions in a table.
Preserve the timezone of the receiver when calling to `to_time`.
Put gem configuration first so local configuration overrides it.
Qu is a Ruby library for queuing and processing background jobs.
Quote "type" if it's a reserved word for the current connection.
Raised when unknown attributes are supplied via mass assignment.
Reconstructed a path with all sensitive GET parameters replaced.
Records are separated by a blank line for your viewing pleasure.
Removes `size` characters from the beginning of the given range.
Removes and returns the key/value pairs matching the given keys.
Removes items that the block evaluates to true and returns self.
Represents an SQL table in an abstract way for updating a table.
Returns +true+ if the cache contains an entry for the given key.
Returns +true+ if the parameter is permitted, +false+ otherwise.
Returns Monday of this week assuming that week starts on Monday.
Returns Sunday of this week assuming that week starts on Monday.
Returns a copy of the enumerable without the specified elements.
Returns a new DateTime representing the start of the day (0:00).
Returns a representation of the annotation that looks like this:
Returns a scope for the model without the previously set scopes.
Returns a subquery for the given key using the join information.
Returns an array populated with missing keys if any are present.
Returns the contents of the record as a nicely formatted string.
Returns the current cycle string after a cycle has been started.
Returns the number of bytes equivalent to the exabytes provided.
Returns the relation names useable to back Active Record models.
Returns the size of the collection calling +size+ on the target.
Returns true, since this connection adapter supports migrations.
See ActiveSupport::Cache::Strategy::LocalCache for more details.
Send welcome message to the internal connection monitor channel.
So you specify the object you want messaged on a given callback.
Specify whether submit_tag should automatically disable on click
Streams allow channels to route broadcastings to the subscriber.
Subsequent calls to order on the same relation will be appended.
TODO: More precise handling (rescue, ensure, nested begin, etc.)
TODO: The reason for this test is unclear, improve documentation
Takes in an array of nested modules and extracts the last module
Thanks to James Tucker for the Gem tricks involved in this call.
The above example will now change /posts/new to /posts/brand_new
The given symbol(s) should match the name of the association(s).
The key is expanded using ActiveSupport::Cache.expand_cache_key.
The map tells them where to go based on some predefined pattern:
This class performs a pattern-matching operation on an AST node.
This cop checks for non-nil checks, which are usually redundant.
This cop checks for uses of *begin...end while/until something*.
This cop enforces the use of a single string formatting utility.
This has functionality that might be shared by multiple classes.
This is especially useful for boolean flags on existing records.
This is important for streaming responses such as the following:
This is required because PATH_INFO isn't reset between requests.
This makes app.url_for and app.foo_path available in the console
This method creates nested route entry for namespaced resources.
This regular expression is used to split the levels of a domain.
To use Backburner set the queue_adapter config to +:backburner+.
Usable when the storage for a string is limited for some reason.
Uses the git repo if one is given, otherwise use name (version).
We don't know which came from the proxy, and which from the user
We need to verify the message in order to avoid padding attacks.
You can also send a real document in the simulated HTTP request.
You can localize your labels based on model and attribute names.
`return` does not exit to outside of lambda block, this is safe.
both attributes of saved object should be treated as not changed
check if there's any whitespace between the keyword and the cond
class Current mattr_accessor :user, instance_accessor: false end
class Person include ActiveModel::Model attr_accessor :id, :name
concern :image_attachable do resources :images, only: :index end
create a map matching lines to the number of expressions on them
create dynamic Post models to allow different dependency options
def some_method(used, unused, _unused_but_allowed) puts used end
element:: XML element whose texts are to me merged into the hash
frozen_string_literal: true rubocop:disable Metrics/ModuleLength
if the right brace is on the same line as the last value, accept
l.(1) has no selector, so we use the opening parenthesis instead
offense is registered on args node when parentheses are unwanted
outside of transactions we can simply flush this query and retry
record.written on is equal to (i.e., simultaneous with) utc_time
select_time(my_time, time_separator: ':', include_seconds: true)
subdir does not look for Ruby files, but its parent tmpdir does.
time_zone_select( "user", "time_zone", nil, include_blank: true)
touch the parents as we are not calling the after_save callbacks
which will work similarly to formats and MIME types negotiation.
* The CurrencyController inherits the layout from BankController.
+attribute_missing+ is like +method_missing+, but for attributes.
+schema+ and +identifier+ are unquoted to prevent double quoting.
1) Include ActionView::Context to bring the required dependencies
2) Call _prepare_context that will do the required initialization
2:30AM does not exist because at 2AM, time springs forward to 3AM
@overload each_ancestor(type) Yield only nodes matching the type.
A hanging closing parenthesis means `)` preceded by a line break.
A mailer model defines methods used to generate an email message.
Add a value to a multivalued header like Vary or Accept-Encoding.
Aliasing these off because AD::Http::Cache::Response defines them
All initialization is done, including eager loading in production
All of the association macros can be specialized through options.
All other controllers in turn inherit from ApplicationController.
Also accepts keys as strings (for parsing from YAML for example):
An abstract class that implements a Resolver with path semantics.
An array may also be specified, to support testing multiple jobs.
And pass the bind values as the first argument of +execute+ call.
Article.published.featured.latest_article Article.featured.titles
Autoloading recursion, also expected to be watched and discarded.
Be sure to include shadowed public instance methods of this class
By default, only save the associated object if it's a new record.
Calls the given block for each ancestor node from parent to root.
Common functionality for cops checking if and unless expressions.
Compare objects before comparing counts for clear failure output.
Convenience for loading config/foo.yml for the current Rails env.
Corrector to correct conditional assignment in `case` statements.
Crazy H4X to get this working in windows / jruby with no forking.
Create a new renderer for the same controller but with a new env.
Creates an internal metadata table with columns +key+ and +value+
Defines the primary key field -- can be overridden in subclasses.
DeprecatedObjectProxy transforms an object into a deprecated one.
Derives the join table name for +first_table+ and +second_table+.
Don't check if expression is on same line as "then" keyword, etc.
Each response is represented by a corresponding block if present.
Empty strings for fixnum and float columns are turned into +nil+.
Every +frequency+ seconds, the reaper will call +reap+ on +pool+.
Exclude column attribute since MRI does not output column number.
Fallback to config.secret_token if secrets.secret_token isn't set
For convenience, an instance predicate method is defined as well.
For example, you can use that when manually building SQL strings:
Good practice is to let the first declared status be the default.
Handles calculation of deltas when the enforced style is 'table'.
If the args is just a non-empty options hash, go to the database.
If the future has made this irrelevant, feel free to delete this.
If you absolutely must write from within a function use +concat+.
If you are using Unicorn with NGINX, you may need to tweak NGINX.
Includes the setter method for changing the active queue adapter.
It is recommended that this string be base64 or hexadecimal data.
It is recommended that you use `sanitize` instead of this method.
It returns a new value object instead of changing its own values.
Keep hooks configuration that are used on prepare_for_invocation.
Mary and Bob both have posts in misc, but they are the only ones.
More details here https://github.com/whitequark/parser/issues/283
Mount a Rack-based application to be used within the application.
Note that the return value of validation methods is not relevant.
Pass a method name or lambda argument or provide a block to call.
Please note that YAML must be consistently indented using spaces.
Please refer to the documentation of the base helper for details.
Pluck all the ID's for the relation using the table's primary key
Provides a proxy to access helpers methods from outside the view.
Rather, you just call the method you defined on the class itself.
Reference: http://www.limited-entropy.com/padding-oracle-attacks.
Register an Interceptor which will be called before mail is sent.
Remove the first blank element in case of '::ClassName' notation.
Requests to routes can be constrained based on specific criteria:
Returns +nil+ if the message was not signed with the same secret.
Returns a Duration instance matching the number of days provided.
Returns a new DateTime representing the middle of the day (12:00)
Returns a new Time representing the start of the minute (x:xx:00)
Returns a string like 'Post(id:integer, title:string, body:text)'
Returns all the identifiers that were applied to this connection.
Returns the configuration of the associated connection as a hash:
Returns the module which contains this one according to its name.
Returns the number of bytes equivalent to the gigabytes provided.
Returns the number of bytes equivalent to the kilobytes provided.
Returns the number of bytes equivalent to the megabytes provided.
Returns the number of bytes equivalent to the petabytes provided.
Returns the number of bytes equivalent to the terabytes provided.
Returns the parent node, or `nil` if the receiver is a root node.
Returns true if the logger destination matches one of the sources
Search for a file in autoload_paths matching the provided suffix.
See Response for more information on controller response objects.
See Time and TimeZone for further documentation of these methods.
See docs on the FlashHash class for more details about the flash.
Session is responsible for lazily loading the session from store.
Significant was set to true with precision 2, using b for billion
Single quotes not escaped in Ruby 1.9, so add extra substitution.
So we only load the YAML code if we find some real code in there.
Specifies words that are uncountable and should not be inflected.
Stub the destroy method of the second child to raise an exception
Take care of the broken text/xml entry by renaming or deleting it
The +key+ argument can also respond to +cache_key+ or +to_param+.
The contents are the same, so no corruption of data should occur.
The current Rails environment (development, test, or production).
The default returns "Infinity" or "NaN" which are not valid JSON.
The foreign keys are represented as ForeignKeyDefinition objects.
The given key may still get filtered out when +permit+ is called.
The hard limit is 1GB, because of a 32-bit size field, and TOAST.
The object returned is a relation, which can be further extended.
The user has defined their own default scope method, so call that
There's an implicit variable reference by the zero-arity `super`:
This allows you to modify application's generators from Railties.
This approach was introduced in Rails 3.1 and is still improving.
This cop checks for multiple expressions placed on the same line.
This cop checks for the use of the has_and_belongs_to_many macro.
This cop checks if the length a class exceeds some maximum value.
This cop makes sure that Ruby source files have snake_case names.
This is a registry for all the event stacks kept for subscribers.
This is because automatic corrections can introduce new offenses.
This method should return an array with the messages to be added.
This module provides methods for generating asset paths and urls.
This operates similarly to a has_and_belongs_to_many association.
To clear the cookies for a test just clear the cookie collection:
To remove unused values, the explicit hash syntax should be used.
Tune the size yourself with config.action_cable.worker_pool_size.
Two rewrites in the same area by the same cop can not be handled.
URI path and fragment escaping http://tools.ietf.org/html/rfc3986
Uploaded files are temporary files whose lifespan is one request.
Use a smaller worker pool or a larger db connection pool instead.
Useful for making sure that only one user can be named "davidhh".
Validates whether the associated object or objects are all valid.
Variants also support common +any+/+all+ block that formats have.
When streaming, rendering happens top-down instead of inside-out.
Wraps any standard Logger object to provide tagging capabilities.
You can also pass a block to new with the new record as argument:
You can also use interpolation in the supplied redirect argument:
You can even render plain text directly without using a template:
You may wish to organize groups of controllers under a namespace.
class Audit def before(caller) puts 'Audit: before is called' end
controller "food" do match "bacon", action: :bacon, via: :get end
date_select("article", "written_on", use_two_digit_numbers: true)
eagerloaded row count should be greater than just developer count
migration_template "migration.rb", "db/migrate/add_foo_to_bar.rb"
rubocop:enable Metrics/MethodLength, Metrics/CyclomaticComplexity
t.change(:name, :string, limit: 80) t.change(:description, :text)
this lets us do YAML defaults and not have an extra fixture entry
* Lazily load TZInfo::Timezone instances only when they're needed.
:nodoc: Abstract representation of an index definition on a table.
:nodoc: Converts the given object to an ActiveModel compliant one.
:nodoc: The internal PostgreSQL identifier of the BYTEA data type.
A helper to make it easier to test different route configurations.
Accepts a Date or Time object and inserts it in the proper format.
Active Record can serialize any object in text columns using YAML.
Add a class collisions name to be checked on class initialization.
All mounted applications come with routing helpers to access them.
Asserts that the number of enqueued jobs matches the given number.
Builds a hash containing the flashes to keep for the next request.
Checks for uses of the `then` keyword in multi-line if statements.
Checks for various semantic errors as stated in ISO 8601 standard.
Classes passed to `serialize` must have a 0 argument constructor."
Clone the last fixture to check that it gets the next greatest id.
Common methods and behaviors for dealing with remote config files.
Connection details inside of the "url" key win any merge conflicts
Construct attributes for :through pointing to owner and associate.
Controls whether form-action/method specific CSRF tokens are used.
Converts a value from database input to the appropriate ruby type.
Corrector to correct conditional assignment in ternary conditions.
Delegation is particularly useful with Active Record associations:
Either a class, string or symbol can be passed in as the Observer.
Exceptions raised inside exception handlers are not propagated up.
FIXME: Remove this class, and the second argument to lookups on PG
FIXME: as far as I can tell, `from` will always be an Arel::Table.
For example, a BlogPost model might return "blog_posts/blog_post".
For more information on locking, please see ActiveRecord::Locking.
Gets the Rails::Html::FullSanitizer instance used by +strip_tags+.
Hack, ignore the desc calls performed by the original initializer.
Helper for building query glob string based on resolver's pattern.
However, they are supported by Chrome, Firefox, Opera, and Safari.
If +false+, the number of fractional digits (defaults to +false+).
If so, a streaming buffer *may* be passed when it start rendering.
If you want to expose your action to GET, use +get+ in the router:
Implement the required interface for Rails::Generators::Migration.
In normal cases, this method returns the same name as it receives.
In order to use DatabaseTasks, a few config values need to be set.
In this way the server can limit the time of the nonce's validity.
Include any trailing whitespace so we don't create a syntax error.
It can be set to any of the normalizations in NORMALIZATION_FORMS.
It checks if the action name is valid and returns false otherwise.
Make upwards search for .rubocop.yml files stop at this directory.
Makes backticks behave (somewhat more) similarly on all platforms.
Meant to be used by ConnectionPool with which it shares a Monitor.
Note that marking a constant for unloading need only be done once.
Notice this method takes into consideration the default root path.
ONLY Use ONLY if you want to generate only one or a set of guides.
ONLY Use ONLY if you want to validate only one or a set of guides.
Only loads a smaller set of middleware suitable for API only apps.
Passes if evaluated code in the yielded block raises no exception.
Paths in other config files are relative to the current directory.
Raised when an unsupported argument type is set as a job argument.
Relative paths are idiomatic, use absolute paths only when needed.
Removes the index named +by_branch_party+ in the +accounts+ table.
Resets the sequence of a table's primary key to the maximum value.
Restore available locales check so it will take place from now on.
Returns +true+ if the given +record+ is present in the collection.
Returns +true+ if the session is mimicking a secure HTTPS request.
Returns a Duration instance matching the number of hours provided.
Returns a Duration instance matching the number of weeks provided.
Returns a consistent, platform-independent identifier for +label+.
Returns a new DateTime representing the end of the day (23:59:59).
Returns a new hash with all keys converted by the block operation.
Returns a new string with all occurrences of the patterns removed.
Returns a string containing an XML representation of its receiver:
Returns fully resolved connection, accepts hash, string or symbol.
Returns the list of parameters which will be selected for wrapped.
See https://dev.mysql.com/doc/refman/5.7/en/group-by-handling.html
Sets the sequence of a table's primary key to the specified value.
Simulate `db:rollback` + edit of the migration file + `db:migrate`
So you shouldn't use it for elements that will be fragment cached.
Specify whether an error should be raised for missing translations
Test the inverse order in case the first success was a coincidence
The +div_radio_button+ code from above can now be used as follows:
The Configuration instance used to configure the Rails environment
The capture method extracts part of a template as a String object.
The check stops when we reach Object or the end of ancestors tree.
The first is a version of library and the second is a library name
The options hash is passed to the underlying cache implementation.
The set of directories from which we may automatically load files.
The very last line of +activerecord/lib/active_record/base.rb+ is:
Then define a list of methods that you want callbacks attached to:
This allows method chaining on the result of any of these methods.
This allows using AS::DescendantsTracker without AS::Dependencies.
This can be used for example, to alternate classes for table rows.
This cop checks for *rescue* blocks targeting the Exception class.
This cop checks for Windows-style line endings in the source code.
This cop checks if the length a module exceeds some maximum value.
This is useful if you want to display a corporate logo or a photo.
This locking mechanism will function inside a single Ruby process.
This may happen if there are paths in different drives on Windows.
This mechanism requires you to have a +password_digest+ attribute.
This mix-in module provides string coloring methods for terminals.
To add a member route, add a member block into the resource block:
To match a wildcard parameter, it must have a name assigned to it.
To recreate the instance, pass a non-false value as the parameter.
Useful for tests that need to compare SQL queries on associations.
Using explicit id in insert for compatibility across all databases
Weak ETags are what we almost always need, so they're the default.
When a class is inherited, wrap its helper module in a new module.
When it comes to streaming, exceptions get a bit more complicated.
When the time comes, V5_0 should be defined straight in its class.
Worker used by Server.send_async to do connection work in threads.
Yields an ActiveRecord::Relation object for each batch of records.
You can add new inflections in config/initializers/inflections.rb.
You can pass the following options to change the default behavior.
You can require that the attribute matches the regular expression:
You can set the default value from the database declaration, like:
You can subscribe to some event temporarily while some block runs.
You can think of a layout as a method that is called with a block.
You would use +content_for+ in your template to specify the title:
`elsif` branches show up in the if node as nested `else` branches.
active_support.rb sets an autoload for ActiveSupport::Deprecation.
as well as adding or subtracting their results from a Time object.
class Person include ActiveModel::Conversion attr_accessor :id end
class Person include ActiveModel::Validations attr_accessor :title
def perform(*args) raise ErrorLoadingSite if cannot scrape end end
generates class method .columns, which conflicts with an AR method
george: id: 1 name: George the Monkey fruits: apple, orange, grape
has_many through Source: has_and_belongs_to_many Through: has_many
has_many through Source: has_many Through: has_and_belongs_to_many
if the right bracket is on the same line as the last value, accept
mysql by default does not store fractional seconds in the database
private def generate_connection_token SecureRandom.hex(36) end end
remove_reference(:products, :user, index: true, foreign_key: true)
reset the html_document variable, except for cookies/assigns calls
rubocop:disable Metrics/MethodLength, Metrics/CyclomaticComplexity
setup do ActiveRecord::LogSubscriber.attach_to(:active_record) end
"rails:generators:webrat", "webrat:generators:controller", "webrat"
+constraints+ is a hash of constraints to be applied to this route.
+delim+ corresponds to the `typdelim` column in the pg_types table.
-- Allows code reuse in the methods below without polluting Module.
:nodoc: PostgreSQL doesn't like ORDER BY when there are no GROUP BY
@overload each_child_node(type) Yield only nodes matching the type.
@overload each_descendant(type) Yield only nodes matching the type.
A basic formatter that displays the lines disabled inline comments.
A cache store implementation which doesn't actually store anything.
A custom scrubber takes precedence over custom tags and attributes.
ActiveSupport::Cache::Store can store any serializable Ruby object.
Add configured load paths to ruby load paths and remove duplicates.
All other controllers in turn inherit from +ApplicationController+.
Asserts that the number of performed jobs matches the given number.
Attempting to change it afterwards will result in a +RuntimeError+.
Can be a single value, array, or an object that responds to +call+.
Can be called multiple times, but this is probably not a good idea.
Common functionality for cops which processes Parser's diagnostics.
Computes and returns a table name according to default conventions.
Control the link options in url_for format using the +url_options+.
Converts RuboCop objects to and from the serialization format JSON.
Corrector to correct conditional assignment in `unless` statements.
Could be a CSV list and/or repeated headers that were concatenated.
Create such a table with custom function as default value generator
Define file as an alias to create_file for backwards compatibility.
Don't omit the accumulator when calling `next` in a `reduce` block.
Examples of calling methods on the returned BatchEnumerator object:
Expose the eager_load_namespaces at "module" level for convenience.
For instance if the template the collection renders is cached like:
For more complicated hash keys, let the parser validate the syntax.
Generators frequently change the current path using +FileUtils.cd+.
Gets the Rails::Html::LinkSanitizer instance used by +strip_links+.
However, there are examples where this strategy doesn't make sense.
IF YOU DON'T USE A PROXY, THIS MAKES YOU VULNERABLE TO IP SPOOFING.
If it's a Fixnum or String, we figure out what its symbolized name.
If no time argument is passed, the current time is used as default.
If there is a trailing hash arg without explicit braces, like this:
Impersonating a connection requires a TaggedLoggerProxy'ied logger.
In order to benefit from streaming you would want to rewrite it as:
In that case, +options+ and the block will be used by create_table.
Include user ID in the path to make sure the user has write access.
Includes the ability to override the default queue name and prefix.
Initialize ORM::Generators::ActiveModel to access instance methods.
Initialize cache early in the stack so railties can make use of it.
Inputs of type "search" may be styled differently by some browsers.
Instantiates the controller, then executes the action named +name+.
It also finds uses of `alias :symbol` rather than `alias bareword`.
Its results are tested comprehensively in the inflector test cases.
Mark these as private so we don't leak encoding-specific constructs
Middleware like session, flash, cookies can be added back manually.
Nest FirmOnTheFly in the test case where Dependencies won't see it.
Normalize arguments by catching blocks and setting them on :update.
Note that magic comments must be at the first line(except sh-bang).
One query for updating name and second query for updating pirate_id
Other classes we mess with will be dealt with in the specific tests
Parse an XML Document string or IO into a simple hash using libxml.
Parses the token and options out of the token authorization header.
Pass in the instance of the object that is using the errors object.
Prepares the context by setting the appropriate instance variables.
Provides access to the request's HTTP headers from the environment.
Provides access to the underlying database driver for this adapter.
Put the new handler at the end because the list is read in reverse.
Raise Rack::Utils::InvalidParameterError for consistency with Rack.
Register an Observer which will be notified when mail is delivered.
Removes the module part from the constant expression in the string.
Resources can also be nested infinitely by using this block syntax:
Respond to variants in the action just like you respond to formats:
Returns +text+ transformed into HTML using simple formatting rules.
Returns a +string+ identifying the path associated with the object.
Returns a new DateTime representing the end of the hour (hh:59:59).
Returns a new Time representing the end of the day, 23:59:59.999999
Returns a new Time representing the end of the hour, x:59:59.999999
Returns a new date/time the specified number of days in the future.
Returns a new hash with +self+ and +other_hash+ merged recursively.
Returns an HTML block tag of type +name+ surrounding the +content+.
Returns an instance of ConnectionSpecification for a given adapter.
Returns default for the option name given doing a lookup in config.
Returns the corresponding message for the current HTTP status code:
Returns the result of a render that's dictated by the options hash.
See: http://www.postgresql.org/docs/current/static/ddl-schemas.html
Set a fake logger to avoid creating the log directory automatically
Sets the base_name taking into account the current class namespace.
Should be destroyed since the association is exclusively dependent.
Test private kernel method through collection proxy using has_many.
Tests correction of an issue resulting in `lambdado` syntax errors.
The cookie is signed by your app's `secrets.secret_key_base` value.
The cookies of the request that initiated the WebSocket connection.
The default strategy for an UPDATE with joins is to use a subquery.
The exhaustive tests are in test/controller/html/sanitizer_test.rb.
The other elements' indentations are handled by the AlignArray cop.
The reject_if option is defined by +accepts_nested_attributes_for+.
The result may contain alphanumeric characters except 0, O, I and l
The string will not be modified if the range given is out of bounds
This allows any character other than a slash as part of your +:id+.
This class wraps all the strings we see and does the extra escaping
This configures the callbacks intended for overwriting by the user.
This cop checks for non-ascii (non-English) characters in comments.
This ensures that the scope is re-evaluated each time it is called.
This file is auto-generated from the current state of the database.
This is most probably a mistake, but not this cop's responsibility.
This is used internally by rails to set its generators source root.
This is useful for testing multiple sessions in a single test case.
This logic should be extracted to `env_config` and calculated once.
This may improve the asset loading performance of your application.
This means that the resulting array always contains a blank string.
This will make the wrapped hash accessible from controller and view
Through associations can either use the has_many or has_one macros.
To do this just assign a value to the session or cookie collection:
To use Delayed Job, set the queue_adapter config to +:delayed_job+.
True if an ETag is set and it's a weak validator (preceded with W/)
Try to match the absolute path, as Exclude properties are absolute.
Use callbacks to share common setup or constraints between actions.
We use our object ID here to avoid conflicting with other instances
We want a nice table layout, so we allow space inside empty hashes.
What we want here is 'content   ', not ' content content content '.
Within the mailer method, you have access to the following methods:
You can even reference any named routes you happen to have defined.
You may also set the content type, the file name, and other things.
You may also specify additional options via the +options+ argument.
add_reference(:products, :supplier, polymorphic: true, index: true)
assert_nothing_raised do perform_service(param: 'no_exception') end
checks that parent node of send_type and receiver is the given node
class Current thread_mattr_reader :user, instance_reader: false end
class Current thread_mattr_writer :user, instance_writer: false end
class Person has_many :pets accepts_nested_attributes_for :pets end
def before_save(caller) puts 'Audit: before_save is called' end end
def_matcher can be used to define a pattern-matching method on Node
namespace :admin do namespace :users do resources :products end end
only override explicitly set adapters, a quirk of `class_attribute`
reduce 3 omitted reduce 4 omitted reduce 5 omitted reduce 6 omitted
returns either false or the inverse association name that it finds.
scope path: ":account_id", as: "account" do resources :projects end
test generating engine's route from engine with default_url_options
tests the arguments modification free version of define_hash_access
the header is part of the HTML page, so we don't construct it here.
(SET TIME ZONE does not use an equals sign like other SET variables)
* +counter_name+ - The name of the field that should be decremented.
* +counter_name+ - The name of the field that should be incremented.
* No args - Returns +false+ if the table is empty, +true+ otherwise.
* StatementInvalid - The database server rejected the SQL statement.
+scope+ takes additional options which apply to all enclosed routes.
:nodoc: check if we have any binary column and if they need escaping
A list of extensions, to be filled in by adapters that support them.
A polymorphic association cannot have a type mismatch, by definition
All queries inside the block will not use the previously set scopes.
Alternatively, +:reject_if+ also accepts a symbol for using methods:
An internal class for representing a shuffle + method node analyzer.
As this is both cryptic and usually redundant, it should be avoided.
Browsers will remember the original HSTS directive until it expires.
CREATE UNIQUE INDEX by_branch_party ON accounts(branch_id, party_id)
Callbacks allow you to trigger logic during the life cycle of a job.
Called by the server when a new WebSocket connection is established.
Check for non UTF-8 parameter values, which would cause errors later
Checking against variable assignments, etc, would be more difficult.
Checks if any of the authenticity tokens from the request are valid.
Common functionality for cops checking for space before punctuation.
Create a new renderer for the same controller but with new defaults.
DeprecatedConstantProxy transforms a constant into a deprecated one.
Do not make this inheritable, because we always want it to propagate
Each model uses an association to describe its role in the relation.
Extract the name of the missing constant from the exception message.
Find the last record (or last N records if a parameter is supplied).
For API controllers, the implicit response is always 204 No Content.
For example +Preloader::Association+ or +Preloader::HasManyThrough+.
Hence, dynamic values in fixtures are to be considered a code smell.
If STI is used, find the correct subclass for association reflection
If a table is referenced only once, the standard table name is used.
If a third option is set to +true+, it also adds bold to the string.
If there is trailing whitespace, then that must be dealt with first.
In rare circumstances you might need to access the mapping directly.
In your ERB templates, use this method to escape any unsafe content.
Indexes are appended for any more successive uses of the table name.
Instead, use the header to tell browsers to expire HSTS immediately.
Interoperability problems can be resolved easily with a +to_s+ call.
It is still possible to override that by passing the "value" option.
It will be inserted into HTML with no additional escaping performed.
It's a way to redirect incoming requests to controllers and actions.
Job: The number of retries can be set per instance of the job class.
Lock a file for a block so only one process can modify it at a time.
Main render entry point shared by Action View and Action Controller.
Mysql floats are precision 0..24, Mysql doubles are precision 25..53
Non-nil checks are allowed if they are the final nodes of predicate.
Note that this is currently not recommended since it breaks caching.
Only 'GET' and 'HEAD' requests will result in a file being returned.
Possible values are +GET+, +POST+, +PATCH+, +PUT+, +DELETE+, +HEAD+.
Provided strictly for compatibility and can be removed in Rails 5.1.
Queries are collected asynchronously by the subscriber and returned.
Queries the database and returns the results in an Array-like object
Refresh the cached action_methods when a new action_method is added.
Returns a Duration instance matching the number of minutes provided.
Returns a hash of attributes before typecasting and deserialization.
Returns a new date/time representing the given day in the next week.
Returns a new date/time the specified number of weeks in the future.
Returns a new date/time the specified number of years in the future.
Returns all expanded paths but only if they exist in the filesystem.
Returns the constant path for the provided parent and constant name.
Returns the description of what the correct indentation is based on.
Returns the subdomains of a host as a String given the domain level.
Returns the subdomains of a host as an Array given the domain level.
Returns true if the date/time does not fall on a Saturday or Sunday.
Returns true if the given controller is capable of rendering a path.
Returns whether a counter cache should be used for this association.
Serializes duration to string according to ISO 8601 Duration format.
Since the source has a trailing newline, there is a final empty line
SpaceAroundOperators leaves it to AlignHash when the style is table.
Starts a transaction in the association class's database connection.
Templates in the collection not already cached are written to cache.
The compact style is only forced for classes/modules with one child.
The final string will be 'converted' back to UTF-8 before returning.
The first_name attribute must be in the object and it must be blank.
The user can override this default by passing a block to the layout:
These methods do not verify the assets exist before linking to them:
They are to be used in combination with ActionController::Resources.
This cop checks for assignments in the conditions of if/while/until.
This cop checks for useless `else` in `begin..end` without `rescue`.
This if statement fits exactly on one line if written as a modifier.
This is not recommended if the data is coming from the user's input.
This module is used to encapsulate access to thread local variables.
This thread is compatible with both of the "primary" attempts above.
To use Sucker Punch set the queue_adapter config to +:sucker_punch+.
Tries to retrieve the application name or simply return application.
Unloadable constants are removed each time dependencies are cleared.
Update lib/active_record/internal_metadata.rb when this gets removed
Used as secret in generating nonce to prevent tampering of timestamp
User.where.not(name: nil) SELECT * FROM users WHERE name IS NOT NULL
Users can generate the guides, and thus this flag is off by default.
Whenever streaming Cache-Control is automatically set to "no-cache".
Without the alias, the column cannot be found and properly typecast.
You can force a particular deletion strategy by passing a parameter.
You can read more about each approach by clicking the modules below.
You can specify what Rails should route "/" to with the root method:
You can use +:inverse_of+ to avoid an extra query during validation.
any of `:refactor`, `:convention`, `:warning`, `:error` or `:fatal`.
attr_accessor :name, :age, :address attribute_method_prefix 'clear_'
check if the class/module name matches the definee for the defs node
class Person include ActiveModel::Model attr_accessor :id, :name end
class Record include ActiveSupport::Callbacks define_callbacks :save
codepoints are in hex in the test suite, pack wants them as integers
compact - combine definitions as much as possible class Foo::Bar end
def up execute "ALTER TYPE model_size ADD VALUE 'new_value'" end end
module Pagination def page(number) pagination code goes here end end
nested - have each child on its own line class Foo class Bar end end
rails generate migration add_fieldname_to_tablename fieldname:string
request - ActionDispatch::Request instance with the current headers.
rubocop:disable Lint/HandleExceptions All errors are in diagnostics.
send_file '/path/to.jpeg', type: 'image/jpeg', disposition: 'inline'
since there are no parens, warning message is for 'consistent' style
valid as both CP-1252 and UTF-8, but with different interpretations.
we can add data until it's actually written, which happens on `each`
(To convert to an actual class follow +classify+ with +constantize+.)
* +migrations_paths+: a list of paths to directories with migrations.
* Call +define_attribute_methods+ after the other methods are called.
* Calling an attribute writer to prevent an local variable assignment
+Client-Ip+ and +X-Forwarded-For+ should not, generally, both be set.
+subtype+ is derived from the `typelem` column in the pg_types table.
4.2 is defined as a module because it needs to be shared with Legacy.
:nodoc: Represents an HTTP response generated by a controller action.
@example Good if EnforcedStyle is slashes or mixed, bad if percent_r.
A high-performance RabbitMQ background processing framework for Ruby.
A job can also be processed immediately without sending to the queue:
A nonce might, for example, be constructed as the base 64 encoding of
A request cannot produce a directory traversal using this middleware.
Abstract base class for formatter, implements all public API methods.
Add the prefix bonus only when the Jaro distance is above this value.
Adds timestamps (+created_at+ and +updated_at+) columns to the table.
All directories in this set must also be present in +autoload_paths+.
Alternatively, you may enable auto-instantiation of the fixture data.
An acronym must be specified as it will appear in a camelized string.
An array of constant names that need to be unloaded on every request.
At the read uncommitted level, there is nothing that must not happen.
Attribute hash keys that should not be assigned as normal attributes.
Avoid intermittent failure when another test set ConfigLoader options
By default the associated records are protected from being destroyed.
Configure your session store in config/initializers/session_store.rb:
Converts +self+ to an integer number of seconds since the Unix epoch.
Custom +disallowed_types+ can also be passed in the form of an array.
Deallocate invalidated prepared statements outside of the transaction
Declares a method available for all attributes with the given prefix.
Declares a method available for all attributes with the given suffix.
Defaults to `coder: nil` which does no decoding, passes raw messages.
Define how a class is converted to Arel nodes when passed to +where+.
Defines additional Rack env configuration that is added on each call.
Destroys the +records+ supplied and removes them from the collection.
Either a class, string or symbol can be passed in as the Interceptor.
Ensure original are still the same since we are reindexing view paths
FIXME: Change this file to a symlink once RubyGems 2.5.0 is required.
First, extend ActiveModel::Callbacks from the class you are creating:
For example you can define the following in your locale (e.g. en.yml)
For example, the number 123.45 has a precision of 5 and a scale of 2.
For string and array conditions, use the table name in the condition.
GET requests are checked for cross-origin JavaScript after rendering.
Gets the full description of the cop or nil if no description is set.
Given two users whose names are Alice and Bob, these snippets return:
Handles calculation of deltas when the enforced style is 'separator'.
If a Regexp is given, the matching portion of the string is returned.
If an associated record does not yet exist, one will be instantiated.
If block given, loads all records and checks for one or more matches.
If block given, loads all records and checks for two or more matches.
If the last response was not a redirect, an exception will be raised.
If there are multiple proxies, that header may contain a list of IPs.
If you are using jQuery with jquery-rails this happens automatically.
Instead, Action Cable operates through a remote-procedure call model.
Loads all the given data into +records+ for a singular +association+.
Look for more specific XML-based types and sort them ahead of app/xml
Makes it dead easy to do HTTP Basic, Digest and Token authentication.
Note: `raise_error` refers to us re-raising the error in this method.
Now you can mount your engine in application's routes just like that:
Only one def, so rule about empty line *between* defs does not apply.
Optimization for the common case where path begins with the base dir.
Placing your callbacks after associations is usually a good practice.
Raised on attempt to update record that is instantiated as read only.
Raised when a relation cannot be mutated because it's already loaded.
Reads the given file at the source root and prints it in the console.
Reason is twofold: On one hand doing less calls is in general better.
Returns 'https://' if this is an SSL request and 'http://' otherwise.
Returns +text+ wrapped at +len+ columns and indented +indent+ spaces.
Returns +true+ if the association has been loaded, otherwise +false+.
Returns a Range representing the whole week of the current date/time.
Returns a Range representing the whole year of the current date/time.
Returns a new DateTime representing the end of the minute (hh:mm:59).
Returns a new DateTime representing the start of the hour (hh:00:00).
Returns a new DateTime representing the time a number of seconds ago.
Returns a new Time representing the end of the minute, x:xx:59.999999
Returns a new date/time the specified number of months in the future.
Returns a stylesheet link tag for the sources specified as arguments.
Returns a substring from the given position to the end of the string.
Returns an array of callback objects that form the before_save chain.
Returns the current database encoding format as a string, eg: 'UTF-8'
Returns the indented string, or +nil+ if there was nothing to indent.
Returns the number of days to the start of the week on the given day.
Same semantics as +reverse_merge+ but modifies the receiver in-place.
See http://www.postgresql.org/docs/current/static/libpq-envars.html .
Sets log tags, logs the request, calls the app, and flushes the logs.
Should not be called normally, but this operation is non-destructive.
So if the predicate returns +true+ the attribute will become +false+.
So this method creates an array of scopes corresponding to the chain.
The `threads` method setting takes two numbers a minimum and maximum.
The digest will be generated using +virtual_path:+ if it is provided.
The hidden field has the same name as the file one and a blank value.
The order of the mappings will determine the order of the parameters.
The rightmost argument to +form_for+ is an optional hash of options -
The string gets passed keys +:number+ (integer) and +:name+ (string).
These files do not require any others and are needed to run the tests
This allows you to modify the application's middlewares from Engines.
This cop checks for strings that are just an interpolated expression.
This cop checks for the use of old-style attribute validation macros.
This cop checks if the length of a method exceeds some maximum value.
This is a default queue implementation that ships with Notifications.
This is a safety measure to keep existing applications from breaking.
This is generally intended for internal use and extension frameworks.
This is needed because 'SELECT count(DISTINCT *)..' is not valid SQL.
This method is only called when consider_all_requests_local is false.
This method should be used with care when shared cache is being used.
This script validates the generated guides against the W3C Validator.
This uses an abstract class that defines attributes and associations.
This will also run validations and callbacks of associated object(s).
This will try to load any generator in the load path to show in help.
True if the current request URI was generated by the given +options+.
Use it only if that name can't be inferred from the association name.
Use the +model+ method to retrieve the record which did not validate.
Used internally by +javascript_include_tag+ to build the script path.
We also need to ensure that associations are readonly where relevant.
We don't want that to happen, so we disable transactional tests here.
When EnforcedStyle is 'strict' then only use of Time.zone is allowed.
When a connection is established or removed, we invalidate the cache.
With a block which is passed with the current record to be validated:
Wrap the migration in a transaction only if supported by the adapter.
You can force the form to use the full array of HTTP verbs by setting
add_on_empty: generate_message(attr, :empty, message: custom_message)
after_class_unload -- Run immediately after the classes are unloaded.
class Person include ActiveModel::Model attr_accessor :name, :age end
def person_params params.require(:person).permit(:name, :age) end end
dump foreign keys at the end to make sure all dependent tables exist.
klass option is necessary to support loading polymorphic associations
no need to delay test suite by waiting the whole full default timeout
scope path: "/cpanel", as: 'admin' do resources :posts, :comments end
send_data image.data, type: image.content_type, disposition: 'inline'
set up before_action, prepend_before_action, skip_before_action, etc.
the user would see the usage message aligned against the left margin.
this method must only be called while holding connection pool's mutex
we need to be wary of comments since they don't show up in the tokens
we should probably have a better way to indicate the query was cached
with the include, will retrieve only developers for the given project
* If +value+ is a callable object it must expect one or two arguments.
* Otherwise, returns an array with the argument as its single element.
* updated_at/updated_on column is updated if that column is available.
@example good for all styles if condition statement else statement end
@options_config stores a config that is specified in the command line.
A return value of 0 means that the erroneous config file was not read.
Also be aware that the document may be cached by proxies and browsers.
CREATE TABLE categories_suppliers ( category_id int, supplier_id int )
Calls the given block for each descendant node with depth first order.
Checks for space between a method name and a left parenthesis in defs.
Compiles reader methods so we don't have to go through method_missing.
Creates the name of a table like Rails does for models to table names.
Decodes WebSocket messages and dispatches them to subscribed channels.
Defaults to the created_at attribute on the record if one such exists.
Defaults to the updated_at attribute on the record if one such exists.
Define sets of events in the object life cycle that support callbacks.
Defines the setter and getter methods for the collection_singular_ids.
Don't print warnings to stderr if corrections conflict with each other
EDGE Set to "1" to indicate generated guides should be marked as edge.
EnforcedStyle can be changed to get rid of the EnforcedStyle offenses.
Executes the delete statement and returns the number of rows affected.
Executes the update statement and returns the number of rows affected.
FIXME: Change these files to symlinks once RubyGems 2.5.0 is required.
Find the first record (or first N records if a parameter is supplied).
For :autocorrect level, any offense - corrected or not - is a failure.
For example you can define the following in your locale (e.g. en.yml).
Given that the current action has been reached through `GET /users/1`:
Grab the list of namespaces that we're looking for new constants under
Identifies whether the class name of a record or class is uncountable.
If a block is provided, it should not cause any emails to be enqueued.
If it cannot find a suitable inverse association name, it returns nil.
If just one argument is sent, invoke say, otherwise invoke say_status.
If the hour and minute is passed, then sec, usec and nsec is set to 0.
If the position is negative, it is counted from the end of the string.
If you modify this collection please update the API of +permit+ above.
If you want to customize your source root, you should use source_root.
If you want to explicitly render only certain templates, pass a block:
Implements the details of eager loading of Active Record associations.
In either case the merge respects the semantics of indifferent access.
In such cases, you don't want to do changes in places but use setters:
Instead, it waits until it's called in a later stage of the execution.
It also defines the attribute methods if they have not been generated.
It is up to you to ensure that the values are semantically meaningful.
It takes an object, a deprecation message and optionally a deprecator.
It's up to subclasses to implement the stale_state method if relevant.
Load the constant named +const_name+ which is missing from +from_mod+.
Make a very basic app, without creating the whole directory structure.
Note that the model will _not_ be destroyed until the parent is saved.
Note that this will unsubscribe all subscriptions with the given name:
Note that using conditions like this can have unintended consequences.
Note that you can't use HAVING without also specifying a GROUP clause.
Note, all the attributes for all the cases are kept in the same table.
Overwrite render_to_string because body can now be set to a rack body.
Parts with different signs are exists in PostgreSQL interval datatype.
Provides a list of emails that have been delivered by Mail::TestMailer
Provides a set of methods for making it easier to debug Rails objects.
Provides functionality so that Rails can output logs from Action View.
Query methods allow you to test whether an attribute value is present.
Raises if the wrong reflection name is used to set the Edge belongs_to
Read more about writing ERB and Builder templates in ActionView::Base.
Recursively fill out the rest of the array from the through reflection
Register an Interceptor which will be called before mail is previewed.
Removes all the previously dynamically defined methods from the class.
Returns a Range representing the whole month of the current date/time.
Returns a string of the object's date, time, zone and offset from UTC.
Returns all the full error messages for a given attribute in an array.
Returns an array of names for the attributes available on this object.
Returns an array with distinct records based on the +group+ attribute:
Returns an array with the name of the attributes with unsaved changes.
Returns the last record, or the last +n+ records, from the collection.
Returns the number of milliseconds equivalent to the seconds provided.
Returns the underscored name of the mailer preview without the suffix.
Sanitizes the given LIMIT parameter in order to prevent SQL injection.
Stub the save method of the first child instance to raise an exception
Sucker Punch is a single-process Ruby asynchronous processing library.
TEST METHODS THAT ARE REQUIRED OF THE ADAPTER'S BACKEND STORAGE OBJECT
The +attributes+ parameter can be either a Hash or an Array of Hashes.
The Application is also responsible for building the middleware stack.
The class returned implements a `run` method that accepts a preloader.
The different methods are available to make the tests more expressive.
The first_name attribute must be in the object and it cannot be blank.
The hidden field has the same name as multiple select and blank value.
The request that initiated the WebSocket connection is available here.
These are "broken" inverse_of associations for the purposes of testing
This constant will be unloaded on each request, not just the next one.
This cop checks for string literal concatenation at the end of a line.
This force provides a way to track local variables and scopes of Ruby.
This method takes a block that contains the content you wish to cache.
This module encapsulates the logic for autocorrect behavior for a cop.
To add behavior to the initialize method, use the following signature:
To add redirection helpers to your metal controller, do the following:
To set the default allowed tags or attributes across your application:
To use queue_classic set the queue_adapter config to +:queue_classic+.
Two controllers can share a set of partials and render them like this:
Two modes are supported through the AlignWith configuration parameter.
Updates the receiver in-place, merging in the hash passed as argument:
Used for running multiple migrations up to or down to a certain value.
Used internally by +stylesheet_link_tag+ to build the stylesheet path.
We accept blank origin headers because some user agents don't send it.
We need to apply this decorator here, rather than on module inclusion.
We need to create a new class in order to install the new named route.
We need to undef `root`, RenderTestCases don't want this to be defined
Yes: The adapter will run the job in the future through perform_later.
Yields ActiveRecord::Relation objects to work with a batch of records.
You can also unsubscribe by passing the name of the subscriber object.
account is dependent with nullify, therefore its firm_id should be nil
action_methods are cached and there is sometimes need to refresh them.
activerecord/test/cases/associations/eager_test.rb:1133 with :comments
class Person include ActiveModel::Model attr_accessor :id, :name, :omg
class_eval STRING pushes the class to the nesting of the eval'ed code.
def cleanup_view_runtime super - time_taken_in_something_expensive end
module Bar def self.included(base) base.method_injected_by_foo end end
rubocop:disable Style/SpaceInsideHashLiteralBraces, Style/ExtraSpacing
rubyonrails: id: 1 name: Ruby on Rails url: http://www.rubyonrails.org
skip the last migration if we're headed down, but not ALL the way down
some developers have grown accustomed to using comma in cookie values.
suppress(ZeroDivisionError) do 1/0 puts 'This code is NOT reached' end
test if attributes set as part of after_initialize are duped correctly
to_prepare -- Run once at application startup, and also from +to_run+.
validates_presence_of :name validates_inclusion_of :age, in: 0..99 end
* +execute_if_updated+ which just executes the block if it was updated.
*First:* Specify a subset of fields to be selected from the result set.
...and content pages that fulfill these references _at_ rendering time:
...would result in ActiveRecord::Base.configurations to look like this:
:nodoc: Generates a v5 non-random UUID (Universally Unique IDentifier).
:nodoc: Implements the reader method, e.g. foo.bar for Foo.has_one :bar
:nodoc: Provides methods for converting numbers into formatted strings.
@example Good if EnforcedStyle is backticks or mixed, bad if percent_x.
A cache store implementation which stores everything on the filesystem.
A list of index algorithms, to be filled by adapters that support them.
Accepts a hash one layer deep that contains all connection information.
Adds comment for given table column or drops it if +comment+ is a +nil+
Allows you to specify controller-wide key prefixes for cache fragments.
Also you can pass a block to set up the attribute with a default value.
An Email controller for example does not support paths, only full URLs.
By default this is assumed to be an instance named after the attribute.
Cutoff the common prefix length to this value if it's longer than this.
Databases behave differently to enforce the serializability constraint.
Default is ActiveSupport::Multibyte::Unicode.default_normalization_form
Defines a callback that will get called right after validation happens.
Don't allow the Money object to have its amount changed after creation.
Enable the query cache within the block if Active Record is configured.
Encodes the given token and options into an Authorization header value.
Ensure that the before filter is executed *before* self.formats is set.
Establish dependent relationship between Person and PersonalLegacyThing
Every Active Record database supports transactions except MySQL MyISAM.
Example of a more complex migration that also needs to initialize data:
Exception that can be raised to stop migrations from being rolled back.
Fallback to config.secret_key_base if secrets.secret_key_base isn't set
For example, if we wanted it to be +user+ instead of +account+ we'd do:
For more details on the issues involved see Section 4 of this document.
For performance reasons, we don't check whether to validate at runtime.
Here is an example where +on_load+ method is called to register a hook.
However, most part of shoulda generators are similar to test_unit ones.
If ActiveSupport::Dependencies is not loaded, forget about autoloading.
If it succeeds, an array with the respective return values is returned:
If the adapter cannot be found, this will default to the Redis adapter.
If the first argument is not a Symbol, then it will simply be returned:
If there are parentheses around the block, check if that is being used.
If true, the default table name for a Product class will be +products+.
If you pass arguments to "yield" then this will be passed to the block.
In tests you can simply pass the URL or named route to +get+ or +post+.
It returns an object that can be used to query the database repeatedly.
It returns nil when the name is not in CamelCase or is not initialized.
It takes either a column name, or the name of a belongs_to association.
It's also possible to delegate a method to the class by using +:class+:
Iterates through each error key, value pair in the error messages hash.
Makes an underscored, lowercase form from the expression in the string.
Middlewares that need to manipulate the body won't work with streaming.
Must come after Rack::MethodOverride to properly log overridden methods
N/A: The adapter does not support queueing, and therefore sorting them.
Obtains the specified cache store class, given the name of the +store+.
Parses a string formatted according to ISO 8601 Duration into the hash.
Person.where(name: 'Spartacus', rating: 4).ids returns an Array of ids.
Provides a basic serialization to a serializable_hash for your objects.
Rails::Generators::ControllerGenerator.hook_for :webrat, type: :boolean
Raised when an object assigned to an association has an incorrect type.
Raises error if length of new index name is greater than allowed limit.
Records that are passed in are serialized/deserialized using Global ID.
Reload edges table from fixtures as otherwise repeated test was failing
Returns a +String+ with the last requested path including their params.
Returns a Duration instance matching the number of fortnights provided.
Returns a new DateTime representing the start of the minute (hh:mm:00).
Returns a new hash with all keys converted using the +block+ operation.
Returns an array of reflections which are involved in this association.
Returns constant of subscription adapter specified in config/cable.yml.
Returns the specified association instance if it exists, nil otherwise.
Returns the wrapper key which will be used to store wrapped parameters.
Returns true if the current object's time falls within the current day.
See also Table for details on all of the various column transformation.
So the the method argument nodes need to be processed in current scope.
Specify whether or not the session should mimic a secure HTTPS request.
TODO: would be nice if we could detect the schema change automatically.
The begin and end could also be braces, but we call the variables do...
The default terminator halts the chain when a callback throws +:abort+.
The label of the current fixture is always available as a column value:
The only restriction is that the word must begin with a capital letter.
The whole block will be called in the right order within the migration.
These access modifiers do not make singleton methods private/protected.
This can either be a single value or an array of values to be disabled.
This class provides methods for manipulating the schema representation.
This cop checks for non-local exit from iterator, without return value.
This cop checks for unwanted parentheses in parameterless method calls.
This cops checks for class and module names with an underscore in them.
This gives the column as it appears when viewing the file in an editor.
This in turn will make RuboCop fall back on cop-by-cop auto-correction.
This is currently the most popular cache store for production websites.
This is meant to be implemented by the adapters that support extensions
This is our best guess: first try to close the attribute, then the tag.
This is unlike entity objects where equality is determined by identity.
This method should only be used if this class contains the foreign key.
This method uses the +pluralize+ method on the last word in the string.
This module handles measurement and reporting of complexity in methods.
This tests that the helpers hook up correctly to the sanitizer classes.
This will often result in a performance improvement over a simple join.
This will perform a diff and delete/add only records that have changed.
Truncates a table alias according to the limits of the current adapter.
Unfortunately, the current Rails behavior is to just return the string.
Use .unscope(where: :attribute_name) or .unscope(:order), for example."
Useful if there is not a default value required for the select element.
Using this on non-JSON values will open up serious XSS vulnerabilities.
` ln -s foo.example.yml foo.example ln -s bar.example.yml bar.example `
before_class_unload -- Run immediately before the classes are unloaded.
controller - ActionController::Base instance for the outgoing response.
def test_login get the login page get "/login" assert_equal 200, status
give the other `thread` some time to get stuck in `group_action_method`
if the codepoint is decomposable in with the current decomposition type
make sure it gets removed from the pool by clear_reloadable_connections
module HairColors mattr_reader :hair_colors, instance_reader: false end
module HairColors mattr_writer :hair_colors, instance_writer: false end
must come after Rack::MethodOverride to properly log overridden methods
reduce 11 omitted reduce 12 omitted reduce 13 omitted reduce 14 omitted
some Nokia phone browsers omit the space after the semicolon separator.
test combination of dates and escaped or unicode encoded data in arrays
to ensure that session requirements in setup are persisted in the tests
Accept header send with user HTTP_USER_AGENT: Sunrise/0.42j (Windows XP)
ActionPack uses this to find a suitable partial to represent the object.
Additional HTML attributes for the link can be passed in +html_options+.
Adds timestamps (+created_at+ and +updated_at+) columns to +table_name+.
All classes inheriting from ActiveRecord::Base will use this connection.
All instance methods are expected to return a message object to be sent.
Also, you can pass a block to set up the attribute with a default value.
An *each* call with a block on a single line is always allowed, however.
An internal class for correcting parallel assignment protected by rescue
As an input to the initializer, we take a Fixnum, a String, or a Symbol.
Attempting to try to do either again will result in a DoubleRenderError:
Behavior module allows to determine how to display deprecation messages.
Check for double render errors and set the content_type after rendering.
Checks the client's masked token to see if it matches the session token.
Common functionality for finding names that are similar to a given name.
Configure sensitive parameters which will be filtered from the log file.
Cops interact with this force need to override some of the hook methods.
DateTime objects have their time set to 0:00 unless +same_time+ is true.
DateTimes are Dates, we document the type but avoid the redundant check.
Default is ActiveSupport::Multibyte::Unicode.default_normalization_form.
Defines a callback that will get called around the job's perform method.
Defines a callback that will get called right after the job is enqueued.
Defines a callback that will get called right before validation happens.
Disable the query cache within the block if Active Record is configured.
Either via the +module+ or +class+ keyword or by an explicit assignment:
Elements are inserted into the string in the order in which they appear.
First checks if the :nodoc: comment is associated with the class/module.
Generate a list of target files by expanding globbing patterns (if any).
Global: The adapter is configured that all jobs have a maximum run time.
Go to https://hstspreload.appspot.com to submit your site for inclusion.
Helpers related to template lookup using the lookup context information.
Here we check if the elements of a multi-line array literal are aligned.
However, the above applies if the parent model is being updated as well.
If a block is passed, that block should not cause any emails to be sent.
If a subclass changes the value, the parent class' value is not changed.
If false, callback chains will only be halted by calling +throw :abort+.
If it's set to `def`, the `end` shall be aligned with the `def` keyword.
If no .rubocop.yml is found there, the user's home directory is checked.
If none is registered, defaults to an ActionDispatch::Routing::RouteSet.
If specified, an event with this name will be dispatched on the browser.
If the client wants HTML, we just redirect them back to the person list.
If the collection is empty the root element is "nil-classes" by default:
In such actions, you want to delay queries execution as much as you can.
In the end it appends the regular report data in the clang style format.
Include in a cookie jar to allow chaining, e.g. cookies.permanent.signed
It is also good to know what is the bare minimum to get Rails booted up.
It purposely does not inherit from Response, because it doesn't need it.
Middlewares can also be completely swapped out and replaced with others:
MySQL uses an implicit default 0 rather than NULL unless in strict mode.
Note that Active Record can detect in-place modifications automatically.
Note that if the target has not been loaded, it is not considered stale.
One query for updating name, not triggering query for updating pirate_id
Options must be taken because of https://bugs.ruby-lang.org/issues/10856
Or with a block where self points to the current record to be validated:
Overriding inspect to be more human readable, especially in the console.
Parse an XML Document string or IO into a simple hash using Java's jdom.
ProcessPhotoJob.set(wait_until: Date.tomorrow.noon).perform_later(photo)
Raised when an exception is raised during job arguments deserialization.
Removes the foreign key named +special_fk_name+ on the +accounts+ table.
Returns +true+ if +attribute+ is an attribute method, +false+ otherwise.
Returns a Range representing the whole quarter of the current date/time.
Returns a new date/time representing the given day in the previous week.
Returns the current behavior or if one isn't set, defaults to +:stderr+.
Returns the first record, or the first +n+ records, from the collection.
Returns the statement identifier for the client side cache of statements
Returns true if inverse association on the given record needs to be set.
Returns true if this object has been destroyed, otherwise returns false.
Reversible migrations are migrations that know how to go +down+ for you.
Roundtrip to Rake to allow plugins to hook into database initialization.
See ActiveRecord::Transactions::ClassMethods for detailed documentation.
See RFC 4122 for details of UUID at: http://www.ietf.org/rfc/rfc4122.txt
See http://www.postgresql.org/docs/current/static/errcodes-appendix.html
Sets the schema search path to a string of comma-separated schema names.
Setting behaviors only affects deprecations that happen after boot time.
Some CDNs only support strong ETags and will ignore weak ETags entirely.
Sometimes the code needs that the callbacks execute in a specific order.
The +id+ parameter must match the constraint passed in for this example.
The Rails package has several tools to help create and apply migrations.
The cop only registers an offense if the extra line is completely empty.
The following invariants must be true for all conformant implementations
The header to use is set via +config.action_dispatch.x_sendfile_header+.
The method removes the basename of the file path and the digest, if any.
The minimum required to qualify for browser preload lists is `18.weeks`.
The object being replaced will still be saved to update its foreign key.
Therefore the primary key must be orderable, e.g an integer or a string.
These tests are mostly just to ensure that the ordinalize method exists.
This class has side effects on the +store+ passed during initialization.
This cop checks for methods invoked via the :: operator instead of the .
This cop checks the indentation of the first parameter in a method call.
This cop checks whether method definitions are separated by empty lines.
This holds a variable declaration node, and some states of the variable.
This is because transactions are per-database connection, not per-model.
This is inspired by the Fuubar formatter for RSpec by Jeff Kreeftmeijer.
This makes retrieving the connection pool O(1) once the process is warm.
This may be used by users to specify a different time zone model object.
This method can be passed attribute names and an optional time argument.
This would cause a warning to be printed on stderr if the file was read.
To enqueue a job to be performed as soon as the queueing system is free:
TransactionIsolationError will be raised under the following conditions:
Tries to find a constant with the name specified in the argument string.
Use standard-conforming strings so we don't have to do the E'...' dance.
Used by the migration template to determine the parent name of the model
Used to sanitize objects before they're used in an SQL SELECT statement.
User.order('name DESC') SELECT "users".* FROM "users" ORDER BY name DESC
We unset temporary bundler variables to load proper bundler and Gemfile.
We use an implicit NULL so schema.rb is compatible with other databases.
While executing the given block, the recorded will be in reverting mode.
Will look for all templates at "app/views/notifier" with name "welcome".
You can read more about setting up your DNS CNAME records from your ISP.
You must manually generate the join table with a migration such as this:
action_methods are cached and there is sometimes a need to refresh them.
alternatively we have to consider a logical node with a literal argument
create a new connection in case there are threads still stuck in a queue
def disconnect Any cleanup work needed when the cable connection is cut.
define_callbacks :validate define_callbacks :initialize, :save, :destroy
http://www.ietf.org/rfc/rfc4627.txt http://www.json.org/JSONRequest.html
if host matches one of the supplied domains without a dot in front of it
if not running callbacks, only adds the record to the parent transaction
json "fragments" - these are invalid JSON, but ActionPack relies on this
test generating application's route from engine with default_url_options
test generating engine's route from application with default_url_options
using an exception class that is not a StandardError subclass on purpose
(They order records differently, so the 'first' record can be different.)
* An identifier for a TZInfo::Timezone object (e.g., "America/New_York").
* Define the various generic +_attribute+ methods that you have declared.
* The current mapper * A hash of options which the concern object may use
+raw_old_value+ The original value, before being passed to +deserialize+.
+underscore+ will also change '::' to '/' to convert namespaces to paths.
4 bytes means a MySQL int or Postgres integer as opposed to smallint etc.
@example Parentheses `()` Brackets.new(:tLPAREN, :tRPAREN, 'parentheses')
A +LookupContext+ will use a +PathSet+ to store the paths in its context.
A JoinAssociation represents an association which is joining to the base.
A call to new_constants is always called after a call to watch_namespaces
ALTER TABLE `users` ADD COLUMN age INT, ADD COLUMN birthdate DATETIME ...
Accepts options that will be made available through the +options+ reader.
Allows programmers to programmatically define a schema in a portable DSL.
An Engine with the responsibility of coordinating the whole boot process.
An internal stack used to record which constants are loaded by any block.
As an alternative, it is recommended to use one of the following methods.
Before processing, set the request formats in current controller formats.
Builds a prompt option tag with supplied options or from default options.
But if anything else goes wrong, this is still the best way to handle it.
Check indentation against end keyword but only if it's first on its line.
Common functionality for checking instance methods and singleton methods.
Configuration files above the work directory shall not disturb the tests.
Construct options and pass them with scope to the target class's +count+.
Converts the first character to uppercase and the remainder to lowercase.
Declare a class-level attribute whose value is inheritable by subclasses.
Decrements an already existing integer value that is stored in the cache.
Define some internal variables that should not be propagated to the view.
Defines a callback that will get called right before the job is enqueued.
Determine the layout for a given name, taking into account the name type.
Determines whether the mutable value has been modified since it was read.
Disable available locale checks to avoid warnings running the test suite.
Doing so will lead to a circular dependency and cause infinite recursion.
Eager loads the named associations for the given Active Record record(s).
For +has_many+ associations, the default deletion strategy is +:nullify+.
For example, the following would not work following the previous example:
For more information, see the documentation for the +:inverse_of+ option.
If a block is passed, that block should not cause any job to be enqueued.
If a magic encoding comment was found, tag the String with this encoding.
If a string or symbol is passed in it will be camelized and constantized.
If every single IP option is in the trusted list, just return REMOTE_ADDR
If passed an optional locale, rules for other languages can be specified.
If you do pass a block, you can render specific templates of your choice:
If you have an array of keys you want to limit to, you should splat them:
In most cases such calls can be replaced with an explicit array creation.
Increments an already existing integer value that is stored in the cache.
Initializes new record from relation while maintaining the current scope.
It either runs on a separate or forked process, or on a different thread.
It is also possible to assign a flash message as part of the redirection.
It's a wildcard match that we use for `respond_to` negotiation internals.
It's possible to set the fixture's model class directly in the YAML file.
List all validators that are being used to validate a specific attribute.
Make sure the lock version column gets updated when counters are updated.
Makes it seem like the nested associations are just regular associations.
Makes the adapter execute EXPLAIN for the tuples of queries and bindings.
Once rendering the template is done, sets its content in the :layout key.
Or, progressively roll out the cache invalidation using a computed value:
Oracle saves empty string as NULL therefore :message changed to one space
Other options will be handled by the specific cache store implementation.
Overridden in adapters that require something beyond a simple insert (eg.
Provides an interface for any class to have Active Record like callbacks.
Raised when Active Record cannot find a record by given id or set of ids.
Rather, the entire AST must be copied any time any part of it is changed.
Receives a namespace, arguments and the behavior to invoke the generator.
Removes the rightmost segment from the constant expression in the string.
Returns ActiveRecord::RecordNotFound error if the object cannot be found.
Returns an ActionDispatch::Response that represents the current response.
Sets a WWW-Authenticate header to let the client know a token is desired.
Should replace the hash with only the given keys when given an array key.
Some transformations are destructive in a manner that cannot be reversed.
Sometimes you need to set up the session and cookie variables for a test.
The TimeZone class serves as a wrapper around TZInfo::Timezone instances.
The current table in this iteration becomes the foreign table in the next
The default normalization used for operations that require normalization.
The main method that creates the message and renders the email templates.
The method will also ensure an HTTP Date header for client compatibility.
The rules for duplicated keys follow the semantics of indifferent access:
The string is formatted imitating the ones printed by the database shell.
The worker pool is where we run connection callbacks and channel actions.
There are two ways to call this method, with a block, or without a block.
There is also a list of options that could be used along with validators:
There's also +insert_after+ which will insert a middleware after another:
This cop checks for underscore-prefixed variables that are actually used.
This cop checks if each_with_object is called with an immutable argument.
This cop checks the style of children definitions at classes and modules.
This form will not only create the table, but also columns for the table.
This is on by default but can be turned off to aid in functional testing.
This is the recommended form: def create Person.create(person_params) end
This is true by default, which is useful for the development environment.
This means that if no layout conditions are used, this method is not used
This middleware returns a file's contents from disk in the body response.
To generate a secret key for an existing application, run `rails secret`.
To play nicely with JavaScript conventions sub-attributes are dasherized.
Use that class method when you need to know the ordinal value of an enum.
Used to specify an operation that can be run in one direction or another.
WARNING: This validation must not be used on both ends of an association.
We don't want any non-native JSON elements in the job hash, like symbols.
You can also subscribe to all events whose name matches a certain regexp:
but take into account that at some point those ones have to be permitted:
call a method in the context which this pattern-matching code is used in.
class Person include ActiveModel::Validations attr_accessor :name, :email
create a new "anonymous" class that will host the compiled reader methods
def edit render plain: "I'm only accessible if you know the password" end
excerpt strips the resulting string before ap-/prepending excerpt_string.
friend_too exists to test a bug, and probably shouldn't be used elsewhere
if nothing is found then try same procedure to find super class's layout.
test generating engine's route from other engine with default_url_options
test named routes like foo_path and foos_path map to the correct options.
use native attr_* methods as they are faster on some Ruby implementations
verify that the options passed in have not changed from the original ones
+DateTime+ objects have their time set to 0:00 unless +same_time+ is true.
- With no block, but multiple captures: captures are returned as an array.
A through association is nested if there would be more than one join table
ActiveSupport::Reloader.to_prepare do i18n_reloader.execute_if_updated end
Asserts the given attribute type gets translated to a field type properly:
Attempts to +save+ the record and clears changed attributes if successful.
Be careful to sanitize the path parameter if it is coming from a web page.
Called when running bundle, we just want to stub it so nothing to do here.
Consequently, assert_migration accepts the same arguments has assert_file.
Correcting ActiveRecord methods with this cop should be considered unsafe.
Creates a new Dalli::Client instance with specified addresses and options.
Defines a class attribute and creates a class and instance reader methods.
Filters the primary keys and readonly attributes from the attribute names.
Finds all Ruby source files under the current or other supplied directory.
For example, an extension doing any of the following would need a railtie:
For example, suppose that you have 5 models, with the following hierarchy:
For example, when there are two placeholders with only one value supplied:
If a block is passed, that block should not cause any job to be performed.
If block is given, gem entries in block are wrapped into the source group.
If it is persisted, a form for the object will route to the update action.
If the object is invalid, the saving will fail and false will be returned.
If the template was not compiled yet, it is done exactly before rendering.
Including the active Rails version, Ruby version, Rack version, and so on.
It is also possible, however, to pass a model object itself to +form_for+.
Lazy load the Unicode database so it's only loaded when it's actually used
Lets you selectively disable calls to `touch` for the duration of a block.
Note: Partial indexes are only supported for PostgreSQL and SQLite 3.8.0+.
Parts are summarized (as they can become repetitive due to addition, etc).
Pass a block if you want to show extra content when the text is truncated.
Pass a hash in the second argument (+path+) to specify the request method.
Process controller specific options, as status, content-type and location.
ROUTES TODO: These assertions should really work in an integration context
Regular output functions like print or puts won't work with ERB templates.
Returns +true+ if no errors are found, raises +ValidationError+ otherwise.
Returns +true+ if the class name and +other+ are equal, otherwise +false+.
Returns a hash of attributes that were changed before the model was saved.
Returns an array of ColumnDefinition objects for the columns of the table.
Returns the +String+ full path including params of the last URL requested.
Returns the class type of the record using the current module as a prefix.
Returns the configured supported identifier length supported by PostgreSQL
Returns the position where the match starts or +nil+ if there is no match.
Should return a new hash with only the given keys when given an array key.
Significant was set to true with precision 2, with custom translated units
Since +font_url+ is based on +asset_url+ method you can set :host options.
Since we define a new cop class, we have to do this in a separate process.
Skip before, after, and around action callbacks matching any of the names.
Some tests depend on assumption that this attribute will have Date values.
Some times you'll have template dependencies that can't be derived at all.
Subclasses can change their own value and it will not impact parent class.
Test for mounting apps that respond to routes, but aren't Rails-like apps.
That code returns right away, you are just subscribing to "render" events.
That first executes the block and then notifies all subscribers once done.
That is, do not execute statements like 'CREATE TABLE' inside such blocks.
The +FormBuilder+ object is yielded when using +form_for+ or +fields_for+.
The `case` node plus the first `when` score one complexity point together.
The block syntax also allows you to customize the part headers if desired:
The caching is done using the +cache+ helper available in the Action View.
The controller generator will then try to invoke the following generators:
The controller passes objects to the view by assigning instance variables:
The key is the table, the value is a list of rows to insert to that table.
The next thing that changes in isolated engines is the behavior of routes.
The target method must be public, otherwise it will raise +NoMethodError+.
The tasks defined here are used with Rake tasks provided by Active Record.
This allows you to use the same format for links in views and controllers.
This cop checks for duplicated instance (or singleton) method definitions.
This ensures that the polymorphism of taggings is being observed correctly
This happens inside the transaction initiated by the parent's save method.
This includes the day as a hidden field instead of showing a select field.
This is useful for numbers that can get very large (and too hard to read).
This makes cases more complex than the simple and guessable ones possible.
This requires a join table that has no corresponding model or primary key.
This works for mysql2 where table.column can be used to resolve ambiguity.
Three modes are supported through the `AlignWith` configuration parameter:
Unescapes bytea output from a database to the binary string it represents.
Uses an MD5 digest based on time to generate a value to be used only once.
Validates option arguments and the options' compatibility with each other.
While +indent_string+ is typically one space or tab, it may be any string.
You can modify the link attributes by passing a hash as the last argument.
You can still override that by passing the "value" option explicitly, e.g.
activerecord model introspection with reserved-word table and column names
class MyModel extend ActiveModel::Callbacks define_model_callbacks :create
deprecated_object.to_s DEPRECATION WARNING: This object is now deprecated.
friends_too exists to test a bug, and probably shouldn't be used elsewhere
get the class_name of the belongs_to association of the through reflection
rubocop --require ./path/to/my_custom_formatter --format MyCustomFormatter
test that asset path will not get script_name when generated in the engine
* +attributes+ - This should be a hash of attributes or an array of hashes.
+associations+ specifies one or more associations that you want to preload.
- +path+: The URI (as a String) on which you want to perform a GET request.
:nodoc: Basic url_for that can be overridden for more robust functionality.
:nodoc: Caches the method definition as a singleton method of the receiver.
@example bad User.where(name: 'Bruce').first User.where(name: 'Bruce').take
Add a set of modules to the watch stack, remembering the initial constants.
Additional options on the input tag can be passed as a hash with +options+.
Additional options on the label tag can be passed as a hash with +options+.
All requests are checked except GET requests as these should be idempotent.
Any change to the attributes on either instance will affect both instances.
By default it will create it in the same directory as the destination file.
Check for uses of braces or do/end around single line or multi-line blocks.
Checking if Uglifier is defined we can know if Sprockets was reached or not
Common functionality for cops checking for missing space after punctuation.
Connection pool base class for managing Active Record database connections.
Constants like __FILE__ are handled as strings, but don't respond to begin.
Convert the provided const desc to a qualified constant name (as a string).
Corresponds to the return value of one of the calls to +option_key_method+.
Different association with the same name, callbacks should be omitted here.
Essentially, if there are no elements, the expression can not be multiline.
Example: To show messages with links, you will have to use sanitize helper.
Find the foreign key when using queries such as: Post.where(author: author)
For example, +UsersController+ will try to find if the +User+ model exists.
Formats a +number+ with grouped thousands using +delimiter+ (e.g., 12,324).
Helper module to provide common methods to ConditionalAssignment correctors
If both models don't exist, it will then fallback to use +user+ as the key.
If the code block is provided, then it will be run and its result returned.
If the flush parameter is true content_for replaces the blocks it is given.
Implementors should call super if they override the default implementation.
Implements the ids reader method, e.g. foo.item_ids for Foo.has_many :items
In case of any error while parsing data ParamsParser::ParseError is raised.
In the case of the example above, the template would be fed +ad_iteration+.
It doesn't expose that information directly, so we must hard-code its size:
Keeps track of table aliases for ActiveRecord::Associations::JoinDependency
KeyGenerator is a simple wrapper around OpenSSL's implementation of PBKDF2.
Make sure all headers are set before calling write or close on your stream.
Make sure an exception is raised if the format is not valid Fixture format.
Marks this record to be destroyed as part of the parent's save transaction.
Most libraries, however, parse non-integer JSON numbers directly as floats.
Must be done if the transaction block raises an exception or returns false.
Must repeat the setup because AV::TestCase is a duplication of AC::TestCase
NOTE: The default validations with the exception of +uniqueness+ will work.
NOTE: This check is performed only if +password_confirmation+ is not +nil+.
Note that Active Record models will automatically detect their primary key.
Notice that events get sent even if an error occurs in the passed-in block.
Now we will change back the locale and it will still pick the old template.
On subsequent requests, the If-None-Match header is set to the cached ETag.
Otherwise, the case node gets 0.8 complexity points and each when gets 0.2.
Passes each element of +candidates+ collection to ArrayInquirer collection.
Person.find_by(name: 'Spartacus', rating: 4) returns the first item or nil.
Prepare the statement if it hasn't been prepared, return the statement key.
Provides callbacks to be executed before and after dispatching the request.
Rails.application.config.session_store :cookie_store, expire_after: 14.days
Register one or more Interceptors which will be called before mail is sent.
Rename the +index_people_on_last_name+ index to +index_users_on_last_name+:
Returns a Hash that can be used as the JSON representation for this object.
Returns a new Date representing the date 1 day ago (i.e. yesterday's date).
Returns a new date/time representing the end of this week on the given day.
Returns a string of option tags for pretty much any time zone in the world.
Returns a substring from the beginning of the string to the given position.
Returns an array of Column objects for the table specified by +table_name+.
Returns the contents that are yielded to a layout, given a name or a block.
Returns the deepest existing ascendant, which could be the argument itself.
Returns the list of a table's column names, data types, and default values.
Routes can also be constrained to an IP or a certain range of IP addresses:
See +send_file+ for more information on HTTP Content-* headers and caching.
Set config.eager_load to false so that an eager_load warning doesn't pop up
Since +audio_url+ is based on +asset_url+ method you can set :host options.
Since +image_url+ is based on +asset_url+ method you can set :host options.
Since +video_url+ is based on +asset_url+ method you can set :host options.
So passing a Workshop object will attempt to use the +workshop_path+ route.
The +options+ supports two additional keys for convenience and conformance:
The DOM class convention is to use the singular form of an object or class.
The array has each value sanitized and interpolated into the SQL statement.
The join table should not have a primary key or a model associated with it.
The resource and all segments will now route to /postings instead of /posts
The rest is used by rails internally to perform temporary rename operations
The second argument, +indent_string+, specifies which indent string to use.
The string form can be used for statements that don't involve tainted data.
These Hashes describe the attributes on the objects that are to be created.
This callback is called after a create, update, or destroy are rolled back.
This cop checks for missing top-level documentation of classes and modules.
This cop checks for operators, variables and literals used in void context.
This cop enforces the use of consistent method names from the String class.
This cop only auto-corrects the first statement in a def body, for example.
This includes the year as a hidden field instead of showing a select field.
This is meant to be implemented by the adapters that support advisory locks
This method is responsible for properly setting the encoding of the source.
This module provides a way to locate the conditional branch the node is in.
True if an ETag is set and it isn't a weak validator (not preceded with W/)
User.order(:name) SELECT "users".* FROM "users" ORDER BY "users"."name" ASC
Uses Date to provide precise Time calculations for years, months, and days.
When passing a record or a collection, you can still set the public header:
Work directory (the parent of .rubocop_cache) is removed afterwards anyway.
You can use +insert_before+ if you wish to add a middleware before another:
You can use this shortcut in a controller, instead of the previous example:
You may want to override it in your class to simulate a different scenario:
You must define your own inflection rules for languages other than English.
alter column with a reserved-word name in a table with a reserved-word name
custom drop table, uses execute on connection to drop a table if it exists.
def create run_callbacks :create do Your create action methods here end end
has_many through Source: has_many through a habtm Through: has_many through
in Oracle '' is saved as null therefore need to save ' ' in not null column
module HairColors mattr_accessor :hair_colors, instance_accessor: false end
(Gem): An additional gem is required to use perform_later with this adapter.
(This exists to support the use of this class with the +composed_of+ macro.)
* +id+ - The id of the object that should be decremented or an array of ids.
* +id+ - The id of the object that should be incremented or an array of ids.
+override: true+ will cause your type to be used instead of the native type.
+try+ will also return +nil+ if the receiver does not respond to the method:
:delete_all is called on each client since the dependent options is :destroy
:nodoc: Allows views to be streamed back to the client as they are rendered.
:nodoc: Implements the reader method, e.g. foo.items for Foo.has_many :items
A Set containing renderer names that correspond to available renderer procs.
A strong ETag implies exact equality: the response must match byte for byte.
Action Mailer provides hooks into the Mail observer and interceptor methods.
Action View contexts are supplied to Action Controller to render a template.
Active Records accept constructor parameters either in a hash or as a block.
After loading the appropriate files, the corresponding modules are returned.
An engine is nothing more than a railtie with some initializers already set.
An offset that is not expected, but correct if the configuration is changed.
Asserts that the provided options can be used to generate the provided path.
Browsers open a limited number of simultaneous connections to a single host.
CREATE FULLTEXT INDEX index_developers_on_name ON developers (name) -- MySQL
Calling content_for stores a block of markup in an identifier for later use.
Checks whether record is different to the current target, without loading it
Computes the path to a JavaScript asset in the public javascripts directory.
Connections can be obtained and used from a connection pool in several ways:
Controls whether the Origin header is checked in addition to the CSRF token.
Creates a new Duration from string formatted according to ISO 8601 Duration.
Default pattern, loads views the same way as previous versions of rails, eg.
Delimits thousands (e.g. 1,000,000 is a million) (always in groups of three)
Executes the given block and updates the latest watched files and timestamp.
Extract the action name from the passed data and process it via the channel.
Extracts an excerpt from +text+ that matches the first instance of +phrase+.
Fall back to 'keyword' style if this node is not on the RHS of an assignment
For example, you could do this in your controller to rollback a transaction:
Formats a +number+ into a phone number (US by default e.g., (555) 123-9876).
Freeze so future modifications will fail rather than do nothing mysteriously
Furthermore, the `bar` method will be redefined every time `foo` is invoked.
Here's an example of multiple sessions and custom DSL in an integration test
However, if you supply validate: false, validations are bypassed altogether.
Ideally this would, if only for symmetry's sake with other association types
If an alias was specified, it will be accessible from the resulting objects:
If this is an anonymous mailer, this method will return +anonymous+ instead.
If we took a while to get the lock, we may have been halted in the meantime.
If you want to use an inline method, such as a proc, do something like this:
Initializing the cache is done by passing the statement in the create block:
It is easier to do a sanity check here than require the caller to be clever.
It may be: - a Symbol or a String which specifies a single association name.
It provides an interface for protecting attributes from end-user assignment.
It should not matter as we are using +HashWithIndifferentAccess+ internally.
Locking::Pessimistic provides support for row-level locking using SELECT ...
NOTE: This validation will not fail if the association hasn't been assigned.
Normalize the list of new constants, and add them to the list we will return
Normally you'd also just keep domain objects, like Active Records, in there.
Note: The path passed to `--require` is directly passed to `Kernel.require`.
Now, +Engine+ will get only requests that were not handled by +Application+.
Options supported are +:compress+, +:compress_threshold+, and +:expires_in+.
Other proxy services set the Client-Ip header instead, so we check that too.
Parameters: * +grouped_options+ - Accepts a nested array or hash of strings.
Rails uses the alias internally, and plugin authors are encouraged to do so.
Register an object to be invoked during both the +run+ and +complete+ steps.
Returns a new hash with the results of running +block+ once for every value.
Returns an array of all the attributes that have been specified as readonly.
Returns false if +no_wait+ is set and the lock is not immediately available.
Returns true if statement cache should be skipped on the association reader.
Sanitizes a +string+ so that it is safe to use within an SQL LIKE statement.
See the +ActiveSupport::MessageVerifier+ documentation for more information.
Set +open+ to true to create an open tag compatible with HTML 4.0 and below.
Sets attributes to be used when creating new records from a relation object.
Settings in config/environments/* take precedence over those specified here.
Since there is overhead, values must be large enough to warrant compression.
Split the token into the one-time pad and the encrypted value and decrypt it
Spurious files that come and go should not cause a crash, at least not here.
TODO Once "exceptron" is in, refactor this piece to simply re-use exceptron.
Take note that in that last case, the results are sorted in ascending order:
The actual method that is called is determined by calling method_for_action.
The argument _n_ specifies the length, of the random string to be generated.
The block is called from within a transaction, the object is already locked.
The block is saved and will be called whenever someone instruments "render":
The block syntax is also useful in providing information specific to a part:
The cache file has not been created because there was a symlink in its path.
The callback implementation should be restricted to cleaning up caches, etc.
The deprecator defaults to +ActiveSupport::Deprecator+ if none is specified.
The options argument is interpreted to be a hash of header names and values.
The reverse of +pluralize+, returns the singular form of a word in a string.
There are some more advanced features available even if the id is specified:
There is no way to do this automatically since it can be set on a superclass
There's a short-hand method for each of the type values declared at the top.
These are extensions that must be enabled in order to support this database"
These methods will operate with value objects like the ones described below:
This cop checks for excessive nesting of conditional and looping constructs.
This cop checks whether the rescue and ensure keywords are aligned properly.
This cop checks whether the source file has a utf-8 encoding comment or not.
This cop identifies places where `gsub` can be replaced by `tr` or `delete`.
This cop identifies places where `lstrip.rstrip` can be replaced by `strip`.
This cops checks for parentheses around the arguments in method definitions.
This helper returns the name of a cache key for a given fragment cache call.
This includes the month as a hidden field instead of showing a select field.
This is a violation of the Rails style, but it's not for this cop to report.
This is meant to be implemented by the adapters that support advisory locks.
This method should only be used if the other class contains the foreign key.
Unsubscribes all streams associated with this channel from the pubsub queue.
We don't own this job so we will update the locked_by name and the locked_at
When this attribute has a +nil+ value, the validation will not be triggered.
Wraps the passed block in a transaction, locking the object before yielding.
Yields each batch of records that was found by the find options as an array.
You can also specify that a file should be displayed inline with other HTML.
You can optionally provide HTML attributes as the last element of the array.
You can then use this object anywhere in your templates, layout, or helpers.
account is dependent, therefore is destroyed when reference to owner is lost
add_foreign_key :articles, :users, column: :author_id, primary_key: "lng_id"
alias_method :foo_without_feature, :foo alias_method :foo, :foo_with_feature
class Person include ActiveModel::Validations validates_with MyValidator end
common to require_no_parentheses and require_no_parentheses_except_multiline
do_something if str.match(/regex/) while regex.match('str') do_something end
if we get current version during initialization, it happens stack over flow.
on Oracle aliases are truncated to 30 characters and are quoted in uppercase
t.remove_references(:user) t.remove_belongs_to(:supplier, polymorphic: true)
we should only check core class (`DateTime`/`Time` or `::Date`/`::DateTime`)
would set the session cookie to expire automatically 14 days after creation.
* +initialize+ which expects two parameters and one block as described below.
* Grouped values: This returns an ordered hash of the values and groups them.
-- if owner_thread param is omitted, this must be called in synchronize block
A Config is associated with a YAML configuration file from which it was read.
A Symbol can be used to specify the type of the generated primary key column.
A case where the same cop could try to correct an offense twice in one place.
A singleton ActionCable::Server instance is available via ActionCable.server.
ActiveRecord::Base.transaction do david.withdrawal(100) mary.deposit(100) end
All caches support auto-expiring content after a specified number of seconds.
Also converts '/' to '::' which is useful for converting paths to namespaces.
As an engine can now be a rack endpoint, it can also have a middleware stack.
At one time, there was a problem with the psych YAML engine under Ruby 1.9.3.
Author.first.books.transaction do same effect as calling Book.transaction end
Available so that TimeZone instances respond like TZInfo::Timezone instances.
Basic implementation of url_for to allow use helpers without routes existence
But if not having a profile yet is fine and should not be an error condition:
Choosing which way to build a many-to-many relationship is not always simple.
Controllers should use the methods defined in ActionController::Base instead.
Creates a session hash, merging the properties of the previous session if any
Declares an attribute reader backed by an internally-named instance variable.
Declares an attribute writer backed by an internally-named instance variable.
Defines a callback that will get called before and after the job is enqueued.
Each such detected template will be added to the message, as a separate part.
Eager load the application by loading all ruby files inside eager_load paths.
First, we declare that this connection can be identified by its current_user.
HTML escapes strings but doesn't wrap them with an ActiveSupport::SafeBuffer.
Handles default conversions: to_model, to_key, to_param, and to_partial_path.
Helpers for creating and wrapping delivery behavior, used by DeliveryMethods.
Hence the need to ignore certain predefined sqls that deal with system calls.
If no +:dependent+ option is given, then it will follow the default strategy.
If the collection has been already loaded +length+ and +size+ are equivalent.
If the collection has been already loaded +size+ and +length+ are equivalent.
If the file does not exist, a 404 "File not Found" response will be returned.
If there is data in the cache with the given key, then that data is returned.
If you do this, then Mail will take the file name and work out the mime type.
In some cases, the code under test will happen to match an alternative style.
It's common to have resources that are logically children of other resources:
Just in case the error was caused by another process deleting the file first.
Monkey patch subscriber to test that only one subscriber per method is added.
NOTE: You can't set the limit either, that's used to control the batch sizes.
Note that the +:limit+ option is only applicable to one-to-many associations.
Number.create(i: 0) rescue ActiveRecord::StatementInvalid ...which we ignore.
Optimistic locking will also check for stale data when objects are destroyed.
Otherwise we may get mismatched pathnames when loading config files later on.
Populate +coder+ with attributes about this record that should be serialized.
Rails dups objects in a few critical spots where they are not that arbitrary.
Read more: http://www.martinfowler.com/eaaCatalog/singleTableInheritance.html
Register one or more Observers which will be notified when mail is delivered.
Remember to call `super` if you want to recursively process descendant nodes.
Removes an unwanted relation that is already defined on a chain of relations.
Removes current changes and makes them accessible through +previous_changes+.
Removes the timestamp columns (+created_at+ and +updated_at+) from the table.
Replaces any existing order defined on the relation with the specified order.
Returns a new date/time representing the start of this week on the given day.
Returns a quoted version of the table name, used to construct SQL statements.
Returns an array of +Column+ objects for the table specified by +table_name+.
Returns an empty HTML tag of type +name+ which by default is XHTML compliant.
Returns the full controller name, underscored, without the ending Controller.
Returns the name of all database fields which have been read from this model.
Returns the ordered railties for this application considering railties_order.
Returns the value of the cookie by +name+, or +nil+ if no such cookie exists.
Reverses the migration commands for the given block and the given migrations.
See http://feedvalidator.org/docs/error/InvalidTAG.html for more information.
See the concrete implementation for details on the expected parameter values.
Simulate a PUT request with the given parameters and set/volley the response.
So the task of this method is to merge them according to the following rules:
TODO: Revert to the original expression once the fix in Rubinius is released.
Test the same thing as above, but make sure the view path is not eager loaded
The +comments+ resource here will have the following routes generated for it:
The reconnection time in milliseconds used when attempting to send the event.
There is currently no way to differentiate between which source it came from.
This can be supplied as a proc, lambda or symbol which returns an enumerable.
This can happen if parallel RuboCop invocations try to remove the same files.
This cop checks for the use of the read_attribute or write_attribute methods.
This is needed, for example, when using Makara proxies for distributed Redis.
This is useful for web services that need to work with raw requests directly.
This method toggles directly the underlying value without calling any setter.
Those will not be the ultimate client IP in production, and so are discarded.
Through association (uses the :primary_key option from the source reflection)
To iterate over these one hundred posts, we'll generate 201 database queries.
Tries to rescue the exception by looking up and calling a registered handler.
We allow uses of `self` with operators because it would be awkward otherwise.
We are going to assign to existing constants on purpose, so silence warnings.
We still need to respect the source_reflection's :primary_key option, though.
We want to be able to start and stop EM loop in tests to make things simpler.
Wraps its argument in an array unless it is already an array (or array-like).
You also don't need to use longer url helpers like +my_engine_articles_path+.
You can add your own middlewares by using the +config.middleware.use+ method:
You shouldn't ever need to create a TimeWithZone instance directly via +new+.
change column default to see that column doesn't lose its not null definition
def edit render plain: "I'm only accessible if you know the password" end end
def instance_validations validates_with MyValidator, MyOtherValidator end end
edge case for one constant only complain when the number of variables matches
preallocate all the default blocks for performance/memory consumption reasons
rename_index :people, 'index_people_on_last_name', 'index_users_on_last_name'
test "find" do assert_equal "Ruby on Rails", web_sites(:rubyonrails).name end
*  by initializing an instance of renderer by passing it a custom environment.
:nodoc: Normalize ::Foo, ::Object::Foo, Object::Foo, Object::Object::Foo, etc.
@local_tz is initialized as nil to avoid warnings when connect tries to use it
ActionController::TestCase will be deprecated and moved to a gem in Rails 5.1.
Active Record collections delegate their representation in XML to this method.
Adds the namespace defined in the options to a pattern designed to match keys.
All authors with subscribers where one of the subscribers' nick is 'alterself'
Assign any deferred nested attributes after the base attributes have been set.
CREATE TABLE objects ( guid int auto_increment PRIMARY KEY, name varchar(80) )
Callbacks are code hooks that are run at key points in an object's life cycle.
Calling it on a value not stored with :raw will initialize that value to zero.
Check the polymorphism of taggings is being observed correctly (in both joins)
Checks for space between a the name of a called method and a left parenthesis.
Common functionality for checking for spaces inside various kinds of brackets.
Creates a new MemCacheStore object, with the given memcached server addresses.
Dups the singleton before each test, restoring the original inflections later.
Ensure we set the output buffer to an encoding different than the default one.
Escapes carriage returns and single and double quotes for JavaScript segments.
Executes a custom SQL query against your database and returns all the results.
FIXME: `references` has no impact on the aliases generated for the join query.
Fetches the first/last using SQL if possible, otherwise from the target array.
For instance, you can figure out the name of a table from the name of a class.
Functional tests allow you to test a single controller action per test method.
Here are some examples of render calls that Cache Digests knows how to decode:
If stale, the association accessor method on the owner will reload the target.
If the collection has been already loaded, +length+ and +size+ are equivalent.
If the request wasn't encoded `as` something, it's the same as calling `body`.
If there is data in the cache with the given keys, then that data is returned.
If you are having to call this function, you are likely doing something wrong.
If you do this, you do not need to do anything else for things to "just work".
If you don't specify an endpoint, routes will be used as the default endpoint.
In addition, it will destroy the association if it was marked for destruction.
Instead, a second model object is created when the create request is received.
It provides two options that controls the top-level behavior of new instances:
It raises a NameError when the name is not in CamelCase or is not initialized.
Just remember: They'll be gone by the time the next action has been performed.
Look at last expression of contents if there are parentheses around condition.
Marshaling an association shouldn't make it unusable by wiping its reflection.
Most text helpers by default sanitize the given content, but do not escape it.
Nested attribute writers are normal setter methods named after an association.
Normally, +user_path+ will construct a path with the user object's 'id' in it:
Notice that for fixnum and float columns empty strings are converted to +nil+.
One workaround is to begin a transaction on each class whose models you alter:
Oracle DATE columns are datetime columns and Oracle adapter returns Time value
Oracle has some funky default handling, so it requires a bit of extra testing.
Parse an XML Document string or IO into a simple hash using libxml / nokogiri.
Parses +str+ according to +format+ and returns an ActiveSupport::TimeWithZone.
Que is a queue for Ruby and PostgreSQL that manages jobs using advisory locks.
Rails.application.config.session_store :cookie_store, key: '_your_app_session'
Raised if you set the key for a Hash something else than a string or a symbol.
Raised when a primary key is needed, but not specified in the schema or model.
Registers a callback to be executed after bundle and spring binstubs have run.
Returns the receiver if it's included in the argument otherwise returns +nil+.
Ruby scripts (i.e. source files with a shebang in the first line) are ignored.
Scopes based on the allowed values of the enum field will be provided as well.
See the documentation of ActiveSupport::PerThreadRegistry for further details.
Set `config.ssl_options` with `secure_cookies: false` to disable this feature.
Setup all fixtures in test/fixtures/*.yml for all tests in alphabetical order.
Sidekiq uses threads to handle many jobs at the same time in the same process.
Simulate a HEAD request with the given parameters and set/volley the response.
Simulate a POST request with the given parameters and set/volley the response.
Takes in a limit and checks if the attributes_collection has too many records.
Tests the base functionality that should be identical across all cache stores.
That does not depend on whether the collection has already been loaded or not.
That one is particularly useful for serving assets from an SSL-protected page.
The +precision+ parameter can be used to limit seconds' precision of duration.
The ABC size is based on assignments, branches (method calls), and conditions.
The WatchStack keeps a stack of the modules being watched as files are loaded.
The hidden field has the same name as collection radio button and blank value.
The key should be +:where+ and the value should be the where value to unscope.
The preferred alternative is set in the EnforcedStyle configuration parameter.
These are the starting point for new projects and are not considered complete.
This cop checks for every useless assignment to local variable in every scope.
This cop checks whether constant names are written using SCREAMING_SNAKE_CASE.
This is a documented side-effect of the method that may avoid an extra SELECT.
This makes the entire controller stack thinner, suitable for API applications.
This method is available within the context of an ActiveRecord::Base instance.
This method must also receive a block that will be called once a path changes.
This object is initialized with a block that knows how to render the template.
User.select(:name).distinct.distinct(false) You can also remove the uniqueness
When +post+ is a persisted ActiveRecord::Base instance, the resulting HTML is:
When it's time to invalidate all fragments, simply change the string constant.
When you enable nested attributes an attribute writer is defined on the model.
Wrapping a string in this class gives you a prettier way to test for equality.
assert application trace refers to line that calls method_that_raises is first
class Person has_many :articles has_many :comment_tags, through: :articles end
def test_emails_again assert_emails 1 do ContactMailer.welcome.deliver_now end
fails because no class has the correct inverse_of for horrible_polymorphic_man
the actual attribute here is name, title is an alias setup via alias_attribute
validates_presence_of: generate_message(attr, :blank, message: custom_message)
(In a later update, the original implementation of `PLANETS` has been removed.)
+MessageVerifier+ creates HMAC signatures using SHA1 hash algorithm by default.
--exclude-limit is valid if there's a parsed or yet unparsed --auto-gen-config.
// The header part of this layout hello world // The footer part of this layout
@bad if condition_a action_a else if condition_b action_b else action_c end end
A reaper instantiated with a nil frequency will never reap the connection pool.
A session store that uses an ActiveSupport::Cache::Store to store the sessions.
A utility method for escaping HTML without affecting existing escaped entities.
All commands recorded will end up being recorded reverted and in reverse order.
Also note that the life of stale cache is extended only if it expired recently.
As long as there's at least one comment line that isn't an annotation, it's OK.
Avoid getting "symlink() function is unimplemented on this machine" on Windows.
Blocks and ignores any exception passed as argument if raised within the block.
By default, Rails will compile each template to a method in order to render it.
By default, associations will look for objects within the current module scope.
By default, this method is accessible from your controllers, views and mailers.
Called by +instantiate+ to decide which class to use for a new record instance.
Checks whether the connection to the database is still active (i.e. not stale).
Common functionality for checking multiline method calls and binary operations.
Create a new +Rakefile+ with the provided code (either in a block or a string).
Creates a masked version of the authenticity token that varies on each request.
Despite the cop's name, blocks are not considered as an extra level of nesting.
Expands out the +key+ argument into a key that can be used for the cache store.
Finally, the block can take block arguments, which can be passed in by +yield+:
For details on which formats use which options, see ActiveSupport::NumberHelper
For queries selecting a subset of columns, return false for unselected columns.
Here, the `case` node doesn't count, but each when scores one complexity point.
If a String is given, that given string is returned if it occurs in the string.
If everything goes fine a COMMIT is executed once the chain has been completed.
If in revert and going :up, say, we want to execute :down without reverting, so
If the action renders a different template, you can include its digest instead.
If the cache is cleaned up correctly, subsequent digests should return the same
If the collection hasn't been loaded, it fetches the records from the database.
If the number of records in the set exceeds the threshold, a warning is logged.
If this option is not passed, the previous default value (if any) will be used.
Includes +url_for+ into the host class (e.g. an abstract controller or mailer).
It differs for namespaced models regarding whether it's inside isolated engine.
It's impossible for a method call without parentheses to have a trailing comma.
It's used as the default entry point for generate, destroy and update commands.
Keep in mind that database adapters handle certain serialization tasks for you.
Layouts have access to variables specified in the content pages and vice versa.
Make sure that the resulting String to be eval'd is in the encoding of the code
Makes it possible for the RemoteConnection to disconnect a specific connection.
Note that this is simply 'syntactic sugar' for defining an actual class method:
Now all you have to do is change that timestamp when the helper method changes.
Of course, you can also query them directly if the scopes don't fit your needs:
On Ruby 2.0+ keyword arguments can optionally be excluded from the total count.
Override this in a subclass to modify the behavior around processing an action.
Qu was created to overcome some shortcomings in the existing queuing libraries.
Returns a String, which Action Pack uses for constructing a URL to this object.
Returns a string of the object's date and time in the ISO 8601 standard format.
Returns a string of the object's date and time in the RFC 2822 standard format.
Returns the backtrace after all filters and silencers have been run against it.
Sanitizes a hash of attribute/value pairs into SQL conditions for a SET clause.
Simulate a PATCH request with the given parameters and set/volley the response.
So either extending the provided method below, or rolling your own is required.
Tests that integration tests don't call Controller test methods for processing.
The body assignment is last, since the loop variable bar has an assignment too.
The check for an existing value should be run from a class that isn't abstract.
The last one is an argument to the first, and they both start on the same line.
The original exception that was raised during deserialization of job arguments.
The point of fixtures are that they're stable units of predictable sample data.
The underlying class variable is set to +nil+, if it is not previously defined.
Then, in another template or layout, this code would render only the last link:
They are searched from right to left, from bottom to top, and up the hierarchy.
This callback is called after a record has been created, updated, or destroyed.
This cop checks for a line break before the first element in a multi-line hash.
This cop checks for conditions that are not on the same line as if/while/until.
This cop looks for trailing blank lines and a final newline in the source code.
This is obviously a rubbish fix but it's the best I can come up with for now...
This is the same technique used in the +database.yml+ file to specify defaults:
This is used by the methods which create and delete records on the association.
Timestamps are in UTC by default but you can use the local timezone by setting:
Use a guard clause instead of wrapping the code inside a conditional expression
Validates that the specified attributes match the length restrictions supplied.
We don't know if the first semicolon on the line is a separator of expressions.
Would create +after_create+, +before_update+ and +around_destroy+ methods only.
Yes: The Queue Adapter has the ability to run the job in a non-blocking manner.
You can create your own custom FormBuilder templates by subclassing this class.
You can use +local_assigns+ in the sub templates to access the local variables:
change_column_null, make it not nullable and set null values to a default value
git :init git add: "this.file that.rb" git add: "onefile.rb", rm: "badfile.cxx"
queue_classic provides a simple interface to a PostgreSQL-backed message queue.
* Limit the set of zones provided by TZInfo to a meaningful subset of 146 zones.
:doc: Execute the supplied block without interference from any concurrent loads.
:nodoc: Singleton object used to determine if an optional param wasn't specified
Adds the ability to turn a basic fair FIFO queue into one biased to some thread.
All the concrete database adapters follow the interface laid down in this class.
Both calls delete the affected posts all at once with a single DELETE statement.
Can be used for cleaning up connections or marking users as offline or the like.
Convert namespaces to paths by replacing ":" for "/" and adding an extra lookup.
Create a new initializer with the provided code (either in a block or a string).
Declares a method available for all attributes with the given prefix and suffix.
Destructively converts all keys to symbols, as long as they respond to +to_sym+.
Determine if a transaction included an action for :create, :update, or :destroy.
FIXME: I don't know if this is *desired* behavior, but it is *today's* behavior.
FIXME: Remove this when the deprecation cycle on TZ aware types by default ends.
Filters out simple method calls to similarly named private, protected or public.
Generate default options for collection helpers, such as :checked and :disabled.
If +true+, +as_json+ will emit a single root node named after the object's type.
If a server goes down, then MemCacheStore will ignore it until it comes back up.
If all parts are negative it will negate all of them and return minus as a sign.
If it's a string within an interpolation, then it's not an offense for this cop.
If localization is used, the strings should be localized for the current locale.
If not, it means the layout exited without requiring anything from the template.
If the :only option is specified, then only the listed job(s) will be performed.
If the RAW_POST_DATA environment variable is already set, wrap it in a StringIO.
If the primary key is an integer, find by id coerces its arguments using +to_i+.
If there will be no +:tablet+ variant declared, +:phone+ variant will be picked:
If your proxies aren't removed, pass them in via the +custom_proxies+ parameter.
If your tables share a common prefix, it will only appear once at the beginning.
In order to work with ActionController, a Context must just include this module.
In such cases, all you need to do is to call refresh passing in the view object.
In this case Rails will simply infer the appropriate URL from the record itself.
It can be invoked via the guides:generate rake task within the guides directory.
It is initialized with a block that, when called, starts rendering the template.
Let's say that you want to create a form pointing to one of the engine's routes.
Most notably, the instance methods provided by SchemaStatements are very useful.
NOTE: Each nesting level will merge inherited defaults in addition to their own.
No such attribute would be set for objects of the Message class in that example.
Non related references which are caught in the above scan would be skipped here.
Now routes such as +/posts/1+ will no longer be valid, but +/posts/1.1+ will be.
On machines without Unix-domain sockets, the default is to connect to localhost.
One can generate the same path as the above example by using the following code:
One way to use this is to pass an array to layout and treat it as an enumerable.
Please note that callbacks are executed in the order they were defined in model.
Register one or more Interceptors which will be called before mail is previewed.
Reset the column used for optimistic locking back to the +lock_version+ default.
Returns +true+ if any of the attributes have unsaved changes, +false+ otherwise.
Returns +true+ when it's in the specified character class and +false+ otherwise.
Returns a record hash with the column names as keys and column values as values.
Returns an ActionDispatch::Request instance that represents the current request.
Returns the AssociationReflection object for the +association+ (use the symbol).
Returns the sequence name for a table's primary key or some other specified key.
Returns the source root for this generator using default_source_root as default.
Returns this record's primary key value wrapped in an array if one is available.
Returns true, since this connection adapter supports prepared statement caching.
Sanitizes HTML input, stripping all tags and attributes that aren't whitelisted.
See ActionDispatch::Routing for general information about routing and routes.rb.
See the examples below for more information about providing custom type objects.
Sets a flash that will not be available to the next action, only to the current.
Several Rack middlewares may not work and you need to be careful when streaming.
Simulate a DELETE request with the given parameters and set/volley the response.
Since +javascript_url+ is based on +asset_url+ method you can set :host options.
Since +stylesheet_url+ is based on +asset_url+ method you can set :host options.
So we need to store the path at file load and revert back to it after each test.
That's an instance of the class ActiveRecord::Reflection::AssociationReflection.
The +extension+ argument allows you to pass a block into a has_many association.
The CLI is a class responsible of handling all the command line interface logic.
The `if` node must have only `if` body since we excluded `if` with `else` above.
The base +Renderer+ class uses its +render+ method to delegate to the renderers.
The current cycle string can be obtained anytime using the current_cycle method.
The result would be the same if we added +:inverse_of+ to our model definitions:
The version number in which the deprecated behavior will be removed, by default.
Then, in another template or layout, this code would render both links in order:
These are all the files we have `require`d plus everything in the bin directory.
This allows us to abstract the normalization across several methods that use it.
This cop checks for a line break before the first element in a multi-line array.
This cop checks whether the end keywords are aligned properly for do end blocks.
This cop checks whether the end statement of a do..end block is on its own line.
This cop enforces the use of consistent method names from the Enumerable module.
This includes the keys from the root hash and from all nested hashes and arrays.
This is then used by Action Cable to determine the URL of your WebSocket server.
This method is I18n aware, so you can set up custom approximations for a locale.
This method makes sure that tests don't leak global state related to time zones.
This script is prepared to be launched from the guides directory as a rake task:
To generate a new migration, you can use rails generate migration MyNewMigration
To work around this, you must specify the pluralized form as an acronym as well:
Under the hood, it replaces spaces with underscores and defines the test method.
Use it to retrieve the current state of the response, or customize the response.
Using modules in separate files means tedious sifting to get a big-picture view.
We are also defining a constant to hold the frozen string of the attribute name.
We can't transcode to the same format, so we choose a nearly-identical encoding.
We can't use alias_method here, because method 'id' optimizes itself on the fly.
When set to false, the pattern matches any request prefixed with the given path.
You also need to specify which attributes inside the hash should be whitelisted.
You can use the +prepend+ option on the +before_destroy+ callback to avoid this.
`either` (which is the default) : the `end` is allowed to be in either location.
class Project has_and_belongs_to_many :developers, after_add: :evaluate_velocity
file fixtures/_top_level_partial.html (not fixtures/test, with format extension)
if a template has changed, it will be now be newer than all the cached templates
if there is a provided tld length then we use it otherwise default domain regexp
postgresql test if randomly executed then executes "SHOW max_identifier_length".
puts 'This code gets executed and nothing related to ZeroDivisionError was seen'
rack will raise a Rack::Utils::ParameterTypeError when parsing this query string
* +id+ - The id of the object you wish to update a counter on or an array of ids.
+override: false+ will cause the native type to be used over yours if one exists.
:nodoc: This is like this because benchmarking justifies the strange :false stuff
A Unicode safe version of all the String methods are defined on this proxy class.
A valid ruby identifier - suitable for class, method and specially variable names
Active Record supports optimistic locking if the +lock_version+ field is present.
An example would be Active Record log subscriber responsible for logging queries:
As this is the most popular route of most Rails applications, this is beneficial.
Be lazy computing stuff to have as light impact as possible to the rest of tasks.
Build an application by invoking the generator and going through the whole stack.
By convention, each action also maps to particular CRUD operations in a database.
By default, it will create a button tag with type `submit`, if type is not given.
Check to make sure that you don't have an attribute or method with the same name.
Deletes and returns a key-value pair from +Parameters+ whose key is equal to key.
Do the relevant stuff to insert the given record into the association collection.
Does the actual rewrite and returns string corresponding to the rewritten source.
Find a few candidate jobs to run (in case some immediately get locked by others).
For example, suppose a person has many projects, and each project has many tasks.
If +full_messages+ is +true+, it will contain full messages (see +full_message+).
If +nil+ is passed as the name the value of the link itself will become the name.
If :sql, the schema is dumped as (potentially database- specific) SQL statements.
If a reference is broken levenshtein distance is used to suggest an existing one.
If the current value of +method+ is +tag_value+ the radio button will be checked.
If the user has explicitly decided to NOT raise errors, pass that option to I18n.
Initialize the logger early in the stack in case we need to log some deprecation.
It can contain other characters, e.g. a unary plus, but it must start with space.
It includes model name introspections, conversions, translations and validations.
It takes an instance of a class, a method on that class and an instance variable.
JSON.dump will fail if the offense message contains text which is not valid UTF-8
MySQL 5.7 and Oracle do not allow to create duplicate indexes on the same columns
NameError is raised when the name is not in CamelCase or the constant is unknown.
Note that the status code must be a 3xx HTTP code, or redirection will not occur.
Otherwise a new record will be instantiated and used to replace the existing one.
Performs a request using the specified method, following any subsequent redirect.
Place `when` conditions that use splat at the end of the list of `when` branches.
Read more about optimistic locking in ActiveRecord::Locking module documentation.
Removes any condition from the query other than the one(s) specified in +onlies+.
Respect the order on `reflection_scope` if it exists, else use the natural order.
Returns an escaped version of +html+ without affecting existing escaped entities.
Returns true if the cop name or the cop namespace matches any of the given names.
Running both things in the same process is a recipe for a night with paracetamol.
See Rack::Utils::SYMBOL_TO_STATUS_CODE for a full list of valid +status+ symbols.
Tests, setup, and teardown common to the application and plugin generator suites.
That is, the request API client will handle the session for you instead of Rails.
The +expires_in+ parameter can override the value set when the entry was created.
The cipher text and initialization vector are base64 encoded and returned to you.
The command above creates a new root object and adds "app/controllers" as a path.
The first is an array of files and the second is an optional hash of directories.
The following bundled adapters throw the ActiveRecord::RecordNotUnique exception:
The human way of thinking about adding stuff to the end of a list is with append.
The offset is the number of seconds that this time zone is offset from UTC (GMT).
There is no implied ordering so if order matters, you should specify it yourself.
This cop checks for missing space between a token and a comment on the same line.
This is a convenient way of creating a namespace for tables in a shared database.
This is particularly useful for initializing an options hash with default values.
This is useful for limiting which attributes should be allowed for mass updating.
This means that the header and footer are only mentioned in one place, like this:
This protects your cookies from interception by a vulnerable site on a subdomain.
This relies on the rack variable set by the ActionDispatch::RequestId middleware.
This stub emulates the Railtie including the URL helpers from a Rails application
This will close the active connection and the defined connection (if they exist).
To close this gap, browser vendors include a baked-in list of HSTS-enabled sites.
To take advantage of these options, install the +actionview-encoded_mail_to+ gem.
Turns the Response into a Rack-compatible array of the status, headers, and body.
Useful to render parts of your layout differently based on what is in your views.
We can use the same cached proxy object because the id is available for the scope
When +post+ is a new, unsaved ActiveRecord::Base instance, the resulting HTML is:
When EnforcedStyle is 'flexible' then it's also allowed to use Time.in_time_zone.
When enqueuing jobs with the Inline adapter the job will be executed immediately.
When the argument is a module it will be included directly in the template class.
Without any +options+, the returned Hash will include all the model's attributes.
Workers do not work on JRuby or Windows (both of which do not support processes).
Yes, this process is extending the time for a stale value by another few seconds.
You are able to move this logic out into a class if it is too complex for routes.
You can also specify overrides if you want by passing a hash instead of a string:
You can change it to +true+ if the given JSON string includes a single root node.
You could for example raise an +ArgumentError+ when invalid options are supplied.
You interact with the value objects just like you would with any other attribute:
module ActiveRecord class RuntimeRegistry extend ActiveSupport::PerThreadRegistry
only one of two clients is included in the association due to the :conditions key
this would usually return "abstract_controller/testing/overriding_local_prefixes"
we must actually delete prefix segment keys to avoid passing them to next url_for
A CookieOverflow exception is raised if you attempt to store more than 4K of data.
A cache store implementation which stores data in Memcached: http://memcached.org/
A class with no predefined methods that behaves similarly to Builder's BlankSlate.
ActionCable.server.remote_connections.where(current_user: User.find(1)).disconnect
ActiveRecord::RecordNotFound is rescued within the method, and it is not reraised.
Additionally users can allow additional variables via the AllowedVariables option.
Attributes marked as readonly are silently ignored if the record is being updated.
By default this is guessed to be the name of the association with an "_id" suffix.
Cache source root and add lib/generators/base/generator/templates to source paths.
Check-out a database connection from the pool, indicating that you want to use it.
Configure the frequency by setting "reaping_frequency" in your database yaml file.
Creates an entry tag for a specific record and prefills the id using class and id.
Extracts the nested parameter from the given +keys+ by calling +dig+ at each step.
FIXME: this should probably split on +delim+ and use +subtype+ to cast the values.
Hook method defining how an attribute value should be retrieved for serialization.
If no welcome template exists, it will raise an ActionView::MissingTemplate error.
If the user accepts, the form is processed normally, otherwise no action is taken.
If the user accepts, the link is processed normally, otherwise no action is taken.
If there is no such data in the cache (a cache miss), then +nil+ will be returned.
If there's no .rubocop.yml there either, the path to the default file is returned.
If value is true (default), attempting to update a record will result in an error.
If you only have secret_token set, your cookies will be signed, but not encrypted.
In both cases, if an offset is negative, it is counted from the end of the string.
In the simple case, MySQL allows us to place JOINs directly into the UPDATE query.
It is your responsibility to ensure that the string contains no malicious content.
It will be called as is, there will be no database agnostic conversions performed.
It's pretty safe to assume that these calls are not missed by anyone reading code.
Never trust parameters from the scary internet, only allow the white list through.
Note that declaring a header multiple times will add many fields of the same name.
Note: How end-of-line comments are associated with code changed in parser-2.2.0.4.
Now reload, and verify that it gets the DB version, and not the querycache version
Optionally accepts a namespace, and all keys will be scoped within that namespace.
Prints the mapping from filenames to annotations in +results+ ordered by filename.
Raises TooManyRecords error if the attributes_collection is larger than the limit.
Regardless of this setting, the Reaper will be invoked before every blocking wait.
Resets one or more counter caches to their correct value using an SQL count query.
Returns a new Date representing the date 1 day after today (i.e. tomorrow's date).
See http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html for more possibilities.
So we should build a relation to merge in rather than directly merging the values.
So, we have to rearrange things so that the request looks like this (url-encoded):
Sometimes it is useful to have access to the owner object when building the query.
Sometimes you may want to isolate engine, but use helpers that are defined for it.
Specify the proc used to decorate input tags that refer to attributes with errors.
The +source+ can be full path or file that exists in your public audios directory.
The cache is thus automatically bumped whenever the project updated_at is touched.
The method, proc or string should return or evaluate to a +true+ or +false+ value.
The namespace attribute will be prefixed with underscore on the generated HTML id.
The same record may be represented in the persisted array and in the memory array.
Then consistency is checked only within each section delimited by a modifier node.
These requires are to emulate an engine loading Action View before the application
This can happen in Internet Explorer when redirecting after multipart form submit.
This class handles preparation of the arguments before the AppGenerator is called.
This cop checks for string conversion in string interpolation, which is redundant.
This takes advantage of Copy On Write process behavior so workers use less memory.
This will create a number of routes for each of the posts and comments controller.
This will use +font_path+ internally, so most of their behaviors will be the same.
Used to test that read and question methods are not generated for these attributes
User.eager_load(:posts) SELECT "users"."id" AS t0_r0, "users"."name" AS t0_r1, ...
Using the route above, the URL "http://localhost:3000/articles/2005/11/06" maps to
We follow the same principle regardless of which Ruby version we're running under.
We should get `old_backend` here even while another thread is using `new_backend`.
When using a select list to choose an existing 'ship' id, with include_blank: true
Will add an error message to each of the attributes in +attributes+ that is empty.
You can create a custom behavior or set any from the +DEFAULT_BEHAVIORS+ constant.
Your server can also configure this for you by setting the X-Sendfile-Type header.
activerecord/test/cases/associations/cascaded_eager_loading_test.rb:37 with :posts
class CssInlineStyler def self.previewing_email(message) inline CSS styles end end
class User include ActiveSupport::Configurable config_accessor :allowed_access end
config.assets.debug and config.assets.compile are false for production environment
def test_jobs_again assert_performed_jobs 1 do HelloJob.perform_later('robin') end
module Bar include Foo def self.included(base) base.method_injected_by_foo end end
number of iterations selected based on consultation with the google security team.
redirect_to posts_url, status: :see_other redirect_to action: 'index', status: 303
remove_index calls index_name_for_remove which can't work since execute is stubbed
test that this wasn't a fluke and using an incorrect order results in an exception
wrap_parameters false disables parameters wrapping for this controller altogether.
'And they found that many people were sleeping better.'.truncate(25, omission: '...
1) This request passed through two proxies with incompatible IP header conventions.
A JoinBase represents the Active Record which everything else is being joined onto.
A proc can also be passed, and will be called once each time a new value is needed.
Action Controller sends content to the user by using one of five rendering methods.
ActionView::Template is one of a few sources of potential encoding issues in Rails.
ActiveSupport::Subscriber is an object set to consume ActiveSupport::Notifications.
Adding an index fires a query every time to check if an index already exists or not
All of the identifiers applied to the connection class associated with this server.
Be careful when using the older argument style, as an extra literal hash is needed:
But if it is +nil+ and does not respond to the delegated method, +nil+ is returned.
By default this is guessed to be the name of the association with a "_type" suffix.
Called when object is nested under an object that receives with_indifferent_access.
Defines a per-thread class attribute and creates class and instance reader methods.
Don't attempt to autocorrect if semicolon is separating statements on the same line
Filters out directories which are descendants of others in the collection (stable).
First, include ActiveModel::Validations::Callbacks from the class you are creating:
For removing objects from the session, you can either assign a single key to +nil+:
Fred.aaa DEPRECATION WARNING: aaa is deprecated and will be removed from Rails 5.1.
Gives a record (or N records if a parameter is supplied) without any implied order.
Hold off drawing routes until all the possible controller classes have been loaded.
I18n load paths are a special case since the ones added later have higher priority.
If a block is given, the new session is yielded to the block before being returned.
If the cookie was tampered with by the user (or a 3rd party), nil will be returned.
If the status is true the transaction is committed, otherwise a ROLLBACK is issued.
If you don't have a layout, just render the thing and concatenate the final result.
If you pass a single Fixnum, returns a substring of one character at that position.
It can be used to derive a number of keys for various purposes from a given secret.
Loads the Unicode database and returns all the internal objects of UnicodeDatabase.
Make class option aware of Rails::Generators.options and Rails::Generators.aliases.
Methods defined on the FormBuilder are used to generate fields bound to this model.
Migrations can manage the evolution of a schema used by several physical databases.
No: The adapter will run jobs at the next opportunity and cannot use perform_later.
Note: MySQL doesn't yet support index order (it accepts the syntax but ignores it).
One way to change these is to specify `always_permitted_parameters` in your config.
Or you may provide a custom delivery method object e.g. +MyOwnDeliveryMethodClass+.
Otherwise, February 31st or February 29th, 2011 can be selected, which are invalid.
Otherwise, tell I18n to raise an exception, which we rescue further in this method.
Resets a cycle so that it starts from the first element the next time it is called.
Return if a TimeZone instance, or wrap in a TimeZone instance if a TZInfo::Timezone
Returns +true+ if the given attribute is in the attributes hash, otherwise +false+.
Returns a cache key that can be used to identify the records fetched by this query.
Returns a hash with the job data that can safely be passed to the queueing adapter.
Returns a quoted version of the primary key name, used to construct SQL statements.
Returns a string of the object's date and time in the format used by HTTP requests.
Returns the next value that will be used as the primary key on an insert statement.
Returns the record for an association collection that should be validated or saved.
Returns whether or not this association reflection is for a collection association.
So the three-lined example in "Using partials" can be rewritten with a single line:
Specifies the `port` that Puma will listen on to receive requests, default is 3000.
TODO: look for constant definition and see if it is nested inside a class or module
The +Path+ object is simply an enumerable and allows you to easily add extra paths:
The call method must accept two arguments, params and request, and return a string.
The expiration time is used to support the :race_condition_ttl option on the cache.
The hidden field has the same name and its attributes mimic an unchecked check box.
The mysql2 and postgresql adapters support setting the transaction isolation level.
The names in the template are replaced with the corresponding values from the hash.
The paths are interpreted as relative to dir1 because .rubocop.yml is placed there.
The selects are prepared for multi-parameter assignment to an Active Record object.
The value is returned with the same data type of the column, +0+ if there's no row.
The value returned from calling +method+ on the instance +object+ will be selected.
This approach will assume that when a new topic is added, you'll touch the project.
This cops checks for indentation of the first non-blank non-comment line in a file.
This essentially combines +assert_recognizes+ and +assert_generates+ into one step.
This generates helpers such as +account_projects_path+, just like +resources+ does.
This is expected because lookup_context will reuse the previous key for :en locale.
This is used internally to append, prepend and skip callbacks to the CallbackChain.
This may be represented in the same way as values passed to +url_for+ or +link_to+.
This method enables you to use the flash as a central messaging system in your app.
This method will access the database and load the model's schema if it is required.
This test was failing when run on its own (as opposed to running the entire suite).
This will use +asset_path+ internally, so most of their behaviors will be the same.
This will use +audio_path+ internally, so most of their behaviors will be the same.
This will use +image_path+ internally, so most of their behaviors will be the same.
This will use +video_path+ internally, so most of their behaviors will be the same.
To change this, we can give a block to customize how the controller can be invoked.
To raise an exception when the value is blank, append a bang to the key name, like:
Values are encoded to JSON, with the exception of strings, symbols and BigDecimals.
When given an array of keys, the method tries to require each one of them in order.
When loading the file, Dependencies will watch for the addition of these constants.
When using a proc or lambda the instance under validation is passed as an argument.
Without a variable name to attach the glob parameter to, the route can't be parsed.
You can redirect any path to another path using the redirect helper in your router:
attr_accessor :name attribute_method_prefix 'clear_' define_attribute_methods :name
class Cat include ActiveModel::AttributeAssignment attr_accessor :name, :status end
class Person Required dependency for ActiveModel::Errors extend ActiveModel::Naming
test that correct path is generated for the same polymorphic_path call in an engine
"State" can be anything: the controller's HTTP response, the database contents, etc.
:nodoc: Double assign to suppress the dreaded 'assigned but unused variable' warning
A VariableTable manages the lifetime of all scopes and local variables in a program.
A block node has three children: the block start, the arguments, and the expression.
A braceless hash is the last parameter of a method call and will be checked as such.
A common example, /profile always shows the profile of the currently logged in user.
A pattern can also point to a +Rack+ endpoint i.e. anything that responds to +call+:
All of the select-type methods share a number of common options that are as follows:
Always increase the heading level by 1, so we can use h1, h2 heading in the document
An eager loading condition to force the eager loading model into the old join model.
And sometimes you need to do something in SQL not abstracted directly by migrations:
Asserts that the job passed in the block has been enqueued with the given arguments.
Be sure to look at the documentation of those specific classes for more information.
CREATE INDEX by_branch_desc_party ON accounts(branch_id DESC, party_id ASC, surname)
Change to the application's path if there is no config.ru file in current directory.
Checks to see if a foreign key exists on a table for a given foreign key definition.
Don't change '/../temp/' cavalierly or you might hose something you don't want hosed
Enables the use of byte calculations and declarations, like 45.bytes + 2.6.megabytes
Fill in the headers with dummy data to make sure they get removed during the testing
For example, let's say you made a helper to automatically add labels to form inputs.
Guesses the table name, but does not decorate it with prefix and suffix information.
Holds all the methods that are shared between MacroReflection and ThroughReflection.
Hook overridden in controller to add request information with `default_url_options`.
If attribute names are passed, they are updated along with updated_at/on attributes.
If it's not a string within an interpolation, then it's not an offense for this cop.
If no layout is supplied, look for a template named the return value of this method.
If the :only option is specified, then only the listed job(s) will not be performed.
In other words, we make the request so that it operates on a single entity's person.
In the above block, a +FormBuilder+ object is yielded as the +person_form+ variable.
Instrument the given block by measuring the time taken to execute it and publish it.
Invoke a method on the connection asynchronously through the pool of thread workers.
It's strongly recommended that you check this file into your version control system.
Limits the byte size of the string to a number of bytes without breaking characters.
Note that these are implemented as callbacks, and Rails executes callbacks in order.
Note that we are including a 30-second boundary around the interval we want to test.
Once Subclass assigns a value then the value assigned by Subclass would be returned.
One can additionally pass a hash as an argument to unscope specific +:where+ values.
Otherwise, since the String is invalid in the encoding specified, raise an exception
Overwriting will negate any effect of the +primary_key_prefix_type+ setting, though.
Raises: - ActiveRecord::ConnectionTimeoutError if a connection could not be acquired
Returns a new Time representing the time a number of seconds since the instance time
Returns the AggregateReflection object for the named +aggregation+ (use the symbol).
Returns the type of the attribute with the given name, after applying all modifiers.
Rolling back this migration will raise an ActiveRecord::IrreversibleMigration error.
Runs the given block in a database transaction, and returns the result of the block.
So the template digest for the current action is automatically included in the ETag.
Takes an action name and returns the name of the method that will handle the action.
That action implicitly responds to all formats, but formats can also be whitelisted:
The precise location of the problem is shown together with the relevant source code.
The same instance variables defined in the action are passed to all email templates.
This class provides the ability to write an SSE (Server Sent Event) to an IO stream.
This class represents the configuration of the RuboCop application and all its cops.
This cop checks for big numeric literals without _ between groups of digits in them.
This cop checks whether the end keywords of method definitions are aligned properly.
This cops checks if empty lines around the bodies of blocks match the configuration.
This falls back on `define_method` and `send` if the given names cannot be compiled.
This form is significantly faster on JRuby, and this is one of our biggest hotspots.
This hidden field is given the same field name as the checkboxes with a blank value.
This is especially useful if you want to persist the changed class in your database.
This is mainly intended for sharing common conditions between multiple associations.
This is typically the case when you have template rendering that happens in helpers.
This means HTML tags will appear in the page but all malicious code will be removed.
This module provides a method which will redirect the browser to use HTTPS protocol.
This verifier can be used to generate and verify signed messages in the application.
To get the default_scope conditions for any of the other reflections in the chain 2.
Updates the associated record with values matching those of the instance attributes.
Use this if you already have some hash and you want to create a new one based on it.
Use this macro in your model to set a default scope for all operations on the model.
User.order(email: :desc) SELECT "users".* FROM "users" ORDER BY "users"."email" DESC
We care if the block start with arguments and the expression start on the same line.
When placed on a parent resource, generates shallow routes for all nested resources.
Without knowing the secret, the original value cannot be extracted from the message.
You can also use one or more strings, which will be used unchanged as SELECT fields.
You can control the form submission and input element behavior using +html_options+.
You can include this in your classes if you want to access routes for other engines.
def test_jobs_again assert_enqueued_jobs 1 do HelloJob.perform_later('cristian') end
module needs to be created after Qux is included in Object or bug won't be triggered
post :change_avatar, avatar: fixture_file_upload('files/spongebob.png', 'image/png')
redeclared association on AR descendant should not inherit callbacks from superclass
rename column to see that column doesn't lose its not null and/or default definition
resulting in the following output within the logs including a hash with the payload:
* +updates+ - A string, array, or hash representing the SET part of an SQL statement.
* Integrate exceptions with exceptron * Rack::Cache needs to support streaming bodies
+range+ (PG only) specifies that the type should be a range (see the examples below).
A block can be passed to +select+ to customize how the options tags will be rendered.
A cache store implementation which stores everything into memory in the same process.
Active Record saves the ids of the records from the first query to use in the second.
ActiveRecord::Suppressor prevents the receiver from being saved during a given block.
Add 1 to half the number of files, so that we remove the file if there's only 1 left.
Asserts that the job passed in the block has been performed with the given arguments.
Calculates a new Time or Date that is as far in the past as this Duration represents.
Calls the given block for the receiver and each descendant node in depth-first order.
Casts a value from the ruby type to a type that the database knows how to understand.
Collection class for all the channel subscriptions established on a given connection.
Common functionality for the styles where not only keys, but also values are aligned.
Copy the instance variables from the current session instance into the test instance.
Count should come from sql count() of treasures rather than treasures_count attribute
Deal with controller names on scaffold and add some helpers to deal with ActiveModel.
Ensure proxy class responds to all methods that underlying time instance responds to.
Establish a new connection, the old database may be gone (db:test:prepare uses purge)
For any custom MIME Types you've registered, you can even add your own encoders with:
For example, Rails::Generators::ModelGenerator will return "model" as generator name.
For example, here's a pattern of creating notifications when new comments are posted.
For example, shoulda is considered a test_framework and is an extension of test_unit.
For example, when RuboCop inspects 2 files, the invocation order should be like this:
For hash conditions, you can either use the table name in the key, or use a sub-hash.
If child.rb is being autoloaded, its constants will be added to autoloaded_constants.
If the attribute has more than one error message, yields once for each error message.
In each of these cases, the named routes remain the same as if you did not use scope.
It doesn't really matter how you do it, but the md5 of the template file must change.
Meant to be used as a sanity check when you are about to assign an associated record.
Modifies the amount of an already existing integer value that is stored in the cache.
Most of the tests mess with the validations of Topic, so lets repair it all the time.
NOTE: Due to backwards compatibility concerns, the collection can't be one of hashes.
Nested resources and/or namespaces are also supported, as illustrated in the example:
Only public methods are added as subscribers, and only if a notifier has been set up.
Oracle identifier length is limited to 30 bytes or less, `polymorphic` renamed `poly`
Override this method if you want to customize when detailed exceptions must be shown.
Parameters after the first one are checked by Style/AlignParameters, not by this cop.
Params wrapper should come before instrumentation so they are properly showed in logs
Provides a store of all the enqueued jobs with the TestAdapter so you can check them.
Provides a way to track changes in your object in the same way as Active Record does.
Reading a cookie does not get the cookie object itself back, just the value it holds.
Reads multiple values from the cache using a single call to the servers for all keys.
Register an object that knows how to handle template files with the given extensions.
Returns a hash of mappings from the abstract data types to the native database types.
Returns true if a connection that's accessible to this class has already been opened.
Returns true if the node has a comment on the line above it that isn't an annotation.
See ActiveModel::Validations::HelperMethods.validates_length_of for more information.
See the ActiveSupport::Multibyte::Chars implementation for an example how to do this.
Since fixtures are a testing construct, we use them in our unit and functional tests.
Since jobs share a single thread pool, long-running jobs will block short-lived jobs.
So, for example, if we had a _local_ variable +post+ representing an existing record,
Sometimes, you have a resource that clients always look up without referencing an ID.
Such abnormal situation can happen for example if the user changes the clock by hand.
TODO: Move all these random hacks into the ARTest namespace and into the support/ dir
That's a string with the absolute path of the asset, for example "/assets/rails.png".
The +helper+ class method can take a series of helper module names, a block, or both.
The +sources+ can be full paths or files that exists in your public videos directory.
The application is also responsible for setting up and executing the booting process.
The exceptions app should be passed as parameter on initialization of ShowExceptions.
The instrumenters for multiple notifiers are held in a single instance of this class.
The render call itself will just return a string holding the result of the rendering.
This automatically set classes 'year', 'month', 'day', 'hour', 'minute' and 'second'.
This can be useful in development mode to determine which fields need to be selected.
This cop checks for nested use of if, unless, while and until in their modifier form.
This cop checks that comment annotation keywords are written according to guidelines.
This cops checks if empty lines around the bodies of classes match the configuration.
This cops checks if empty lines around the bodies of methods match the configuration.
This cops checks if empty lines around the bodies of modules match the configuration.
This hash allows you to specify the most used headers in an email message, these are:
To make things DRY this macro is created to define 3 tests for every validation case.
To preserve the case of the characters in a string, use the `preserve_case` argument.
To return old behavior set +config.action_controller.include_all_helpers+ to +false+.
Tries to create a new record with the same scoped attributes defined in the relation.
Valid keys are: :words_connector, :two_words_connector, :last_word_connector, :locale
Validates whether the value of the specified attributes are unique across the system.
We specifically do a manual INSERT here, and then test only the SELECT functionality.
You need to supply an absolute path or a path relative to the configured destination:
You should disable those middlewares whenever streaming in development or production.
`class_eval` with no receiver applies to whatever module or class we are currently in
add_column(:shapes, :triangle, 'polygon') ALTER TABLE "shapes" ADD "triangle" polygon
assignment to silence parse-time warning "possibly useless use of :: in void context"
if the adapter doesn't support the indexes call, pick defaults that let the test pass
perform_enqueued_jobs do HelloJob.perform_later('xavier') end assert_performed_jobs 1
specify the one exception to double render rule - render_to_string followed by render
the string we're going to sprintf our values against, with standardized column widths
this is safe to do, because .dupped ConnectionSpecification also auto-dups its config
+array+ (PG only) specifies that the type should be an array (see the examples below).
+constantize+ tries to find a declared constant with the name specified in the string.
+selected+ may also be an array of values to be selected when using a multiple select.
3 cops were disabled, then 2 were enabled again, so we should get 2 offenses reported.
:nodoc: We're treating `nil` as "unset", and we want the default setting to be `true`.
ActionMailer::Base.preview_interceptors.delete(ActionMailer::InlinePreviewInterceptor)
Adjust the given time to the simultaneous time in the time zone represented by +self+.
Allows you to consider additional controller-wide information when generating an ETag.
Also, you can specialize this method with per-user checking of permissible attributes.
An inline image has no need for an alt tag to be automatically generated from the cid:
As such, changes to `lock_optimistically`, or `locking_column` would not be picked up.
By default you will only be able to set and update attributes on the associated model.
CREATE UNIQUE INDEX accounts_branch_id_party_id_index ON accounts(branch_id, party_id)
Checks for if and unless statements used as modifers of other if or unless statements.
Checks if the request originated from the same origin by looking at the Origin header.
Converts a Date instance to a Time, where the time is set to the beginning of the day.
DeprecatedInstanceVariableProxy transforms an instance variable into a deprecated one.
Determines whether to store the full constant name including namespace when using STI.
Executes +method+ within a transaction and captures its return value as a status flag.
FIXME: this is more of an integration test with AR::Base and the schema modifications.
Foo::Bar::UsersController will try to find Foo::Bar::User, Foo::User and finally User.
From a user's perspective, the easiest thing to do is to save your templates as UTF-8.
Gets the Rails::Html::WhiteListSanitizer instance used by sanitize and +sanitize_css+.
Here we check if the parameters on a multi-line method call or definition are aligned.
If all the values for a given attribute are empty, the attribute will be set to +nil+.
If an internationalized template is not found it will fall back on `/public/500.html`.
If both headers are supplied, both must match, or the request is not considered fresh.
If no route is generated the formatter will raise ActionController::UrlGenerationError
If not and you are going to need the records anyway +length+ will take one less query.
If not possible, probe which are the default permissions in the destination directory.
If the owner is a new record then foreign_key must be present in order to load target.
If the record no longer exists in the database ActiveRecord::RecordNotFound is raised.
If this value is `false` (the default), a ClientDisconnected exception will be raised.
It's even possible to call these dynamic finder methods on relations and named scopes.
Just provide the polymorphic target type and Active Record will take care of the rest.
Left side bracket has to be able to match multiple types (e.g. :tLBRACK and :tLBRACK2)
MemCacheStore is currently the most popular cache store for large production websites.
Most template dependencies can be derived from calls to render in the template itself.
Note: The new instance will share a link to the same attributes as the original class.
Oracle enhanced adapter allows to define Date attributes in model class (see topic.rb)
Oracle supports precision up to 38 and it identifies decimals with scale 0 as integers
Otherwise, two corrections can interfere with each other, resulting in corrupted code.
Possible callbacks are: +before_add+, +after_add+, +before_remove+ and +after_remove+.
Preemptively iterates through all stored keys and removes the ones which have expired.
Provides a store of all the performed jobs with the TestAdapter so you can check them.
Rails::Application is responsible for executing all railties and engines initializers.
Returns an array of AggregateReflection objects for all the aggregations in the class.
Returns the +Errors+ object that holds all information about attribute error messages.
See ActiveModel::Validations::HelperMethods.validates_absence_of for more information.
See the documentation for those methods in ActiveRecord::Type::Value for more details.
The connection will remain open and active but will no longer be managed by this pool.
The current is to only run them in isolation to avoid randomly failing our test suite.
The decrement is performed directly on the underlying attribute, no setter is invoked.
The exception has an +attribute+ property that is the name of the offending attribute.
The first character of the string is at position 0, the next at position 1, and so on.
The form_for method automatically includes the model id as a hidden field in the form.
The increment is performed directly on the underlying attribute, no setter is invoked.
The set of directories from which automatically loaded constants are loaded only once.
Therefore test_invalid column should always return true even if the type is not valid.
They will receive the corrector itself and should use its method to modify the source.
This adapter may also present failed instances of the job class that can be restarted.
This allows you to easily return a response that consists only of significant headers:
This cop checks for chaining of a block after another block that spans multiple lines.
This error is raised when trying to eager load a polymorphic association using a JOIN.
This is a mimic of the warning "shadowing outer local variable - foo" from `ruby -cw`.
This is only relevant to certain associations, which is why it returns nil by default.
This is the root class of all associations ('+ Foo' signifies an included module Foo):
This is useful in cases where you aren't sure if the local variable has been assigned.
This should be called wherever the underlying cache implementation is not thread safe.
This value may be a string from the form builder, or a ruby object passed to a setter.
This will allow you to specify a text which will displayed instead by using this form:
Through the use of eager loading, the number of queries will be reduced from 101 to 2.
User.order('name DESC, email') SELECT "users".* FROM "users" ORDER BY name DESC, email
Using Date.today is dangerous, because it doesn't know anything about Rails time zone.
We are not using DROP COLUMN IF EXISTS because that syntax is only supported by pg 9.X
When passed a symbol or a name of a method, returns an array of errors for the method.
When the record is updated, the same check is made but disregarding the record itself.
While it's blocked, it holds no lock, so it doesn't interfere with any other attempts.
You may also provide a custom view path (see ActionView::PathSet for more information)
added sort by ID as otherwise Oracle select sometimes returned rows in different order
associations is the list of associations which are joined using hash, symbol or array.
avoid intermittent failure caused when another test set global options on ConfigLoader
def test_emails assert_no_emails ContactMailer.welcome.deliver_now assert_emails 1 end
+assert_routing+ lets you test whether or not the route properly resolves into options.
+raw_old_value+ will be the `_before_type_cast` version of the value (likely a string).
A connection was established in an ancestor process that must have subsequently forked.
Active Job objects can be configured to work with different backend queuing frameworks.
All of these objects are converted into a lambda and handled the same after this point.
Allows you to add shortcut so that you don't have to refer to attribute through config.
An elegant way to factor duplication out of options passed to a series of method calls.
Asserts that the number of emails enqueued for later delivery matches the given number.
Backtraces often include many lines that are not relevant for the context under review.
By default, never raise an UnpermittedParameters exception if these params are present.
Calculates a new Time or Date that is as far in the future as this Duration represents.
Causes the records to be loaded from the database if they have not been loaded already.
Class that will build the hash while the XML document is being parsed using SAX events.
Clears the cache which maps classes and re-connects connections that require reloading.
Common identifiers are current_user and current_account, but could be anything, really.
Define a method `name` in `mod` that dispatches to `send` using the given `extra` args.
Do not replace association name with association foreign key if they are named the same
Emulate OptionParser's behavior to make failures consistent regardless of option order.
Example using Active Record (which automatically includes ActiveModel::SecurePassword):
FileUpdateChecker specifies the API used by Rails to watch files and control reloading.
For example, specifying +:books+ allows this method to preload all books for an Author.
For instance, +attributes+ and +connection+ would be bad choices for association names.
If a file is not found on disk, the request will be delegated to the application stack.
If a key is given and caching is on always check the cache before hitting the resolver.
If a subclass changes the value then that would also change the value for parent class.
If cond is nil, that means each when has an expression that evaluates to true or false.
If so, this helper will take care of the enclosing div and xhtml namespace declaration.
If the connection is no longer active, then this method will reconnect to the database.
If the object does not respond to +to_partial_path+, then an +ArgumentError+ is raised.
If this is a money type column and there are any currency symbols, then strip them off.
If you need to disconnect a given connection, you can go through the RemoteConnections.
If your code is intended for general consumption, test with multiple database backends.
If your type returns an object which could be mutated, you should override this method.
It just provides methods to repack Parser's diagnostics/errors into RuboCop's offenses.
Make sure IntegrationTest does not try to delegate these methods to the session object.
No point in executing the counter update since we're going to destroy the parent anyway
Note an object is not required to implement all APIs in order to work with Action Pack.
Note that if the user has JavaScript disabled, the request will fall back to using GET.
Options may also be used by concerns defined in a block by accepting a block parameter.
Oracle barfs on this because the join includes unqualified and conflicting column names
Overwrite the default class equality method to provide support for association proxies.
Postgres does not preserve insignificant whitespaces when round-tripping jsonb columns.
Provides some helpers to deal with testing log subscribers by setting up notifications.
Raised when unserialized object's type mismatches one specified for serializable field.
Receives namespaces in an array and tries to find matching generators in the load path.
Registers an alias that's not used on mime type lookup, but can be referenced directly.
Returns +true+ if attr_name were changed before the model was saved, +false+ otherwise.
Returns a string representation of the receiver suitable for use as a URL query string:
Returns a string that represents the array in XML by invoking +to_xml+ on each element.
Returns an instance of the specified +klass+ with the attributes of the current record.
Returns false unless the request credentials response value matches the expected value.
Returns the IP address of client as a +String+, usually set by the RemoteIp middleware.
Returns true if the current object's time is within the specified +min+ and +max+ time.
SQL error in sort clause if :include is not included due to Unknown column 'authors.id'
SQLite3 will not allow you to add a NOT NULL column to a table without a default value.
Some extensions can only be made to work with knowledge of the association's internals.
Sometimes you'll want to add a column in a migration and populate it immediately after.
Tag the source with the default external encoding or the encoding specified in the file
Take a simple example where the layout expects the template to tell which title to use:
Test first if column creation/deletion works correctly when no transaction is in place.
The cyclomatic complexity is the number of linearly independent paths through a method.
The referrer information is pulled from the HTTP `Referer` (sic) header on the request.
The second argument may be the cookie's value or a hash of options as documented above.
The variable foo belongs to the top level scope, but in AST, it's under the block node.
These two methods represent the two basic action archetypes used in Action Controllers.
This array needs not be flat, i.e. +records+ itself may also contain arrays of records.
This check is performed only if +terms_of_service+ is not +nil+ and by default on save.
This cop checks for a line break before the first argument in a multi-line method call.
This cop checks that the ABC size of methods is not higher than the configured maximum.
This could even happen if you use transactions with the 'serializable' isolation level.
This means working down from the current class (self), to the first non-abstract class.
This will allow clients to submit requests without having to specify any root elements.
To do so, the method loops over the pairs and builds nodes that depend on the _values_.
User.preload(:posts) SELECT "posts".* FROM "posts" WHERE "posts"."user_id" IN (1, 2, 3)
Value objects can also be composed of multiple attributes, such as the case of Address.
We search for .rubocop.yml only if we haven't already found it for the given directory.
WebSocket connection implementations differ on when they'll mark a connection as stale.
Without cache_classes + eager_load, the load interlock is required for proper operation
Wrap block with namespace of current application if namespace exists and is not skipped
Yes: Jobs may set which queue they are run in with queue_as or by using the set method.
You can use a block as well if your link target is hard to fit into the name parameter.
You should not use the +match+ method in your router without specifying an HTTP method.
always convert table names to downcase as in Oracle quoted table names are in uppercase
check against Time.local, since some platforms will return a Time instead of a DateTime
collection_select(:post, :author_id, Author.all, :id, :name_with_initial, prompt: true)
delete all interest records to ensure that hard coded invalid_id(s) are indeed invalid.
find the post, then find the author which is null so no query for the author or address
perform_enqueued_jobs do HelloJob.perform_later('yves') assert_performed_jobs 2 end end
'And they found that many people were sleeping better.'.truncate_words(5, omission: '...
* Autofilled timestamp columns * Fixture label interpolation * Support for YAML defaults
* `preload`: Advertise that this site may be included in browsers' preloaded HSTS lists.
Adds validation and save callbacks for the association as specified by the +reflection+.
And now it will look for all templates at "app/views/notifications" with name "another".
BUT salary has non-nil default which should be treated as not changed on cloned instance
Backburner is a beanstalkd-powered job queue that can handle a very high volume of jobs.
Can be an object that responds to +call+ or a string representing a controller's action.
Common methods shared by Style/TrailingCommaInArguments and Style/TrailingCommaInLiteral
Configures the encoding, verbosity, schema search path, and time zone of the connection.
Creates a class name from a plural table name like Rails does for table names to models.
Declares an attribute reader and writer backed by an internally-named instance variable.
Filter out Minitest backtrace while allowing backtrace from other libraries to be shown.
For example, you might want to set some session properties before sending a GET request.
Given an attributes hash, +instantiate+ returns a new instance of the appropriate class.
If a block is given, the new session will be yielded to the block before being returned.
If a block is passed, that block should cause the specified number of emails to be sent.
If a signed cookie was tampered with by the user (or a 3rd party), nil will be returned.
If the +uppercase_first_letter+ parameter is set to false, then produces lowerCamelCase.
In offense message, we want to show the assignment LHS rather than the entire assignment
Nested attributes allow you to save attributes on associated records through the parent.
Note: Joining, eager loading and preloading of these associations is not fully possible.
On shared hosts, Apache sometimes doesn't pass authentication headers to FCGI instances.
One should restart the entire transaction if an ActiveRecord::StatementInvalid occurred.
Overrides the default inspect method with a human readable one, e.g., "Mon, 21 Feb 2005"
Pattern has to be a valid glob string, and it allows you to use the following variables:
Please give a name which does not contain a namespace starting with numeric characters."
Prepare callbacks are run before each request, and cleanup callbacks after each request.
Removes the timestamp columns (+created_at+ and +updated_at+) from the table definition.
Returns an array of AssociationReflection objects for all the associations in the class.
Returns true if there is a foreign key present on the owner which references the target.
Returns true when the parent of what looks like an access modifier is a Class or Module.
SQL error in sort clause if :include is not included due to Unknown column 'comments.id'
Should succeed as validates_uniqueness_of only applies to UniqueReply and its subclasses
Some common code shared between FavorUnlessOverNegatedIf and FavorUntilOverNegatedWhile.
Streaming may be considered to be overkill for lightweight actions like +new+ or +edit+.
Subject can be set in your I18n file at config/locales/en.yml with the following lookup:
The 'value_of_e' field is defined as 'DECIMAL' with precision/scale explicitly left out.
The corresponding relative version, 'sqlite3:foo', is handled elsewhere, as an "opaque".
The following example demonstrates an extension which can be used with or without Rails.
The human way of thinking about adding stuff to the beginning of a list is with prepend.
The line below is required because mount sometimes fails when a resource route is added.
The list of addressable types to load is determined on the back of the addresses loaded.
The method also contains logic that handles the type of object passed in as the partial.
The result of calling `write` when this is `false` is determined by `ignore_disconnect`.
The value is returned with the same data type of the column, or +nil+ if there's no row.
There are multiple cache store implementations, each having its own additional features.
There is a special syntactic shortcut to generate migrations that add fields to a table.
These allow you to register classes that are called during the mail delivery life cycle.
These helper methods extend Action View making them callable within your template files.
These tests do not attempt to determine the semantic correctness of the returned values.
This class computes Jaro distance, which is a measure of similarity between two strings.
This is used to maintain the correlation between the form data and its associated model.
This is useful for creating cookies with values that the user is not supposed to change.
This makes fields_for suitable for specifying additional model objects in the same form.
This means that from the perspective of your handler, the entire pipeline is just UTF-8.
This one allows you to keep files with different formats in separate subdirectories, eg.
This simulates the fact that instance variables are reset every time a view is rendered.
This will use +javascript_path+ internally, so most of their behaviors will be the same.
This will use +stylesheet_path+ internally, so most of their behaviors will be the same.
To ensure consistent data, the environment deletes the fixtures before running the load.
To prevent this, the helper generates an auxiliary hidden field before every file field.
Trigger a built-in NameError exception including the ill-formed constant in the message.
We are only testing that there are no errors because it's too hard to test serializable.
Weak ETags are considered to be semantically equivalent but not byte-for-byte identical.
When +method_missing+ is called we check to see if there is a matching attribute method.
When using this method, you list the cache dependency as the name of the cache, like so:
Would only create the +after_create+ and +before_create+ callback methods in your class.
You can also test your JSON API easily by setting what the request should be encoded as:
You can manually reset a cycle by calling reset_cycle and passing the name of the cycle.
You create background jobs and place them on multiple work queues to be processed later.
all cops were disabled, then 2 were enabled again, so we should get 2 offenses reported.
assert_redirected_to top_level_url('foo') would pass because of exact match early return
but we can successfully create a record so long as we don't reference the removed column
module Foo extend ActiveSupport::Concern included do def self.method_injected_by_foo ...
reload rescue ActiveRecord::RecordNotFound If the record is gone there is nothing to do.
skip_bundle is only about running bundle install, ensure the Gemfile is still generated.
validates_acceptance_of: generate_message(attr_name, :accepted, message: custom_message)
we pass in the new_xml to the helper so it doesn't call anything on the original builder
* Otherwise, if the argument responds to +to_ary+ it is invoked, and its result returned.
+try+ returns +nil+ when called on +nil+ regardless of whether it responds to the method:
:nodoc: Establishes a connection to the database that's used by all Active Record objects
A change to any of them could affect the cop output so we include them in the cache hash.
A connection pool synchronizes thread access to a limited number of database connections.
AbstractAdapter and related classes form the abstraction layer which makes this possible.
ActiveRecord::Scoping::ScopeRegistry.set_value_for(:current_scope, Board, some_new_scope)
Adds +message+ to the error messages and used validator type to +details+ on +attribute+.
After performing its main purpose (creating a new post), it initiates a redirect instead.
By default column length +len+ equals 72 characters and indent +indent+ equal two spaces.
By default this is guessed to be the name of this class in lower-case and "_id" suffixed.
Contrast this to the following situation where the +before_destroy+ method is overridden:
Don't autocorrect where(...).first, because it can return different results from find_by.
Each method called on the block variable must take an options hash as its final argument.
Ensure, we can set connection params using the example of Generic Query Optimizer (geqo).
For every request, the router determines the value of the +controller+ and +action+ keys.
For example, you've probably had the chance to write code like this in one of your views:
FormattedTimeHelper can now be included in a controller, using the +helper+ class method:
Get the columns for a table as a hash, key is the column name value is the column object.
Given a set of columns and an ORDER BY clause, returns the columns for a SELECT DISTINCT.
If B descends from A through some arbitrarily deep hierarchy, B.base_class will return A.
If not and you are going to need the records anyway this method will take one less query.
If the given limit is greater than or equal to the string length, returns a copy of self.
If the latter is specified, the Product class will look for "product_id" instead of "id".
In addition, default connection parameters of libpq can be set per environment variables.
In the meantime that first process will go ahead and will write into cache the new value.
Included in the Action Pack is the Action View, which enables rendering of ERB templates.
It becomes especially helpful when navigating through associations that may return +nil+.
MacroReflection class has info for AggregateReflection and AssociationReflection classes.
Note that this method removes records from the database ignoring the +:dependent+ option.
Note that this schema.rb definition is the authoritative source for your database schema.
Number of decimals, behind the separator (the number 1 with a precision of 2 gives: 1.00)
On initialization, the ActiveModel accepts the instance name that will receive the calls:
Passing a block is required when `force` is true so this always results in a cache write.
Person.where(name: 'Spartacus', rating: 4) returns a chainable list (which can be empty).
Pushes the given Rack middleware and its arguments to the bottom of the middleware stack.
Raised when a record cannot be inserted because it would violate a uniqueness constraint.
Raised when a validation cannot be corrected by end users and are considered exceptional.
Replaces special characters in a string so that it may be used as part of a 'pretty' URL.
Returns +true+ if +attribute+ is an attribute method and table exists, +false+ otherwise.
Returns DateTime with local offset for given year if format is local else offset is zero.
Returns a new DateTime representing the time a number of seconds since the instance time.
Returns true if another +Parameters+ object contains the same content and permitted flag.
Returns true if running with --auto-correct would remove the braces of the last argument.
Ruby 2.2.2 will have type lvar if it is calling its own method without a specified "self"
See also http://tenderlovemaking.com/2011/06/28/til-its-ok-to-return-nil-from-to_ary.html
Similarly, if the parent class changes the value, the value of subclasses is not changed.
The default regexp for an acceptable copyright notice can be found in config/default.yml.
The digestor can be bypassed by passing skip_digest: true as an option to the cache call:
The hash form works much like the array form, except only equality and range is possible.
The keys of the hash which is the value for +:posts_attributes+ are ignored in this case.
The method reference is the preferred approach to variable layouts and is used like this:
The regular _puts_ and _print_ methods do not operate as expected in an eRuby code block.
This cop checks for identical lines at the end of each branch of a conditional statement.
This cop checks whether some constant value isn't a mutable literal (e.g. array or hash).
This method depends on the fact that we have guarded against implicit and empty literals.
This table is to verify if the :limit option is being ignored for text and binary columns
To configure the adapter's thread pool, instantiate the adapter and pass your own config:
To define a reversible migration, define the +change+ method in your migration like this:
To prevent that block from being called anymore, just unsubscribe passing that reference:
To prevent this the helper generates an auxiliary hidden field before the very check box.
Unlike other helpers, +select+ expects this option to be in the +html_options+ parameter.
UrlFor also allows one to access methods that have been auto-generated from named routes.
Uses the Active Record object's own table_name, or pre/suffix from the options passed in.
We don't want Faye to start the EM reactor in tests because it makes testing much harder.
We only support indirectly modifying through associations which have a belongs_to source.
When a collection is used you might want to know the index of each object into the array.
Yes: The Number of retries can be configured globally, for each instance or on the queue.
You can also insert your own messages and benchmarks by using the +say_with_time+ method:
You can also supply a block to hook_for to customize how the hook is going to be invoked.
belongs_to polymorphic overrides this to look at the polymorphic_type field on the owner.
but we keep this around for libraries that directly require it knowing they want cattr_*.
class Person include ActiveModel::Validations include ActiveModel::Validations::Callbacks
class Person validates_presence_of :name, :email validates_length_of :name, in: 5..30 end
def test_emails_again assert_enqueued_emails 1 do ContactMailer.welcome.deliver_later end
module Foo def self.included(base) base.class_eval do def self.method_injected_by_foo ...
periodically every: 3.minutes do transmit action: :update_count, count: current_count end
rake("db:migrate") rake("db:migrate", env: "production") rake("gems:install", sudo: true)
sudo su postgres -c "pg_ctl restart -D /opt/local/var/db/postgresql91/defaultdb/ -m fast"
uuid_from_hash always generates the same UUID for a given name and namespace combination.
* +database_configuration+: configuration of your databases (as in +config/database.yml+).
* +public+: By default, HTTP responses are private, cached only on the user's web browser.
:nodoc: Establishes a connection to the database that's used by all Active Record objects.
ActiveRecord::Base.establish_connection( adapter:  "sqlite3", database: "path/to/dbfile" )
Add new mime types for use in respond_to blocks: Mime::Type.register "text/richtext", :rtf
Adding, removing, and changing attributes and their type is done directly in the database.
Allows you to make aliases for attributes, which includes getter, setter, and a predicate.
An empty branch can be an `if` without an `else`, or a branch that contains only comments.
And of course you can just create a bare object and specify the attributes after the fact:
Any thread holding this lock will be compiling the template needed by the threads waiting.
By default after callbacks are executed no matter if callback chain was terminated or not.
Creates a record with values matching those of the instance attributes and returns its id.
Creates an anchor element of the given +name+ using a URL created by the set of +options+.
Creates an object (or multiple objects) and saves it to the database, if validations pass.
Declaring an identification means that an attr_accessor is automatically set for that key.
Defines a callback that will get called right after the job's perform method has finished.
Defines a callback that will get called right before the job's perform method is executed.
Enable warnings if this file has not been loaded before and warnings_on_first_load is set.
Handle Cross-Origin Resource Sharing (CORS) in order to accept cross-origin AJAX requests.
If a block is passed, that block should cause the specified number of jobs to be enqueued.
If a layout is not explicitly mentioned then look for a layout with the controller's name.
If the argument is a string, it is interpreted to mean the name of the timezone to locate.
If there are more blocks in the chain, they will be found by subsequent calls to on_block.
If we're here then we haven't found among non-private methods but found among all methods.
If you want to pass non-primitive types, you will have to handle that in your application.
In this respect they are analogs of ActionDispatch::Callback's before and after callbacks.
Initializes +attribute+ to zero if +nil+ and adds the value passed as +by+ (default is 1).
Instances of this type are typically created and returned by methods in database adapters.
It can be helpful to provide these in a migration's +change+ method so it can be reverted.
Look up the timezone based on the identifier (unless we've been passed a TZInfo::Timezone)
Make sure to specify the correct server location in each of your environment config files:
Note that if you use +permit+ in a key that points to a hash, it won't allow all the hash.
Other preferred methods appearing in the default config (e.g., map over collect) are kept.
Otherwise, if the String is valid in the encoding, encode immediately to default_internal.
Passing a hash containing +:from+ and +:to+ will make this change reversible in migration:
Payloads consist of a hash whose contents are arbitrary and generally depend on the event.
Perform unauthenticated request to retrieve digest parameters to use on subsequent request
Records the association that is being destroyed and destroying this record in the process.
Removes the index on +branch_id+ in the +accounts+ table if exactly one such index exists.
Respond to also allows you to specify a common block for different formats by using +any+:
Returns +true+ if the constant was not previously marked for unloading, +false+ otherwise.
Returns `-1`, `0` or `+1` if this offense is less than, equal to, or greater than `other`.
Run the provided block and detect the new constants that were loaded during its execution.
Set the memcache expire a few minutes in the future to support race condition ttls on read
Since this key is generated only once during the request, it speeds up all cache accesses.
So it's possible that changing something outside of that call will still expire the cache.
Sometimes you do not want to subscribe to an event for the entire life of the application.
Specifying foreign keys in fixtures can be very fragile, not to mention difficult to read.
Take the text and format it, indented two spaces for each line, and wrapped at 72 columns:
That way, the middleware will ignore those IP addresses, and return the one that you want.
The PostgreSQL adapter works with the native C (https://bitbucket.org/ged/ruby-pg) driver.
The Pragma and Cache-Control headers declare how the file may be cached by intermediaries.
The default Multibyte Chars proxy has more features than the normal string implementation.
The example above generates "http://assets1.example.com" and "http://assets2.example.com".
The face attribute must be in the object and it cannot be blank or marked for destruction.
The following methods for retrieval and query of a single associated object will be added:
The underlying per-thread class variable is set to +nil+, if it is not previously defined.
There are two ways to use the fixtures, but first let's take a look at a sample unit test:
This abstracts the setup and rendering into a separate classes for partials and templates.
This allows us to more easily catch INSERT being broken, but SELECT actually working fine.
This cop checks for the correct use of Date methods, such as Date.today, Date.current etc.
This cop makes sure that certain operator methods have their sole parameter named `other`.
This determines if the json object should contain full messages or not (false by default).
This ensures that your caches will automatically expire when you change the template file.
This heredoc is unsafe to edit around because it ends on the same line as the node itself.
This is really useful if you need to validate a self-signed and/or a wildcard certificate.
This is useful since IDs are generated by Markdown from headers and thus edits alter them.
This middleware calculates the IP address of the remote client that is making the request.
This module only intends to provide guidance in case you want all features out of the box.
To require confirmation, make sure to add a presence check for the confirmation attribute:
Updates an object (or multiple objects) and saves it to the database, if validations pass.
We also want to avoid double reporting of offenses checked by the MultilineBlockChain cop.
We can't silence plain ruby Logger cause with thread safety but at least we don't break it
When in transactional tests mode, this will cause Active Record to create a new savepoint.
Which will render a +multipart/alternative+ email with +text/plain+ and +text/html+ parts.
You can consume those events and the information they provide by registering a subscriber.
You could also turn it on per controller by setting the format array to a non-empty array:
def test_emails_again assert_no_emails do No emails should be sent from this block end end
perform_enqueued_jobs do HelloJob.perform_later('matthew') assert_performed_jobs 1 end end
route prepends two spaces onto the front of the string that is passed, this corrects that.
table_joins is an array of arel joins which might conflict with the aliases we assign here
that's the correct behavior since we don't want to break the `class_attribute` inheritance
we only want to indent relative to the receiver when the method called looks like a setter
without dup, additional (and possibly unwanted) values will be present in the options (eg.
+safe_constantize+ tries to find a declared constant with the name specified in the string.
1 query to delete the existing reader (michael) 1 query to associate the new reader (david)
@see http://rubydoc.info/github/whitequark/parser/Parser/Source/Range Parser::Source::Range
A hook which allows other frameworks to log what happened during controller process action.
Accessing the attribute normally would typecast the string to 0, which isn't what you want.
ActiveSupport::Cache::MemCacheStore.new("localhost", "server-downstairs.localnetwork:8229")
Additionally validator classes may be in another namespace and still used within any class.
Although DJ can have many storage backends, one of the most used is based on Active Record.
An internal class for correcting parallel assignment guarded by if, unless, while, or until
And it will be wrapped into a nested hash with the key name matching the controller's name.
At rendering time, the content page is computed and then inserted in the layout, like this:
Avoid column definitions in create table statements like: `title` varchar(255) DEFAULT NULL
Be aware that these columns use a string keyed hash and do not allow access using a symbol.
But they have to be loaded (as in a real environment) to make the second generator run fail
Check whether the given class names are already taken by user application or Ruby on Rails.
Checks that block braces have or don't have surrounding space inside them on configuration.
Dummy implementation of method in ConfigurableEnforcedStyle that is called from StringHelp.
Eager includes of has many and habtm associations aren't necessarily sorted in the same way
Enables the use of time calculations and declarations, like 45.minutes + 2.hours + 4.years.
Explicitly disabling HSTS clears the existing setting from browsers by setting expiry to 0.
For example, Object.const_get('::String') raises NameError and so does qualified_const_get.
For example, webrat developers might want to have webrat available on controller generator.
Given that the parameters starts with `_`, the finder needs to use the same parameter name.
Here we check if the keys, separators, and values of a multi-line hash literal are aligned.
If a block is passed, that block should cause the specified number of jobs to be performed.
If a collection is given, the layout will be rendered once for each item in the collection.
If any of them fail ActiveRecord::RecordInvalid gets raised, and the record won't be saved.
If fibers are defined, we return a streaming body that renders the template piece by piece.
If no +category_ids+ are selected then we can safely assume this field will not be updated.
If the passed value is +true+, the methods are prefixed/suffixed with the name of the enum.
If you perform a DDL operation, then any created savepoints will be automatically released.
It's the same as Thor default except that the Generator at the end of the class is removed.
MySQL returns "SUM(DISTINCT(credit_limit))" as the column name unless an alias is provided.
N/A: The adapter does not run in a separate process, and therefore doesn't support retries.
N/A: This adapter does not run in a separate process, and therefore timeout is unsupported.
Now it's possible to access attributes from the database through the value objects instead.
Often this can be simplified by passing just the name of the model object to +fields_for+ -
Or equivalently, if +TenderloveMigration+ is defined as in the documentation for Migration:
Order by added as otherwise Oracle tests were failing because of different order of results
Raises: - ActiveRecord::ConnectionTimeoutError no connection can be obtained from the pool.
Requires and returns a hash of all of the channel class constants, which are keyed by name.
Returns a hash of the given methods with their names as keys and returned values as values.
Returns a new hash with all keys converted to symbols, as long as they respond to +to_sym+.
Returns a renderer instance (inherited from ActionController::Renderer) for the controller.
Returns all the parents of this module according to its name, ordered from nested outwards.
Returns an array of column names as strings if it's not an abstract class and table exists.
Returns the class of the error that will be raised when there is an error in decoding JSON.
Sets the default migration template that is being used for the generation of the migration.
Setting the value object to +nil+ has the effect of writing +nil+ to all mapped attributes.
Specifies a humanized form of a string by a regular expression rule or by a string mapping.
The array form is to be used when the condition input is tainted and requires sanitization.
The connection is long-lived, so it needs its own set of tags for its independent duration.
The default way Rails renders views is by first rendering the template and then the layout.
The inclusion of the ETag prevents a replay request for an updated version of the resource.
The same as +content_for+ but when used with streaming flushes straight back to the layout.
This allows control over how values are converted to and from SQL when assigned to a model.
This ensures the connection monitor state is reset after a successful websocket connection.
This is because MySQL automatically releases all savepoints upon executing a DDL operation.
This makes it hard to find the signal amongst the backtrace noise, and adds debugging time.
This method constructs a single SQL UPDATE statement and sends it straight to the database.
This method will _always_ remove record from the database ignoring the +:dependent+ option.
This way the wildcard for `app/views/recordings/events` would be `recordings/events/*` etc.
To achieve this, the validation adds accessors to the model for the confirmation attribute.
Waits on the queue up to +timeout+ seconds, then removes and returns the head of the queue.
You can pass an array of attributes hashes, this will return an array with the new objects.
You may also pass a different UUID generation function from +uuid-ossp+ or another library.
You should avoid modifying the association content, before autosave callbacks are executed.
a class emitter method may be defined inside `def self.included`, `def self.extended`, etc.
aliased to avoid conflicts with an audio_url named route Computes the path to a font asset.
class RootUrl include ActionController::UrlFor include Rails.application.routes.url_helpers
creates seven different routes in your application, all mapping to the +Photos+ controller:
make sure exceptions are thrown when establish_connection is called with an anonymous class
table name is 29 chars, the standard sequence name will be 33 chars and should be shortened
(If you're not concerned about IP spoofing you can turn the +ip_spoofing_check+ option off.)
* +permit_all_parameters+ - If it's +true+, all the parameters will be permitted by default.
* `subdomains`: Set to `true` to tell the browser to apply these settings to all subdomains.
+camelize+ will also convert '/' to '::' which is useful for converting paths to namespaces.
:controller maps to your controller name :action     maps to an action with your controllers
:nodoc: First try looking for a sequence with a dependency on the given table's primary key.
A heredoc that's the last item in a literal or parameter list can not have a trailing comma.
Action Mailer allows you to send email from your application using a mailer model and views.
All you need to do is pass the helper as the first element in array with attributes for url:
Alternatively, you can also use the STEP option if you wish to rollback last few migrations.
Assets are stored under files, and copied to output/files as part of the generation process.
Collection class for all the connections that have been established on this specific server.
Constraints can include the 'ignorecase' and 'extended syntax' regular expression modifiers:
Dates are taken as their timestamp at the beginning of the day in the application time zone.
Don't create associations that have the same name as instance methods of ActiveRecord::Base.
Encapsulates the interaction with the view flow so it returns the correct buffer on +yield+.
Filters are used to modify lines of data, while silencers are used to remove lines entirely.
Handles caching of configurations and association of inspected ruby files to configurations.
Helper module to provide common methods to classes needed for the ConditionalAssignment Cop.
Holds all the meta-data about an aggregation as it was specified in the Active Record class.
Holds all the meta-data about an association as it was specified in the Active Record class.
If +method_name+ is not +nil+, the mailer will be initialized according to the named method.
If +selected+ is specified, the matching "last" or element will get the selected option-tag.
If :host options is set, it overwrites global +config.action_controller.asset_host+ setting.
If a block is passed, that block should cause the specified number of emails to be enqueued.
If a name was not explicitly given, we check if it is valid and return nil in case it isn't.
If the +source+ filename has no extension, .css will be appended (except for explicit URIs).
If the attribute is an association, records that are marked for destruction are not counted.
If the database column does not exist, the +terms_of_service+ attribute is entirely virtual.
If the object cannot be converted to YAML using +to_yaml+, +inspect+ will be called instead.
If the subject has interpolations, you can pass them through the +interpolations+ parameter.
If we deleted one of a person's tasks, we would probably not want the project to be deleted.
If you'd prefer to use numeric prefixes, you can turn timestamped migrations off by setting:
Invoke a generator based on the value supplied by the user to the given option named "name".
It's also a good idea to add indexes to each of those columns to speed up the joins process.
It's implemented as a cop in that it inherits from the Cop base class and calls add_offense.
List all validators that are being used to validate the model using +validates_with+ method.
Make sure that each fixture gets its own rendering context so that fixtures are independent.
Most commonly, the streamed broadcast is sent straight to the subscriber on the client-side.
Must return the MySQL error number from the exception, if the exception has an error number.
Normalization of DEVANAGARI LETTER QA breaks when composition exclusion isn't used correctly
Number.transaction do Number.create(i: 0) begin This will raise a unique constraint error...
Pass `coder: ActiveSupport::JSON` to decode messages as JSON before passing to the callback.
Receives an array of mimes and return the first user sent mime that matches the order array.
Repeated calls to the cache for the same key will hit the in-memory cache for faster access.
Replaces the existing method definition, if there is one, with the passed block as its body.
Returns +true+ if +other+ is also a Duration instance, which has the same parts as this one.
Returns an empty string if the beginning of the range is greater than the end of the string.
Returns the +signed+ or +encrypted+ jar, preferring +encrypted+ if +secret_key_base+ is set.
Returns true if a method for the action is available and can be dispatched, false otherwise.
Returns true if its required to reload the connection between requests for development mode.
Sanity check for required instance variables so we can give an understandable error message.
Since the +notice+ and +alert+ keys are a common idiom, convenience accessors are available:
Since we have no idea, if we are concerned about IP spoofing we need to give up and explode.
So descendants of MyApp::Business::Account would appear as MyApp::Business::AccountSubclass.
So the values are scoped within the Thread.current space under the class name of the module.
Storing the ha1 hash: MD5(username:realm:password), is better than storing a plain password.
Subclass FormBuilder and override or define some more helpers, then use your custom builder.
TODO: test against the generated SQL since testing locking behavior itself is so cumbersome.
Test for 30 significant digits (beyond the 16 of float), 10 of them after the decimal place.
The +message+ parameter allows you to specify a custom error message for assertion failures.
The above code will load all the comments and all of their associated authors and gravatars.
The keys must be the fixture names, that coincide with the short paths to the fixture files.
The list of form-data media types can be modified through the +FORM_DATA_MEDIA_TYPES+ array.
The registry is stored as a thread local, which is accessed through +ScopeRegistry.current+.
The subscriber dispatches notifications to a registered object based on its given namespace.
The type of an attribute is given the opportunity to change how dirty tracking is performed.
The user can specify the encoding using Ruby-style encoding comments in any template engine.
This allows a "loose" upgrade, which, being less strict, prevents some classes of deadlocks.
This can be overwritten to customize the default generated string representation if desired.
This middleware is commonly initialized to serve assets from a server's `public/` directory.
This module provides functionality for checking if names match the configured EnforcedStyle.
To get around this you can call the define_model_callbacks method as many times as you need.
To prevent this the helper generates an auxiliary hidden field before every multiple select.
Which provides you with the full standard validation stack that you know from Active Record:
Wrap the given buffer in the StreamingBuffer and pass it to the underlying template handler.
You can disable forgery protection on controller by skipping the verification before_action:
You can modify the HTML attributes of the script tag by passing a hash as the last argument.
You don't need to use these tags for regular forms as they generate their own hidden fields.
def log_status puts 'going to call the block...' yield puts 'block successfully called.' end
fill in timestamp columns if they aren't specified and the model is set to record_timestamps
included do has_many :events before_create :track_creation after_destroy :track_deletion end
rails("db:migrate") rails("db:migrate", env: "production") rails("gems:install", sudo: true)
truncate("And they found that many people were sleeping better.", length: 25, omission: '...
without using SQL directly, so your applications can more easily support multiple databases.
:nodoc: Provides methods to generate HTML tags programmatically when you can't use a Builder.
A class option is created when this method is invoked and you can set a hash to customize it.
ALL isn't a real MIME type, so we don't register it for lookup with the other concrete types.
Accepts a container (hash, array, enumerable, your type) and returns a string of option tags.
ActionCable.server.broadcast "comments_for_45", author: 'DHH', content: 'Rails is just swell'
Add instrumentations hooks at the bottom, to ensure they instrument all the methods properly.
After a request, the response in the test case doesn't have the defaults merged on top again.
All the methods on the Chars proxy which normally return a string will return a Chars object.
Any additional arguments will be passed to the corresponding cache store class's constructor:
Any method with a block will be treated as an XML markup tag with nested markup in the block.
Anything you place in the flash will be exposed to the very next action and then cleared out.
As we are using Action View's +image_tag+ method, you can pass in any other options you want:
Both underscores and dashes have to be interpreted as if they were originally sent as dashes.
But by default it is invoked with the same name as the resource generator, which is singular.
Create a select tag and a series of contained option tags for the provided object and method.
Eager loading is a way to find objects of a certain class and a number of named associations.
Either way, there is no way for us to determine which header is the right one after the fact.
If any of :controller, :action or :id is not found, don't pull any more keys from the recall.
If you have images as application resources this method may conflict with their named routes.
In the example above +render+ is the name of the event, and the rest is called the _payload_.
Instead, you should simply use +articles_path+, like you would do with your main application.
Interestingly, the exact same view code in the previous example can be used to edit a person.
Last argument can specify options: - :direction (default is :up) - :revert (default is false)
MigrationProxy is used to defer loading of the actual migration classes until they are needed
Must only be called by the thread that called start_exclusive (and currently holds the lock).
Normally, when you namespace your controllers, you also need to namespace the related routes.
Note that it also means that associations marked for destruction won't be destroyed directly.
Of course, the most common way of specifying a layout is still just as a plain template name:
Prepare class invocation to search on Rails namespace if a previous added hook is being used.
Provides integration between your object and the Rails internationalization (i18n) framework.
Reason is the ActiveRecord::Rollback exception in the nested block does not issue a ROLLBACK.
Removes +records+ from this association calling +before_remove+ and +after_remove+ callbacks.
Removes all records from the association without calling callbacks on the associated records.
Returns a link tag that browsers and feed readers can use to auto-detect an RSS or Atom feed.
Returns true if the current time is within Daylight Savings Time for the specified time zone.
See: http://google.com/, http://gmail.com/, https://maps.google.com/, http://plus.google.com/
Set the paths from which Rails will automatically load source files, and the load_once paths.
So 29s gets rounded down to 0m, 30s gets rounded up to 1m, and 1m29s gets rounded down to 1m.
So, the target may be non-empty and still lack children waiting to be read from the database.
Statement cache is used to cache a single statement in order to avoid creating the AST again.
The +message+ parameter allows you to specify a custom error message to display upon failure.
The error message is different depending on whether a single id or multiple ids are provided.
The final caveat is that your actions are executed in a separate thread than the main thread.
The order in which jobs are processed can be configured differently depending on the adapter.
Then in the view any form using +form_for+ will be an instance of the specified form builder:
They get help with adding offenses for the faulty string nodes, and with filtering out nodes.
This allows the template engine to support additional mechanisms for specifying the encoding.
This allows you to have layouts with references that won't materialize before rendering time:
This class computes Jaro-Winkler distance, which adds prefix-matching bonus to Jaro distance.
This method differs from its non-bang version in that it passes through the attribute setter.
This method is abstract in the sense that +delete_records+ has to be provided by descendants.
This method is called automatically by filters, so you generally don't need to care about it.
This uses a server-appropriate method (such as X-Sendfile) via the Rack::Sendfile middleware.
To setup, you need just to configure the destination and set which generator is being tested:
Use this method in code that absolutely needs a certain constant to be defined at that point.
Usually the place to setup any streams you want this channel to be sending to the subscriber.
Validates that the value of the specified attribute is not in a particular enumerable object.
We store our author information in a yaml file and specify the keys in The post front matter.
You can specify callbacks using before_action and after_action for configuring your messages.
You can use the button tag as a regular submit tag but it isn't supported in legacy browsers.
Your CoffeeScript can then connect to the server without needing to specify the URL directly:
`ActiveRecord` compatibility: `ActiveRecord` will ignore the block that is passed to `count`.
class Current thread_mattr_accessor :user, instance_writer: false, instance_reader: false end
def person_params It's mandatory to specify the nested attributes that should be whitelisted.
post :change_avatar, avatar: fixture_file_upload('files/spongebob.png', 'image/png', :binary)
raise WrongEncodingError.new( problematic_string, expected_encoding )  :method: local_assigns
will use SQL LOWER function before comparison, unless it detects a case insensitive collation
+coder+ should be the result of previously encoding an Active Record model, using encode_with.
+from_table+ is the table with the key column, +to_table+ contains the referenced primary key.
A convenience method for returning a collection of TimeZone objects for time zones in the USA.
A migration file name can only contain underscores (_), lowercase characters, and numbers 0-9.
ActionDispatch::ParamsParser works for all the requests having any Content-Length (like POST).
And instantiate will find the existing constant rather than trying to require firm_on_the_fly.
As long as the indentation of this method is consistent with that of the last one, we're fine.
Because of how the rescue clauses come out of Parser, these are special and need to be tested.
For every WebSocket the Action Cable server accepts, a Connection object will be instantiated.
For example, SQLite does not understand dates, so this method will convert a Date to a String.
If +no_wait+ is set and the lock is not immediately available, returns +nil+ without yielding.
If found, the module is created and assigned to +into+'s constants with the name +const_name+.
If set, the zeros after the decimal separator will always be stripped (eg.: 1.200 will be 1.2)
If the class method does not have a method, then send the method call to the Railtie instance.
If the next id was calculated in advance (as in Oracle), it should be passed in as +id_value+.
If the silencer returns +true+ for a given line, it will be excluded from the clean backtrace.
If you do not provide a +block+, it will return an Enumerator for chaining with other methods:
In this case, make sure you return a String from your handler encoded in the default_internal.
Instantiates objects for all attribute classes that needs more than one constructor parameter.
It should look like an integer, or a comma-delimited list of integers, or an Arel SQL literal.
Keeps either the entire current flash or a specific flash entry available for the next action:
MessageEncryptor is a simple way to encrypt values which get stored somewhere you don't trust.
Nested classes are given table names prefixed by the singular form of the parent's table name.
Note that fields_for will automatically generate a hidden field to store the ID of the record.
Note that these methods do not strictly require +Post+ to be a subclass of ActiveRecord::Base.
Otherwise, in addition to the in-place modification the method returns +self+ for convenience.
Rails starts with the layout, and the template is rendered later, when its +yield+ is reached.
Raised when a record cannot be inserted or updated because a value too long for a column type.
Remove the constants that have been autoloaded, and those that have been marked for unloading.
Responsible for routing incoming commands that arrive on the connection to the proper channel.
Returns a Hash of name of the reflection as the key and an AssociationReflection as the value.
Returns a TimeZone instance with the given name, or +nil+ if no such TimeZone instance exists.
Returns a hash that maps filenames under +dir+ (recursively) to arrays with their annotations.
Returns a set of HTML select-tags (one for year, month, and day) pre-selected with the +date+.
Returns default aliases for the option name given doing a lookup in Rails::Generators.aliases.
Returns the result of an SQL statement that should only include a COUNT(*) in the SELECT part.
Returns whether or not the association should be validated as part of the parent's validation.
Returns whether or not this record will be destroyed as part of the parent's save transaction.
Second: Modifies the SELECT statement for the query so that only certain fields are retrieved:
See http://www.unicode.org/reports/tr15/tr15-29.html for more information about normalization.
See https://github.com/svenfuchs/rails-i18n/blob/master/rails/locale/en.yml for more examples.
Sends the initializers to the +initializer+ method defined in the Rails::Initializable module.
The +message+ parameter allows you to pass in an error message that is displayed upon failure.
The SQL standard only specifies what must not happen at a certain level, not what must happen.
The extra text that comes after the last token could be __END__ followed by some data to read.
The payload is a mechanism that allows instrumenters to pass extra information to subscribers.
They default to require clients to validate with the server before releasing cached responses.
This behaves in almost the same way as outlined previously, with a couple of small exceptions.
This cop is used to identify usages of `where.first` and change them to use `find_by` instead.
This ensures that the parent class's module can be changed independently of the child class's.
This formatter displays just a list of the files with offenses in them, separated by newlines.
This guarantees that your rules run before any of the rules that may already have been loaded.
This is especially useful if you want multiple workers dealing with the same processing queue.
This is the method which actually finds the layout using details in the lookup context object.
This method assumes an +ApplicationController+ exists, and it extends +ActionController::Base+
This method raises an ActiveRecord::ActiveRecordError  if the attribute is marked as readonly.
This method returns the maximum mtime of the files in +paths+, or +nil+ if the array is empty.
This method will raise an +IrreversibleMigration+ exception if it cannot invert the +command+.
This will render the layout for each user and yield to the block, passing the user, each time.
Used by ActionDispatch::Session::CookieStore to avoid the need to introduce new cookie stores.
We can improve upon the situation further by referencing both associations in the finder with:
When that callback is triggered, the object has a method by the name of the callback messaged.
You can also pass a custom timestamp column to fetch the timestamp of the last updated record.
You need to make sure yourself that your dom ids are valid, in case you overwrite this method.
You still could pass +:include+ and +:exclude+ to set the list of attributes you want to wrap.
You'll see that appear accepts a data parameter, which it then uses as part of its model call.
assert_emails 2 do ContactMailer.welcome.deliver_now ContactMailer.welcome.deliver_now end end
before_validation :do_stuff_before_validation after_validation  :do_stuff_after_validation end
class Article has_many :comments has_many :comment_tags, through: :comments, source: :tags end
def cannot_be_robot errors.add(:base, 'A person cannot be a robot') if person_is_robot end end
helpers1_pack was given as a second path, so pack1_helper should be included as the second one
scope shallow_path: "sekret" do resources :posts do resources :comments, shallow: true end end
validates_confirmation_of: generate_message(attr_name, :confirmation, message: custom_message)
whether this behavior is meaningful when excerpt_string is not to be appended is questionable.
+nil+ is returned when the name is not in CamelCase or the constant (or part of it) is unknown.
+user_provided_default+ Whether the default value should be cast using +cast+ or +deserialize+.
:nodoc: Define the abstract ivar on subclasses so that we don't get uninitialized ivar warnings
:nodoc: Use FixtureResolver in your tests to simulate the presence of files on the file system.
A case where WordArray's correction can be clobbered by AccessModifierIndentation's correction.
A common prefix is removed (useful for namespaced models like Music::Artist and Music::Record):
Converts the given keys to the value that the database adapter returns as a usable column name:
Doesn't use after_save as that would save associations added in after_create/after_update twice
Each address is either a host name, or a host-with-port string in the form of "host_name:port".
Each of these fixtures has two unique identifiers: one for the database and one for the humans.
For example, the following association would find all events that occur on the user's birthday:
For instance, in order to change the routes to allow for a dot character in the +id+ parameter:
For more details on creating custom types, see the documentation for ActiveRecord::Type::Value.
HEAD request should match `get /home` rather than the lower-precedence Rack app mounted at `/`.
Here's an example of a channel that allows subscribers to get all new comments on a given page:
If +sources+ is an array, a video tag with nested source tags for each source will be returned.
If no method can handle the action, then an AbstractController::ActionNotFound error is raised.
If the day is hidden, the day should be set to the 1st so all month and year choices are valid.
If you want to add conditions to your included models you'll have to explicitly reference them.
If your cache is on a shared infrastructure, you can define a namespace for your cache entries.
Ignored columns won't have attribute accessors defined, and won't be referenced in SQL queries.
In that case it is preferable to either use +check_box_tag+ or to use hashes instead of arrays.
Initializes +attribute+ to zero if +nil+ and subtracts the value passed as +by+ (default is 1).
It's usually too much work to keep it all synchronized -- something databases already excel at.
Override this method in your controller if you want to change paths prefixes for finding views.
Raised when a record cannot be inserted or updated because it references a non-existent record.
Returns a +ActiveRecord::ConnectionAdapters::NullColumn+ if the named attribute does not exist.
Returns a hash that maps filenames under +dirs+ (recursively) to arrays with their annotations.
Returns a string which represents the time in used time zone as DateTime defined by XML Schema:
Similarly if parent class changes the value then that would change the value of subclasses too.
So, at operator assignment node, we need to reference the variable before processing rhs nodes.
Strong params has an internal cache to avoid duplicated loops in the most common usage pattern.
The +extension+ argument allows you to pass a block into a has_and_belongs_to_many association.
The behavior is the same, it returns true if the collection based on the criteria is not empty.
The block receives two arguments, an instance of the current class and the class to be invoked.
The normal offset, i.e., the distance from the punctuation token where a space should be, is 1.
The type for the numeric depends on the width of the field, so we'll do something special here.
This allows you to specify that associated records should be deleted when the owner is deleted.
This class finds target files to inspect by scanning the directory tree and picking ruby files.
This cop checks whether the multiline assignments have a newline after the assignment operator.
This heredoc is safe to edit around because it ends on a line before the last line of the node.
This is a convenient way to check whether the variable is used in its entire variable lifetime.
This is called by providing and resuming back to the fiber, if that's the key it's waiting for.
This jar allows chaining with the signed jar as well, so you can set permanent, signed cookies.
This middleware will attempt to return the contents of a file's body from disk in the response.
This unique ID is useful for tracing a request from end-to-end as part of logging or debugging.
We expect one of EOFError or Errno::ECONNRESET in normal operation (when the client goes away).
We have some records loaded from the database (persisted) and some that are in-memory (memory).
We ignore any extra parameters in the request_uri if the submitted url doesn't have any either.
When our views change, they should bubble up into HTTP cache freshness and bust browser caches.
When streaming, the HTTP headers are sent to the client right before it renders the first line.
When using strings to specify conditions, you can use any operator available from the database.
When you rescue an exception from your job you can ask Active Job to retry performing your job.
You can also pass an object that responds to +maximum+, such as a collection of active records.
You can set custom coder to encode/decode your serialized attributes to/from different formats.
You can use this accessor to configure your own proxy class so you can support other encodings.
You may define a wide range of unit quantifiers, even fractional ones (centi, deci, mili, etc).
You will need ordered fixtures when you have foreign key constraints on keys in the same table.
aliased to avoid conflicts with an font_path named route Computes the full URL to a font asset.
def down execute "ALTER TABLE `pages_linked_pages` DROP INDEX `page_id_linked_page_id`" end end
form_tag('http://far.away.com/form', authenticity_token: false) form without authenticity token
reload schema_migrations to be sure it wasn't changed by another process before we got the lock
select_datetime(my_date_time, date_separator: '/', time_separator: '', datetime_separator: ',')
* +seed_loader+: an object which will load seeds, it needs to respond to the +load_seed+ method.
* The TellerController also uses the "information" layout, because the parent explicitly set it.
+Rails.application.secrets.namespace+ returns +my_app_production+ in the production environment.
@example `bar` definition actually produces methods in the same scope as the outer `foo` method.
ActiveSupport::Notifications.instrument('render', extra: :information) do render text: 'Foo' end
Adding a name to this array will cause it to be unloaded the next time Dependencies are cleared.
All Active Record models use this handler to determine the connection pool that they should use.
Be careful with this method since it could affect other processes if shared cache is being used.
Because the generated param begins with the record's +id+, it is suitable for passing to +find+.
Depending on the number of associations involved there can be arbitrarily many SQL queries made.
Entity identity is determined by object or relational unique identifiers (such as primary keys).
Execute the block setting the given values and restoring old values after the block is executed.
For example, if you're posting to +UsersController+, your new +params+ hash will look like this:
For information about how to change the default Multibyte behavior see ActiveSupport::Multibyte.
Force the request to this particular controller or specified actions to be under HTTPS protocol.
Give up: we couldn't compute the klass type so we won't be able to find any associations either.
If +try+ is called without arguments it yields the receiver to a given block unless it is +nil+:
If set to a string, the string will be used as the option's content and the value will be empty.
If these cops try to autocorrect the same file at the same time, bad things are liable to happen
If your database supports setting the isolation level for a transaction, you can set it like so:
If your railtie has Rake tasks, you can tell Rails to load them through the method +rake_tasks+:
In addition to saving, it also destroys any associated records that were marked for destruction.
In case the layout continues yielding, we need to resume the fiber until all yields are handled.
It will use the given +user_content_type+, or multipart if the mail message has any attachments.
Marks the entire flash or a single flash entry to be discarded by the end of the current action:
NFKC is considered the best normalization form for passing strings to databases and validations.
One by one, each engine sets up its load paths, routes and runs its config/initializers/* files.
Reload the class Owner, simulating auto-reloading of model classes in a development environment.
Returns the default value for the option name given doing a lookup in Rails::Generators.options.
Runs all the specified validations and returns +true+ if no errors were added otherwise +false+.
Save the new record state and id of a record so it can be restored later if a transaction fails.
See http://dev.mysql.com/doc/refman/5.7/en/savepoint.html for more information about savepoints.
See http://www.postgresql.org/docs/current/static/libpq-connect.html for the list of parameters.
See the classes under the ActiveSupport::Cache module, e.g. ActiveSupport::Cache::MemCacheStore.
Sets the +etag+ and/or +last_modified+ on the response and checks it against the client request.
Sets the model class for a fixture when the class name cannot be inferred from the fixture name.
TODO: this is no longer required but we keep it for the moment to support older config.ru files.
That could be weird, but if we parse P1Y1M0.5D and output it to ISO 8601, we'll get P1Y1MT12.0H.
The Template::Error exception is raised when the compilation or rendering of the template fails.
The following checks can also be supplied with a proc or a symbol which corresponds to a method:
The log subscriber dispatches notifications to a registered object based on its given namespace.
The only exception in ActiveModel for ActiveRecord is the use of self.build instead of self.new.
The option currently held by the object will be selected, provided that the object is available.
These options will be tagged onto the HTML as an HTML element attribute as in the example shown.
This class stores the +:current_scope+ and +:ignore_default_scope+ values for different classes.
This cop checks for implicit string concatenation of string literals which are on the same line.
This cop checks for parentheses in the definition of a method, that does not take any arguments.
This cop checks whether the multiline do end blocks have a newline after the start of the block.
This cop looks for delegations, that could have been created automatically with delegate method.
This functionality is enabled in +config/initializers/wrap_parameters.rb+ and can be customized.
This is useful for when you need to call a proprietary method such as PostgreSQL's lo_* methods.
This method returns a Response object, which one can use to inspect the details of the response.
This prevents the user from tampering with the session but also allows them to see its contents.
This problem is not possible to reproduce now, but we want to avoid it in case it's still there.
This will ensure that user's sensitive information will be transferred safely over the internet.
This works by using a type column in addition to a foreign key to specify the associated record.
Useful for situations where you don't want other processes or threads to see half-written files.
When defining an around callback remember to yield to the block, otherwise it won't be executed:
When the given key starts with a period, it will be scoped by the current controller and action.
add info on sort order for columns (only desc order is explicitly specified, asc is the default)
def test_jobs_again assert_no_enqueued_jobs do No job should be enqueued from this block end end
scope shallow_prefix: "sekret" do resources :posts do resources :comments, shallow: true end end
secure processing of java xml http://www.ibm.com/developerworks/xml/library/x-tipcfsx/index.html
shows count of topics and loops after loading the query should not trigger extra queries either.
A map of the cookies returned by the last response, and which will be sent with the next request.
An +attributes+ hash must be defined and should contain any attributes you need to be serialized.
Broadcasting is how other parts of your application can send messages to a channel's subscribers.
Call configure to load the settings from Rails.application.config.generators to Rails::Generators
Calling +write+ or +close+ on the response stream will cause the response object to be committed.
Everything up to the end of the line (or closing ERB comment tag) is considered to be their text.
Executes +sql+ statement in the context of this connection using +binds+ as the bind substitutes.
For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html
For instance, an HTTP controller with a template matching the action name is considered to exist.
HTML wants to know the encoding of the content you're giving them, so we need to send that along.
However, currently it's unclear whether there's a way to emit this warning without syntax errors.
If `size` is greater than the size of `range`, the removed region can overrun the end of `range`.
If a proc, lambda, or block is given, its body is evaluated in the context of the current object.
If anything is passed in the html_options hash it will be applied to every select tag in the set.
If the fiber is still alive, it means we need something from the template, so start rendering it.
If the file sets the +model_class+ and current instance value is not set, it uses the file value.
If the method that is chained on the do...end block is itself a method with a block, we allow it.
If you wish to disable this emulation you can add the following line to your application.rb file:
In order to change engine's priority you can use +config.railties_order+ in the main application.
It is also possible for a cop to keep adding indefinitely to a file, making it bigger and bigger.
Middleware class can be inserted as a Rack handler to be local cache for the duration of request.
Modifier nodes have special indentation and will be checked by the AccessModifierIndentation cop.
Most commonly, you might group a number of administrative controllers under an +admin+ namespace.
NOTE: Only the option tags are returned, you have to wrap this call in a regular HTML select tag.
No defaults are needed because Resolver guarantees that the arguments are present and normalized.
Non-reachable constants may be passed if some of the parents were autoloaded and already removed.
Normalization is required because MySQL JSON data format includes the space between the elements.
Notice the 97.18 as a float is greater than 97.18 as a BigDecimal due to floating point precision
Overriding case equality method so that it returns true for ActiveSupport::TimeWithZone instances
Parentheses around the arguments would solve the problem, but we let the user add those manually.
Provides a number of methods for turning different kinds of containers into a set of option tags.
Provides an interface for any class to have +before_validation+ and +after_validation+ callbacks.
Relies on Active Support, so we have to lazy load to postpone definition until AS has been loaded
Removes and returns the last element in the array if it's a hash, otherwise returns a blank hash.
Returns +true+ if an error on the attribute with the given message is present, +false+ otherwise.
Returns +true+ if the class name and +other+ have the same length and content, otherwise +false+.
Returns a class containing the logic needed to load preload the data and attach it to a relation.
Returns an "action-cable-url" meta tag with the value of the URL specified in your configuration.
Returns the association instance for the given name, instantiating it if it doesn't already exist
Saves the record with the updated_at/on attributes set to the current time or the time specified.
Some times you don't care about the content of the fixtures as much as you care about the volume.
That rescue is very expensive (like 40 times slower than a predicate), and it is often triggered.
The +selected+ parameter must be either +nil+, or a string that names an ActiveSupport::TimeZone.
The below example shows how you can use this to provide performance introspection in the process:
The declaration can also include an +options+ hash to specialize the behavior of the association.
The default implementation returns this record's id as a String, or nil if this record's unsaved.
The flash provides a way to pass temporary primitive-types (String, Array, Hash) between actions.
The following methods for retrieval and query of collections of associated objects will be added:
The following transaction covers any possible database side-effects of the attributes assignment.
The node must begin inside the parent, otherwise node is the first part of a chained method call.
This can be overridden in AS::Callback implementors in order to provide better debugging/logging.
This cop is used to identify usages of `all.each` and change them to use `all.find_each` instead.
This is a class which takes in a rails command and initiates the appropriate initiation sequence.
This method ensures a template is compiled just once and removes the source after it is compiled.
This might be done via the +SecureRandom.uuid+ method and a +before_save+ callback, for instance.
This module keeps all methods and behavior in ActionView that simply delegates to the controller.
This option is useful for example if you need fewer/more than four hosts, custom host names, etc.
This should ideally be false in the production environment where dumping schema is rarely needed.
To add the render helpers you're used to having in a normal controller, you can do the following:
Unfortunately, the JSON gem's encoder relies on its own to_json implementation to encode objects.
Use +true+ with boolean attributes that can render with no value, like +disabled+ and +readonly+.
We lazy-load rubocop so that the task doesn't dramatically impact the load time of your Rakefile.
When you don't pass an explicit receiver, it executes the whole block in merging options context:
Wrapping an array in an +ArrayInquirer+ gives a friendlier way to check its string-like contents:
You can specify that the callback should only be fired by a certain action with the +:on+ option:
`start_of_block` : the `end` shall be aligned with the start of the line where the `do` appeared.
after_save/update and the model itself can end up checking dirty status and acting on the results
aliased to avoid conflicts with a stylesheet_url named route Computes the path to an image asset.
def test_jobs assert_no_enqueued_jobs HelloJob.perform_later('jeremy') assert_enqueued_jobs 1 end
module HairColors mattr_accessor :hair_colors, instance_writer: false, instance_reader: false end
this is correctly done double-checked locking (Concurrent::Map's lookups have volatile semantics)
Active Record uses table aliasing in the case that a table is referenced multiple times in a join.
Also note that the model will not be destroyed unless you also specify its id in the updated hash.
Before callbacks should also be executed as early as possible, so also include them at the bottom.
By default, Active Record can guess the inverse of the association based on the name of the class.
Caches that implement LocalCache will be backed by an in-memory cache for the duration of a block.
Call the methods +up+ and +down+ of the yielded object to run a block only in one given direction.
Capitalizes the first word, turns underscores into spaces, and strips a trailing '_id' if present.
Checks for if and unless statements that would fit on one line if written as a modifier if/unless.
Checks for uncountable plurals, and appends "_index" if the plural and singular form are the same.
Creates a form that allows the user to create or update the attributes of a specific model object.
Creates a new join table with the name created using the lexical order of the first two arguments.
Deletes the records of the collection directly from the database ignoring the +:dependent+ option.
Either the row with the given ID doesn't exist or the row didn't meet the additional restrictions.
Encrypts the password into the +password_digest+ attribute, only if the new password is not empty.
Error generated by +delegate+ when a method is called on +nil+ and +allow_nil+ option is not used.
Guides are taken from the source directory, and the resulting HTML goes into the output directory.
If one or more records can not be found for the requested ids, then RecordNotFound will be raised.
If the proxy class doesn't respond to a certain method, it's forwarded to the encapsulated string.
If you attempt to access a field except +id+ that is not in the initialized record you'll receive:
In an isolated engine, the prefix will be omitted in url helpers and form fields, for convenience.
In contrast to the CyclomaticComplexity cop, this cop considers `else` nodes as adding complexity.
In order to use instantiated fixtures with preloaded data, set +self.pre_loaded_fixtures+ to true.
In the rare case that a race condition occurs, the database will guarantee the field's uniqueness.
It's still possible to use both the stand-alone FormHelper methods and methods from FormTagHelper.
NOTE - the following 4 tables are used by models that have :inverse_of options on the associations
Note that +touch+ must be used on a persisted object, or else an ActiveRecordError will be thrown.
Note that meanwhile the class Pet is not reloaded, simulating a class that is present in a plugin.
Overwrite modules_for_helpers to accept :all as argument, which loads all helpers in helpers_path.
Please consult the class method documentation for more information on creating your own validator.
Provides a +delegate+ class method to easily expose contained objects' public methods as your own.
Returns a select tag with options for each of the days 1 through 31 with the current day selected.
Returns a set of NFA states reachable from some NFA state +s+ in set +t+ on nil-transitions alone.
Returns true for constructs such as private def my_method which are allowed in Ruby 2.1 and later.
Returns week start day symbol (e.g. :monday), or raises an +ArgumentError+ for invalid day symbol.
See the Mail gem documentation on the interface you need to implement for a custom delivery agent.
Setting the :extname option will control what extension (if any) is appended to the url for assets
Since the change could (theoretically) introduce parsing errors, we break the loop if we find any.
Specifies a new irregular that applies to both pluralization and singularization at the same time.
Subclasses of Hash may implement this method and return true to declare themselves as extractable.
Supply an ActiveSupport::TimeZone name as +selected+ to have it marked as the selected option tag.
That would just give each lambda the same reference and they would all get the last value of each.
The GetIp class exists as a way to defer processing of the request data into an actual IP address.
The SanitizeHelper module provides a set of methods for scrubbing text of undesired HTML elements.
The database still needs to send all the data to Active Record and it still needs to be processed.
The resulting object is returned whether the object was saved successfully to the database or not.
This cache has a bounded size specified by the :size options to the initializer (default is 32Mb).
This cop checks for optional arguments to methods that do not come at the end of the argument list
This cop is used to identify usages of `count` on an `Array` and `Hash` and change them to `size`.
This formatter displays a progress bar and shows details of offenses as soon as they are detected.
This formatter displays the report data in format that's easy to process in the Emacs text editor.
This helper exposes a method for caching fragments of a view rather than an entire action or page.
This is a poor solution, but fully distributed transactions are beyond the scope of Active Record.
This is needed to isolate class_attribute assignments like `table_name_prefix` for each test case.
This is overridden by HABTM as the condition should be on the foreign_key column in the join table
This is the method that defines the application behavior when a request is found to be unverified.
This means that it doesn't take part in the investigation phase when the other cops do their work.
This plays nicely with tools like jekyll-feed which expect post.author to be in a specific format.
This token is stored as a random string in the session, to which an attacker does not have access.
To enable the +uuid-ossp+ extension, you can use the +enable_extension+ method in your migrations.
To use a UUID primary key without +uuid-ossp+ enabled, you can set the +:default+ option to +nil+:
Transforms attribute names into a more human format, such as "First name" instead of "first_name".
When creating custom validators, it might be useful to be able to specify additional default keys.
add_delivery_method :sendmail, Mail::Sendmail, location:  '/usr/sbin/sendmail', arguments: '-i -t'
aliased to avoid conflicts with an image_path named route Computes the full URL to an image asset.
assert_enqueued_jobs 2 do HelloJob.perform_later('aaron') HelloJob.perform_later('rafael') end end
assert_performed_jobs 2 do HelloJob.perform_later('carlos') HelloJob.perform_later('sean') end end
change_column(:suppliers, :name, :string, limit: 80) change_column(:accounts, :description, :text)
def test_jobs_again assert_no_performed_jobs do No job should be performed from this block end end
ensure that we're not going to throw and rescue from NoMethodError in method_missing which is slow
quoted_name should be downcased as some database adapters (Oracle) return quoted name in uppercase
sometimes tests on Oracle fail if ORDER BY is not provided therefore add always :order with :first
using a copy as we need the drop_table method to continue to work for the ensure block of the test
validates_format_of:  generate_message(attr_name, :invalid, message: custom_message, value: value)
A server-specified data string which should be uniquely generated each time a 401 response is made.
Active Job objects can be defined by creating a class that inherits from the ActiveJob::Base class.
Also, ensure that your database connection pool size is as least as large as your worker pool size.
By default this is guessed to be the name of the associated class in lower-case and "_id" suffixed.
Commissioner class is responsible for processing the AST and delegating work to the specified cops.
Cop name validation must be done later than option parsing, so it's not called from within Options.
Each item in the array corresponds to a table which will be part of the query for this association.
For more details on the whole callback system, read the documentation for ActiveSupport::Callbacks.
Handles calculation of deltas (deviations from correct alignment) when the enforced style is 'key'.
If anything is passed in the +html_options+ hash it will be applied to every select tag in the set.
If the else clause is an elsif, it will get its own on_if call so we don't need to process it here.
If the inspection loop runs for an excessively high number of iterations, this is likely happening.
If you are using file uploads then you will also need to set the multipart option for the form tag:
If you don't have a type column defined in your table, single-table inheritance won't be triggered.
If you want to escape all content, you should invoke the +h+ method before calling the text helper.
Instead of writing every template out, you can use a wildcard to match any template in a directory:
It is configurable to enforce one of the styles for both single line and multiline lambdas as well.
It is important that we do not eat more than one newline because formatting may be wrong otherwise.
Limit also can be specified as a Proc or a Symbol pointing to a method that should return a number.
Not good enough, but we can't do much about it since there is no specific error for frozen objects.
Note that this is a "shallow" copy as it copies the object's attributes only, not its associations.
Note: This is purely a browser performance optimization and is not meant for server load balancing.
Nothing is said about existing indentation that mixes spaces and tabs, so there is nothing to test.
Nothing we can do if we are in a transaction because all commands will raise InFailedSQLTransaction
Oracle does not allow double quotes in table and column names at all therefore quoting removes them
Returns +true+ if the +macro+ is either +has_many+ or +has_and_belongs_to_many+, +false+ otherwise.
Returns a string representation of the key attribute(s) that is suitable for use in an HTML DOM id.
Returns value of the key stored in the session or nil if the given key is not found in the session.
Runs EXPLAIN on the query or queries triggered by this relation and returns the result as a string.
Since minitest only loads plugins if its extensions are empty we have to call `load_plugins` first.
So we check that initially parsed and reparsed duration added to time will result in the same time.
TLS redirect: Permanently redirects http:// requests to https:// with the same URL host, path, etc.
Testing membership still loops, but it's going to be faster than our own loop that converts values.
The block given to the nested fields_for call will be repeated for each instance in the collection:
The current object and the result lambda of the callback will be provided to the terminator lambda.
The following example would subscribe to a broadcasting like `comments:Z2lkOi8vVGVzdEFwcC9Qb3N0LzE`
The translated model name, translated attribute name and the value are available for interpolation.
There are two possible formats for the +choices+ parameter, corresponding to other helpers' output:
This class is responsible to tell scaffold entities how to generate an specific method for the ORM.
This cop checks for setter call to local variable as the final expression of a function definition.
This is great for boiling down a noisy block to just a single statement that produces one log line:
This is required to fulfil the following contract, which must be universally true in Active Record:
This will clear all named routes and reload routes.rb if the file has been modified from last load.
To access the +Instrumenter+ object for a particular +notifier+, you can call the following method:
Use that one when enabling the constraint if needed, since otherwise those rows would not be valid.
Warning: This class mutates ARGV because some commands require manipulating it before they are run.
We may want to disable CSRF protection for APIs since they are typically designed to be state-less.
We might be able to change the implementation to remove conflicts by index, rather than column name
When no selection is made for a collection of checkboxes most web browsers will not send any value.
With rubinius 2.0.0.rc1 + rspec 2.13.1, File.stub(:open).and_call_original causes SystemStackError.
Writes +content+ to the location signified by +key+ (see +expire_fragment+ for acceptable formats).
You can call perform_later with the job arguments to enqueue the job with the preconfigured options
class Person validates_presence_of :name, :address, :email validates_length_of :name, in: 5..30 end
def show doesn't need to assign the flash notice to the template, that's done automatically end end
if no argument/-h/--help is passed to rails destroy command, then it generates the help associated.
if the accumulator parameter is assigned to in the block, then we can't convert to each_with_object
make sure that overriding delivery method options per mail instance doesn't affect the Base setting
:nodoc: We want to exit on failure to be kind to other libraries This is only when accessing via CLI
Accepts a hash two layers deep, keys on the first layer represent environments such as "production".
Allows you to measure the execution time of a block in a template and records the result to the log.
Alternatively, you can pass a String formatted as an ISO8601 date as the values for "min" and "max."
Alternatively, you can pass a String formatted as an ISO8601 time as the values for "min" and "max."
Alternatively, you can require that the specified attribute does _not_ match the regular expression:
An example would be an Active Record subscriber responsible for collecting statistics about queries:
Avoid issues with setting the default_locale by disabling available locales check while configuring.
By the SQL standard, numbers assigned to this field should be truncated but that's seldom respected.
Called by the cable connection when it's cut, so the channel has a chance to cleanup with callbacks.
Checks that operators have space around them, except for ** which should not have surrounding space.
Cop already disabled on this line, so we end the current disabled range before we start a new range.
Especially useful for rendering different HTML versions depending on the user agent, like an iPhone.
Form helpers are designed to make working with resources much easier compared to using vanilla HTML.
From the moment you require "config/application.rb" in your app, the booting process goes like this:
Generates a form containing a single button that submits to the URL created by the set of +options+.
Get the "actual" source reflection if the immediate source reflection has a source reflection itself
Hashes are turned into this form automatically, so the keys become "firsts" and values become lasts.
Holds all the meta-data about a :through association as it was specified in the Active Record class.
If a range is supplied, a substring containing characters at offsets given by the range is returned.
If certain methods do explicitly check the class, call +to_s+ before you pass chars objects to them.
If invalid string is provided, it will raise +ActiveSupport::Duration::ISO8601Parser::ParsingError+.
If the argument is a regexp, it will check if the regular expression matches the given file content.
If the node is inside a block, it makes no difference if that block is an argument in a method call.
If this is the case, Active Record falls back to the previously used LEFT OUTER JOIN based strategy.
If validations for any of the associations fail, their error messages will be applied to the parent.
If you use this option you need to make sure to reconnect any threads in the `on_worker_boot` block.
In Rails, a resourceful route provides a mapping between HTTP verbs and URLs and controller actions.
Inflections are locale specific, and you may define rules for as many different locales as you wish.
Instead of looking up the complete data each time we need it, we'll just look it up here and assign.
It is possible that BracesAroundHashParameters will remove the braces while this cop inserts spaces.
NOTE: this test seems to fail (changeset 1958) only on certain platforms, like OSX, and FreeBSD 5.4.
Overwrites _layout_for in the context object so it supports the case a block is passed to a partial.
Returns a select tag with options for each of the hours 0 through 23 with the current hour selected.
Returns the value of the attribute identified by +attr_name+ before typecasting and deserialization.
Sessions are stored by default in a browser cookie that's cryptographically signed, but unencrypted.
Set routes reload after the finisher hook to ensure routes added in the hook are taken into account.
Split by the first colon followed by some digits, which works for both Windows and Unix path styles.
Splitting with left parentheses and picking up last will return all columns separated with comma(,).
Stop processing work: any work that has not already started running will be discarded from the queue
Streaming can be added to a given template easily, all you need to do is to pass the :stream option.
String inflections define new methods on the String class to transform names for different purposes.
TODO: Don't report that a problem is corrected when it actually went away due to another correction.
The exceptions AdapterNotSpecified, AdapterNotFound and +ArgumentError+ may be returned on an error.
The hash is passed to the supplied Proc or the method and it should return either +true+ or +false+.
The point of this check is that it's easy to miss the call tacked on to the block when reading code.
The proxy objects that control the access to associations can be extended through anonymous modules.
The second element will be an Array of the constants that were present before child.rb was required.
The testing environment will automatically load the all fixtures into the database before each test.
The user is informed by a warning like: "unknown OID 5653508: failed to recognize type of 'address'.
The worker pool is an executor service that's backed by a pool of threads working from a task queue.
These are handled by SpaceAroundEqualsInParameterDefault, so SpaceAroundOperators leaves them alone.
These operations happen before instance creation and the scope will be called with a +nil+ argument.
This can be used to assert that values in the query string will end up in the params hash correctly.
This class is a registry which holds all of the +Instrumenter+ objects in a particular thread local.
This class, however, allows you to call methods with the model object you are building the form for.
This cop checks that the cyclomatic complexity of methods is not higher than the configured maximum.
This cop checks the indentation of the first line of the right-hand-side of a multi-line assignment.
This cop is used to identify usages of `reverse.each` and change them to use `reverse_each` instead.
This instance becomes the parent of all of the channel subscriptions that are created from there on.
This is because UrlFor has no information about the website hostname that your Rails app is serving.
This removal may generate an issue on FreeBSD, that's why we need to use remove_possible_method here
Used to extend a scope with additional methods, either through a module or through a block provided.
We need this special case to avoid creating the pattern /**/* which searches the entire file system.
We often want to render different html/json/xml templates for phones, tablets, and desktop browsers.
When no value is given, it checks if the object is a new resource or not to create the proper label:
Yields a singleton instance of Inflector::Inflections so you can specify additional inflector rules.
added sort by ID as otherwise test using JRuby was failing as array elements were in different order
allows you to access the +address+ attribute of the +User+ model without firing an additional query.
because we pass in the non-default builder, the content generated by the helper should go 'nowhere'.
def test_no_emails assert_no_enqueued_emails do No emails should be enqueued from this block end end
if no argument/-h/--help is passed to rails generate command, then it generates the help associated.
lazy_load_hooks allows Rails to lazily load a lot of components and thus making the app boot faster.
time is in the "spring forward" hour gap, so we're moving the time forward one hour and trying again
* ActiveRecordError - Generic error class and superclass of all other errors raised by Active Record.
*Warning*: one should not catch ActiveRecord::StatementInvalid exceptions inside a transaction block.
+cast_type+ A symbol such as +:string+ or +:integer+, or a type object to be used for this attribute.
:nodoc: Pretty prints the result of an EXPLAIN in a way that resembles the output of the MySQL shell:
A method name is 'dangerous' if it is already (re)defined by Active Record, but not by any ancestors.
A simple base class that can be used along with ActiveModel::Validations::ClassMethods.validates_with
Alternatively, you can add prefixes to your path without using a separate directory by using +scope+.
As we haven't started doing any real work yet, we should pretend that we never made it off the queue.
Assumes that +str+ is a time in the time zone +self+, unless +format+ includes an explicit time zone.
Be sure to specify the same class as the +value_method+ when specifying selected or disabled options.
By supplying +skip_digest:+ true to cache, the digestion of cache fragments can be manually bypassed.
Caches can also store values in a compressed format to save space and reduce time spent sending data.
Capitalizes all the words and replaces some characters in the string to create a nicer looking title.
Constructs a call to a named RESTful route for the given record and returns the resulting URL string.
Creates a password field, a masked text field that will hide the users input behind a mask character.
Defaults to issuing a +private+ instruction, so that intermediate caches must not cache the response.
Exceptions will force a ROLLBACK that returns the database to the state before the transaction began.
Fred.bbb DEPRECATION WARNING: bbb is deprecated and will be removed from Rails 5.1 (use zzz instead).
If +message+ is a symbol, it will be translated using the appropriate scope (see +generate_message+).
If a subclass does not have a layout specified, it inherits its layout using normal Ruby inheritance.
If it is a numeric value it is either the hour offset, or the second offset, of the timezone to find.
If our parents do not have a constant named +const_name+ then we are free to attempt to load upwards.
If the collection is empty, the first form returns +nil+, and the second form returns an empty array.
If you want to ensure associated objects are revalidated on every update, use +validates_associated+.
In MySQL 5.7.5 and up, ONLY_FULL_GROUP_BY affects handling of queries that use DISTINCT and ORDER BY.
In other words, associations which could also be represented as has_and_belongs_to_many associations.
In this case it is usually more natural to include an association which has conditions defined on it:
NOTE - for now, we're only supporting inverse setting from belongs_to back onto has_one associations.
Note that passing custom disallowed types will override the default types, which are Symbol and YAML.
Note that the association_scope is merged into the target_scope only when the scope method is called.
Note that the md5 is taken of the entire template file, not just what's within the cache do/end call.
Now, validate that the source we got back from the template handler is valid in the default_internal.
Offenses are displayed at compact form - just the location of the problem and the associated message.
Pass either a constant +value+, or a block which computes a value each time a cache key is generated.
Private methods are included in the search only if the optional second parameter evaluates to +true+.
REMOTE_ADDR will be correct if the request is made directly against the Ruby process, on e.g. Heroku.
Requires supporting files with custom matchers and macros, etc, in ./support/ and its subdirectories.
Returns a new relation expressing WHERE + NOT condition according to the conditions in the arguments.
Returns check box tags for the collection of existing return values of +method+ for +object+'s class.
SET statements from :variables config hash http://www.postgresql.org/docs/current/static/sql-set.html
See http://rubydoc.info/github/svenfuchs/i18n/master/I18n/Backend/Base:localize for more information.
Store gives you a thin wrapper around serialize for the purpose of storing hashes in a single column.
Subclasses may override this method to add additional conditions that should be considered an action.
Test that generated cache keys are short enough to have Tempfile stuff added to them and remain valid
That is automatically set to ascending on the primary key ("id ASC") to make the batch ordering work.
The above code creates a new method +div_radio_button+ which wraps a div around the new radio button.
The case of explicitly lying about encodings via the normal Rails API should be handled inside Rails.
The default inheritance column name is +type+, which means it's a reserved word inside Active Record.
The return values are used as the +value+ attribute and contents of each check box tag, respectively.
The third argument, +indent_empty_lines+, is a flag that says whether empty lines should be indented.
The type used to get this primitive should have been provided before reaching the connection adapter.
The validators hash can also handle regular expressions, ranges, arrays and strings in shortcut form.
This cop checks for unparenthesized method calls in the argument list of a parenthesized method call.
This cop checks the indentation of the method name part in method calls that span more than one line.
This directive tells Puma to first boot the application and load code before forking the application.
Use of the native PostgreSQL UUID type is supported, and can be used by defining your tables as such:
Used in cases where a method or scope could return zero records but the result needs to be chainable.
Useful in applications where the limit or scope being ignored is error-worthy, rather than a warning.
User has explicitly opted out of concurrent request handling: presumably their code is not threadsafe
Using polymorphic associations in combination with single table inheritance (STI) is a little tricky.
When you load an author with all associated books Active Record will make multiple queries like this:
Writing an object will convert it into standard SSE format with whatever options you have configured.
`start_of_line` : the `end` shall be aligned with the start of the line where the expression started.
def down add_column :items, :incomplete_items_count add_column :items, :completed_items_count end end
regular dotted method calls bind more tightly than operators so we need to climb up the AST past them
release_connection releases the connection-thread association and returns the connection to the pool.
test a more aggressive before_destroy  doesn't destroy the habtm joins and still throws the exception
this controller exists in the admin namespace as well which is the only difference from previous test
* +sql+ - An SQL statement which should return a count query from the database, see the example above.
* Otherwise, a node with +key+ as tag is created with a string representation of +value+ as text node.
+MessageVerifier+ makes it easy to generate and verify messages which are signed to prevent tampering.
A class method is 'dangerous' if it is already (re)defined by Active Record, but not by any ancestors.
Additionally, when dealing with numeric values, a query method will return false if the value is zero.
All elements are expected to respond to +to_xml+, if any of them does not then an exception is raised.
Any option parameters provided will be used to re-add the foreign key in case of a migration rollback.
CREATE TABLE accounts ( id int NOT NULL auto_increment, name varchar default NULL, PRIMARY KEY  (id) )
Cache the proxy separately before the owner has an id or else a post-save proxy will still lack the id
Check-in a database connection back into the pool, indicating that you no longer need this connection.
Checks for while and until statements that would fit on one line if written as a modifier while/until.
Don't give a deprecation warning on inspect since test/unit and error logs rely on it for diagnostics.
Each Rails::Application class has its own set of initializers, as defined by the Initializable module.
Emails by default are sent in plain text, so a sample view for our model example might look like this:
Encapsulates the pattern of wanting to validate a password or email address field with a confirmation.
Except if it's one of those special `case`/`when` constructs where there's no expression after `case`.
For example, in the resource generator, the controller should be invoked with a pluralized class name.
For more information about the methods defined on the Chars proxy see ActiveSupport::Multibyte::Chars.
For streaming, instead of rendering a given a template, we return a Body object that responds to each.
Generate a url based on the options provided, default_url_options and the routes defined in routes.rb.
Guides are taken from the output directory, from where all .html files are submitted to the validator.
However, if +content_for+ is called several times, the final result would have all calls concatenated.
If +class_name+ is specified, the serialized object must be of that class on assignment and retrieval.
If +reload_classes_only_on_change+ is true (the default), the class unload will have already occurred.
If it is not possible to load the constant into from_mod, try its parent module using +const_missing+.
If the controller cannot be inferred from the test class name, you can explicitly set it with +tests+.
If the generator is invoked with class name Admin, it will check for the presence of "AdminDecorator".
If the inheritance column value is not self or a valid subclass, raises ActiveRecord::SubclassNotFound
If the object is not persisted, a form for that object, for instance, will route to the create action.
If token Authorization header is present, call the login procedure with the present token and options.
If you enable +ParamsWrapper+ for +:json+ format, instead of having to send JSON parameters like this:
Implicit template rendering is not performed if any attachments or parts have been added to the email.
In any case, +preload_associations+ will preload the all associations records by flattening +records+.
In some cases, like a single table inheritance setup, you might have a bunch of explicit dependencies.
It generates at least one SQL +DELETE+ query per record (or possibly more, to enforce your callbacks).
It is healthy to consider this edge case because with mtimes in the future reloading is not triggered.
Method for creating new ActiveSupport::TimeWithZone instance in time zone of +self+ from given values.
Note that unlike reorder, we're only unscoping the named conditions -- not the entire where statement.
Note: Regexp expiration is only supported on caches that can iterate over all keys (unlike memcached).
Objects of AggregateReflection and AssociationReflection are returned by the Reflection::ClassMethods.
Returns a new relation, which is the logical union of this relation and the one passed as an argument.
Returns set of NFA states to which there is a transition on ast symbol +a+ from some state +s+ in +t+.
See ActionController::Parameters.require and ActionController::Parameters.permit for more information.
Sets the default wrapper key or model which will be used to determine wrapper key and attribute names.
The closing brace of a multi-line hash literal must be on the line after the last element of the hash.
The closing brace of a multi-line method call must be on the line after the last argument of the call.
They express relationships like "Project has one Project Manager" or "Project belongs to a Portfolio".
This can be provided as a proc or lambda returning regular expression which will be called at runtime.
This checks for a caching problem which causes a bug in the fixtures class-level configuration helper.
This class exists to add abstraction and clean naming to the objects that are going to be operated on.
This class is used by Rails to reload the I18n framework whenever they are changed upon a new request.
This cop checks for `private` or `protected` access modifiers which are applied to a singleton method.
This cop checks for braces around the last parameter in a method call if the last parameter is a hash.
This cop checks for correct grammar when using ActiveSupport's core extensions to the numeric classes.
This cop checks for uses of the class/module name instead of self, when defining class/module methods.
This limit may cause some asset downloads to wait for previous assets to finish before they can begin.
This module helps build the runtime properties used to display in the Rails::InfoController responses.
Unless the element is tagged with :nodoc:, the search proceeds to check its ancestors for :nodoc: all.
Useful for partial updates, don't only update the lock_version if there is nothing else being updated.
Using a constant means that we do not have to allocate an object on each call to the attribute method.
Validates whether the value of the specified attribute is available in a particular enumerable object.
Values set on app_generators will become defaults for application, unless application overwrites them.
When on, an exception is raised if it looks like the client is trying to lie about its own IP address.
You can also yield multiple times in one layout and use block arguments to differentiate the sections.
You're encouraged to add a unique index in the database to deal with this even more unlikely scenario.
after_commit :do_foo, on: :create after_commit :do_bar, on: :update after_commit :do_baz, on: :destroy
for backwards compatibility with those that didn't add strip_insignificant_zeros to their locale files
validates_exclusion_of: generate_message(attr_name, :exclusion, message: custom_message, value: value)
validates_inclusion_of: generate_message(attr_name, :inclusion, message: custom_message, value: value)
* Create ActiveSupport::TimeWithZone instances via TimeZone's +local+, +parse+, +at+ and +now+ methods.
@object_cache maps configuration file paths to configuration objects so we only need to load them once.
A case where two cops, EmptyLinesAroundBody and EmptyLines, try to remove the same line in autocorrect.
ActionController::TestCase will automatically infer the controller under test from the test class name.
Additionally, the class-level +table_name_prefix+ is prepended and the +table_name_suffix+ is appended.
Adds, by name, a renderer or renderers to the +_renderers+ available to call within controller actions.
Any libraries that use thread pools should be configured to match the maximum value specified for Puma.
Asserts that the redirection options passed in match those of the redirect called in the latest action.
By quieting the mix-in noise, we arrive at a natural, low-ceremony way to separate bite-sized concerns.
Calling `parsed_body` on the response parses the response body as what the last request was encoded as.
CaseWhenSplat requires multiple rounds of correction to avoid "clobbering errors" from Source::Rewriter
Clears up all existing helpers in this class, only keeping the helper with the same name as this class.
Common functionality for checking for a line break before the first element in a multi-line collection.
Convenience method to hide this generator from the available ones when running rails generator command.
Creates a Cycle object whose _to_s_ method cycles through elements of an array every time it is called.
Declare an enum attribute where the values map to integers in the database, but can be queried by name.
Define url_for in the singleton level so one can do: Rails.application.routes.url_helpers.url_for(args)
Disconnects from the database if already connected, and establishes a new connection with the database.
Drops the database specified on the +name+ attribute and creates it again using the provided +options+.
Having two cops registering offense for the line with only spaces would cause havoc in auto-correction.
If `Metrics/LineLength` is enabled, we do not want to introduce an offense by auto-correcting this cop.
If an argument isn't given to the proc, it's evaluated in the context of the current controller anyway.
If the model is new, a record gets created in the database, otherwise the existing record gets updated.
If the value is :schema_search_path (the default), any schemas listed in schema_search_path are dumped.
If you have multiple class-specific databases, the transaction will not protect interaction among them.
In a multi-threaded environment they should only be set once at boot-time and never mutated at runtime.
It does not require Rails but will integrate tightly with it to make background processing dead simple.
It is also possible to limit the uniqueness constraint to a set of records matching certain conditions.
Loads and returns the entire raw configuration of database from values stored in `config/database.yml`.
Long-lived channels (and connections) also mean you're responsible for ensuring that the data is fresh.
Method for creating new ActiveSupport::TimeWithZone instance in time zone of +self+ from parsed string.
Notice that we use a bang in this instrumentation because you don't want to consume this in production.
Override the default form builder for all views rendered by this controller and any of its descendants.
Owes great inspiration to test runner trailblazers like RSpec, minitest-reporters, maxitest and others.
Raises +InvalidSignature+ if the message was not signed with the same secret or was not Base64-encoded.
Remove the handlers from calculation to improve performance since the user cannot modify it explicitly.
Returns +true+ if the error messages include an error for the given key +attribute+, +false+ otherwise.
Returns a list of modules, normalized from the acceptable kinds of helpers with the following behavior:
Returns true if the name can be considered an action because it has a method defined in the controller.
Ruby has to allocate memory for the splat expansion every time that the `case` `when` statement is run.
See ActiveRecord::Associations::ClassMethods's overview on Bi-directional associations for more detail.
Shortcut helper that returns all the ActionController::API modules except the ones passed as arguments:
Since this loop needs the constants it would be inconsistent to assume they should exist at this point.
String methods are proxied through the Chars object, and can be accessed through the +mb_chars+ method.
The method arguments are symbols which correspond to the names of the methods which should be unscoped.
The second parameter is the argument string that is passed to the generator or an Array that is joined.
The table style is the only one where the first key-value pair can be considered to have bad alignment.
This formatter display dots for files with no offenses and letters for files with problems in the them.
This method differs from its non-bang version in the sense that it passes through the attribute setter.
Update transmit API to be coder-aware so we can no-op when pubsub and connection are both JSON-encoded.
Useful if you suddenly need to see entire filepaths in the backtrace that you had already filtered out.
We're going to 'transcode' bytes from UTF-8 when possible, then fall back to CP1252 when we get errors.
When rendering a collection of objects that each use the same partial, a `cached` option can be passed.
You might want to allow +:id+ and +:_destroy+, see ActiveRecord::NestedAttributes for more information.
predefined global variables their English aliases http://www.zenspider.com/Languages/Ruby/QuickRef.html
"Substitutions in double-quoted strings" http://www.ruby-doc.org/docs/ProgrammingRuby/html/language.html
:nodoc: Methods for sending arbitrary data and for streaming files to the browser, instead of rendering.
Active Job has two built-in queue adapters intended for development and testing: +:async+ and +:inline+.
Additionally, the source reflection and/or through reflection may be subject to polymorphism and/or STI.
After quoting, the values are inserted using the same escapes as the Ruby core method +Kernel::sprintf+.
Alternatively, you can pass a String formatted as an ISO8601 datetime as the values for "min" and "max."
Around callbacks can access the return value from the event, if it wasn't halted, from the +yield+ call.
Because of this, Active Record emulates nested transactions by using savepoints on MySQL and PostgreSQL.
But there may well be off cases, like copying a commentable and its comments, where you don't want that.
Checks that block braces have or don't have a space before the opening brace depending on configuration.
Contains all the mounted helpers across different engines and the `main_app` helper for the application.
Converts the array to a comma-separated sentence where the last element is joined by the connector word.
Each would be rendered and added as a separate part to the message, with the corresponding content type.
Executes delete +sql+ statement in the context of this connection using +binds+ as the bind substitutes.
Executes insert +sql+ statement in the context of this connection using +binds+ as the bind substitutes.
Executes update +sql+ statement in the context of this connection using +binds+ as the bind substitutes.
Filtering only certain sub-keys from a hash is possible by using the dot notation: 'credit_card.number'.
For more information, see the documentation for this option on the different specific association types.
For polymorphic relationships, find the foreign key and type: PriceEstimate.where(estimate_of: treasure)
However, you need to be aware when using +class_attribute+ with mutable structures as +Array+ or +Hash+.
If any of the +before_add+ callbacks throw an exception, the object will not be added to the collection.
If the optional parameter +locale+ is specified, the word will be pluralized as a word of that language.
If you need to address multiple instances of the same class in the same view, you can prefix the dom_id:
In addition, both must be a regular expression or a proc or lambda, or else an exception will be raised.
In these examples, we have three implicit lookup scenarios: * The BankController uses the "bank" layout.
It will still allow passing just a message, or the construction of an error with more than one argument.
Let's suppose you are creating a generator that needs to invoke the controller generator from test unit.
Methods which would normally return a String object now return a Chars object so methods can be chained.
NOTE: This approach has been deprecated for end-user code in favor of thread_mattr_accessor and friends.
NOTE: rack-test v0.5 doesn't build a default uri correctly Make sure requested path is always a full uri
Record that we've seen this file *before* loading it to avoid an infinite loop with mutual dependencies.
Retrieve the connection associated with the current thread, or call checkout to obtain one if necessary.
Retrieve the constants that were present under the namespace when watch_namespaces was originally called
Returns a Pathname object of the current rails project, otherwise it returns nil if there is no project:
Returns a select tag with options for each of the minutes 0 through 59 with the current minute selected.
Returns a select tag with options for each of the seconds 0 through 59 with the current second selected.
Returns radio button tags for the collection of existing return values of +method+ for +object+'s class.
Returns the original value of the environment's REQUEST_METHOD, even if it was overridden by middleware.
Returns, for example, a bare `if` node if the given node is an `if` with calls chained to the end of it.
So if you have "myapp_" as a prefix, the table name guess for an Invoice class becomes "myapp_invoices".
The API has the same methods as ActiveRecord, but each method returns a string that matches the ORM API.
The advantage is that you're able to add validations, callbacks, and extra attributes on the join model.
The closing brace of a multi-line array literal must be on the line after the last element of the array.
The closing brace of a multi-line hash literal must be on the same line as the last element of the hash.
The closing brace of a multi-line method call must be on the same line as the last argument of the call.
The following regexp detects special labels followed by a paragraph, perhaps at the end of the document.
The name is assumed to be the one of a top-level constant, no matter whether it starts with "::" or not.
The recall key is only used if there is no key in the options or if the key in the options is identical.
The replacement should always be a string that may include references to the matched data from the rule.
The return values are used as the +value+ attribute and contents of each radio button tag, respectively.
The standard set of helper methods for form building are located in the +field_helpers+ class attribute.
The test helpers are responsible for setting up the queue, subscriptions and turning colors in logs off.
The top level domain can be any string without a period or **.**, ***.** style TLDs like co.uk or com.au
The values compared should be of fixed length, such as strings that have already been processed by HMAC.
This can be used to identify queries which load thousands of records and potentially cause memory bloat.
This cop checks for a line break before the first parameter in a multi-line method parameter definition.
This cop checks for scope calls where it was passed a method (usually a scope) instead of a lambda/proc.
This cop makes sure that all methods use the configured style, snake_case or camelCase, for their names.
This helper may be included in any class that includes the URL helpers of a routes (routes.url_helpers).
This is the only method that is not thread safe, but is only ever called during the eager loading phase.
This is usually the name of a PostgreSQL relation but it can also represent schema qualified type names.
This is what allows any test framework to hook into Rails as long as it provides any of the hooks above.
This method manipulates the given path and tries to find any migration which matches the migration name.
This redirects the attempts to write objects in an association through the helper methods defined below.
This will render "advertiser/_ad.html.erb" and pass the local variable +ad+ to the template for display.
To prevent this the helper generates an auxiliary hidden field before every collection of radio buttons.
We add 2 because there's one char of padding at both sides, note the extra hyphens in the example above.
We can't reuse the connection, but we can copy the specification and establish a new connection with it.
Whenever setting view paths, makes a copy so that we can manipulate them in instance objects as we wish.
You can choose to have only specific callbacks by passing a hash to the +define_model_callbacks+ method.
You can use this if for some reason you need to explicitly load some records before actually using them.
def test_no_logging assert_no_enqueued_jobs only: LoggingJob do HelloJob.perform_later('jeremy') end end
if host is not ip and matches domain regexp (ip confirms to domain regexp so we explicitly check for ip)
is this regexp 'literal' in the sense of only matching literal chars, rather than using metachars like .
require 'pp' early to prevent hidden_methods from not picking up the pretty-print methods until too late
time_zone_select( "user", "time_zone", ActiveSupport::TimeZone.all.sort, model: ActiveSupport::TimeZone)
validates_length_of: generate_message(attr, :too_long, message: custom_message, count: option_value.end)
validates_length_of: generate_message(attr, :wrong_length, message: custom_message, count: option_value)
(The notification may in turn trigger an email, a push notification, or just appear in the UI somewhere):
+mail_to+ has several methods for customizing the email itself by passing special keys to +html_options+.
Add one or more records to the collection by setting their foreign keys to the association's primary key.
As you're unlikely to write code that can accept values of any type this is rarely a problem in practice.
At the database-level, the actions performed by these users could be interleaved in the following manner:
Delivers an email without checking +perform_deliveries+ and +raise_delivery_errors+, so use with caution.
Each action results in a response, which holds the headers and document to be sent to the user's browser.
First, one uses the +get+, +post+, +patch+, +put+, +delete+ or +head+ method to simulate an HTTP request.
For more details on registering your types to be referenced by a symbol, see ActiveRecord::Type.register.
For single-table inheritance, we check the record for a +type+ column and return the corresponding class.
If +autosave+ is +false+ only new records will be returned, unless the parent is/was a new record itself.
If +objectify_options+ is not called, then the newly created helper will not be linked back to the model.
If the attachments are inline, the content type will be "multipart/related", otherwise "multipart/mixed".
If the time deltas were processed first, the following datetimes would be advanced to 2010/04/01 instead.
If the type is prefixed with a scope operator then we assume that the type_name is an absolute reference.
If you need to share the same extensions between many associations, you can use a named extension module.
In order to override this behavior, take a look at the private method +read_attribute_for_serialization+.
In this case +last_modified+ will be set by calling +updated_at+ and +etag+ by passing the object itself.
In this description, 'association name' shall refer to the name passed to an association creation method.
It is recommended that your type objects inherit from an existing type, or from ActiveRecord::Type::Value
It only accepts type objects, and will do its work immediately instead of waiting for the schema to load.
It should be extended to handle methods whose body is if/else or a case expression with a default branch.
Job: Any class inheriting from the adapter may set the priority on the job object relative to other jobs.
Make sure to use a Proc instead of a lambda, since a Proc allows missing parameters and sets them to nil.
Note that content_for concatenates (default) the blocks it is given for a particular identifier in order.
Ordinal returns the suffix used to denote the position in an ordered sequence such as 1st, 2nd, 3rd, 4th.
Removes the index on +branch_id+ and +party_id+ in the +accounts+ table if exactly one such index exists.
Replaces all ISO-8859-1 or CP1252 characters by their UTF-8 equivalent resulting in a valid UTF-8 string.
Restore the new record state and id of a record that was previously saved by a call to save_record_state.
Returns +true+ when the connection adapter supports prepared statement caching, otherwise returns +false+
Returns a hash of all the attributes with their names as keys and the values of the attributes as values.
Returns the difference in milliseconds between when the execution of the event started and when it ended.
Similarly, if you want it to also look up in the rails namespace, you just need to provide the :in value:
So if set to "basecamp_", all table names will be named like "basecamp_projects", "basecamp_people", etc.
Thanks to repeated auto-correction, we can get rid of the trailing spaces, and then the extra empty line.
The following is not a valid RFC 4122 UUID, but PG doesn't seem to care, so we shouldn't block it either.
The immutable requirement is enforced by Active Record by freezing any object assigned as a value object.
The method is intended to return an ActiveRecord::Relation object, which is composable with other scopes.
The route key also considers if the noun is uncountable and, in such cases, automatically appends _index.
The unusual part of its implementation is that it doesn't have any on_* methods or an investigate method.
This class takes a source buffer and rewrite its source based on the different correction rules supplied.
This cop checks for ambiguous operators in the first argument of a method invocation without parentheses.
This is a white list of permitted scalar types that includes the ones supported in XML and JSON requests.
This is an initial / outermost share call: any outstanding requests for an exclusive lock get to go first
This is especially important on Windows where the temporary directory is under the user's home directory.
This is to avoid ActiveModel (and by extension the entire framework) being dependent on a binary library.
This means that if a handler doesn't handle encodings, it will always get Strings in the default_internal
This middleware verifies the path to ensure that only files living in the root directory can be rendered.
To create a new application, you can instantiate a new instance of a class that has already been created:
Unfortunately that workaround does not work when the check box goes within an array-like parameter, as in
When you mount an engine in an application's routes, a special helper is created to allow you to do that.
With +purpose+ matching, it is possible to yield only to other threads whose activity will not interfere.
With layouts, you can flip it around and have the common structure know where to insert changing content.
You *must* call close on your stream when you're finished, otherwise the socket may be left open forever.
You can add backtrace silencers for libraries that you're using but don't wish to see in your backtraces.
You can use the +:_prefix+ or +:_suffix+ options when you need to define multiple enums with same values.
add_column(:users, :picture, :binary, limit: 2.megabytes) ALTER TABLE "users" ADD "picture" blob(2097152)
assert that since this is within default timeout our connection hasn't been forcefully taken away from us
because parameter name repetition is precisely what Rails seeks to distinguish the elements of the array.
change_column_default(:suppliers, :qualification, 'new') change_column_default(:accounts, :authorized, 1)
def test_no_logging assert_no_performed_jobs only: LoggingJob do HelloJob.perform_later('jeremy') end end
this is a correctly done double-checked locking idiom (Concurrent::Map's lookups have volatile semantics)
validates_numericality_of: generate_message(attr_name, option, value: raw_value, default: custom_message)
* SerializationTypeMismatch - The serialized object wasn't of the class specified as the second parameter.
+InheritableOptions+ provides a constructor to build an +OrderedOptions+ hash inherited from another hash.
+name+ The name of the methods to define attribute methods for, and the column which this will persist to.
:nodoc: Pretty prints the result of an EXPLAIN in a way that resembles the output of the PostgreSQL shell:
A Chars object accepts a string upon initialization and proxies String methods in an encoding safe manner.
AST: (begin (block (send nil :some_method (lvasgn :foo (int 1))) (args) nil) (send nil :puts (lvar :foo)))
Acquire the ActiveSupport::Dependencies::Interlock unload lock, ensuring it will be released automatically
Adds an interval of time to the current object's time and returns that value as a new TimeWithZone object.
Alternatively, you can exert more control over the asset host by setting +asset_host+ to a proc like this:
Among other things, this method is responsible for properly setting the encoding of the compiled template.
Annoyingly, the code for prepared statements whose return value may have changed is FEATURE_NOT_SUPPORTED.
By default if an HTML response is expected it will render static error pages from the `/public` directory.
CREATE UNIQUE INDEX index_accounts_on_branch_id_and_party_id ON accounts(branch_id, party_id) WHERE active
Checks that braces used for hash literals have or don't have surrounding space depending on configuration.
Creates a scope around a specific model object like form_for, but doesn't create the form tags themselves.
Current Rails style favors RESTful routes whenever possible, so base your application on resources and use
First, it will ensure that any thrown +MissingTranslation+ messages will be rendered as inline spans that:
For other adapters you will have to parse the (database-specific) exception message to detect such a case.
HSTS protects your site on every visit *except the first visit* since it hasn't seen your HSTS header yet.
If the collection is empty the target is set to an empty array and the loaded flag is set to true as well.
If the optional parameter +locale+ is specified, the word will be singularized as a word of that language.
If you need to redirect on the condition of something, then be sure to add "and return" to halt execution.
Implements the ActiveSupport::LogSubscriber for logging notifications when email is delivered or received.
In the Asset example, you'd need an +attachable_id+ integer column and an +attachable_type+ string column.
Notifications ships with a queue implementation that consumes and publishes events to all log subscribers.
Polymorphic associations on models are not restricted on what types of models they can be associated with.
Resets all the cached information about columns, which will cause them to be reloaded on the next request.
Returns a Hash containing a collection of pairs when the key is the node name and the value is its content
Returns a jar that'll automatically set the assigned cookies to have an expiration date 20 years from now.
Returns translated month names, but also ensures that a custom month name array has a leading nil element.
Routing Concerns allow you to declare common routes that can be reused inside others resources and routes.
Runs the supplied command using either "rake ..." or "rails ..." based on the executor parameter provided.
Same as XmlSimple::xml_in but doesn't shoot itself in the foot, and uses the defaults from Active Support.
Saving changes to the parent and its associated model can now be performed automatically _and_ atomically:
Simulate an HTTP request to +action+ by specifying request method, parameters and set/volley the response.
Take callback names and an optional callback proc, normalize them, then call the block with each callback.
The +add+ method accepts the following options as arguments: eager_load, autoload, autoload_once and glob.
The .other directory is explicitly included, so the configuration file is read, and modifies the behavior.
The array of files and list of directories cannot be changed after FileUpdateChecker has been initialized.
The channel just acts as a connector between the two parties (the broadcaster and the channel subscriber).
The closing brace of a multi-line array literal must be on the same line as the last element of the array.
The result can be used as an argument for establish_connection, for easily re-establishing the connection.
This also means that this method only works when the primary key is orderable (e.g. an integer or string).
This cop checks for the presence of superfluous parentheses around the condition of if/unless/while/until.
This cop makes sure that all variables use the configured style, snake_case or camelCase, for their names.
This exception then gathers a bunch of intimate details and uses it to report a precise exception message.
This goes a step further than signed cookies in that encrypted cookies cannot be altered or read by users.
This technique is useful caching pieces like menus, lists of new topics, static HTML fragments, and so on.
This will include both records as part of the cache key and updating either of them will expire the cache.
This would allow a user to use new nonce without prompting the user again for their username and password.
Useful if your context of debugging suddenly expands as you suspect a bug in one of the libraries you use.
You can also pass a list of named timestamps, and the newest in the list will be used to generate the key:
You can tell RuboCop to use your custom formatter with a combination of `--format` and `--require` option.
has_one - Source reflection can be has_one or belongs_to - Through reflection can be has_one or belongs_to
record) is given a name and is followed by an indented list of key/value pairs in the "key: value" format.
the 'pattern-matching' expression may be a composite which contains an arbitrary number of sub-expressions
* Call each of its methods you want to add, such as +attribute_method_suffix+ or +attribute_method_prefix+.
* In which case, we must make sure to *not* update the counter cache, or else it will be decremented twice.
A symbolic link anywhere in the cache directory tree is an indication that a symlink attack is being waged.
ActiveModel is a class to be implemented by each ORM to allow Rails to generate customized controller code.
Any collection renders will find those cached templates when attempting to read multiple templates at once.
Avoid correcting to `lambdado` by inserting whitespace if none exists before or after the lambda arguments.
Convenience method for types which do not need separate type casting behavior for user and database inputs.
Default is set to 5 threads for minimum and maximum, this matches the default thread size of Active Record.
Deletes all the records from the collection according to the strategy specified by the +:dependent+ option.
Executes an SQL statement, returning a PGresult object on success or raising a PGError exception otherwise.
For example, the following demo integration test prints the body of the controller response to the console:
If a cop modifies the source and another cop undoes it producing identical source we have an infinite loop.
If a single string, IPAddr, or Regexp object is provided, it will be used in addition to +TRUSTED_PROXIES+.
If you need to address multiple instances of the same class in the same view, you can prefix the dom_class:
If you want to cache the statement without the values you can use the +bind+ method of the block parameter.
In this case it deletes all the entries in the specified file store directory except for .keep or .gitkeep.
It does not instantiate the involved models and it does not trigger Active Record callbacks or validations.
Must try to match prefixes/suffixes first, or else the matcher with no prefix/suffix will match every time.
Override this method in subclasses should you need to retrieve the value for a given attribute differently:
Person.find_or_create_by(name: 'Spartacus', rating: 4) returns the first item or creates it and returns it.
Person.where(name: 'Spartacus', rating: 4).pluck(:field1, :field2) returns an Array of the required fields.
Reports the approximate distance in time between two Time, Date or DateTime objects or integers as seconds.
Resource routing allows you to quickly declare all of the common routes for a given resourceful controller.
Returns true if a record exists in the table that matches the +id+ or conditions given, or false otherwise.
Set clearing dependencies after the finisher hook to ensure paths added in the hook are taken into account.
That is automatically set to ascending on the primary key ("id ASC") to make the batch ordering consistent.
The behavior is the same, it returns true if the collection based on the criteria has more than one record.
The constructor for the value class is called +create+ and it expects a CIDR address string as a parameter.
The updated template should be picked since lookup_context generated a new key after we changed the locale.
This can be done either by specifying a method reference as a symbol or using an inline method (as a proc).
This class allows you to store and get the scope values on different classes and different types of scopes.
This method is a shortcut to all default validators and any custom validator classes ending in 'Validator'.
We're nested inside a +yield_shares+ call: we'll resume as soon as there isn't an exclusive lock in our way
When a string is used, the human form should be specified as desired (example: 'The name', not 'the_name').
When called, serializable hash will use instance methods that match the name of the attributes hash's keys.
When you specify a class option, the default value for that attribute will be a new instance of that class.
With such an engine, everything that is inside the +MyEngine+ module will be isolated from the application.
You can find the connections you're looking for by searching for the identifier declared on the connection.
You may declare that the parameter should be an array of permitted scalars by mapping it to an empty array:
assert_enqueued_emails 2 do ContactMailer.welcome.deliver_later ContactMailer.welcome.deliver_later end end
class Person include ActiveModel::Validations validates_with MyValidator, MyOtherValidator, on: :create end
validates_length_of: generate_message(attr, :too_short, default: custom_message, count: option_value.begin)
A commissioner object is responsible for traversing the AST and invoking the specific callbacks on each cop.
A simple hack to restore the observers and interceptors for Mail, as it does not have an unregister API yet.
Active Record won't persist value objects that have been changed through means other than the writer method.
Additionally, it checks whether the block arguments, if any, are on the same line as the start of the block.
Adds one or more +records+ to the collection by setting their foreign keys to the association's primary key.
All such identifiers will automatically create a delegation method of the same name on the channel instance.
Anything else is blank, some user type, or some function and we can't know the value of that, so return nil.
Attempt to autoload the provided module name by searching for a directory matching the expected path suffix.
Connects to a PostgreSQL server and sets up the adapter depending on the connected server's characteristics.
Converts an HTTP header name to an environment variable name if it is not contained within the headers hash.
Defines the name of the table column which will store the class name on single-table inheritance situations.
Enabling nested attributes on a one-to-one association allows you to create the member and avatar in one go:
Every major component of Rails (Action Mailer, Action Controller, Active Record, etc.) implements a railtie.
Finishes in-progress work and handles any new jobs following the executor's fallback policy (`caller_runs`).
For each file that RuboCop scans, a comment that matches this regex must be found or an offense is reported.
Given a +Foo+ module and a +Bar+ module which depends on the former, we would typically write the following:
Hook method that gets called by the initializer allowing verification that the arguments supplied are valid.
If :type options is set, a file extension will be appended and scoped to the corresponding public directory.
If passed an optional +locale+ parameter, the word will be pluralized using rules defined for that language.
If using threads and workers together the concurrency of the application would be max `threads` * `workers`.
If you want to ensure your destination root is clean before running each test, you can set a setup callback:
In addition, this allows a single partial to be used to generate form inputs for both edit and create forms.
In this case, you can use a singular resource to map /profile (rather than /profile/:id) to the show action.
In this case, you can use a singular resource to map /profile (rather than /profile/:id) to the show action:
Like the Active Record methods, the callback chain is aborted as soon as one of the methods throws +:abort+.
May be overridden to change the default stream handling behavior which decodes JSON and transmits to client.
Note that the request parameter might not be supplied, e.g. when the assets are precompiled via a Rake task.
On any platform we don't want a .rubocop.yml file in the temporary directory to affect the outcome of rspec.
Railties can access a config object which contains configuration shared by all railties and the application:
Raised when argument +number+ param given to the helpers is invalid and the option :raise is set to  +true+.
Reads a cached fragment from the location signified by +key+ (see +expire_fragment+ for acceptable formats).
Returns a formatted string of the offset from UTC, or an alternative string if the time zone is already UTC.
Returns a new Date where one or more of the elements have been changed according to the +options+ parameter.
Returns a new Time where one or more of the elements have been changed according to the +options+ parameter.
Returns a select tag with options for each of the five years on each side of the current, which is selected.
Since escaping tags is now default, this can be used when you don't want Rails to automatically escape tags.
The +FormBuilder+ object can be thought of as serving as a proxy for the methods in the +FormHelper+ module.
The DOM id convention is to use the singular form of an object or class with the id following an underscore.
The default key_size is chosen to be compatible with the default settings of ActiveSupport::MessageVerifier.
The implicit block given to +link_to_unless_current+ is evaluated if the current action is the action given.
The second argument indicates whether the callback is to be run +:before+, +:after+, or +:around+ the event.
There is also a list of default options supported by every validator: +:if+, +:unless+, +:on+ and +:strict+.
They can't be used for responses that must be byte-identical, like serving Range requests within a PDF file.
This cop is used to identify usages of `count` on an `Enumerable` that follow calls to `select` or `reject`.
This is possible thanks to a hidden field generated by the helper method for every collection of checkboxes.
This method is used primarily for maintaining counter_cache columns that are used to store aggregate values.
This particular method should be called with a method_name and the args passed into that method as an input.
This test creates two groups of threads: group1 whose members all start waiting before any thread in group2.
This will cause transactions to overlap and fail unless they are performed on separate database connections.
Use :ruby if you want to have different database adapters for, e.g., your development and test environments.
When no option is given, the behavior is to do nothing with the associated records when destroying a record.
With carefully crafted JavaScript on their end, sensitive data in your JavaScript response may be extracted.
Wrap this block around expensive operations or possible bottlenecks to get a time reading for the operation.
Yes: Allows the priority to be set on the job object, at the queue level or as default configuration option.
class User include ActiveSupport::Configurable config_accessor :allowed_access, instance_accessor: false end
frozen_string_literal: true rubocop:disable Metrics/ClassLength rubocop:disable Metrics/CyclomaticComplexity
usually a majority of template look ups return nothing, use this canonical preallocated array to save memory
would produce a form with fields whose initial state reflect the current values of the attributes of +post+.
'wibble'.to_i will give zero, we want to make sure that we aren't marking int zero to string zero as changed.
(The first one with that offset will be returned.) Returns +nil+ if no such time zone is known to the system.
(This is the same behavior as +parse+.) In either case, the returned TimeWithZone has the timezone of +self+.
*Note*: The attributes listed are class-level attributes (accessible from both the class and instance level).
Accepts an array or string of SQL conditions and sanitizes them into a valid SQL fragment for a WHERE clause.
ActiveSupport::Notifications.subscribe('process_action.action_controller', ActionController::PageRequest.new)
Chars objects are perfectly interchangeable with String objects as long as no explicit class checks are made.
Classes may signal their instances are not duplicable removing +dup+/+clone+ or raising exceptions from them.
Converts Date to a Time (or DateTime if necessary) with the time portion set to the end of the day (23:59:59)
Converts Date to a Time (or DateTime if necessary) with the time portion set to the middle of the day (12:00)
Depending on command line arguments, the migration template and the table name instance variables are set up.
FileStore implements the Strategy::LocalCache strategy which implements an in-memory cache inside of a block.
For each item with a checked check box you get an extra ghost item with only that attribute, assigned to "0".
For example, making sure that a teacher can only be on the schedule once per semester for a particular class.
Formats the bytes in +number+ into a more understandable representation (e.g., giving it 1500 yields 1.5 KB).
However, we can't replace with each_with_object if the accumulator parameter is assigned to within the block.
If an associated record already exists, the method's behavior depends on the value of the update_only option.
If no content type is registered for the extension, the default type 'application/octet-stream' will be used.
If that is the case, be sure to +html_escape+ or +sanitize+ any user-generated content returned by your JSON.
If the first is specified, the Product class will look for "productid" instead of "id" as the primary column.
If the object responds to +to_partial_path+, then +to_partial_path+ will be called and will provide the path.
If the optional code block is given and the key is not found, pass in the key and return the result of block.
If the relation is the result of a join, you may create a condition which uses any of the tables in the join.
If we find one, we'll encode the String in that encoding, otherwise, we'll use the default external encoding.
If we get no exception here, then either we re-connected successfully, or we never actually got disconnected.
If your environment matches this description and you cannot authenticate, try this rule in your Apache setup:
In that case, we must force an "early" commit: we're about to freeze the headers, so this is our last chance.
Methods can be delegated to instance variables, class variables, or constants by providing them as a symbols:
Paths specified in .rubocop.yml and .rubocop_todo.yml files are relative to the directory where that file is.
Performs an XMLHttpRequest request with the given parameters, mirroring an AJAX request made from JavaScript.
Raised when raw data from the request cannot be parsed by the parser defined for request's content mime type.
Requests that set If-None-Match header may return a 304 Not Modified response if it matches the ETag exactly.
Require the gems listed in Gemfile, including any gems you've limited to :test, :development, or :production.
Returns the current time back to its original state, by removing the stubs added by `travel` and `travel_to`.
The .rubocop.yml file inherits from default.yml where the Include config parameter is set for the rails cops.
The HTML specification says unchecked check boxes are not successful, and thus web browsers do not send them.
The counter cache is incremented when an object of this class is created and decremented when it's destroyed.
The default inflections for pluralization, singularization, and uncountable words are kept in inflections.rb.
The following generated method calls the target exactly once, storing the returned value in a dummy variable.
The real benefit of streaming is on expensive actions that, for example, do a lot of queries on the database.
There can be multiple .rubocop.yml files in subdirectories, but we just look at the current working directory
This formatter displays the list of offended cops with a count of how many offenses of their kind were found.
This is required because Rails looks in load paths and loads the generator just before it's going to be used.
This method requires you to pass a module where all your controllers, helpers and models should be nested to:
We go from right to left because pairs are pushed onto rescue_handlers as rescue_from declarations are found.
We've found that "end" is not aligned with the start node (which can be a block, a variable assignment, etc).
Wraps the array in an +ArrayInquirer+ object, which gives a friendlier way to check its string-like contents.
You can set default values for any of the above headers (except +:date+) by using the ::default class method:
You should consult the documentation for your database to understand the semantics of these different levels:
def test_no_emails assert_no_enqueued_emails ContactMailer.welcome.deliver_later assert_enqueued_emails 1 end
in the options hash creates a form that will allow the unobtrusive JavaScript drivers to modify its behavior.
is computed directly through SQL and does not trigger by itself the instantiation of the actual post records.
requests that set If-None-Match header may return a 304 Not Modified response if it matches the ETag exactly.
* +subject+ * +sender+ * +from+ * +to+ * +cc+ * +bcc+ * +reply-to+ * +orig-date+ * +message-id+ * +references+
+separate_class_name_and_id_with_underscore+ sets whether the method should put '_' between the name and 'id'.
A convenient wrapper for the zlib standard library that allows compression/decompression of strings with gzip.
Active Record allows inheritance by storing the name of the class in a column that is named "type" by default.
Also renames a table's primary key sequence if the sequence name exists and matches the Active Record default.
An instance of this class represents a set of requests and responses performed sequentially by a test process.
As a consequence changes to the database are not seen outside your connection until the operation is complete.
Before each constant is removed a callback is sent to its class/module if it implements +before_remove_const+.
Can be overridden (i.e. in ThroughAssociation) to merge in other scopes (i.e. the through association's scope)
Checks if a signed message could have been generated by signing an object with the +MessageVerifier+'s secret.
Controllers passed in using the +:controller+ option will retain their namespace unless it is an absolute one.
Disconnect all the connections identified by `identifiers` on this server or any others via RemoteConnections.
Divides the array into one or more subarrays based on a delimiting +value+ or the result of an optional block.
Each that is defined will be marked as autoloaded, and will be removed when Dependencies.clear is next called.
Finally, it's also possible to explicitly map the relation between attribute and database integer with a hash:
Finds the first record with the given attributes, or creates a record with the attributes if one is not found:
For more on key-based expiration, see: http://signalvnoise.com/posts/3113-how-key-based-cache-expiration-works
Fragment caching is used for caching various blocks within views without caching the entire action as a whole.
Fred.ddd DEPRECATION WARNING: ddd is deprecated and will be removed from MyGem next-release (use zzz instead).
Fred.eee DEPRECATION WARNING: eee is deprecated and will be removed from MyGem next-release (use zzz instead).
Generates all the attribute related methods for columns in the database accessors, mutators and query methods.
IE versions 4, 5, 5.5, and 6 are all known to have a variety of quirks (especially when downloading over SSL).
If a limit is supplied, returns a substring from the beginning of the string until it reaches the limit value.
If passed an optional +locale+ parameter, the word will be singularized using rules defined for that language.
If the template engine handles encodings, we send the encoded String to the engine without further processing.
If we are inside a Rails application this method performs an exec and thus the rest of this script is not run.
If you need to access the subject, from or the recipients in the view, you can do that through message object:
If you need to do more complex things with a default scope, you can alternatively define it as a class method:
If you need to use dots as part of the +:id+ parameter add a constraint which overrides this restriction, e.g:
If you pass any additional configuration options, they will be passed to the class and available as +options+:
If you use `permit` with just the key that points to the nested attributes hash, it will return an empty hash.
In many cases you will want to wrap the above in another helper, so you could do something like the following:
In order to deploy this code, we should be able to handle any unmasked tokens that we've issued without error.
In order to test those situations, it may be necessary to require another library for the duration of one spec
It is used for keeping separate connection pools for Active Record models that connect to different databases.
It takes raw data from the request and puts it through the parser that is picked based on Content-Type header.
It's also possible to construct multi-dimensional parameter hashes by specifying keys using brackets, such as:
It's extremely important to run the syntax check in a clean environment - otherwise it will be extremely slow.
Layouts are basically just regular templates, but the name of this template needs not be specified statically.
Makes all the (instance) methods in the helper module available to templates rendered through this controller.
Note: depending on your database connector, the result returned by this method may be manually memory managed.
On JRuby and Rubinius, there's a risk that we hang in tokenize() if we don't set the all errors as fatal flag.
One can specify multiple memcached servers, and MemCacheStore will load balance between all available servers.
Other methods, such as `select`, will convert the association to an array and then run the block on the array.
Otherwise, we pass the invalid name forward so the underlying router engine treats it and raises an exception.
Raised when Active Record cannot find database adapter specified in +config/database.yml+ or programmatically.
Since classes don't know their subclasses, we have to build the hierarchy between self and the record's class.
Some ORM systems do not use IDs on nested models so in this case you want to be able to disable the hidden id.
TODO This should be broken apart into AD::Request::Session and probably be included by the session middleware.
The HTML specification says that when a file field is empty, web browsers do not send any value to the server.
The cache responds that it's not valid, which means that new results should normally be collected and saved...
The full request object is available via the request accessor and is primarily used to query for HTTP headers:
The hash method is especially useful when you're receiving the data from somewhere else, like an HTTP request.
This cop checks for circular argument references in optional keyword arguments and optional ordinal arguments.
This cop looks for use of the same name as outer local variables for block arguments or block local variables.
This jar requires that you set a suitable secret for the verification on your app's +secrets.secret_key_base+.
This method is the only valid source of information for anything related to the types of a model's attributes.
This will only complain when the number of variables being assigned matched the number of assigning variables.
Updates the attributes directly in the database issuing an UPDATE SQL statement and sets them in the receiver:
Used in number_to_delimited These are also the defaults for 'currency', 'percentage', 'precision', and 'human'
When parsing the code to see if the AST has changed, a braceless hash would not be parsed as a hash otherwise.
When you alter a template, Rails will check the file's modification time and recompile it in development mode.
class Person include ActiveModel::Validations validates_with MyValidator, my_custom_key: 'my custom value' end
dependencies.rb gives a similar error message but its wording is not as clear because it mentions autoloading.
expires_in 20.minutes expires_in 3.hours, public: true expires_in 3.hours, public: true, must_revalidate: true
the callback will be called for all "sql.active_record" events instrumented during the execution of the block.
...then each key/value pair is treated as a method 'argument' when determining where line breaks should appear.
A hook which allows you to clean up any time, wrongly taken into account in views, like database querying time.
ALTER TABLE "articles" ADD CONSTRAINT fk_rails_e74ce85cbc FOREIGN KEY ("author_id") REFERENCES "authors" ("id")
Accepts an array, or string of SQL conditions and sanitizes them into a valid SQL fragment for an ORDER clause.
Allows you to set all the attributes by passing in a hash of attributes with keys matching the attribute names.
Alternatively, use one of the class macros in `NodePattern::Macros` to define your own pattern-matching method.
But if the app does not use the "Foo" constant we need to be careful not to trigger loading "foo.rb" ourselves.
By default, +test_helper.rb+ will load all of your fixtures into your test database, so this test will succeed.
By default, the +namespace+ and +name+ option will take the namespace and name of the given class respectively.
Checks if the inverse reflection that is returned from the +automatic_inverse_of+ method is a valid reflection.
Conditions can either be specified as a string, array, or hash representing the WHERE-part of an SQL statement.
Converts +self+ to a floating-point number of seconds, including fractional microseconds, since the Unix epoch.
Converts Date to a Time (or DateTime if necessary) with the time portion set to the beginning of the day (0:00)
Defines a class attribute and creates a class and instance writer methods to allow assignment to the attribute.
Deprecation warnings raised by gems are not affected by this setting because they happen before Rails boots up.
Explicitly define as :date column so that returned Oracle DATE values would be typecasted to Date and not Time.
Handles `Max` configuration parameters, especially setting them to an appropriate value with --auto-gen-config.
If using Active Record's time zone support configure the connection to return TIMESTAMP WITH ZONE types in UTC.
If you need to disable this for any reason (e.g. development) then you can use an +:if+ or +:unless+ condition.
In addition to the basic accessors, query methods are also automatically available on the Active Record object.
In rare instances, web servers or front proxies strip authorization headers before they reach your application.
It allows you to collect information about how you want to structure your application paths by a Hash like API.
It makes the table object available to a block that can then add/remove columns, indexes or foreign keys to it.
It's intended that +method+ returns an integer and if that integer is above zero, then the checkbox is checked.
Localization can also be based purely on the translation of the attribute-name (if you are using ActiveRecord):
Now we are going to change the template, but it won't change the returned template since we will hit the cache.
Records loaded through joins with piggy-back attributes will be marked as read only since they cannot be saved.
Returns an Array of all key attributes if any of the attributes is set, whether or not the object is persisted.
Returns the object's date and time as a rational number of seconds since the Epoch (January 1, 1970 00:00 UTC).
Returns the object's date and time as an integer number of seconds since the Epoch (January 1, 1970 00:00 UTC).
Running that line here causes the SHOW TABLES result to be cached so we don't have to do it again in the block.
Setting it to nil is useful to re-enable template lookup overriding a previous configuration set in the parent:
Since only one table is loaded at a time, conditions or orders cannot reference tables other than the main one.
Take control of all existing connections so a "group" action such as reload/disconnect can be performed safely.
The Queue in stdlib's 'thread' could replace this class except stdlib's doesn't support waiting with a timeout.
The capitalization of the first word can be turned off by setting the optional parameter +capitalize+ to false.
The difference is that returns +self+, instead of an array with the deleted objects, so methods can be chained.
The disable comment should not be reported as unnecessary (even if it is) since --only overrides configuration.
The hash should contain a :path with the incoming request path and a :method containing the required HTTP verb.
The target is stale if the target no longer points to the record(s) that the relevant foreign_key(s) refers to.
These describe which attributes to be created on the object, or multiple objects when given an Array of Hashes.
This allows for the detection of queries that return a large number of records, which could cause memory bloat.
This cache is not thread safe and is intended only for serving as a temporary memory cache for a single thread.
This cop checks for ambiguous regexp literals in the first argument of a method invocation without parentheses.
This cop checks for options hashes and discourages them if the current Ruby version supports keyword arguments.
This cop checks how the *when*s of a *case* expression are indented in relation to its *case* or *end* keyword.
This finalizer is needed (and exactly with a proc inside another proc) otherwise templates leak in development.
This method is used to define validations that cannot be corrected by end users and are considered exceptional.
This needs to be an initializer, since it needs to run once per engine and get the engine as a block parameter.
This redirect works by returning an external "302 Moved" HTTP response that takes the user to the index action.
To cause a validation error, you must add to the +record+'s errors directly from within the validators message.
Updates the attributes of the model from the passed-in hash and saves the record, all wrapped in a transaction.
User.order(:name, email: :desc) SELECT "users".* FROM "users" ORDER BY "users"."name" ASC, "users"."email" DESC
Users may also define their own custom types, as long as they respond to the methods defined on the value type.
We must make sure that the reflection's active_record name matches up with the current reflection's klass name.
When you're not sharing any code within the format, you can simplify defining variants using the inline syntax:
YAML.load_file would crash when reading empty .yml files or files that only contained comments and blank lines.
You can also pass in +extras+ with a hash containing URL parameters that would normally be in the query string.
app/views/projects/show.html.erb app/views/projects/show.html+tablet.erb app/views/projects/show.html+phone.erb
approved is a protected attribute, so if mass assignment is used, it won't get updated and will still be false.
* +execute+ which executes the given block on initialization and updates the latest watched files and timestamp.
An entity class such as Customer can easily have two different objects that both have an address on Hyancintvej.
At the time of writing, the only database that supports true nested transactions that we're aware of, is MS-SQL.
At the time of writing, the only database that we're aware of that supports true nested transactions, is MS-SQL.
Be careful because this also means you're initializing a model object with only the fields that you've selected.
Connection pool allows for concurrent (outside the main +synchronize+ section) establishment of new connections.
Converts an array into a string suitable for use as a URL query string, using the given +key+ as the param name.
Delayed::Job (or DJ) encapsulates the common pattern of asynchronously executing longer tasks in the background.
Destroying an associated model, as part of the parent's save action, is as simple as marking it for destruction:
Ensuring that the records in the association target are updated, whether the association is loaded before or not
Extend ActionDispatch middleware stack to make it aware of options allowing the following syntax in controllers:
Extensions can access relevant state using the following methods (where +items+ is the name of the association):
Generate the path indicated by the arguments, and return an array of the keys that were not used to generate it.
If any of the path parameters has an invalid encoding then raise since it's likely to trigger errors further on.
If no arguments are passed to this method, then a new ActiveSupport::Cache::MemoryStore object will be returned.
If the attribute is an association, the associated object is considered absent if it was marked for destruction.
In Rails, this is usually achieved by creating the form using +form_for+ and a number of related helper methods.
In general, this means that templates will be UTF-8 inside of Rails, regardless of the original source encoding.
In these cases, you can mix ERB in with your YAML fixtures to create a bunch of fixtures for load testing, like:
Internally we use column number that start at 0, but when outputting column numbers, we want them to start at 1.
It can be used to retrieve all kinds of naming-related information (See ActiveModel::Name for more information).
It provides access to parent nodes and an object-oriented way to traverse an AST with the power of `Enumerable`.
It's the extra spaces between the keys and values in a hash, since those are handled by the Style/AlignHash cop.
Lean on the protect_from_forgery declaration to mark which actions are due for same-origin request verification.
Make sure your actions are thread safe, and this shouldn't be a problem (don't share state across threads, etc).
Methods will be added for retrieval and query for a single associated object, for which this object holds an id:
Most methods expect a +number+ argument, and will return it unchanged if can't be converted into a valid number.
NOTE: This validation will not fail while using it with an association if the latter was assigned but not valid.
Note that some of the migrations may be skipped if a migration with the same name already exists in application.
Note: The old instance's sti column value will be changed too, as both objects share the same set of attributes.
Provides general behavior that will be included into every Active Job object that inherits from ActiveJob::Base.
RecordIdentifier encapsulates methods used by various ActionView helpers to associate records with DOM elements.
Return a basic hash of statistics for the connection keyed with `identifier`, `started_at`, and `subscriptions`.
Returns a new DateTime where one or more of the elements have been changed according to the +options+ parameter.
Ruby 2.0 will have type send every time, and "send nil" if it is calling itself with a specified "self" receiver
Send the missing method to +time+ instance, and wrap result in a new TimeWithZone with the existing +time_zone+.
Setting this is useful when you want delivery notifications sent to a different address than the one in +:from+.
So, to dup an arbitrary object you normally use an optimistic approach and are ready to catch an exception, say:
The +extras+ hash allows you to specify options that would normally be provided as a query string to the action.
The +size+ method is the one that takes the loaded flag into account and delegates to +count_records+ if needed.
The Connection itself does not deal with any specific application logic beyond authentication and authorization.
The classic example is the use of a header and footer (even though the Action Pack-way would be to use Layouts):
The default includes both 'controller' and 'action' because they are added by Rails and should be of no concern.
There are several connection-pooling-related options that you can add to your database connection configuration:
These methods will be included into any Active Job object, adding callbacks for +perform+ and +enqueue+ methods.
This class is used to create a table that keeps track of which migrations have been applied to a given database.
This cop identifies Float literals which are, like, really really really really really really really really big.
This cop identifies places where a case-insensitive string comparison can better be implemented using `casecmp`.
This is required for Oracle and is useful for any database which relies on sequences for primary key generation.
This is useful when adding new counter caches, or if the counter has been corrupted or modified directly by SQL.
This method breaks on the first whitespace character that does not exceed +line_width+ (which is 80 by default).
This method uses the memcached decr atomic operator and can only be used on values written with the :raw option.
This method uses the memcached incr atomic operator and can only be used on values written with the :raw option.
This middleware is responsible for logging exceptions and showing a debugging page in case the request is local.
This must be done after the options have already been processed, because they can affect how ConfigStore behaves
This will execute one query to load the addresses and load the addressables with one query per addressable type.
Two of these symbols are special, +:controller+ maps to the controller and +:action+ to the controller's action.
Unlike subclasses of ActionController::Base, channels do not follow a RESTful constraint form for their actions.
When EnforcedStyle is 'flexible' then only 'Date.today' is prohibited and only 'to_time' is reported as warning.
When correcting nested offenses, we need to keep track of how much we have adjusted the indentation of each line
You simply supply the +up+ logic, and the Migration system figures out how to execute the down commands for you.
rails g controller foo/bar/baz index Will generate - namespace :foo do namespace :bar do get 'baz/index' end end
validates_numericality_of: generate_message(attr_name, :not_a_number, value: raw_value, message: custom_message)
:nodoc: Pretty prints the result of an EXPLAIN QUERY PLAN in a way that resembles the output of the SQLite shell:
ALTER TABLE "articles" ADD CONSTRAINT fk_rails_58ca3d3a82 FOREIGN KEY ("author_id") REFERENCES "users" ("lng_id")
ActionController::TestCase will also automatically provide the following instance variables for use in the tests:
Any path parameter implicitly used by +url_for+ can always be overwritten like shown on the last +url_for+ calls.
Attributes listed as readonly will be used to create a new record but update operations will ignore these fields.
Be aware, though, that the objects will _not_ have their instance data returned to their pre-transactional state.
Check response freshness (Last-Modified and ETag) against request If-Modified-Since and If-None-Match conditions.
Currently, when an exception happens in development or production, Rails will automatically stream to the client:
Don't check unneeded disable if --only or --except option is given, because these options override configuration.
For example when this middleware receives a 500 response it will render the template found in `/public/500.html`.
For example, "rails:model" should be searched in both: "rails/model/model_generator" and "rails/model_generator".
For example, suppose that two users try to post a Comment at the same time, and a Comment's title must be unique.
However, if a block has been passed, that block will be passed the key and executed in the event of a cache miss.
If the database adapter supports DDL transactions, all migrations will automatically be wrapped in a transaction.
In other words, if the Jaro distance is less than this value, JaroWinkler.distance returns the raw Jaro distance.
In the above example, the configuration from the first application was used to initialize the second application.
In this example, the :iphone format will be used if it's available, otherwise it'll fallback to the :html format.
Invokes Journey::Router::Utils.normalize_path and ensure that (:locale) becomes (/:locale) instead of /(:locale).
Keep in mind that all session-oriented requests should be CSRF protected, including JavaScript and HTML requests.
MemCacheStore implements the Strategy::LocalCache strategy which implements an in-memory cache inside of a block.
NOTE: The returned records may not be in the same order as the ids you provide since database rows are unordered.
New values can be assigned to the value object using either another +NetAddr::CIDR+ object, a string or an array.
Pluck returns an Array of attribute values type-casted to match the plucked column names, if they can be deduced.
Prepend a hidden field to make sure something will be sent back to the server if all radio buttons are unchecked.
Search the non-excluded top directories, but also add files on the top level, which would otherwise not be found.
See: http://www.sqlite.org/lang_altertable.html SQLite has an additional restriction on the ALTER TABLE statement
Sends any runner called in the instance of a new application up to the +runner+ method defined in Rails::Railtie.
Setting it to +true+ will _always_ save the members, whereas setting it to +false+ will _never_ save the members.
Subtracts an interval of time from the current object's time and returns the result as a new TimeWithZone object.
Test case for bug which would emit an "object" attribute when used with form_for using a search_field form helper
The `elsif` node will get an `on_if` call from the framework later, but we're done here, so we set it to ignored.
The callback objects have methods named after the callback called with the record as the only parameter, such as:
The disable comment should not be reported as unnecessary (even if it is) since --except overrides configuration.
The object is instantiated first, therefore all callbacks and filters are fired off before the object is deleted.
This allows the user to submit a form page more than once with the expected results of creating multiple records.
This cop checks the indentation of the right hand side operand in binary operations that span more than one line.
This formatter displays the list of offensive files, sorted by number of offenses with the worst offenders first.
This is done by either returning and leasing existing connection, or by creating a new connection and leasing it.
This makes it possible to store arrays, hashes, and other non-mappable objects without doing any additional work.
This needs to happen before eager load so it happens in exactly the same point regardless of config.cache_classes
Useful when you have an object that may need multiple spots to transmit to a specific broadcasting over and over.
We override this in the sqlite3 and postgresql adapters to use only the column name (as per syntax requirements).
You can also call try with a block without accepting an argument, and the block will be instance_eval'ed instead:
You can then declare accessors to this store that are then accessible just like any other attribute of the model.
You may also set a +:reject_if+ proc to silently ignore any new record hashes if they fail to pass your criteria.
You should be sure to measure your actual performance across targeted browsers both before and after this change.
`ActiveRecord` compatibility: `ActiveRecord` does not implement a `detect` method and `find` has its own meaning.
assert_redirected_to "http://test.host/action_pack_assertions/foo" would pass because of exact match early return
define_model_callbacks accepts the same options +define_callbacks+ does, in case you want to overwrite a default.
-- An instance of FixtureSet is normally stored in a single YAML file and possibly in a folder with the same name.
@example good if condition statement else the content of the else branch will be determined by Style/EmptyElse end
Accepts an array, hash, or string of SQL conditions and sanitizes them into a valid SQL fragment for a SET clause.
Alternatively, you can use named placeholders in the template, and pass a hash as the second element of the array.
Deletes the +records+ supplied from the collection according to the strategy specified by the +:dependent+ option.
Every time after an action is processed, this method is invoked with the payload, so you can add more information.
Force a row to have a JSON "null" instead of a database NULL (this is how null values are saved on 4.1 and before)
Make sure that you declare the database column used for the serialized store as a text, so there's plenty of room.
NOTE: If you are going to iterate through each record, you should call each_record on the yielded BatchEnumerator:
NOTE: the JoinDependency constructed here needs to know about any joins already present in `self`, so pass them in
Note also that destroying a record preserves its ID in the model instance, so deleted models are still comparable.
Override AbstractController::Base's process_action to run the process_action callbacks around the normal behavior.
Passing +true+ will forcibly tidy all bytes, assuming that the string's encoding is entirely CP1252 or ISO-8859-1.
Return a single connection identifier that combines the value of all the registered identifiers into a single gid.
Returns a select tag with options for each of the months January through December with the current month selected.
Similarly, a simple hash without a statement will generate conditions based on equality with the SQL AND operator.
Sometimes you'll have exceptions where one action wants to use a different layout than the rest of the controller.
The --no-color CLI option sets `color: false` so we don't want the `no_color` key, which is created automatically.
The `:force` option is useful when you're calling some other method to ask whether you should force a cache write.
The following example finds all customers with +balance_amount+ equal to 20 and +balance_currency+ equal to "USD":
The hash must have directories as keys and the value is an array of extensions to be watched under that directory.
This method finds record by its primary key (which could be assigned manually) and modifies the receiver in-place:
This migration will add a boolean flag to the accounts table and remove it if you're backing out of the migration.
This should not be used on variable length plaintext strings because it could leak length info via timing attacks.
This way, the client either sends only the hidden field (representing the check box is unchecked), or both fields.
To ensure entries fit within the specified memory prune the cache by removing the least recently accessed entries.
To use engine's migrations in application you can use the rake task below, which copies them to application's dir:
When the entirety of +activerecord/lib/active_record/base.rb+ has been evaluated then +run_load_hooks+ is invoked.
When using a regular expression based replacement, the normal humanize formatting is called after the replacement.
You can create values for the "min" and "max" attributes by passing instances of Date or Time to the options hash.
You can inspect the +attribute+ property of the exception object to determine which attribute triggered the error.
You can pass +Fixnum+ or +String+ values, it finds the records responding to the +id+ and executes delete on them.
ZERO-WIDTH NO-BREAK SPACE aka BOM Returns a regular expression pattern that matches the passed Unicode codepoints.
empty method not used anywhere to ensure methods like `status` and `location` aren't called on `redirect_to` calls
sqlite3 databases should be able to support any type and not just the ones mentioned in the native_database_types.
this cop does not handle spaces after a ternary operator, which are instead handled by Style/SpaceAroundOperators.
+identifier+ is a 10 character long string which is deterministically generated from the +from_table+ and +column+.
A tricky special case where the closing brace of the interpolation risks getting confused for a hash literal brace.
ActionController::Renderer allows to render arbitrary templates without requirement of being in controller actions.
Another round of inspection will be done, and any other offenses will be caught then, so we don't need to continue.
Association with autosave option defines several callbacks on your model (before_save, after_create, after_update).
Both correct and incorrect code has been found in relation to EnforcedStyleForEmptyBraces, but that doesn't matter.
Checks for empty else-clauses, possibly including comments and/or an explicit `nil` depending on the EnforcedStyle.
Create a Rails::Generators::GeneratedAttribute by supplying the attribute type and, optionally, the attribute name:
FIXME: We are avoiding to use alias because a bug on thor that make this method public and add it to the task list.
For now, action_controller must always be present with rails, so let's make sure that it gets required before here.
If so, we don't check it because there could be good reasons why it needs to end with a certain number of newlines.
If you're on MySQL, then do not use DDL operations in nested transactions blocks that are emulated with savepoints.
It's strange if interpolation syntax appears inside a static string, but we can't be sure if it's a mistake or not.
Note: It is possible for this value to match multiple options as you might have the same option in multiple groups.
Now we are going to change the template, but it won't change the returned template since the timestamp is the same.
One query for columns (delete_me table) One query for primary key (delete_me table) One query to do the bulk change
Oracle adapter uses prefetched primary key values from sequence and passes them to connection adapter insert method
Override this method if you wish to change how action methods are called, not to add additional behavior around it.
Raised when adapter not specified on connection (or configuration file +config/database.yml+ misses adapter field).
Raises ActiveRecord::AssociationTypeMismatch unless +record+ is of the kind of the class of the associated objects.
Register a record with the current transaction so that its after_commit and after_rollback callbacks can be called.
Returns true if the given node is within another node that has already been marked for auto-correction by this cop.
Returns true if there are any active connections among the connection pools that the ConnectionHandler is managing.
Sends any console called in the instance of a new application up to the +console+ method defined in Rails::Railtie.
The abstract adapter is used simply to bypass the bit of code that checks that the adapter file can be required in.
The check are based on the presence of flow of control statement in non-final position in *begin*(implicit) blocks.
The closing brace of a multi-line method definition must be on the line after the last parameter of the definition.
The example above will create a test framework option and will invoke a generator based on the user supplied value.
The method reference callbacks work by specifying a protected or private method available in the object, like this:
This feature is implemented by keeping a connection pool in ActiveRecord::Base that is a hash indexed by the class.
This is based on the Highline implementation and will automatically append CLEAR to the end of the returned String.
This will render the partial "advertisement/_ad.html.erb" regardless of which controller this is being called from.
We can't simply check the first line of the backtrace, because JRuby reports the call to __send__ in the backtrace.
You can mix and match any combination of symbols, arrays, and hashes to retrieve the associations you want to load.
errors from Marshal or YAML Object couldn't be dumped, perhaps because of singleton methods -- this is the fallback
if it doesn't properly say DROP TEMPORARY TABLE, the transaction commit will complain that no transaction is active
- However, if +:requires_new+ is set, the block will be wrapped in a database savepoint acting as a sub-transaction.
-- Implementation constraint: a newly established connection returned by this method must be in the +.leased+ state.
2) The client passed one of +Client-Ip+ or +X-Forwarded-For+ (whichever the proxy servers weren't using) themselves.
:nodoc: Overwrite this factory method for redis connections if you want to use a different Redis library than Redis.
AST: (begin (lvasgn :instance (send (const nil :Object) :new)) (sclass (lvar :instance) (begin (lvasgn :foo (int 1))
Add a constraint for wildcard route to make it non-greedy and match the optional format part of the route by default
Adds a new delivery method through the given class using the given symbol as alias and the default options supplied.
All the caching stores from ActiveSupport::Cache are available to be used as backends for Action Controller caching.
Allows you to change a previously set where condition for a given attribute, instead of appending to that condition.
Always wrap the outermost handler to invoke the user handler on the worker pool rather than blocking the event loop.
Common parameters are parameters that are not in the default configuration, but are nonetheless allowed for any cop.
Composed of Time, and hash of Time with secret key from the Rails session secret generated upon creation of project.
Create a url helper allowing ordered parameters to be associated with corresponding dynamic segments, so you can do:
Evaluating many similar methods may use more memory as the instruction sequences are duplicated and cached (in MRI).
Executes the SQL statement in the context of this connection and returns the raw result from the connection adapter.
Finally, an object which responds to call can be supplied to redirect, allowing you to reuse common redirect routes.
For many resources, loose upgrades are sufficient: if a thread is awaiting a lock, it is not running any other code.
Given a collection of Pathname objects returns the longest subpath common to all of them, or +nil+ if there is none.
Given an ordering of datetime components, create the selection HTML and join them with their appropriate separators.
Helpers::FormOptions can be used to create common select boxes such as countries, time zones, or associated records.
If no addresses are specified, then MemCacheStore will connect to localhost port 11211 (the default memcached port).
If no such connection exists checkout a connection, yield it to the block, and checkin the connection when finished.
If the table name is not prefixed with a schema, the database will take the first match from the schema search path.
If these requires were at the top of the file the constant would not be defined by the time their files were loaded.
If you want to share just a few specific helpers you can add them to application's helpers in ApplicationController:
If you want to use another serialization method, you can set the serializer in the options hash upon initialization:
In order to use this module, all you need is to implement view_renderer that returns an ActionView::Renderer object.
It accepts limit in the form of symbol, proc, or number-like object (anything that can be compared with an integer).
It is important we are consistent with how we generate this so that exclusive locking works across migrator versions
Mark a key as being a connection identifier index that can then be used to find the specific connection again later.
May be overridden to add instrumentation, logging, specialized error handling, or other forms of handler decoration.
Note that partials are not supported to be rendered with streaming, so in such cases, we just wrap them in an array.
Only one constraint option can be used at a time apart from +:minimum+ and +:maximum+ that can be combined together:
Optimization to quickly decide if the given file is hidden (on the top level) and can not be matched by any pattern.
Otherwise, transaction will raise exceptions when it tries to release the already-automatically-released savepoints:
Please note *this method is not atomic*, it runs first a SELECT, and if there are no results an INSERT is attempted.
Queue: The adapter can set the priority for job queues, when setting a queue with Active Job this will be respected.
Returns true or false depending on whether the proc is contained in the before_save callback chain on a Topic model.
Saving of the parent, its associations, and the destruction of marked associations, all happen inside a transaction.
Secure cookies: Sets the `secure` flag on cookies to tell browsers they mustn't be sent along with http:// requests.
Sets the default value for Time.zone If assigned value cannot be matched to a TimeZone, an exception will be raised.
Shortcut helper that returns all the modules included in ActionController::Base except the ones passed as arguments:
The latter is used to set the parameter as permitted and limit which attributes should be allowed for mass updating.
The row is simply removed with an SQL +DELETE+ statement on the record's primary key, and no callbacks are executed.
The session should not be used, however, as a cache for objects where it's likely they could be changed unknowingly.
This allows you to create forms that set or change the attributes of a parent object and its associations in one go.
This is necessary because `changed_attributes` might be overridden in other implementations (e.g. in `ActiveRecord`)
This will generate the +exciting_path+ and +exciting_url+ helpers which can be used to navigate to this mounted app.
To allow proxies to cache the response, set +true+ to indicate that they can serve the cached response to all users.
Trigger i18n config before any eager loading has happened so it's ready if any classes require it when eager loaded.
Turns a number into an ordinal string used to denote the position in an ordered sequence such as 1st, 2nd, 3rd, 4th.
We need to store the RAILS_DEV_PATH in a constant, otherwise the path can change in Ruby 1.8.7 when we FileUtils.cd.
Week is assumed to start on +start_day+, default is +Date.beginning_of_week+ or +config.beginning_of_week+ when set.
You can also simulate POST, PATCH, PUT, DELETE, and HEAD requests with +post+, +patch+, +put+, +delete+, and +head+.
You can debug this situation by logging all environment variables, and check for HTTP_AUTHORIZATION, amongst others.
added initialization of author_email_address in the same way as in Topic class as otherwise synonym test was failing
aliased to avoid conflicts with an asset_path named route Computes the full URL to an asset in the public directory.
custom create table, uses execute on connection to create a table, note: escapes table_name, does NOT escape columns
def with_optimistic_retry begin yield rescue ActiveRecord::StaleObjectError begin Reload lock_version in particular.
femto: Quadrillionth pico: Trillionth nano: Billionth micro: Millionth mili: Thousandth centi: Hundredth deci: Tenth
form_tag('http://far.away.com/form', authenticity_token: "cf50faa3fe97702ca1ae") form with custom authenticity token
support for highlighting, but needs support for the very non-standard "code fences with line highlights" extension).
the helpers are made protected by default--we make them public for easier access during testing and troubleshooting.
Anything with a scope can additionally ruin our attempt at finding an inverse, so we exclude reflections with scopes.
Before changes, the floating point numbers will be interpreted as table names and will cause this to run in one query
By default, this makes all database statements in the nested transaction block become part of the parent transaction.
CDATA sections are used to escape blocks of text containing characters which would otherwise be recognized as markup.
Check whether a run created source identical to a previous run, which means that we definitely have an infinite loop.
Do it a few times: the resulting headers should be identical no matter how many times you send with the same options.
For example if all the addressables are either of class Person or Company then a total of 3 queries will be executed.
For example, actions that could result in the rendering of different templates will use the manual rendering methods:
For example, if we have a +User+ model with +category_ids+ field and we have the following code in our update action:
If brackets are on different lines and there is one item at least, then comma is needed anytime for consistent_comma.
If the channel is in a namespace, then the namespaces are represented by single colon separators in the channel name.
If the node matches, and no block is provided, the new method will return the captures, or `true` if there were none.
If you want to delete many rows quickly, without concern for their associations or callbacks, use delete_all instead.
In a chain of method calls, we regard the top send node as the base for indentation of all lines following the first.
In most cases, fetching large number of records can be performed efficiently using the ActiveRecord::Batches methods.
IrreversibleOrderError is raised when a relation's order is too complex for +reverse_order+ to automatically reverse.
It also uses the more advanced +create_table+ syntax where you can specify a complete table schema in one block call.
It's difficult to imagine that anybody would want empty lines around a method body, so we don't make it configurable.
Notice that the first argument is the method to be dispatched which is *not* necessarily the same as the action name.
Offenses are signaled only on assignment to class variables to reduced the number of offenses that would be reported.
One reason you may wish to call this method explicitly is between queries that ask the database to randomize results.
ProcessedSource contains objects which are generated by Parser and other information such as disabled lines for cops.
Removes the cookie on the client machine by setting the value to an empty string and the expiration date in the past.
Returns an ActiveSupport::TimeWithZone instance representing the current time in the time zone represented by +self+.
Returns the object's date and time as a floating point number of seconds since the Epoch (January 1, 1970 00:00 UTC).
Sets the name of the wrapper key, or the model which +ParamsWrapper+ would use to determine the attribute names from.
Since Active Record can figure out the ID of any fixture from its label, you can specify FK's by label instead of ID.
The acronym, however, must occur as a delimited unit and not be part of another word for conversions to recognize it:
The advantages of Qu are: Multiple backends (redis, mongo), jobs are requeued when worker is killed, resque-like API.
The closing brace of a multi-line method definition must be on the same line as the last parameter of the definition.
The difference to the default template method is that the migration version is appended to the destination file name.
The hash will automatically be wrapped in a JSON envelope with the proper channel identifier marked as the recipient.
This can also be used to "borrow" the connection to do database work unrelated to any of the specific Active Records.
This cop checks for the use of a method, the result of which would be a literal, like an empty array, hash or string.
This is because cookies signed based on the new secret_key_base in Rails 4 are not backwards compatible with Rails 3.
This is useful for adding new finders, creators and other factory-type methods to be used as part of the association.
This test is testing 3 things: render :file in AV      :ported: render :template in AC  :ported: setting content type
Tries to get the description from a USAGE file one folder above the source root otherwise uses a default description.
Unless the join table is explicitly specified as an option, it is guessed using the lexical order of the class names.
checking if there are topics is used before you actually display them, thus it shouldn't invoke an extra count query.
module CustomDsl def browses_site get "/products/all" assert_response :success assert_select 'h1', 'Products' end end
once we have already warned about a certain modifier, don't warn again even if it is never applied to any method defs
testing against to_s(:db) representation because either a Time or a DateTime might be returned, depending on platform
when routes are inside application class definition they should not be reloaded when engine's routes file has changed
Although the usage and purpose of +fields_for+ is similar to +form_for+'s, its method signature is slightly different.
Attributes are reloaded from the database, and caches busted, in particular the associations cache and the QueryCache.
AutosaveAssociation is a module that takes care of automatically saving associated records when their parent is saved.
Check if a cached fragment from the location signified by +key+ exists (see +expire_fragment+ for acceptable formats).
Common functionality for checking whether an AST node/token is aligned with something on a preceding or following line
Connections in the pool are actually AbstractAdapter objects (or objects compatible with AbstractAdapter's interface).
Determines if the primary key values should be selected from their corresponding sequence before the insert statement.
Encapsulates the pattern of wanting to validate the acceptance of a terms of service check box (or similar agreement).
However, sometimes you want to isolate your engine from the application, especially if your engine has its own router.
If errors are present, the method should return an array of strings that are the errors for the attribute in question.
If not, the mailer will remain uninitialized (useful when you only need to invoke the "receive" method, for instance).
If the process regenerating the entry errors out, the entry will be regenerated after the specified number of seconds.
If the various assert methods are not sufficient, then you may use this object to inspect the HTTP response in detail.
If they want JavaScript, then it is an Ajax request and we render the JavaScript template associated with this action.
If you care about that, then you need to explicitly drop or ignore those headers sometime before this middleware runs.
If you care to define how to move up and down in these cases, you should define the +up+ and +down+ methods as before.
If you want to associate with a class in another module scope, this can be done by specifying the complete class name.
It basically delegates to other objects like TemplateRenderer and PartialRenderer which actually renders the template.
It is an object with defined null behavior and always returns an empty array of records without querying the database.
Note that the validator is initialized only once for the whole application life cycle, and not on each validation run.
Override this method in subclasses with validation logic, adding errors to the records +errors+ array where necessary.
Plugins and extensions can override this method to point to custom assets or generate digested paths or query strings.
Rack::Sendfile will usually intercept the response and uses the path directly, so there is no reason to open the file.
Returns the source lines, line break characters removed, excluding a possible __END__ and everything that comes after.
Returns true if the record is persisted, i.e. it's not a new record and it was not destroyed, otherwise returns false.
See the mapping rules in table_name and the full example in link:files/activerecord/README_rdoc.html for more insight.
Sometimes you want to alternate layouts depending on runtime information, such as whether someone is logged in or not.
TODO: if constant name has cbase (leading ::), then we don't need to keep traversing up through nested classes/modules
TODO: once the offset argument is removed from find_nth, find_nth_with_limit_and_offset can be merged into this method
Templates can share variables amongst themselves by using instance variables defined using the regular embedding tags.
The +:path+, +:as+, +:module+, +:shallow_path+ and +:shallow_prefix+ options all default to the name of the namespace.
The Date Helper primarily creates select/option tags for different kinds of dates and times or date and time elements.
The block version of redirect allows for the easy encapsulation of any logic associated with the redirect in question.
The capitalization of the first word can be turned off by setting the +:capitalize+ option to false (default is true).
The reason it can't be implemented as a normal cop is that it depends on the results of all other cops to do its work.
This class handles the processing of files, which includes dealing with formatters and letting cops inspect the files.
This class is used to dump the database schema for some connection to some output format (i.e., ActiveRecord::Schema).
This is done by calling new on the column type or aggregation type (through composed_of) object with these parameters.
This method is abstract in the sense that it relies on +count_records+, which is a method descendants have to provide.
This method is abstract in the sense that it relies on +find_target+, which is expected to be provided by descendants.
To test query strings you must use the extras argument, appending the query string on the path directly will not work.
Usually there will be carriage return characters on all or none of the lines in a file, so we report only one offense.
We go back to the connection for the column queries because Topic.columns is cached and won't report changes to the DB
def self.authenticate_safely_simply(user_name, password) where(user_name: user_name, password: password).first end end
don't play me." validates_length_of :words_in_essay, minimum: 100, too_short: 'Your essay must be at least 100 words.'
validates_with MyValidator validates_with OtherValidator, on: :create validates_with StrictValidator, strict: true end
'match' is a fairly generic name, so we don't flag it unless we see a string or regexp literal on one side or the other
:nodoc: Optimize range sum to use arithmetic progression if a block is not given and we have a range of numeric values.
All database statements that happen within the block are effectively appended to the already open database transaction.
Any class that inherits from ActiveModel::Validator must implement a method called +validate+ which accepts a +record+.
As such, changes to `time_zone_aware_attributes`, or `skip_time_zone_conversion_for_attributes` would not be picked up.
By default, +model+ is the ActiveSupport::TimeZone constant (which can be obtained in Active Record as a value object).
Caching results when a cop has crashed would prevent the crash in the next run, since the cop would not be called then.
Destroying one of the associated models as part of the parent's save action is as simple as marking it for destruction:
Each class that subclasses +AbstractRenderer+ is used by the base +Renderer+ class to render a specific type of object.
For example, if you want to check for +uniqueness+ with +hstore+ you will need to use a custom validation to handle it.
If +:only+ or +:except+ are used, convert the options into the +:if+ and +:unless+ options of ActiveSupport::Callbacks.
If the source is not valid UTF-8, we raise an exception when the template is compiled to alert the user to the problem.
It creates and returns an instance of the ActiveSupport::Multibyte::Chars class which encapsulates the original string.
It will affect the priority of loading views, helpers, assets and all the other files related to engine or application.
It will be aware when to stop rendering the layout because it needs to search something in the template and vice-versa.
It will be treated as String." To take full advantage of composite types, we suggest you register your own +OID::Type+.
Note: Updating a large number of records will run an UPDATE query for each record, which may cause a performance issue.
Otherwise it's difficult to distinguish between space missing to the left and to the right of the brace in autocorrect.
Otherwise, it always hits the resolver but if the key is present, check if the resolver is fresher before returning it.
Overwrite this factory method for Redis connections if you want to use a different Redis connection library than Redis.
Passes the record off to the class or classes specified and allows them to add errors based on more complex conditions.
Prepending an underscore to mark an unused parameter is allowed, so we remove any leading underscores before comparing.
Put Rails as the first plugin minitest initializes so other plugins can override or replace our default reporter setup.
Return an array of railties respecting the order they're loaded and the order specified by the +railties_order+ config.
Returns true if there's a chance that an Include pattern matches hidden files, false if that's definitely not possible.
Ship has a conventionally named `treasures_count` column, but the counter_cache option is not given on the association.
Since we're processing the view in a different thread, copy the thread locals from the main thread to the child thread.
That's done by replacing the question marks with symbols and supplying a hash with values for the matching symbol keys:
The connection pool is "fair" if threads waiting for connections receive them in the order in which they began waiting.
The elements will be delimited by slashes, and the elements within a Hash will be sorted by key so they are consistent.
The key of the hashes should be directories and the values should be an array of extensions to match in each directory.
The method has no block comment inside, but it's within a class that has a block comment, so it's not corrected either.
The typical route is to just dump everything in a monolithic class, perhaps with a comment, as a least-bad alternative.
There is a known issue with the listen tests that causes files to be incorrectly GC'ed even when they are still in-use.
These predicates are not documented, as I need to look further into their use, and see if they can be removed entirely.
This cop detects instances of rubocop:disable comments that can be removed without causing any offenses to be reported.
This includes checking whether the database is actually capable of responding, i.e. whether the connection isn't stale.
This is because the incoming XML document (if a web-service request is in process) can only contain a single root-node.
This is testing the decoupling of view renderer and view context by allowing the controller to be used as view context.
This lets Rails applications have a single secure secret, but avoid reusing that key in multiple incompatible contexts.
This method will automatically define a new method for each of the given names, and it will be available in your views.
This method will be removed in Rails 5.1 Since it is only necessary when `active_record_internal_metadatas` could exist
This will be the default behavior for Active Record when used in conjunction with Action Pack's request handling cycle.
To implement, you need to wrap the methods you want callbacks on in a block so that the callbacks get a chance to fire:
Variables defined in the methods of your mailer model are accessible as instance variables in their corresponding view.
We want to generate the methods via module_eval rather than define_method, because define_method is slower on dispatch.
We're obliged to implement this (even though it doesn't actually get called here) to properly comply with the Rack SPEC
When the object is finalized Ruby unlinks the file, so there is no need to clean them with a separate maintenance task.
date_select("article", "written_on", start_year: 1995, use_month_numbers: true, discard_day: true, include_blank: true)
if the current controller is "foo/bar/baz" and controller: "baz/bat" is specified, the controller becomes "foo/baz/bat"
the kernel of the whole test is here, everything else is just scaffolding, this latch will not be released unless conn.
A set of common cases for ActiveModel::Validations message generation that are used to generate tests to keep things DRY
Alternatively, you can pass a String formatted as an ISO8601 datetime with UTC offset as the values for "min" and "max."
Associating new records always saves them Thus, 1 query for the new person record, 1 query for the new join table record
By convention, this could be done by trying to find the defined model that has the same singular name as the controller.
By default this is guessed to be the name of the polymorphic association specified on "as" option with a "_type" suffix.
Checks that exactly one space is used between a method name and the first argument for method calls without parentheses.
Classes that include this module just implement functions to determine what is an offense and how to do auto-correction.
Common functionality for checking if presence/absence of empty lines around some kind of body matches the configuration.
For backwards compatibility the +partial_name_counter+ is still present and is mapped to the iteration's +index+ method.
For example, if you try to update the index of a search engine in +after_save+ the indexer won't see the updated record.
However, that would break proxy farms, where requests from a single user often go through different proxies in the farm.
If it is a Proc, it will be invoked when each key is evaluated so that you can use application logic to invalidate keys.
If the header is accepted from the outside world, we sanitize it to a max of 255 chars and alphanumeric and dashes only.
If the request doesn't match the options provided, the request is considered stale and should be generated from scratch.
If the second parameter is left off, then Dependencies will construct a set of names that the file at +path+ may define.
If the second token is a comment, that means that a line break follows, and that the rules for space inside don't apply.
If you have a stream that is related to a model, then the broadcasting used can be generated from the model and channel.
If your type is only meant to be used with a specific database adapter, you can do so by passing +adapter: :postgresql+.
In the dynamically generated methods below, a call to `super` is used to continue iterating over the children of a node.
It can enforce either the use of the class hash rocket syntax or the use of the newer Ruby 1.9 syntax (when applicable).
Note that new records are different from any other record by definition, unless the other record is the receiver itself.
Prints all annotations with tag +tag+ under the root directories +app+, +config+, +db+, +lib+, and +test+ (recursively).
Returns a new TimeWithZone object that represents the difference between the current object's time and the +other+ time.
Returns a set of HTML select-tags (one for year, month, day, hour, minute, and second) pre-selected with the +datetime+.
Since the association adds a method with that name to its model, it will override the inherited method and break things.
Test numeric difference between the return value of an expression as a result of what is evaluated in the yielded block.
That said, when streaming, you need to properly check your templates and choose when to use +provide+ and +content_for+.
The JSON gem adds a few modules to Ruby core classes containing :to_json definition, overwriting their default behavior.
The `as` option sets the format to JSON, sets the content type to 'application/json' and encodes the parameters as JSON.
The closure created by the matcher would otherwise evaluate for `ActiveRecord::Base`, not the sub class being decorated.
The cop also reports warnings when you are using 'to_time' method, because it doesn't know about Rails time zone either.
The cop is configurable and the enforce the use of older something_filter methods or the newer something_action methods.
This cop checks for cases when you could use a block accepting version of a method that does automatic resource cleanup.
This is an optional header and its presence on the request is subject to browser security settings and user preferences.
This is expected if you have just upgraded to masked tokens, but should stop happening shortly after installing this gem
This method also accepts a block, which will return the current time back to its original state at the end of the block:
This module provides an internal implementation to track descendants which is faster than iterating through ObjectSpace.
This variable tracks the number of threads currently in the process of independently establishing connections to the DB.
Use :all to dump all schemas regardless of schema_search_path, or a string of comma separated schemas for a custom list.
Useful for defining methods on associations, especially when they should be shared between multiple association objects.
Validates whether the value of the specified attribute is of the correct form, going by the regular expression provided.
When a new record comes to match the query, or any of the existing records is updated or deleted, the cache key changes.
When an object is specified as a key and has a +cache_key+ method defined, this method will be called to define the key.
Whenever you provide I18n.locale during a request, it will trigger the lookup_context and consequently expire the cache.
You can pass local variables to sub templates by using a hash with the variable names as keys and the objects as values:
* +:bcc+ - Who you would like to Blind-Carbon-Copy on this email, can be a string of addresses, or an array of addresses.
Active Record associations can be used to describe one-to-one, one-to-many and many-to-many relationships between models.
For example, +Post.all+ may return Comments, Messages, and Emails by storing the record's subclass in a +type+ attribute.
For example, if you are attempting to get the current_scope for the +Board+ model, then you would use the following code:
If it's set to `start_of_line`, the `end` shall be aligned with the start of the line where the matching keyword appears.
If it's set to `variable` the `end` shall be aligned with the left-hand-side of the variable assignment, if there is one.
If so, the watched and/or updated_at values are cached until the block is executed via +execute+ or +execute_if_updated+.
If the target is +nil+ and does not respond to the delegated method a +NoMethodError+ is raised, as with any other value.
If you choose to name the composition the same as the attribute's name, it will be the only way to access that attribute.
If you specify a symbol, that attribute will be updated with the current time in addition to the updated_at/on attribute.
Logs a "PostsControllerTest: test name" heading before each test to make test.log easier to search and follow along with.
Mounts a regular expression, returned as a string to ease interpolation, that will match part by part the given constant.
Note that building your own string from user input may expose your application to injection attacks if not done properly.
Once a mailer action and template are defined, you can deliver your message or defer its creation and delivery for later:
Only goes :through once, but the through_reflection is a has_and_belongs_to_many, so this is a nested through association
Please note that sanitizing user-provided text does not guarantee that the resulting markup is valid or even well-formed.
Rails 5.0 introduced this config option so that apps made with earlier versions of Rails are not affected when upgrading.
Rails.application.routes.draw do Pattern 1 tells some request to go to one place Pattern 2 tell them to go to another ...
Records are instantiated and it invokes +before_remove+, +after_remove+ , +before_destroy+ and +after_destroy+ callbacks.
Sends any generators called in the instance of a new application up to the +generators+ method defined in Rails::Railtie.
Set the form builder to be used as the default for all forms in the views rendered by this controller and its subclasses.
Sets the attribute used for single table inheritance to this class name if this is not the ActiveRecord::Base descendant.
Several different Configs can be used during a run of the rubocop program, if files in several directories are inspected.
The +checked_value+ defaults to 1 while the default +unchecked_value+ is set to 0 which is convenient for boolean values.
The chain starts with the target table, but we want to end with it here (makes more sense in this context), so we reverse
The latter method iterates through an array doing regular expression matches, which results in a lot of object creations.
The order in which mappings are defined determines the order in which attributes are sent to the value class constructor.
The phrase "Updating salaries..." would then be printed, along with the benchmark for the block when the block completes.
The returned value from this method should be a +String+, +Numeric+, +Date+, +Time+, +Symbol+, +true+, +false+, or +nil+.
These are originated by a legit usage of attr_* macros for private attributes, but adds a lot of noise to our test suite.
This is for a case where the original String was assumed to be, for instance, UTF-8, but a magic comment proved otherwise
This is the "has_many :tags, through: :taggings" situation, where the join model typically has a belongs_to on both side.
This matches normal Ruby method inheritance: think of writing an attribute on a subclass as overriding the reader method.
This means that all helpers and named routes from the application will be available to your engine's controllers as well.
This means that as_json won't be invoked and the JSON gem will simply ignore any options it does not natively understand.
This method sets a weak ETag validator on the response so browsers and proxies may cache the response, keyed on the ETag.
Uses Date to provide precise Time calculations for years, months, and days according to the proleptic Gregorian calendar.
Using it, you can change the label and check box display order or even use the label as wrapper, as in the example above.
Using sub templates allows you to sidestep tedious replication and extract common display structures in shared templates.
While this provides the most flexibility, you can also unintentionally introduce dependencies on the underlying database.
class AnotherClass def self.before_create( obj ) obj is the MyModel instance that the callback is being called on end end
concerning :EventTracking do included do has_many :events before_create :track_creation after_destroy :track_deletion end
if a method definition is inside an if, it is very likely that a different definition is used depending on platform, etc.
* The EmployeeController uses the "employee" layout, because it set the layout to nil, resetting the parent configuration.
A request body is not assumed to contain form-data when no Content-Type header is provided and the request_method is POST.
An iteration object will automatically be made available to the template with a name of the form +partial_name_iteration+.
Defines a per-thread class attribute and creates a class and instance writer methods to allow assignment to the attribute.
For AJAX requests other than GETs, extract the "csrf-token" from the meta-tag and send as the  "X-CSRF-Token" HTTP header.
For blocks taking parameters, it checks that the left brace has or doesn't have trailing space depending on configuration.
For example, when you have defined `MyCustomFormatter` in `./path/to/my_custom_formatter.rb`, you would type this command:
GET       /profile/new POST      /profile GET       /profile GET       /profile/edit PATCH/PUT /profile DELETE    /profile
However, the button tag does allow for richer labels such as images and emphasis, so this helper will also accept a block.
If AllCops:DisabledByDefault is true, it changes the Enabled params so that only cops from user configuration are enabled.
If most of your actions use the same layout, it makes perfect sense to define a controller-wide layout as described above.
If nothing is specified, all files will be validated, but you can check just some of them using this environment variable:
If the content is not available and we're inside the layout fiber, then it will begin waiting for the given key and yield.
Implementers can decide to either raise an exception or provide a default in case the record uses a composite primary key.
Incoming messages are then routed to these channel subscriptions based on an identifier sent by the Action Cable consumer.
Note that if some blank-like object were initially passed into the query method, then this method will not raise an error.
Note that if you are working on a guide generation will by default process only that one, so ONLY is rarely used nowadays.
Note that keys are treated differently than HashWithIndifferentAccess, meaning that string and symbol keys will not match.
Note: when using +controller+, the route is simply named after the method you call on the block parameter rather than map.
Notice that no +:id+ parameter was provided to the first +url_for+ call and the helper used the one from the route's path.
Once our chunk of behavior starts pushing the scroll-to-understand-it boundary, we give in and move it to a separate file.
Override this method in subclasses with the validation logic, adding errors to the records +errors+ array where necessary.
Polymorphic URL helpers are methods for smart resolution to a named route call when given an Active Record model instance.
Returns a new Time representing the time a number of seconds ago, this is basically a wrapper around the Numeric extension
Returns the authorization header regardless of whether it was specified directly or through one of the proxy alternatives.
Returns the class descending directly from ActiveRecord::Base, or an abstract class, if any, in the inheritance hierarchy.
Setting the layout to nil forces it to be looked up in the filesystem and fallbacks to the parent behavior if none exists.
Similarly, if any of the +before_remove+ callbacks throw an exception, the object will not be removed from the collection.
Some configuration options like :group make it impossible to do an SQL count, in those cases the array count will be used.
Switch `raise RuntimeError, 'message'` to `raise 'message'`, and `raise RuntimeError.new('message')` to `raise 'message'`.
The job is not sent to the queueing adapter but directly executed by blocking the execution of others until it's finished.
There are multiple TimeZone objects per time zone, in many cases, to make it easier for users to find their own time zone.
This class is used to create a table that keeps track of values and keys such as which environment migrations were run in.
This example will only take money from David and give it to Mary if neither +withdrawal+ nor +deposit+ raise an exception.
This is perfect for browser caching of HTML pages where we don't care about exact equality, just what the user is viewing.
This means a user cannot alter their +user_id+ without knowing your app's secret key, but can easily read their +user_id+.
To continue with the asset example above, suppose there are guest posts and member posts that use the posts table for STI.
To make it work across all web requests, the recommended approach is to add +lock_version+ as a hidden field to your form.
Use the format name as the hash key and either a strftime string or Proc instance that takes a date argument as the value.
Use the format name as the hash key and either a strftime string or Proc instance that takes a time argument as the value.
We basically never want a connection to go stale, as you then can't rely on being able to communicate with the connection.
When a +:return_path+ is specified as header, that value will be used as the 'envelope from' address for the Mail message.
frozen_string_literal: true Force JRuby not to select the current working directory as a temporary directory on Travis CI.
t.change_default(:qualification, 'new') t.change_default(:authorized, 1) t.change_default(:status, from: nil, to: "draft")
"Indent when as deep as case" is the job of another cop, and this is one of the possible styles supported by configuration.
* +counters+ - A Hash containing the names of the fields to update as keys and the amount to update the field by as values.
@example This is interpreted as a method invocation with a regexp literal, but it could possibly be `/` method invocations.
ActionDispatch::Reloader provides prepare and cleanup callbacks, intended to assist with code reloading during development.
Assertion that the numeric result of evaluating an expression is not changed before and after invoking the passed in block.
Be sure to declare +define_attribute_method+ after you define any prefix, suffix or affix method, or they will not hook in.
Besides the overwritable callback methods, it's also possible to register callbacks through the use of the callback macros.
Define a method which recurses over the descendants of an AST node, checking whether any of them match the provided pattern
Files with extension +.builder+, +.rb+, +.rake+, +.yml+, +.yaml+, +.ruby+, +.css+, +.js+ and +.erb+ are taken into account.
If any exception happens inside the exceptions app, this middleware catches the exceptions and returns a FAILSAFE_RESPONSE.
If you're using named routes, they can be easily tested using the original named routes' methods straight in the test case.
In this example archived articles are not being taken into consideration when validating uniqueness of the title attribute:
It takes the names of an old (deprecated) constant and of a new constant (both in string form) and optionally a deprecator.
Make named_routes available in the module singleton as well, so one can do: Rails.application.routes.url_helpers.posts_path
Methods used by multiple fixtures should be defined in a module that is included in ActiveRecord::FixtureSet.context_class.
Please note that if you specify a :domain when setting a cookie, you must also specify the domain when deleting the cookie:
Returns a jar that'll automatically encrypt cookie values before sending them to the client and will decrypt them for read.
Returns a new relation, which is the result of filtering the current relation according to the conditions in the arguments.
Second, we rely on the fact that the WebSocket connection is established with the cookies from the domain being sent along.
Specifically, since the string is passed in the header lines as a quoted string, the double-quote character is not allowed.
Splits or iterates over the array in +number+ of groups, padding any remaining slots with +fill_with+ unless it is +false+.
Technically MySQL allows to create indexes with the sort order syntax but at the moment (5.5) it doesn't yet implement them
The handler must respond to +:call+, which will be passed the template and should return the rendered template as a String.
The response is sent to the client after the whole template is rendered, all queries are made, and the layout is processed.
The same as FileSystemResolver but does not allow templates to store a virtual path since it is invalid for such resolvers.
The template digest that's added to the cache key is computed by taking an md5 of the contents of the entire template file.
Therefore, in non-strict mode, we want column.default to report an empty string as its default, to be consistent with that.
This class should be called before the AppGenerator is required and started since it configures and mutates ARGV correctly.
This feature is accomplished by instantiating the class and storing the instance as a thread local keyed by the class name.
This is the safest method to ensure links that cause changes to your data are not triggered by search bots or accelerators.
This method accepts any of the following day symbols: :monday, :tuesday, :wednesday, :thursday, :friday, :saturday, :sunday
We have no direct reference to the colon source range following an optional keyword argument's name, so must construct one.
We must avoid making file names too long for some filesystems to handle If they are short, we can leave them human-readable
We often find ourselves with a medium-sized chunk of behavior that we'd like to extract, but only mix in to a single class.
You can set data attributes directly by passing in a data hash, but all other HTML options must be wrapped in the HTML key.
add_column(:measurements, :huge_integer, :decimal, precision: 30) ALTER TABLE "measurements" ADD "huge_integer" decimal(30)
aliased to avoid conflicts with an image_url named route Computes the path to a video asset in the public videos directory.
assert_enqueued_with(job: MyJob, at: Date.tomorrow.noon) do MyJob.set(wait_until: Date.tomorrow.noon).perform_later end end
class Foo The following is not redundant (conditionally defined methods are considered as always defining a method) private
the quoting here will reveal any double quoting issues in change_column's interaction with the column method in the adapter
:exclusively_dependent means each client is deleted directly from the database without looping through them calling destroy.
ActiveSupport::LogSubscriber is an object set to consume ActiveSupport::Notifications with the sole purpose of logging them.
After loading the posts, find will collect the +author_id+ from each one and load all the referenced authors with one query.
An underscore string that contains the acronym will retain the acronym when passed to +camelize+, +humanize+, or +titleize+.
Build a stream handler by wrapping the user-provided callback with a decoder or defaulting to a JSON-decoding retransmitter.
Checks to see if the reflection doesn't have any options that prevent us from being able to guess the inverse automatically.
Concerns may be defined inline, using a block, or handled by another object, by passing that object as the second parameter.
Create custom PostgreSQL function to generate UUIDs to test dumping tables which columns have defaults with custom functions
Either the params and request are supplied as arguments, or just params, depending of how many arguments your block accepts.
Finally, assuming we have two event instances, one which has a time and one which does not, the output might look like this:
If +prefix_partial_path_with_controller_namespace+ is true, then this method will prefix the partial paths with a namespace.
If it's set to `keyword` (which is the default), the `end` shall be aligned with the start of the keyword (if, class, etc.).
If the date part is missing then the current date is used and if the time part is missing then it is assumed to be 00:00:00.
If the object responds to the method the call is attempted and +ArgumentError+ is still raised in case of argument mismatch.
If you need to work on all current children, new and existing records, +load_target+ and the +loaded+ flag are your friends.
If you want to load all posts (including posts with no approved comments) then write your own LEFT OUTER JOIN query using ON
In case we get back a String from a handler that is not in BINARY or the default_internal, encode it to the default_internal
Match literal regex characters, not including anchors, character classes, alternatives, groups, repetitions, references, etc
Methods are provided for phone numbers, currency, percentage, precision, positional notation, file size and pretty printing.
MiddlewareStackProxy is a proxy for the Rails middleware stack that allows you to configure middlewares in your application.
Options are provided for phone numbers, currency, percentage, precision, positional notation, file size and pretty printing.
Reset the state of this connection, directing the DBMS to clear transactions and other connection-related server-side state.
So to work around this we first define with the __temp__ identifier, and then use alias method to rename it to what we want.
Specifying a custom converter allows the new value to be automatically converted to an instance of value class if necessary.
String or Symbol:: :FooBar or "FooBar" becomes "foo_bar_helper", and "foo_bar_helper.rb" is loaded using require_dependency.
The indentation of the remaining lines can be corrected with other cops such as `IndentationConsistency` and `EndAlignment`.
The parameters in the signature may have reserved Ruby words, in order to prevent errors, we start each param name with `_`.
This allows for views to display rather reasonable strings while still giving developers a way to find missing translations.
This allows us to later be able to find all connections established for that current_user (and potentially disconnect them).
This cop checks that the closing brace in a hash literal is either on the same line as the last hash element, or a new line.
Using it, you can change the label and radio button display order or even use the label as wrapper, as in the example above.
`detected` can be a single style, or an Array of possible styles (if there is more than one which matches the observed code)
aliased to avoid conflicts with an video_url named route Computes the path to an audio asset in the public audios directory.
as the environment will be in an inconsistent state, e.g. other constants may have already been unloaded and not accessible.
assert_performed_with(job: MyJob, at: Date.tomorrow.noon) do MyJob.set(wait_until: Date.tomorrow.noon).perform_later end end
if something else went wrong this can't be a "naked" rescue, because we have should return conns even for non-StandardErrors
if the adapter doesn't support the indexes call the best we can do is return the default index name for the options provided
the repro requires that there are no evented subscribers for the "foo" event, so we have to duplicate some of the setup code
yield all the assignments which must come after `assignment` (due to dependencies on the previous value of the assigned var)
An integration test spans multiple controllers and actions, tying them all together to ensure they work together as expected.
Annotations are looked for in comments and modulus whitespace they have to start with the tag optionally followed by a colon.
As a rule of thumb you can think of +camelize+ as the inverse of underscore, though there are cases where that does not hold:
As a rule of thumb you can think of +underscore+ as the inverse of camelize, though there are cases where that does not hold:
As you can see the integration test involves multiple controllers and exercises the entire stack from database to dispatcher.
Be sure to declare +define_attribute_methods+ after you define any prefix, suffix or affix methods, or they will not hook in.
Checking the fixture for named association is important here, because it's the only way we've been able to reproduce this bug
Expands the "url" key that contains a URL database connection to a full connection hash and merges with the rest of the hash.
For the rest of this documentation, when we say "UTF-8", we mean "UTF-8 or whatever the default_internal encoding is set to".
If a limit is supplied, returns a substring from the end of the string until it reaches the limit value (counting backwards).
If no aligned token was found, search for an aligned token on the nearest line with the same indentation as the checked line.
If no layout is found, it checks if at least a layout with the given name exists across all details before raising the error.
If the size of the nested attributes array exceeds the specified limit, NestedAttributes::TooManyRecords exception is raised.
In this example, if any before validate callbacks returns +false+, any successive before and around callback is not executed.
Makes the controller a Rack endpoint that runs the action in the given +env+'s +action_dispatch.request.path_parameters+ key.
Migrations are currently supported in MySQL, PostgreSQL, SQLite, SQL Server, and Oracle (all supported databases except DB2).
Now, every time something is concatenated to the buffer, it is not appended to an array, but streamed straight to the client.
Returns a Pathname object of the public folder of the current rails project, otherwise it returns nil if there is no project:
Returns the suffix that should be added to a number to denote the position in an ordered sequence such as 1st, 2nd, 3rd, 4th.
Search for files recursively starting at the given base directory using the given flags that determine how the match is made.
Set to false to blow away fixtures cache and ensure our fixtures are loaded and thus takes into account our set_fixture_class
Shoulda then can tell generators to search for test_unit generators when some of them are not available by adding a fallback:
The +ParamsWrapper+ will actually try to determine the list of attribute names from the model and only wrap those attributes:
The return value of the block will be written to the cache under the given cache key, and that return value will be returned.
These methods will be included into any Active Job object, adding helpers for de/serialization and creation of job instances.
This cops checks the indentation of hanging closing parentheses in method calls, method definitions, and grouped expressions.
This method is useful if you have a template object but it does not contain its source anymore since it was already compiled.
`stream.close` should really be reserved for a close from the other direction, but we must fall back to it for compatibility.
if foreign keys are implemented and fixtures are not deleted in reverse order then this test case will raise StatementInvalid
test that we're failing because the current Arel's engine doesn't support UPDATE ORDER BY queries is using subselects instead
this method is quite imperfect and can be fooled to do much better, we would need to do global analysis of the whole codebase
* AssociationTypeMismatch - The object assigned to the association wasn't of the type specified in the association definition.
+json_escape+ doesn't automatically flag the result as HTML safe, since the raw value is unsafe to use inside HTML attributes.
+sql_type_metadata+ is various information about the type of the column +null+ determines if this column allows +NULL+ values.
- a Hash which specifies multiple association names, as well as association names for the to-be-preloaded association objects.
ActiveRecord::Schema is only supported by database adapters that also support migrations, the two features being very similar.
By default nested attribute updating is turned off and you can enable it using the accepts_nested_attributes_for class method.
Checks that the equals signs in parameter default assignments have or don't have surrounding space depending on configuration.
If +reload_classes_only_on_change+ is false, the class unload will have occurred after the work run, but before this callback.
If :ruby, the schema is dumped as an ActiveRecord::Schema file which can be loaded into any database that supports migrations.
Instead use methods +local+, +parse+, +at+ and +now+ on TimeZone instances, and +in_time_zone+ on Time and DateTime instances.
It will also invoke the db:schema:dump task, which will update your db/schema.rb file to match the structure of your database.
Please check unscoped if you want to remove all previous scopes (including the default_scope) during the execution of a block.
PostgreSQL, MySQL, and Oracle overrides this for custom DISTINCT syntax - they require the order columns appear in the SELECT.
Raised when attribute has a name reserved by Active Record (when attribute has name of one of Active Record instance methods).
Returns a Hash of the Arel::Attributes and attribute values that have been typecasted for use in an Arel insert/update method.
Returns a new hash where the parameters of the given config hash have been replaced by parameters returned by the given block.
Returns the sanitized limit parameter, either as an integer, or as a string which contains a comma-delimited list of integers.
Returns value of the given key from the session, or raises +KeyError+ if can't find the given key and no default value is set.
Set to false to blow away fixtures cache and ensure our fixtures are loaded and thus takes into account the +set_model_class+.
Since it's not easy to get the position of the "else" keyword, we check "else" body against latest "when" keyword indentation.
Small macro to add ruby as an option to the generator with proper default value plus an instance helper method called shebang.
Stores some of the Rails initial environment parameters which will be used by middlewares and engines to configure themselves.
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
The actual file is accessible via the +tempfile+ accessor, though some of its interface is available directly for convenience.
The currency unit and number formatting of the current locale will be used unless otherwise specified in the provided options.
The custom FormBuilder class is automatically merged with the options of a nested fields_for call, unless it's explicitly set.
The default trusted IPs list simply includes IP addresses that are guaranteed by the IP specification to be private addresses.
The provided constant descriptor may be a (non-anonymous) module or class, or a qualified constant name as a string or symbol.
This cop checks that the closing brace in a method call is either on the same line as the last method argument, or a new line.
This gives you one class to configure things such as request forgery protection and filtering of sensitive request parameters.
This is used by cache implementations that don't natively serialize entries to protect against accidental cache modifications.
This is used to determine whether we can load the target if the owner is currently a new record (and therefore without a key).
This makes Action Controller parameters forbidden to be used in Active Model mass assignment until they have been whitelisted.
This will merge the existing object (reply) with what gets loaded from the db (which includes the changed approved attribute).
Useful for complex table highlighting or any other design need which requires the current cycle string in more than one place.
When a channel is streaming via pubsub, we want to delay the confirmation transmission until pubsub subscription is confirmed.
Without web-service support, an action which collects the data for displaying a list of people might look something like this:
You can also provide a proc or lambda which will determine the regular expression that will be used to validate the attribute.
You can override +to_param+ in your model to make +user_path+ construct a path using the user's name instead of the user's id:
You can pass +Fixnum+ or +String+ values, it finds the records responding to the +id+ and then deletes them from the database.
this next line will fail if the attribute methods module is generated lazily after the association methods module is generated
we have already seen a wildcard with this name before so the value it matched the first time will already be stored in a temp.
* Sending a message to same object with zero arguments in presence of a method name clash with an argument or a local variable.
ActiveSupport::SecurityUtils.secure_compare( ::Digest::SHA256.hexdigest(token), ::Digest::SHA256.hexdigest(TOKEN) ) end end end
Additionally, the +helper+ class method can receive and evaluate a block, making the methods defined available to the template.
Anonymous modules cannot follow these conventions and therefore we assume that the user wants to refer to a top-level constant.
By safe assignment we mean putting parentheses around an assignment to indicate "I know I'm using an assignment as a condition.
Check if the length of the longest line + the length of the corrected assignment is greater than the max configured line length
Collects attributes from scopes that should be applied when creating an AR instance for the particular class this is called on.
Don't create a double backslash at the end of the line, in case there already was a backslash after the concatenation operator.
Finally, if we DON'T find a template AND the request isn't a browser page load, then we implicitly respond with 204 No Content.
Handlers that take one argument will be called with the exception, so that the exception can be inspected when dealing with it.
Helper class necessitated by silly design of TSort prior to Ruby 2.1 Newer versions have a better API, but that doesn't help us
However, this can change, for instance, when using nested attributes, which is called _after_ the association has been defined.
If a format cannot be found neither from the path, or the handler, we should return the array of formats given to the resolver.
If an explicit :controller was given, always make :action explicit too, so that action expiry works as expected for things like
If the `else` branch of a conditional consists solely of an `if` node, it can be combined with the `else` to become an `elsif`.
If your JSON is being used downstream for insertion into the DOM, be aware of whether or not it is being inserted via +html()+.
It automatically disables coloring if coloring is disabled in the process globally or the formatter's output is not a terminal.
It is similar to render, except that it does not set the +response_body+ and it should be guaranteed to always return a string.
Modifiers should be indented as deep as method definitions, or as deep as the class/module keyword, depending on configuration.
Note this method does not imply the records are actually removed from the database, that depends precisely on +delete_records+.
Optimistic locking allows multiple users to access the same record for edits, and assumes a minimum of conflicts with the data.
Ordinalize turns a number into an ordinal string used to denote the position in an ordered sequence such as 1st, 2nd, 3rd, 4th.
Otherwise, you might trigger the loading of a child before the parent has registered the callbacks and they won't be inherited.
Raises: - ActiveRecord::ConnectionTimeoutError if +timeout+ is given and no element becomes available within +timeout+ seconds,
Returns an array of hashes each containing :name and :value keys suitable for use as the names and values of form input fields:
Set the i18n configuration after initialization since a lot of configuration is still usually done in application initializers.
Streaming inverts the rendering flow by rendering the layout first and streaming each part of the layout as they are processed.
Strong params has an optimization to avoid looping every time you read a key whose value is an array and building a new object.
Technically, it looks for the least indented non-empty line in the whole string, and removes that amount of leading whitespace.
Template lookup accounts for the action name, locales, format, variant, template handlers, and more (see +render+ for details).
The counter_cache option must be given on either the owner or inverse association, and the column must be present on the owner.
The difference here being that the routes generated are like /:account_id/projects, rather than /accounts/:account_id/projects.
These are the normal settings that will be set up by Railties TODO: Have these tests support other combinations of these values
This cache does implement the local cache strategy, so values will actually be cached inside blocks that utilize this strategy.
This cop checks that the closing brace in an array literal is either on the same line as the last array element, or a new line.
This is mostly useful in relation to single-table inheritance structures where you want a subclass to appear as the superclass.
To prevent this, only XmlHttpRequest (known as XHR or Ajax) requests are allowed to make GET requests for JavaScript responses.
Using this method means you won't directly depend on the ActiveSupport's JSON implementation, in case it changes in the future.
When a pattern points to an internal route, the route's +:action+ and +:controller+ should be set in options or hash shorthand.
When passed a single key, if it exists and its associated value is either present or the singleton +false+, returns said value:
With a BacktraceCleaner, filters and silencers are used to remove the noisy lines, so that only the most relevant lines remain.
aliased to avoid conflicts with a video_path named route Computes the full URL to a video asset in the public videos directory.
def test_hello_job assert_performed_jobs 1, only: HelloJob do HelloJob.perform_later('jeremy') LoggingJob.perform_later end end
runs assert_restful_routes_for and assert_restful_named_routes for on the controller_name and options, without passing a block.
+acronym+ may be used to specify any word that contains an acronym or otherwise needs to maintain a non-standard capitalization.
+hook.complete+ will be passed the value returned from +hook.run+, and will only be invoked if +run+ has previously been called.
Add a few more monkeys and pirates and break this into multiple files, and it gets pretty hard to keep track of what's going on.
Additionally, polymorphic belongs_to associations can have multiple associated classes, depending on the polymorphic_type field.
After initialization, a call to +execute_if_updated+ must execute the block only if there was really a change in the filesystem.
All you need to do is to ensure that your log subscriber is added to Rails::Subscriber, as in the second line of the code above.
Attribute that keeps track of converted arrays, if any, to avoid double looping in the common use case permit + mass-assignment.
Besides, if you fetch existing records with +select+ and leave the ID out, you're on your own, this predicate will return false.
CANONICAL_ACTIONS holds all actions that does not need a prefix or a path appended since they fit properly in their scope level.
CREATE TABLE users ( id int NOT NULL auto_increment, account_id int default NULL, name varchar default NULL, PRIMARY KEY  (id) )
CaptureHelper exposes methods to let you extract generated markup which can be used in other parts of a template or layout file.
Determines if a record with the particular +attributes+ should be rejected by calling the reject_if Symbol or Proc (if defined).
For example, `lvar` and `send` type nodes are initially created as an `ident` type node and fixed to the appropriate type later.
For example, the tables "catalog_categories" and "catalog_products" generate a join table name of "catalog_categories_products".
If such a comment is supplied, Rails will apply that encoding to the resulting compiled source returned by the template handler.
Method for creating new ActiveSupport::TimeWithZone instance in time zone of +self+ from number of seconds since the Unix epoch.
Nested attributes for an associated collection can also be passed in the form of a hash of hashes instead of an array of hashes:
Note that the +do end+ syntax for the redirect block wouldn't work, as Ruby would pass the block to +get+ instead of +redirect+.
Please note that Topic 1 is the only not approved so if it were among the first 3 it would raise an ActiveRecord::RecordNotFound
Provided that the directory was loaded from a reloadable base path, it is added to the set of constants that are to be unloaded.
Returns an array of file paths appended with a hash of directories-extensions suitable for ActiveSupport::FileUpdateChecker API.
Sometimes you want to be able to read the raw attribute data without having the column-determined typecast run its course first.
Splits or iterates over the array in groups of size +number+, padding any remaining slots with +fill_with+ unless it is +false+.
The `cached: true` will make Action View's rendering read several templates from cache at once instead of one call per template.
The application object is also responsible for holding the routes and reloading routes whenever the files change in development.
The extent of a "deep" copy is application specific and is therefore left to the application to implement according to its need.
The power of the +validates+ method comes when using custom validators and default validators in one call for a given attribute.
The typical silencer use case is to exclude the output of a noisy library from the backtrace, so that you can focus on the rest.
These layouts are different than the ones that are specified globally for the entire action, but they work in a similar fashion.
This can be used to reset the state information in an existing session instance, so it can be used from a clean-slate condition.
This cop tries to produce a complexity score that's a measure of the complexity the reader experiences when looking at a method.
This file is loaded by every Rails component except Active Support itself, but it does not belong to the Rails public interface.
This finds the first abstract superclass of a controller, and gets a list of all public instance methods on that abstract class.
This is useful for cases like remember-me tokens and auto-unsubscribe links where the session store isn't suitable or available.
This middleware assumes that there is at least one proxy sitting around and setting headers with the client's remote IP address.
This will override the controller-wide "weblog_standard" layout, and will render the help action with the "help" layout instead.
Useful in development and test environments where you don't want caching turned on but need to go through the caching interface.
assign new store attribute and create new hash to ensure that each class in the hierarchy has its own hash of stored attributes.
* +action_on_unpermitted_parameters+ - Allow to control the behavior when parameters that are not explicitly permitted are found.
A lost connection can occur if a programmer forgets to checkin a connection at the end of a thread or a thread dies unexpectedly.
A weak ETag indicates semantic equivalence, not byte-for-byte equality, so they're good for caching HTML pages in browser caches.
ALTER TABLE "articles" ADD CONSTRAINT fk_rails_e74ce85cbc FOREIGN KEY ("author_id") REFERENCES "authors" ("id") ON DELETE CASCADE
Because of extended life of the previous cache, other processes will continue to use slightly stale data for a just a bit longer.
By calling +instantiate+ instead of +new+, finder methods ensure they get new instances of the appropriate class for each record.
Helper methods defined in a fixture will not be available in other fixtures, to prevent against unwanted inter-test dependencies.
However the validation and callback methods are lazy and those methods get created when they are invoked for the very first time.
If the key to be added already exists and the existing value associated with key is not an Array, it will be wrapped in an Array.
If we exhaust the search there is no executable, this could be a call to generate a new application, so restore the original cwd.
It is recommended that you provide any options used when creating the foreign key so that the migration can be reverted properly.
Note that this will clear anything that is being used to validate the model for both the +validates_with+ and +validate+ methods.
Notice that "rails:generators:webrat" could be loaded as well, what Rails looks for is the first and last parts of the namespace.
Passing a record (like an Active Record) instead of a hash as the options parameter will trigger the named route for that record.
Pretty prints (formats and approximates) a number in a way it is more readable by humans (eg.: 1200000000 becomes "1.2 Billion").
Raised when Postgres returns 'cached plan must not change result type' and we cannot retry gracefully (e.g. inside a transaction)
Running several Rake tasks in a single command would trip up the runner, as the patterns would also contain the other Rake tasks.
Tests for the implementation of these features should run on all Ruby versions and shouldn't be tested through the proxy methods.
That is, a normal hash merge, with the addition that any value that is a hash, and occurs in both arguments, will also be merged.
That works that way because the involved helpers know whether the resource is a new record or not, and generate HTML accordingly.
The HTML specification says when nothing is select on a collection of radio buttons web browsers do not send any value to server.
The actual response object is generated automatically through the use of renders and redirects and requires no user intervention.
The class is initialized with a stream and can be used to either write a JSON string or an object which can be converted to JSON.
The method +deserialize+ or +cast+ will be called on your type object, with raw input from the database or from your controllers.
The root node reflects the class name of the first element in plural if all elements belong to the same type and that's not Hash:
They allow a browser or proxy cache to support Range requests, useful for paging through a PDF file or scrubbing through a video.
This allows us to run `rails server` from other directories, but still get the main config.ru and properly set the tmp directory.
This code is based directly on the Text gem implementation Returns a value representing the "cost" of transforming str1 into str2
This cop looks for trivial reader/writer methods, that could have been created with the attr_* family of functions automatically.
This is required by ActiveModel attribute assignment, so that user can pass +Parameters+ to a mass assignment methods in a model.
This makes it easy to use signed cookies that were set when logging in via a web interface to authorize the WebSocket connection.
To the user all it matters is that a helper module couldn't be loaded, autoloading is an internal mechanism that should not leak.
UpgradeLegacySignedCookieJar is used instead of SignedCookieJar if secrets.secret_token and secrets.secret_key_base are both set.
Used with the standard time durations, like 1.hour.in_milliseconds -- so we can feed them to JavaScript functions like getTime().
Validator classes may also exist within the class being validated allowing custom modules of validators to be included as needed.
We use a fully-qualified name in some strings, and a relative constant name in some other to test correct handling of both cases.
We've specified the list of fruits on George's fixture, but we could've just as easily specified a list of monkeys on each fruit.
When a new value is assigned to the value object, the default assumption is that the new value is an instance of the value class.
When loading console, force ActiveRecord::Base to be loaded to avoid cross references when loading a constant for the first time.
aliased to avoid conflicts with an audio_path named route Computes the full URL to an audio asset in the public audios directory.
link_to, and all other functions that require URL generation functionality, actually use ActionController::UrlFor under the hood.
A channel object will be instantiated when the cable consumer becomes a subscriber, and then lives until the consumer disconnects.
A container for responses available from the current controller for requests for different mime-types sent to a particular action.
Also, maps the +omap+ feature for YAML files (See http://yaml.org/type/omap.html) to support ordered items when loading from yaml.
Application configuration should go into files in config/initializers -- all .rb files in that directory are automatically loaded.
Convert an object into a "JSON-ready" representation composed of primitives like Hash, Array, String, Numeric, and true/false/nil.
Creates a mailto link tag to the specified +email_address+, which is also used as the name of the link unless +name+ is specified.
If +timeout+ is given, block if there is no element available, waiting up to +timeout+ seconds for an element to become available.
If a plugin developer wants a generator group to fallback to another group in case of missing generators, they can add a fallback.
If this value is `true`, calling `write` after the client disconnects will result in the written content being silently discarded.
In that case, batch processing methods allow you to work with the records in batches, thereby greatly reducing memory consumption.
In this scenario, the delete method won't actually work: it can only be used if the association on the join model is a belongs_to.
Note that if you return a path without a leading slash then the url is prefixed with the current SCRIPT_NAME environment variable.
Note: klass will always be valid because when there's a NameError from calling +klass+, +reflection+ will already be set to false.
Other hash literals shall have their first key indented one step more than the start of the line where the opening curly brace is.
Report offense only if changing case doesn't change semantics, i.e., if the string would become dynamic or has special characters.
Save with a different object instance, so the instance that's still held in topic.relies doesn't know about the changed attribute.
Sets the default week start If assigned value is not a valid day symbol (e.g. :sunday, :monday, ...), an exception will be raised.
Since these exceptions are captured in transaction blocks, the parent block does not see it and the real transaction is committed.
Table aliases are automatically truncated according to the maximum length of table identifiers according to the specific database.
Test cases can use begin+rollback to isolate their changes to the database instead of having to delete+insert for every test case.
That means that the message will be sent bypassing checking +perform_deliveries+ and +raise_delivery_errors+, so use with caution.
The channel provides the basic structure of grouping behavior into logical units when communicating over the WebSocket connection.
The cookie jar used for storage is automatically configured to be the best possible option given your application's configuration.
The cookies being read are the ones received along with the request, the cookies being written will be sent out with the response.
The results will be returned as an array with columns requested encapsulated as attributes of the model you call this method from.
They use the type as the method name instead of as a parameter and allow for multiple columns to be defined in a single statement.
This allows associated records to be built which will automatically create the appropriate join model records when they are saved.
This is so that paths in config/default.yml, for example, are not relative to RuboCop's config directory since that wouldn't work.
This makes Rails itself absent of any component hooks, allowing other components to be used in place of any of the Rails defaults.
This makes it less repetitive to translate many keys within the same partial and provides a convention to scope keys consistently.
This method exists to avoid the expensive primary_key check internally, without breaking compatibility with the read_attribute API
This method would be useful when you treat the receiver node as the root of a tree and want to iterate over all nodes in the tree.
TimeWithZone instances implement the same API as Ruby Time instances, so that Time and TimeWithZone instances are interchangeable.
When projects is already an association on Person you can use +accepts_nested_attributes_for+ to define the writer method for you:
When using inheritance in your models, it will check all the inherited models too, but only if the model itself hasn't been found.
You can make these callbacks more flexible by passing in other initialization data such as the name of the attribute to work with:
class User include ActiveSupport::Configurable config_accessor :allowed_access, instance_reader: false, instance_writer: false end
def test_logging_job assert_enqueued_jobs 1, only: LoggingJob do LoggingJob.perform_later HelloJob.perform_later('jeremy') end end
make sure we carry over any changes to ActiveRecord::Base.default_timezone that have been made since we established the connection
rubocop:disable Metrics/ClassLength An exception indicating that the inspection loop got stuck correcting offenses back and forth.
we don't want a Time.local instance enforcing its own DST rules as well, so transfer time values to a utc constructor if necessary
* http://www.postgresql.org/docs/current/static/transaction-iso.html * https://dev.mysql.com/doc/refman/5.7/en/set-transaction.html
As with +belongs_to+, Active Record reflects on the fixture's model class and discovers the +has_and_belongs_to_many+ associations.
At this size, the increased overhead can be a reasonable tradeoff even if it reduces our at-a-glance perception of how things work.
But sometimes the database might return columns with characters that are not allowed in normal method names (like 'my_column(omg)'.
By default, all controllers and views have access to a special version of url_for, that already knows what the current hostname is.
By default, this will use the +uuid_generate_v4()+ function from the +uuid-ossp+ extension, which MUST be enabled on your database.
Despite this, in non-strict mode, MySQL will use an empty string as the default value of the field, if no other value is specified.
Ensure that it is not called if the object was never persisted (failed create), but call it after the commit of a destroyed object.
For instance, a time + 24.hours will advance exactly 24 hours, while a time + 1.day will advance 23-25 hours, depending on the day.
Given a key (as described in +expire_fragment+), returns a key suitable for use in reading, writing, or expiring a cached fragment.
If the `verify_authenticity_token` before_action ran, verify that JavaScript responses are only served to same-origin GET requests.
If you need to send attachments with no content, you need to create an empty view for it, or add an empty body parameter like this:
It tests more completely than either unit or functional tests do, exercising the entire stack, from the dispatcher to the database.
Layouts reverse the common pattern of including shared headers and footers in many templates to isolate changes in repeated setups.
Mix this module into your controller, and all actions in that controller will be able to stream data to the client as it's written.
Please note that no validation is performed and only the +after_touch+, +after_commit+ and +after_rollback+ callbacks are executed.
Since most emails do something interesting with database data, you'll need to write some scenarios to load messages with fake data:
Specify whether rendering within namespaced controllers should prefix the partial paths for ActiveModel objects with the namespace.
Test regular association, association with conditions, association with STI, and association with conditions assured not to be true
That means that modifying attributes of the clone will modify the original, since they will both point to the same attributes hash.
That means you have to take special care not to do anything silly in a channel that would balloon its memory footprint or whatever.
The arguments must be legal JSON types (string, int, float, nil, true, false, hash or array) or GlobalID::Identification instances.
The iteration object has knowledge about which index the current object has in the collection and the total size of the collection.
There are two special accessors for the commonly used flash names +alert+ and +notice+ as well as a general purpose +flash+ bucket.
This cop checks whether the block parameters of a single-line method accepting a block match the names specified via configuration.
This is typically '/' but may be different in a mounted engine or where the application is deployed to a subdirectory of a website.
This list is in particular used to filter ordinary requests, String goes as first element to quickly short-circuit the common case.
This means that, modifying headers, cookies, session or flash after the template starts rendering will not propagate to the client.
When address is already an association on a Person you can use +accepts_nested_attributes_for+ to define the writer method for you:
When initialized, it can accept optional HTTP headers, which will be set when a response containing a file's contents is delivered.
When rendering a different template than the default controller/action style, you can indicate which digest to include in the ETag:
max filename size on file system is 255, minus room for timestamp and random characters appended by Tempfile (used by atomic write)
* Stable, autogenerated IDs * Label references for associations (belongs_to, has_one, has_many) * HABTM associations as inline lists
ActionController::Parameters.new.require(:person) ActionController::ParameterMissing: param is missing or the value is empty: person
Alignment for the first element is set by IndentationWidth cop, the rest of the elements should be aligned using the AlignArray cop.
Finally, you can indicate specific attributes of a model for which time zone conversion should not applied, for instance by setting:
For example, this method returns a Mysql2::Client object in case of Mysql2Adapter, and a PGconn object in case of PostgreSQLAdapter.
GET requests are not protected since they don't have side effects like writing to the database and don't leak sensitive information.
If anything goes wrong, the database rolls back to the beginning of the sub-transaction without rolling back the parent transaction.
If you feel that you need to inject dynamic values, then perhaps you should reexamine whether your application is properly testable.
It will include tests that tell you whether your object is fully compliant, or if not, which aspects of the API are not implemented.
Make ConfigLoader reload the default configuration so that its absolute Exclude paths will point into this example's work directory.
MySQL is too stupid to create a temporary table for use subquery, so we have to give it some prompting in the form of a subsubquery.
Note that now there can be more than one router in your application, and it's better to avoid passing requests through many routers.
Note, with using explicit self you can only send messages with public or protected scope, you cannot send private messages this way.
Notice that "rails:generators:test_unit" could be loaded as well, what Rails looks for is the first and last parts of the namespace.
Provides a modified +Hash+ that you can include in your object for handling error messages and interacting with Action View helpers.
So in the nil case, no caching will take place, but that's ok since the nil case is not the common one that we wish to optimise for.
The classic example is a transfer between two accounts where you can only have a deposit if the withdrawal succeeded and vice versa.
The default Content-Type and Content-Disposition headers are set to download arbitrary binary files in as many browsers as possible.
The default iterations are higher than required for our key derivation uses on the off chance someone uses this for password storage
The following URL is unescaped, this is just a hash of options, and it is the responsibility of the caller to escape all the values.
The following migration will remove the table 'horses' and create the table 'apples' on the way up, and the reverse on the way down.
The migration version, migration file name, migration class name are available as instance variables in the template to be rendered.
The specified URL will then be passed a File object containing the selected file, or if the field was left blank, a StringIO object.
The through record (built with build_record) is temporarily cached so that it may be reused if insert_record is subsequently called.
This cops checks the indentation of the first key in a hash literal where the opening brace and the first key are on separate lines.
This is to get around the fact that Rack isn't based around IOs and we need to use a thread to stream data from the response bodies.
This is useful when cache fragments cannot be manually expired unless you know the exact key which is the case when using memcached.
This will load posts and eager load the +approved_comments+ association, which contains only those comments that have been approved.
When running --auto-gen-config, there's some processing done in the cops related to calculating the Max parameters for Metrics cops.
With an isolated engine, the engine's namespace is automatically applied, so you don't need to specify it explicitly in your routes:
You can also implement a custom asset host object that responds to +call+ and takes either one or two parameters just like the proc.
You can use this method when you have an HTTP response that never changes, and the browser and proxies should cache it indefinitely.
enable a logger so that (e.g.) the benchmarking stuff runs, so we can get a more accurate simulation of what happens in "real life".
Also note that this implicitly sets the day to be the first of the given month in order to not create invalid dates like 31 February.
Calling read() on the buffer results in a source that has an encoding of ANSII-8BIT instead of UTF-8 encoded source we were expecting
Filters out the primary keys, from the attribute names, when the primary key is to be generated (e.g. the id attribute has no value).
However if the +:dependent+ value is +:destroy+ then in that case the +:delete_all+ deletion strategy for the association is applied.
However, PostgreSQL will cast the default to the columns type, which leaves us with a default like "default NULL::character varying".
However, if the date component is not provided, but any other upper components are supplied, then the day of the month defaults to 1:
If +value+ is a Hash, this will create an ActionController::Parameters object that has been instantiated with the given +value+ hash.
If a string literal contains hard-to-type characters which would not appear on a "normal" keyboard, then double-quotes are acceptable
If the app is a Rails app, make url_helpers available on the session This makes app.url_for and app.foo_path available in the console
It also removes hyphens and underscores from file names and replaces them with spaces, returning a space-separated, titleized string.
It requires the ORDER BY columns in the select list for distinct queries, and requires that the ORDER BY include the distinct column.
Note: Instantiation, callback execution, and deletion of each record can be time consuming when you're removing many records at once.
Notice this method raises an error if the template to be refreshed does not have a virtual path set (true just for inline templates).
Otherwise, workers may oversubscribe the db connection pool and block while they wait for other workers to release their connections.
Set to false to blow away fixtures cache and ensure our fixtures are loaded and thus takes into account our lack of set_fixture_class
So basically you should use transaction blocks whenever you have a number of statements that must be executed together or not at all.
The +custom_proxies+ argument can take an Array of string, IPAddr, or Regexp objects which will be used instead of +TRUSTED_PROXIES+.
The +info+ hash is optional, and if given is used to define metadata about the current schema (currently, only the schema's version):
The intended use case for this method is to escape JSON strings before including them inside a script tag to avoid XSS vulnerability:
The offenses that couldn't be corrected will be found again so we only keep the corrected ones in order to avoid duplicate reporting.
Their main advantage is that the macros add behavior into a callback queue that is kept intact down through an inheritance hierarchy.
These are named after the class specified, so for the above example the helper is either +some_rack_app_path+ or +some_rack_app_url+.
This cop checks for literals used as the conditions or as operands in and/or expressions serving as the conditions of if/while/until.
This cop checks that the closing brace in a method definition is either on the same line as the last method parameter, or a new line.
This could result in many rows that contain redundant data and it performs poorly at scale and is therefore only used when necessary.
This formatter displays a YAML configuration file where all cops that detected any offenses are configured to not detect the offense.
This may be useful, for example, when you want to add default inline attachments for all messages sent out by a certain mailer class:
When called with a block, the block is called with the filehandle and the filehandle is automatically closed when the block finishes.
With the above example, the bang and predicate methods along with the associated scopes are now prefixed and/or suffixed accordingly:
You can also use the +initialize_copy+ on one of the applications to create a copy of the application which shares the configuration.
add_column(:answers, :bill_gates_money, :decimal, precision: 15, scale: 2) ALTER TABLE "answers" ADD "bill_gates_money" decimal(15,2)
after `pool.disconnect()` the first thread will be left stuck in queue, no need to wait for it to timeout with ConnectionTimeoutError
A singleton instance of this class is yielded by Inflector.inflections, which can then be used to specify additional inflection rules.
Adds easy defaults to writing Atom feeds with the Builder template engine (this does not work on ERB or any other template languages).
Deletes the row with a primary key matching the +id+ argument, using a SQL +DELETE+ statement, and returns the number of rows deleted.
For example, you may want to prefix all fragment cache keys with a global version identifier, so you can easily invalidate all caches.
If no options hash is passed or :update specified, the default is to render a partial and use the second parameter as the locals hash.
If you use a helper method, for example, inside a cached block and you then update that helper, you'll have to bump the cache as well.
In these cases, the variable `foo` is not explicitly referenced, but it can be considered used implicitly by the `super` or `binding`.
It will also set the Content-Type, Content-Disposition, Content-Transfer-Encoding and encode the contents of the attachment in Base64.
Keying them by klass alone would lead to memory leaks in development mode as all previous instances of the class would stay in memory.
Like +merge+ but the other way around: Merges the receiver into the argument and returns a new hash with indifferent access as result:
Might want a shorter timeout depending on whether the request is a PATCH, PUT, or POST, and if the client is a browser or web service.
Note that +:controller+, +:action+ and +:id+ are interpreted as url query parameters and thus available through +params+ in an action.
Note that this method actually runs the queries, since the results of some are needed by the next ones when eager loading is going on.
Remove the assignment from lines that contain the offending assignment because after correcting, this will not be on the line anymore.
Returns a jar that'll automatically generate a signed representation of cookie value and verify it when reading from the cookie again.
So we need to force their encoding to binary before applying the regular expression to ensure we are escaping all characters properly.
Templates can be used concurrently in threaded environments so compilation and any instance variable modification must be synchronized
The +force_restore_state+ argument indicates if the record state should be rolled back to the beginning or just to the last savepoint.
The Renderer will parse the options from the +render+ or +render_body+ method and render a partial or a template based on the options.
This class tracks variable assignments in a method body and if a variable contains object passed as argument at the end of the method.
This is useful when passing around chains of relations and would like to modify the relations without reconstructing the entire chain.
This is useful when you want your forgery protection to depend on other callbacks, like authentication methods (Oauth vs Cookie auth).
This migration will create the horses table for you on the way up, and automatically figure out how to drop the table on the way down.
To avoid false positives, it ignores cases in which we cannot know for certain the type of value that would be assigned to a constant.
Use the format name as the hash key and either a strftime string or Proc instance that takes a time or datetime argument as the value.
We can use session-oriented authentication for these types of requests, by using the `protect_from_forgery` method in our controllers.
Without using prepared statements, it makes no sense to test BLOB data with DB2, because the length of a statement is limited to 32KB.
You can also specify a typecast character in the parentheses to have the parameters typecasted before they're used in the constructor.
queue_classic specializes in concurrent locking and minimizing database load while providing a simple, intuitive developer experience.
- table_name - "table.name" - schema_name.table_name - schema_name."table.name" - "schema.name".table_name - "schema.name"."table.name"
:nodoc: Provides a set of methods for making links and getting URLs that depend on the routing subsystem (see ActionDispatch::Routing).
A +FormBuilder+ object is associated with a particular model object and allows you to generate fields associated with the model object.
Additional helpers can be specified using the +helper+ class method in ActionController::Base or any controller which inherits from it.
Also raised when trying to serialize an object which can't be identified with a Global ID - such as an unpersisted Active Record model.
Also, sometimes (like when porting older join table fixtures) you'll need to be able to get a hold of the identifier for a given label.
BOM (byte order mark) can also be seen as whitespace, it's a non-rendering character used to distinguish between little and big endian.
Currently implemented by belongs_to (vanilla and polymorphic) and has_one/has_many :through associations which go through a belongs_to.
Deletes the record in the database and freezes this instance to reflect that no changes should be made (since they can't be persisted).
Finally, you can pass true as the third argument to silence all log activity (other than the timing information) from inside the block.
For more complex cases, such as conversion to or from your application domain objects, consider using the ActiveRecord::Attributes API.
HTTP Strict Transport Security (HSTS): Tells the browser to remember this site as TLS-only and automatically redirect non-TLS requests.
Handles implicit rendering for a controller action that does not explicitly respond with +render+, +respond_to+, +redirect+, or +head+.
However, if we know that a certain node type (like `int`) never has child nodes, there is no reason to pay the cost of calling `super`.
If this offense is within a line range that is already being realigned by autocorrect, we report the offense without autocorrecting it.
If you override this method to handle additional cases, you may also provide a method (like _handle_method_missing) to handle the case.
In this usage, the argument passed to the block (+format+ above) is an instance of the ActionController::MimeResponds::Collector class.
Instead of passing the content as an argument, you can also use a block in which case, you pass your +options+ as the second parameter.
It is possible to specify includes and excludes using the config file, so you can include other Ruby files like Rakefiles and gemspecs.
Note: this does not capture all cases, for example it would be crazy to try to properly support stale-checking for nested associations.
Notice that when you add a path using +add+, the path object created already contains the path with the same path value given to +add+.
Returns select and option tags for the given object and method, using time_zone_options_for_select to generate the list of option tags.
Take a string with embedded escapes, and convert the escapes as the Ruby interpreter would when reading a double-quoted string literal.
Takes the line number of a given code line and returns a string containing the previous line that's not a comment line or a blank line.
The postgres drivers don't allow the creation of an unconnected PGconn object, so just pass a nil connection object for the time being.
The rules used to do the guess are handled by the Inflector class in Active Support, which knows almost all common English inflections.
This cop checks for odd else block layout - like having an expression on the same line as the else keyword, which is usually a mistake.
Using Active Record, Redis, etc within your channel actions means you'll get a separate connection from each thread in the worker pool.
We call it semantic alignment when a dot is aligned with the first dot in a chain of calls, and that first dot does not begin its line.
`time_zone_select` can't be written with `grep` because Active Support time zones don't support implicit string coercion with `to_str`.
def down not much we can do to restore deleted data raise ActiveRecord::IrreversibleMigration, "Can't recover the deleted tags" end end
def test_emails assert_emails 0 ContactMailer.welcome.deliver_now assert_emails 1 ContactMailer.welcome.deliver_now assert_emails 2 end
:nodoc: This module provides methods for generating HTML that links views to assets such as images, JavaScripts, stylesheets, and feeds.
Allows us to buffer messages received from the WebSocket before the Connection has been fully initialized, and is ready to receive them.
Be careful which directory is specified in your config file when using +FileStore+ because everything in that directory will be deleted.
Callback code can be contained in instance methods, procs or lambdas, or callback objects that respond to certain predetermined methods.
Clobbering caused by two cops changing in the same range is dealt with by the auto-correct loop, so there's no reason to avoid a change.
Conditionally-defined methods are considered as always being defined, and thus access modifiers guarding such methods are not redundant.
For instance, a time - 24.hours will go subtract exactly 24 hours, while a time - 1.day will subtract 23-25 hours, depending on the day.
If a sequence name is not explicitly set when using PostgreSQL, it will discover the sequence corresponding to your primary key for you.
If it's set to `start_of_line` (which is the default), the `end` shall be aligned with the start of the line where the `def` keyword is.
If none of these conditions are true, and method_for_action returns nil, an AbstractController::ActionNotFound exception will be raised.
If you try to define a set of rake tasks on the instance, these will get passed up to the rake tasks defined on the application's class.
It can be useful to access the class that is using that validator when there are prerequisites such as an +attr_accessor+ being present.
Or, an implementation might choose to use one-time nonces or digests for POST, PUT, or PATCH requests and a time-stamp for GET requests.
Pass an SQL locking clause to append the end of the SELECT statement or pass true for "FOR UPDATE" (the default, an exclusive row lock).
Since Rails::Railtie cannot be instantiated, any methods that call +instance+ are intended to be called only on subclasses of a Railtie.
The attribute writer is named after the association, which means that in the following example, two new methods are added to your model:
The various connection pools are managed by a single instance of ConnectionHandler accessible via ActiveRecord::Base.connection_handler.
There are nineteen callbacks in total, which give you immense power to react and prepare for each state in the Active Record life cycle.
When you specify an association there is usually an association on the associated model that specifies the same relationship in reverse.
*IMPORTANT:* In order for inheritance to work for the callback queues, you must specify the callbacks before specifying the associations.
-- Implementation detail: the connection returned by +acquire_connection+ will already be "+connection.lease+ -ed" to the current thread.
Active Record objects don't specify their attributes directly, but rather infer them from the table definition with which they're linked.
ActiveRecord::AttributeMethods::BeforeTypeCast provides a way to read the value of the attributes before typecasting and deserialization.
As explained in Channel, most of the time, these broadcastings are streamed directly to the clients subscribed to the named broadcasting.
Default to 180 days, the low end for https://www.ssllabs.com/ssltest/ and greater than the 18-week requirement for browser preload lists.
Find all the symbol nodes that are adjacent to literal nodes and alter the regexp so that Journey will partition them into custom routes.
For a generic model object, a form can be created by passing +form_for+ a string or symbol representing the object we are concerned with:
For example, if a bulleted list follows the first item is not rendered as a list item, but as a paragraph starting with a plain asterisk.
However, in MySQL it is advised to add a compound index for both of the columns as MySQL only uses one index per table during the lookup.
If the last node is or contains a conflicting HEREDOC, we don't want to adjust the brace layout because this will result in invalid code.
If there are no parentheses around the arguments, then braces and do-end have different meaning due to how they bind, so we allow either.
If you want to use a different hash algorithm, you can change it by providing `:digest` key as an option while initializing the verifier:
If your resource has associations defined, for example, you want to add comments to the document given that the routes are set correctly:
On the other hand, we want to monitor the performance of our real database queries, not the performance of the access to the query cache.
Post.where(published: true).joins(:comments).merge( Comment.where(spam: false) ) Performs a single join query with both where conditions.
Returns true if the given path name (except perhaps for the ".rb" extension) is the missing file which caused the exception to be raised.
Setting this option prepends a select option with a generic prompt  (Day, Month, Year, Hour, Minute, Seconds) or the given prompt string.
Temporarily give up all held Share locks while executing the supplied block, allowing any +compatible+ exclusive lock request to proceed.
The +extras+ parameter is used to tell the request the names and values of additional request parameters that would be in a query string.
The example proc below disables asset hosting for HTTPS connections, while still sending assets for plain HTTP requests from asset hosts.
This module handles everything related to mail delivery, from registering new delivery methods to configuring the mail object to be sent.
This store is most useful if you don't store critical data in your sessions and you don't need them to live for extended periods of time.
This test ensures that if the default_external is set to something other than UTF-8, we don't get any errors and get back a UTF-8 String.
We need to require application after the server sets environment, otherwise the --environment option given to the server won't propagate.
aliased to avoid conflicts with a javascript_url named route Computes the path to a stylesheet asset in the public stylesheets directory.
A class emitter method is a singleton method in a class/module, where the method has the same name as a class defined in the class/module.
A convenience method for returning a collection of TimeZone objects for time zones in the country specified by its ISO 3166-1 Alpha2 code.
Accessing attributes of an object that do not have fields retrieved by a select except +id+ will throw ActiveModel::MissingAttributeError:
Also note that when headers are mapped to CGI-like variables by the Rack server, both dashes and underscores are converted to underscores.
Any +Post+ class will work as long as its instances respond to +to_key+ and +model_name+, given that +model_name+ responds to +param_key+.
As the primaries didn't hold a share lock, as soon as the outer one was released, all the exclusive locks are free to be acquired in turn.
But if you raise an ActiveRecord::Rollback exception, then the database transaction will be rolled back, without passing on the exception.
Common functionality for checking the closing brace of a literal is either on the same line as the last contained elements, or a new line.
Configures two callbacks instead of a single after_save so that the model may rely on their execution order relative to its own callbacks.
Conventions in the generated field names allow controllers to receive form data nicely structured in +params+ with no effort on your side.
Dynamic attribute-based finders are a mildly deprecated way of getting (and/or creating) objects by simple queries without turning to SQL.
Finally, we add a tag to the connection-specific logger with the name of the current user to easily distinguish their messages in the log.
For more information about specifying conditions as a hash or array, see the Conditions section in the introduction to ActiveRecord::Base.
If +selected+ is specified as a Proc, those members of the collection that return true for the anonymous function are the selected values.
If true, Active Record and Active Model callbacks returning +false+ will halt the entire callback chain and display a deprecation message.
If you are upgrading an existing Rails 3 app, you should leave your existing secret_token in place and simply add the new secret_key_base.
In the following example the Post model has many Comments stored within it in a NoSQL database, thus there is no primary key for comments.
Is used as a before_save callback to check while saving a collection association whether or not the parent was a new record before saving.
Mail will actually use the +:return_path+ in preference to the +:sender+ in preference to the +:from+ field for the 'envelope from' value.
NOTE: With Ruby 2.4+ the default for +to_time+ changed from converting to the local system time, to preserving the offset of the receiver.
Note: If the day is not included as an option but the month is, the day will be set to the 1st to ensure that all month choices are valid.
Other array literals shall have their first element indented one step more than the start of the line where the opening square bracket is.
Overwrite this factory method for EventMachine Redis connections if you want to use a different Redis connection library than EM::Hiredis.
Remove and return the head the queue if the number of available elements is strictly greater than the number of threads currently waiting.
Removing a line break between a comment and the closing parenthesis would cause a syntax error, so we only remove the braces in that case.
Returns the path of .rubocop.yml searching upwards in the directory structure starting at the given directory where the inspected file is.
Since we keep references from children to parents and not just the other way around, we cannot update an AST and share identical subtrees.
So in the example above, the irregular rule for octopus will now be the first of the pluralization and singularization rules that is runs.
The XML builder seems to fail miserably when trying to tag something with the same name as a Kernel method (throw, test, loop, select ...)
They are made up of one or more actions that are executed on request and then either it renders a template or redirects to another action.
This class parses the special `rubocop:disable` comments in a source and provides a way to check if each cop is enabled at arbitrary line.
User.transaction do User.create(username: 'Kotori') User.transaction do User.create(username: 'Nemu') raise ActiveRecord::Rollback end end
We always want to persist the locking version, even if we don't detect a change from the default, since the database might have no default
pirate.reject_empty_ships_on_create returns false for saved pirate records in the previous step note that pirate gets saved but ship fails
All operations you run on the app_middleware will be replayed on the application once it is defined and the default_middlewares are created
Because this transformation is idempotent, this helper can be applied even if +ActiveSupport.escape_html_entities_in_json+ is already true.
However, since MySQL doesn't support DDL transactions, creating a table will result in any created savepoints to be automatically released.
If the application returns a "X-Cascade" pass response, this middleware will send an empty response as result with the correct status code.
If the argument is a regular hash with keys +:key+ and +"key"+ only one of the values end up in the receiver, but which one is unspecified.
If the connection dies while sending an SSE to the browser, then the server will receive a +Last-Event-ID+ header with value equal to +id+.
If you don't have SSL certificates for each of the asset hosts this technique allows you to avoid warnings in the client about mixed media.
Instead of passing the content as an argument, you can also use a block in which case, you pass your +html_options+ as the first parameter.
It can be useful if you have a rack application that you would like to wrap with +Engine+ and provide with some of the +Engine+'s features.
Otherwise returns the result of the block, +nil+ if no callbacks have been set, or +true+ if callbacks have been set but no block is given.
Otherwise, the supplied block is called for each key for which there was no data, and the result will be written to the cache and returned.
SCHEMA queries cannot be EXPLAINed, also we do not want to run EXPLAIN on our own EXPLAINs no matter how loopingly beautiful that would be.
The basic idea is that each thread checks out a database connection from the pool, uses that connection, and checks the connection back in.
The generated ID for a given label is constant, so we can discover any fixture's ID without loading anything, as long as we know the label.
There are queries that you can't execute inside a transaction though, and for these situations you can turn the automatic transactions off.
There is also a list of default options supported by every validator: +:if+, +:unless+, +:on+, +:allow_nil+, +:allow_blank+, and +:strict+.
This assertion should preferably be the last in the list, because calling other_topic_klass.table_name sets a class-level instance variable
This can be done by overwriting the default accessors (using the same name as the attribute) and calling +super+ to actually change things.
Time.new can be called with a time zone offset When it is, that should be considered safe Example: Time.new(1988, 3, 15, 3, 0, 0, "-05:00")
define_method may be slower on dispatch, but if you're careful about the closure created, then define_method will consume much less memory.
define_model_callbacks :create,  only: :after define_model_callbacks :update,  only: :before define_model_callbacks :destroy, only: :around
don't warn about defs nodes which are followed by a call to `private_class_method :name` obviously the programmer knows what they are doing
normal code indentation is 2 spaces, and we have configured multiline method indentation to 6 spaces so in this case, 8 spaces are required
normal code indentation is 2 spaces, and we have configured multiline method indentation to 7 spaces so in this case, 9 spaces are required
(You can also pass any object which responds to +call+ to the +default_scope+ macro, and it will be called when building the default scope.)
* Single aggregate value: The single value is type cast to Fixnum for COUNT, Float for AVG, and the given column's type for everything else.
A Ruby source file is defined as a file with the `.rb` extension or a file with no extension that has a ruby shebang line as its first line.
Adds index options to the indexes hash, keyed by column name This is primarily used to track indexes that need to be created after the table
If +selected+ is specified as a value or array of values, the element(s) returning a match on +value_method+ will be selected option tag(s).
If you pass a Symbol as the first argument, then a corresponding cache store class under the ActiveSupport::Cache namespace will be created.
In such a situation you must decide whether to leave that migration or rename the migration in the application and rerun copying migrations.
Note that when options are passed in, you must call +objectify_options+ in order for the model object to get correctly passed to the method.
Raised when a connection could not be obtained within the connection acquisition timeout period: because max connections in pool are in use.
Returns a hash where the keys are column names and the values are default values when instantiating the Active Record object for this table.
The word will be pluralized using rules defined for the locale (you must define your own inflection rules for languages other than English).
There is also a list of default options supported by every validator: +:if+, +:unless+, +:on+, +:allow_nil+, +:allow_blank+, and +:strict+ .
Therefore, it won't work with instances of classes that do not have +Object+ among their ancestors, like direct subclasses of +BasicObject+.
Therefore, we need to parse and re-dump the raw value here to ensure the insignificant whitespaces are consistent with our encoder's output.
This cop finds uses of `alias` where `alias_method` would be more appropriate (or is simply preferred due to configuration), and vice versa.
This should only be set by methods which will call changed_attributes multiple times when it is known that the computed value cannot change.
This will let you use your domain objects across much of Active Record, without having to rely on implementation details or monkey patching.
To add an initialization step to the Rails boot process from your railtie, just define the initialization code with the +initializer+ macro:
but this class is intended for use cases where strings or symbols are the expected keys and it is convenient to understand both as the same.
go through nested autosave associations that are loaded in memory (without loading any new ones), and return true if is changed for autosave
validates_with MyValidator validates_with OtherValidator, on: :create validates_with StrictValidator, strict: true validate :cannot_be_robot
:nodoc: This module is responsible for providing `rescue_from` helpers to controllers and configuring when detailed exceptions must be shown.
A number of operations are defined so that you can search among the paths in this set and also perform operations on other +PathSet+ objects.
BCrypt hash function can handle maximum 72 characters, and if we pass password of length more than 72 characters it ignores extra characters.
By default this will call +validates_each+ to determine validity therefore subclasses should override +validates_each+ with validation logic.
Files under these directories will be reloaded on each request in development mode, unless the directory also appears in autoload_once_paths.
However, after insert_record has been called, the cache is cleared in order to allow multiple instances of the same record in an association.
However, if there is a WHERE clause that spans across tables Active Record will fall back to a slightly more resource-intensive single query:
In the case of a belongs_to relationship, an association key can be used to specify the model if an ActiveRecord object is used as the value.
It is recommended not to use the same verifier for different things, so you can get different verifiers passing the +verifier_name+ argument.
Mobile Safari looks for a different link tag, pointing to an image that will be used if you add the page to the home screen of an iOS device.
NOTE that scopes defined with a string as a name worked on their own but when called on another scope the other scope was completely replaced
Need to scan rhs before assignment so that we can mark previous assignments as referenced if rhs has referencing to the variable itself like:
No .rubocop.yml file in dir2 means that the paths from default.yml are interpreted as relative to the current directory, so they don't match.
Now when a new request for the index action is processed, the layout will vary depending on whether the person accessing is logged in or not.
PostgreSQL requires the ORDER BY columns in the select list for distinct queries, and requires that the ORDER BY include the distinct column.
Provides a number of methods for creating form tags that don't rely on an Active Record object assigned to the template like FormHelper does.
Read more: https://github.com/cyu/rack-cors Rails.application.config.middleware.insert_before 0, Rack::Cors do allow do origins 'example.com'
Returns meta tags "csrf-param" and "csrf-token" with the name of the cross-site request forgery protection parameter and token, respectively.
Since HTML and JavaScript requests are typically made from the browser, we need to ensure to verify request authenticity for the web browser.
That would add something like "Process data files (345.2ms)" to the log, which you can then use to compare timings when optimizing your code.
The block takes two arguments, the first is the value paired with its key and the second is the remaining hash of options passed to +render+.
The default is +nil+, which tells the method to make a guess by peeking at the first indented line, and fallback to a space if there is none.
Then in your class, you can use the +before_create+, +after_create+ and +around_create+ methods, just as you would in an Active Record model.
This cop (by default) checks for uses of the lambda literal syntax for single line lambdas, and the method call syntax for multiline lambdas.
This is handled by walking back up the watch stack and adding the constants found by child.rb to the list of original constants in parent.rb.
This middleware rescues any exception returned by the application and calls an exceptions app that will wrap it in a format for the end user.
Thus this test prepares waiting threads and then trickles in available connections slowly, ensuring the wakeup order is correct in this case.
To implement the corresponding hosts you can either setup four actual hosts or use wildcard DNS to CNAME the wildcard to a single asset host.
We know that we wrote a UTF-8 encoded string to the cache file, so it's safe to force-encode it back to UTF-8 if it happens to be ASCII-8BIT.
add_column(:measurements, :sensor_reading, :decimal, precision: 30, scale: 20) ALTER TABLE "measurements" ADD "sensor_reading" decimal(30,20)
failing to do so means that in cases like activerecord/test/cases/associations/inner_join_association_test.rb:136 incorrect SQL is generated.
* Define an +attributes+ method which returns a hash with each attribute name in your model as hash key and the attribute value as hash value.
+BlockValidator+ is a special +EachValidator+ which receives a block on initialization and call this block for each attribute being validated.
Action Mailer provides some intelligent defaults for your emails, these are usually specified in a default method inside the class definition:
After setting an option in the constructor of the SSE object, all future SSEs sent across the stream will use those options unless overridden.
An implementation might choose not to accept a previously used nonce or a previously used digest, in order to protect against a replay attack.
Any proxy setup will put the value you want in the middle (or at the beginning) of the X-Forwarded-For list, with your proxy servers after it.
Each macro adds a number of methods to the class which are specialized according to the collection or association symbol and the options hash.
Given +path+, a filesystem path to a ruby file, return an array of constant paths which would cause Dependencies to attempt to load this file.
If your type has the same name as a native type for the current adapter, an exception will be raised unless you specify an +:override+ option.
It lets us return the response code and headers back up the rack stack, and still process the body in parallel with sending data to the client
It shows how all migrations have two methods +up+ and +down+ that describes the transformations required to implement or remove the migration.
Note that Rails::Application inherits from Rails::Engine, which inherits from Rails::Railtie and the +new+ method on Rails::Railtie is private
Note that this conversion makes some assumptions about the duration of some periods, e.g. months are always 30 days and years are 365.25 days:
Or, using a callable object, you might implement something more specific to your application, which would be out of place in your routes file.
Prepend this callback to have autoloaded constants cleared before any other possible reloading, in case they need to autoload fresh constants.
So, if we had a comments page and wanted to render a "Go Back" link instead of a link to the comments page, we could do something like this...
Sort through the various IP address headers, looking for the IP most likely to be the address of the actual remote client making this request.
The first and last part used to find the generator to be invoked are guessed based on class invokes hook_for, as noticed in the example above.
The mappings are exposed through a class method with the pluralized attribute name, which return the mapping in a +HashWithIndifferentAccess+:
This is especially beneficial for adding new finders, creators, and other factory-type methods that are only used as part of this association.
This is very helpful for easily exposing store keys to a form or elsewhere that's already built around just accessing attributes on the model.
When a migration is run, its schema number is inserted in to the `SchemaMigration.table_name` so it doesn't need to be executed the next time.
aliased to avoid conflicts with a javascript_path named route Computes the full URL to a JavaScript asset in the public javascripts directory.
aliased to avoid conflicts with a stylesheet_path named route Computes the full URL to a stylesheet asset in the public stylesheets directory.
:nodoc: The goal of this module is to move Adapter specific column definitions to the Adapter instead of having it in the schema dumper itself.
Controller actions are protected from Cross-Site Request Forgery (CSRF) attacks by including a token in the rendered HTML for your application.
Creates a link tag of the given +name+ using a URL created by the set of +options+ if +condition+ is true, otherwise only the name is returned.
For exploded style (default), it recommends passing the exception class and message to `raise`, rather than construct an instance of the error.
If the file is found, has valid encoding, and has correct read permissions, the return value is a URI-escaped string representing the filename.
If you decide to define rake tasks, runners, or initializers in an application other than +Rails.application+, then you must run them manually.
If you look directly to the database you cannot assume that's the entire collection because new records may have been added to the target, etc.
It clears the validators that are created with an invocation of +validates_with+ and the callbacks that are set by an invocation of +validate+.
Layers additional behavior on Time.at so that ActiveSupport::TimeWithZone and DateTime instances can be used when called with a single argument
Note that if you are really concerned about your application security, you might consider using +config.force_ssl+ in your config file instead.
Public instance methods of a controller would normally be considered action methods, so methods declared on abstract classes are being removed.
Returns whether or not this record has been changed in any way (including whether any of its nested autosave associations are likewise changed)
Since the IP address may not be needed, we store the object here without calculating the IP to keep from slowing down the majority of requests.
So a join between Developer and Project will give the default join table name of "developers_projects" because "D" precedes "P" alphabetically.
This cop checks the indentation of the first element in an array literal where the opening bracket and the first element are on separate lines.
This method raises an ActiveRecord::ActiveRecordError when called on new objects, or when at least one of the attributes is marked as readonly.
Thus, you won't be able to verify the results of your transaction until Active Record supports nested transactions or savepoints (in progress).
Unfortunately this introduces a gotcha: if a +User+ model has an +avatar+ field, and no file is selected, then the +avatar+ parameter is empty.
When the select element doesn't have a value yet, this prepends an option with a generic prompt - "Please select" - or the given prompt string.
* +class_name_or_coder+ - Optional, a coder object, which responds to `.load` / `.dump` or a class name that the object type should be equal to.
A FormatterSet can hold multiple formatter instances and provides transparent formatter API methods which invoke same method of each formatters.
A single string, without additional arguments, is passed to the query constructor as an SQL fragment, and used in the where clause of the query.
All stored values are automatically available through accessors on the Active Record object, but sometimes you want to specialize this behavior.
Each method called in the block, with the block variable as the receiver, will have its options merged with the default +options+ hash provided.
In addition, parameters can be marked as required and flow through a predefined raise/rescue flow to end up as a 400 Bad Request with no effort.
Indeed it would be prettier to do this in PostgreSQLColumn.string_to_decimal but would break form input fields that call value_before_type_cast.
Mark all assignments which are referenced in the same loop as referenced by ignoring AST order since they would be referenced in next iteration.
One exception is the ActiveRecord::Rollback exception, which will trigger a ROLLBACK when raised, but not be re-raised by the transaction block.
Oracle adapter cannot have specified index name larger than 30 characters Oracle adapter is shortening index name when just column list is given
Returns a new object of the collection type that has been instantiated with +attributes+ and linked to this object, but have not yet been saved.
The +parsers+ argument can take Hash of parsers where key is identifying content mime type, and value is a lambda that is going to process data.
The second line in the assert_queries block was causing visit_Arel_Attributes_Attribute in Arel::Visitors::ToSql to trigger a SHOW TABLES query.
The values are passed to the connector for quoting, but the caller is responsible for ensuring they are enclosed in quotes in the resulting SQL.
This ensures the model has a password by checking whether the password_digest is present, so that this works with both new and existing records.
creates six different routes in your application, all mapping to the +Profiles+ controller (note that the controller is named after the plural):
https://github.com/apache/lucene-solr/blob/lucene_solr_4_9_0/lucene/suggest/src/test/org/apache/lucene/search/spell/TestJaroWinklerDistance.java
:nodoc: The SQLite3 adapter works SQLite 3.6.16 or newer with the sqlite3-ruby drivers (available as gem from https://rubygems.org/gems/sqlite3).
ActionController::Parameters.new(person: nil).require(:person) ActionController::ParameterMissing: param is missing or the value is empty: person
Active Record takes care of building the query to avoid injection attacks, and will convert from the ruby type to the database type where needed.
ActiveModel::Validations A set of common cases for ActiveModel::Validations message generation that are used to generate tests to keep things DRY
Although this command ignores the block if one is given, it can be helpful to provide one in a migration's +change+ method so it can be reverted.
Any subsequent condition chained to the returned relation will continue generating an empty relation and will not fire any query to the database.
If a cache expires and due to heavy load several different processes will try to read data natively and then they all will try to write to cache.
If the collection is loaded, the method will iterate through the records to generate the timestamp, otherwise it will trigger one SQL query like:
If you are behind multiple proxy servers (like NGINX to HAProxy to Unicorn) then you should test your Rack server to make sure your data is good.
If you don't just want to parlay the broadcast unfiltered to the subscriber, you can also supply a callback that lets you alter what is sent out.
In general, this module should not be included on its own, as it is usually included by url_helpers (as in Rails.application.routes.url_helpers).
It's initially stuck on the outer share lock, but as soon as that's released, it can run -- regardless of whether those threads hold share locks.
Person.where(name: 'Spartacus', rating: 4).select("field1, field2, field3") returns a chainable list of instances with only the mentioned fields.
Please note that with touching no validation is performed and only the +after_touch+, +after_commit+ and +after_rollback+ callbacks are executed.
Raise ClientDisconnected, which is a RuntimeError (not an IOError), because that's more appropriate for something beyond the developer's control.
Since Ruby does not support fall through inside of `case` `when`, like some other languages do, the order of the `when` branches does not matter.
The latter is a flawed and unsustainable approach (the more migrations you'll amass, the slower it'll run and the greater likelihood for issues).
The use of this method should be restricted to complicated SQL queries that can't be executed using the ActiveRecord::Calculations class methods.
This happens because part of the template was already rendered and streamed to the client, making it impossible to render a whole exception page.
This method is called whenever no records are found with either a single id or multiple ids and raises an ActiveRecord::RecordNotFound exception.
To prevent users from using something insecure like "Password" we make sure that the secret they've provided is at least 30 characters in length.
When testing these, we need to make sure it works via loading the association directly, or joining the association, or including the association.
When the select element doesn't have a value yet, this prepends an option with a generic prompt -- "Please select" -- or the given prompt string.
if user provided "name:index" instead of "name:string:index" type should be set blank so GeneratedAttribute's constructor could set it to :string
wrap_parameters Person wraps parameters by determining the wrapper key from Person class (+person+, in this case) and the list of attribute names
1AM during fall DST transition is ambiguous, it could be either DST or non-DST 1AM Mirroring Time.local behavior, this method selects the DST time
ActiveRecord::StatementInvalid exceptions indicate that an error occurred at the database level, for example when a unique constraint is violated.
Callbacks are generally run in the order they are defined, with the exception of callbacks defined as methods on the model, which are called last.
Changes current time to the time in the future or in the past by a given time difference by stubbing +Time.now+, +Date.today+, and +DateTime.now+.
Clone and freeze the attributes hash such that associations are still accessible, even on destroyed records, but cloned models will not be frozen.
Execute before and after filters in a sequence instead of chaining them with nested lambda calls, see: https://github.com/rails/rails/issues/18011
However, when there is an error, the message is added to the password attribute instead so that the error message will make sense to the end-user.
If the user is given a way to change their locale, they will also be able to change the relative value of the currency displayed with this helper.
If you have a nested route, such as +admin_workshop_path+ you'll have to call that explicitly (it's impossible for +url_for+ to guess that route).
If you need to create the application database on another system, you should be using db:schema:load, not running all the migrations from scratch.
In that case, it'll work just like normal subclasses with no special magic for differentiating between them or reloading the right type with find.
Like Action Controller, each mailer class has a corresponding view directory in which each method of the class looks for a template with its name.
Normally when you create controllers, helpers and models inside an engine, they are treated as if they were created inside the application itself.
The Chars object tries to be as interchangeable with String objects as possible: sorting and comparing between String and Char work like expected.
The best way to use this is by doing key-based cache expiration on top of a cache store like Memcached that'll automatically kick out old entries.
The cache key is built with a fingerprint of the sql query, the number of records matched by the query and a timestamp of the last updated record.
The month names are presented as keys (what's shown to the user) and the month numbers (1-12) are used as values (what's submitted to the server).
The only requirement is that the +model+ parameter be an object that responds to +all+, and returns an array of objects that represent time zones.
The return value of this method will implement the interface described by ActiveModel::Type::Value (though the object itself may not subclass it).
This essentially finds the object (or multiple objects) with the given id, creates a new object from the attributes, and then calls destroy on it.
We need this initializer so all extra initializers added in engines are consistently executed after all the initializers above across all engines.
You can also supply an array of ActiveSupport::TimeZone objects as +priority_zones+ so that they will be listed above the rest of the (long) list.
:nodoc: ActiveRecord::Tasks::DatabaseTasks is a utility class, which encapsulates logic behind common tasks used to manage database and migrations.
:nodoc: Chars enables you to work transparently with UTF-8 encoding in the Ruby String class without having extensive knowledge about the encoding.
As you can pass in any header, you need to either quote the header as a string, or pass it in as an underscored symbol, so the following will work:
Asserts that the routing of the given +path+ was handled correctly and that the parsed options (given in the +expected_options+ hash) match +path+.
Care should be taken if +text+ contains HTML tags or entities, because truncation may produce invalid HTML (such as unbalanced or incomplete tags).
Changes current time to the given time by stubbing +Time.now+, +Date.today+, and +DateTime.now+ to return the time or date passed into this method.
CollectionAssociation is an abstract class that provides common stuff to ease the implementation of association proxies that represent collections.
Creates a hidden form input field used to transmit data that would be lost due to HTTP's statelessness or data that should be hidden from the user.
Defines your model's +to_param+ method to generate "pretty" URLs using +method_name+, which can be any attribute or method that responds to +to_s+.
If password confirmation validation is not needed, simply leave out the value for +password_confirmation+ (i.e. don't provide a form field for it).
It is no longer enough to wrap it in +synchronize+ because some pool's actions are allowed to be performed outside of the main +synchronize+ block.
Note: The precision is the total number of significant digits and the scale is the number of digits that can be stored following the decimal point.
Returns a Hash of instance variables and their values, as defined by the user in the test case, which are then assigned to the view being rendered.
So it's no catch-all for performance problems, but it's a great way to cut down on the number of queries in a situation as the one described above.
Supporting polymorphic relationships is a little bit more complicated, since Active Record needs to know what type your association is pointing at.
The HTML specification says when +multiple+ parameter passed to select and all options got deselected web browsers do not send any value to server.
The class provides version or help information if they were requested, and also constructs the railsrc file (used for extra configuration options).
The drivers each provide mechanisms for listening for the completion of the Ajax request and performing JavaScript operations once they're complete
The last three methods are required in your object for +Errors+ to be able to generate error messages correctly and also handle multiple languages.
The plugin builder allows you to override elements of the plugin generator without being forced to reverse the operations of the default generator.
The references are forever, so they won't be released as is normally the case with a controller instance that gets thrown away after every request.
The registered preview interceptors will be informed so that they can transform the message as they would if the mail was actually being delivered.
This pattern has been implemented as a single method that accepts an array and renders a partial by the same name as the elements contained within.
This validator defers to the Active Model validation for presence, adding the check to see that an associated object is not marked for destruction.
You can also supply an array of ActiveSupport::TimeZone objects as +priority_zones+, so that they will be listed above the rest of the (long) list.
added order by id as in fixtures there are two accounts for Rails Core Oracle tests were failing because of that as the second fixture was selected
releasing only those conns that were checked out in this method, conns checked outside this method (before it was called) are not for us to release
* It does not call +to_a+ on the argument, if the argument does not respond to +to_ary+ it returns an array with the argument as its single element.
-- Qualified names are required to be relative because we are extending existing methods that expect constant names, ie, relative paths of length 1.
All of the methods are built on a simple caching principle that will keep the result of the last query around unless specifically instructed not to.
Delete the given records from the association, using one of the methods :destroy, :delete_all or :nullify (or nil, in which case a default is used).
However, when a layout is explicitly set, the explicitly set layout wins: * The InformationController uses the "information" layout, explicitly set.
If nothing has been stored in the cache, there is a chance the cache directory does not yet exist Ensure delete_matched gracefully handles this case
If the +source+ filename has no extension, .js will be appended (except for explicit URIs) Full paths from the document root will be passed through.
If there is no content type passed in via headers, and there are no attachments, or the message is multipart, then the default content type is used.
Implementations that support delete_matched should call this method to translate a pattern that matches names into one that matches namespaced keys.
Note that when an array is used, the implicit mapping from the values to database integers is derived from the order the values appear in the array.
Redirects the browser to the page that issued the request (the referrer) if possible, otherwise redirects to the provided default fallback location.
RuntimeError: can't modify frozen instance of Array kernel/common/array.rb:988:in `pop' ./lib/rubocop/cop/style/indentation_width.rb:99:in `on_case'
Separate connections to an in-memory database create an entirely new database, with an empty schema etc, so we just stub out this schema on the fly.
This cop is used to identify usages of `select.first`, `select.last`, `find_all.first`, and `find_all.last` and change them to use `detect` instead.
This ensures that we don't timeout one HTTP request even while well under capacity in a multi-threaded environment such as a Java servlet container.
This migration first adds the +system_settings+ table, then creates the very first row in it using the Active Record model that relies on the table.
When running with --auto-correct, we need to inspect the file (which includes writing a corrected version of it) until no more corrections are made.
module Copyable def copy_to(destination) Notification.suppress do Copy logic that creates new comments that we do not want triggering notifications.
now set a time between 1:00 and 2:00 by specifying whether DST is active uses: Time.local( sec, min, hour, day, month, year, wday, yday, isdst, tz )
now set a time between 2:00 and 3:00 by specifying whether DST is active uses: Time.local( sec, min, hour, day, month, year, wday, yday, isdst, tz )
previous implementation of validates_presence_of eval'd the string with the wrong binding, this regression test is to ensure that it works correctly
+id_value+ will be returned unless the value is nil, in which case the database will attempt to calculate the last inserted id and return that value.
Allows you to choose which attributes should be whitelisted for mass updating and thus prevent accidentally exposing that which shouldn't be exposed.
By default, this implementation passes the key string through a method that replaces all characters that are invalid inside DOM ids, with valid ones.
Finally, all the above styles can be mixed together, and the +helper+ method can be invoked with a mix of +symbols+, +strings+, +modules+ and blocks.
If specified, the block can also receive the application object, in case you need to access some application-specific configuration, like middleware:
In addition to these specific assertions, you also have easy access to various collections that the regular test/unit assertions can be used against.
It provides a method to capture blocks into variables through capture and a way to capture a block of markup for use in a layout through content_for.
Note that anything marked as an identifier will automatically create a delegate by the same name on any channel instances created off the connection.
Plan your deployment accordingly: 5 servers each running 5 Puma workers each running an 8-thread worker pool means at least 200 database connections.
Since this is currently depending on Redcarpet to cooperate, we are going to be naive, and only allow line highlighting when a language is specified.
The unique request id can be used to trace a request end-to-end and would typically end up being part of log files from multiple pieces of the stack.
There are no tests for this behavior in lint because it doesn't make sense to force any of the possible implementation strategies on the implementer.
Unfortunately we cannot actually know if a method is from Enumerable or not (static analysis limitation), so this cop can yield some false positives.
When the argument is a string or symbol, the method will provide the "_helper" suffix, require the file and include the module in the template class.
`users/new.html` will be loaded from `users/html/new.erb` or `users/new.html.erb`, `users/new.js` from `users/js/new.erb` or `users/new.js.erb`, etc.
this can fail on adapters which require ORDER BY expressions to be included in the SELECT expression if the reorder clauses are not correctly handled
use VARCHAR2(4000) instead of CLOB datatype as CLOB data type has many limitations in Oracle SELECT WHERE clause which causes many unit test failures
* +:from+ - Who the message is from * +:cc+ - Who you would like to Carbon-Copy on this email, can be a string of addresses, or an array of addresses.
ActiveRecord::Base.establish_connection( adapter:  "mysql2", host:     "localhost", username: "myuser", password: "mypass", database: "somedatabase" )
All column values are automatically available through basic accessors on the Active Record object, but sometimes you want to specialize this behavior.
Calls the before and around callbacks in the order they were set, yields the block (if given one), and then runs the after callbacks in reverse order.
Enough connections are checked in to wakeup all group1 threads, and the fact that only group1 and no group2 threads acquired a connection is enforced.
Guesses the table name (in forced lower-case) based on the name of the class in the inheritance hierarchy descending directly from ActiveRecord::Base.
If it matches the current ETag, we can return a 304 Not Modified response with no body, letting the browser or proxy know that their cache is current.
If you need to use a MIME type which isn't supported by default, you can register your own handlers in +config/initializers/mime_types.rb+ as follows.
If you're not going to be using any of the options like collections or layouts, you can also use the short-hand defaults of render to render partials.
If your template cache depends on multiple sources (try to avoid this to keep things simple), you can name all these dependencies as part of an array:
In the above case, because the controller was explicitly given, but no action, the action is implied to be "index", not the recalled action of "show".
It does this by checking various headers that could contain the address, and then picking the last-set address that is not on the list of trusted IPs.
The fact that we pass `:developers_projects_join` to `references` and that the SQL string contains `developers_projects_join` is merely a coincidence.
The reason is that the parent model's type is a column value so its corresponding table name cannot be put in the +FROM+/+JOIN+ clauses of that query.
Then, in the action, we extract the company data from the request, find or create the company, and then create the new person with the remaining data.
They need to be executed in isolation to reproduce the scenario correctly, because other test cases might have already loaded additional dependencies.
This can be overridden on an Adapter level basis to support other extended datatypes (Example: Adding an array option in the PostgreSQL::ColumnDumper)
This means that other parts of Rails can always assume that templates are encoded in UTF-8, even if the original source of the template was not UTF-8.
This module creates compiled delegation methods dynamically at runtime, which makes subsequent calls to that method faster by avoiding method_missing.
Useful for having links perform a POST operation in dangerous actions like deleting a record (which search bots can follow while spidering your site).
When prompted, restart the PostgreSQL server with the "-m fast" option or kill the individual connection assuming you know the incantation to do that.
You can give +link_to_unless_current+ a block which will specialize the default behavior (e.g., show a "Start Here" link rather than the link's text).
render partial: "comments/comment", collection: commentable.comments render "comments/comments" render 'comments/comments' render('comments/comments')
resources :toys, concerns: :purchasable resources :electronics, concerns: :purchasable resources :pets do concerns :purchasable, returnable: false end
Allow database path relative to Rails.root, but only if the database path is not the special path that tells sqlite to build a database only in memory.
Creates a link tag of the given +name+ using a URL created by the set of +options+ unless +condition+ is true, in which case only the name is returned.
Deletes the +records+ and removes them from this association calling +before_remove+ , +after_remove+ , +before_destroy+ and +after_destroy+ callbacks.
Finally, the options +:if+, +:unless+, +:on+, +:allow_blank+, +:allow_nil+, +:strict+ and +:message+ can be given to one specific validator, as a hash:
If there are other threads or processes there is a race condition between both calls and it could be the case that you end up with two similar records.
If those elements are ActiveRecord::Base's, then this triggers the various method_missing's that we have, which significantly impacts upon performance.
Returns a radio button tag for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
Since it always passes a ::JSON::State object as the only argument to to_json, we can detect that and forward the calls to the original to_json method.
Support legacy foo.erb names even though we now ignore .erb as well as incorrectly putting part of the path in the template name instead of the prefix.
TODO: once the offset argument is removed we rely on offset_index within find_nth_with_limit, rather than pass it in via find_nth_with_limit_and_offset
The public controller methods +respond_to+ may be called with a block that is used to define responses to different mime-types, e.g. for +respond_to+ :
This has exactly one variant template defined in the file system (+mobile.html.erb), which raises the regular MissingTemplate error for other variants.
This will provide access to fixture data for every table that has been loaded through fixtures (depending on the value of +use_instantiated_fixtures+).
frozen_string_literal: true RuboCop can be run in contexts where unexpected other libraries are included, which may interfere with its normal behavior.
need to make sure Object::Firm and Object::Client are not defined, so that constantize will not be able to cheat when having to load namespaced classes
Because callbacks are run in the order they are defined, associated objects may need to be explicitly saved in any user-defined +before_save+ callbacks.
But we also allow the "end" to be aligned with the start of the line where the "do" is, which is a style some people use in multi-line chains of blocks.
If they do have such a constant, then this const_missing must be due to from_mod::const_name, which should not return constants from from_mod's parents.
If you don't like this behavior you can provide a different directory but it must be on the same physical filesystem as the file you're trying to write.
In general, an existing record may either be updated with the new set of attribute values or be replaced by a wholly new record containing those values.
It simply does a direct SQL update for the record with the given ID, altering the given hash of counters by the amount given by the corresponding value:
Normally we've already committed by now, but it's possible (e.g., if the controller action tries to read back its own response) to get here before that.
Note that because +delete_all+ removes records by directly running an SQL query into the database, the +updated_at+ column of the object is not changed.
Record destruction so we can test whether firm.clients.clear has is calling client.destroy, deleting from the database, or setting foreign keys to NULL.
Sets the name of the sequence to use when generating ids to the given value, or (if the value is nil or false) to the value returned by the given block.
This makes it less repetitive to translate many keys within the same controller / action and gives you a simple framework for scoping them consistently.
This should be set to, or include, +true+ if you are validating a database column, since the attribute is typecast from "1" to +true+ before validation.
Use to indicate that the given +table_names+ are referenced by an SQL string, and should therefore be JOINed in any query rather than loaded separately.
When joining tables, nested hashes or keys written in the form 'table_name.column_name' can be used to qualify the table name of a particular condition.
(You can use ActiveSupport::TimeZone.us_zones as a convenience for obtaining a list of the US time zones, or a Regexp to select the zones of your choice)
Decimal units output formatting By default we will only quantify some of the exponents but the commented ones might be defined or overridden by the user.
For instance: +json+ and +jsonb+ types in PostgreSQL will be converted between JSON object/array syntax and Ruby +Hash+ or +Array+ objects transparently.
If the user didn't specify an encoding, and the handler handles encodings, we simply pass the String as is to the handler (with the default_external tag)
If we replace the brace with a brace plus space (rather than just inserting a space), then any removal of the same brace will give us a clobbering error.
In this example, the auto-correction (changing "fail" to "raise") creates a new problem (alignment of parameters), which is also corrected automatically.
It reads legacy cookies signed with the old dummy key generator and signs and re-saves them using the new key generator to provide a smooth upgrade path.
Note that if you do not specify the +:inverse_of+ option, then Active Record will try to automatically guess the inverse association based on heuristics.
Note that this is a naive implementation because we could have strings and symbols which represent the same association, but that aren't matched by this.
Otherwise the cache would see the same SQL query and repeatedly return the same result each time, silently undermining the randomness you were expecting.
These two settings work together to allow you to limit a spec run to individual examples or groups you care about by tagging them with `:focus` metadata.
When a request with a content type other than HTML is made, this middleware will attempt to convert error information into the appropriate response type.
Currently this cop has advanced logic that detects unreferenced reassignments and properly handles varied cases such as branch, loop, rescue, ensure, etc.
Every database and/or database adapter has their own behavior if it drops the multi-column index when any of the indexed columns dropped by remove_column.
For example, if you've created a savepoint, then you execute a CREATE TABLE statement, then the savepoint that was created will be automatically released.
If the file starts with a byte order mark (BOM), the column can be non-zero, but then we find out here if there's no space to the left of the first token.
If we have a magic comment in the original migration, insert our comment after the first newline(end of the magic comment line) so the magic keep working.
It's like a simple key/value store baked into your record when you don't care about being able to query that store outside the context of a single record.
It's well-suited for dev/test since it doesn't need an external infrastructure, but it's a poor fit for production since it drops pending jobs on restart.
Note: Acronyms that are passed to +pluralize+ will no longer be recognized, since the acronym will not occur as a delimited unit in the pluralized result.
On the other hand it could be that the target has side-effects, whereas conceptually, from the user point of view, the delegator should be doing one call.
Some are aliased such as "rails:migration" and can be invoked with the shorter "migration", others are private to other generators such as "css:scaffold".
The +given_day_in_next_week+ defaults to the beginning of the week which is determined by +Date.beginning_of_week+ or +config.beginning_of_week+ when set.
They can also be any object that responds to +call+, such as a +proc+, that will be called for each member of the +collection+ to retrieve the value/text.
When using a nested association, you will not be able to modify the association because there is not enough information to know what modification to make.
Where `param_encoder` defines how the params should be encoded and `response_parser` defines how the response body should be parsed through `parsed_body`.
add_column(:articles, :status, :string, limit: 20, default: 'draft', null: false) ALTER TABLE "articles" ADD "status" varchar(20) DEFAULT 'draft' NOT NULL
Active Record looks at the fixture's model class, discovers the correct primary key, and generates it right before inserting the fixture into the database.
For one-to-one nested associations, if you build the new (in-memory) child object yourself before assignment, then this module will not overwrite it, e.g.:
If you're not streaming a broadcasting at the very moment it sends out an update, you will not get that update, even if you connect after it has been sent.
Note that Rails default validators can be overridden inside specific classes by creating custom validator classes in their place such as PresenceValidator.
PartialRenderer - Used for rendering partials TemplateRenderer - Used for rendering other types of templates StreamingTemplateRenderer - Used for streaming
Resque (pronounced like "rescue") is a Redis-backed library for creating background jobs, placing those jobs on multiple queues, and processing them later.
Returns any connections in use by the current thread back to the pool, and also returns connections to the pool cached by threads that are no longer alive.
The cache is even shared across methods to make it even cheaper to use the macro-added methods without worrying too much about performance at the first go.
The example of partial use describes a familiar pattern where a template needs to iterate over an array and render a sub template for each of the elements.
The purpose of allowing strings in rescue_from is to support the declaration of handler associations for exception classes whose definition is yet unknown.
This differs from the above in that it does not have any templates defined in the file system, which triggers the ImplicitRender (204 No Content) behavior.
This is useful when overriding the +validate+ instance method becomes too unwieldy and you're looking for more descriptive declaration of your validations.
To avoid database inconsistencies, permanently deletes an existing associated object when assigning a new one, even if the new one isn't saved to database.
When an entry has a positive :race_condition_ttl defined, put the stale entry back into the cache for a brief period while the entry is being recalculated.
When the object belonging to the current scope has a nested attribute writer for a certain attribute, fields_for will yield a new scope for that attribute.
Will update the name of the Person with ID 1, build a new associated person with the name 'John', and mark the associated Person with ID 2 for destruction.
begin CreditAccount.transaction(requires_new: true) do CreditAccount.find_or_create_by(user_id: user.id) end rescue ActiveRecord::RecordNotUnique retry end
def test_jobs assert_enqueued_jobs 0 HelloJob.perform_later('david') assert_enqueued_jobs 1 HelloJob.perform_later('abdelkader') assert_enqueued_jobs 2 end
:nodoc: semantics of condition variables guarantee that +broadcast+, +broadcast_on_biased+, +signal+ and +wait+ methods are only called while holding a lock
By default, a single session is automatically created for you, but you can use this method to open multiple sessions that ought to be tested simultaneously.
Clients using those libraries would get in general a wrong number and no way to recover other than manually inspecting the string with the JSON code itself.
Functions by instantiating a preloader class such as Preloader::HasManyThrough and call the +run+ method for each passed in class in the +records+ argument.
It reads legacy cookies signed with the old dummy key generator and encrypts and re-saves them using the new key generator to provide a smooth upgrade path.
Returns a checkbox tag tailored for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
Returns the string, first removing all whitespace on both ends of the string, and then changing remaining consecutive whitespace groups into one space each.
The proper way to communicate between layout and template, regardless of whether you use streaming or not, is by using +content_for+, +provide+ and +yield+.
These test cases were added to test that we do not interfere with json gem's output when the AS encoder is loaded, primarily for problems reported in 20775.
This is necessary for doing Range requests within a large video or PDF file, for example, or for compatibility with some CDNs that don't support weak ETags.
This specifically verifies TEST for backwards compatibility with rake test as bin/rails test already supports running tests from a single file more cleanly.
When the request is proxied by another server like HAProxy or NGINX, the IP address that made the original request will be put in an X-Forwarded-For header.
When using multiple parameters in the conditions, it can easily become hard to read exactly what the fourth or fifth question mark is supposed to represent.
* The adapter does not support setting the isolation level * You are joining an existing open transaction * You are creating a nested (savepoint) transaction
A broadcasting is, as discussed elsewhere, a pubsub queue where any data placed into it is automatically sent to the clients that are connected at that time.
An early raised exception could trigger some other handler and the array could include precisely a string whose corresponding constant has not yet been seen.
As you see, the HTML reflects knowledge about the resource in several spots, like the path the form should be submitted to, or the names of the input fields.
Converts Date to a Time (or DateTime if necessary) with the time portion set to the beginning of the day (0:00) and then adds the specified number of seconds
Extends the module object with class/module and instance accessors for class/module attributes, just like the native attr* accessors for instance attributes.
For performance critical pages, selecting only the required fields can be an easy performance win (assuming you aren't using all of the fields on the model).
If +file+ is the filename of a file that contains annotations this method returns a hash with a single entry that maps +file+ to an array of its annotations.
If there are method calls chained to the right hand side of the assignment, we let rhs be the receiver of those method calls before we check its indentation.
In order for the associations to work as expected, ensure that you store the base model for the STI models in the type column of the polymorphic association.
It's also possible to pass a String instead of an options hash, which generates an anchor element that uses the value of the String as the href for the link.
Query implementation notes: - format_type includes the column size constraint, e.g. varchar(50) - ::regclass is a function that gives the id for a table name
The Inflector transforms words from singular to plural, class names to table names, modularized class names to ones without, and class names to foreign keys.
The application builder allows you to override elements of the application generator without being forced to reverse the operations of the default generator.
These methods are useful when you want to generate correct URL or path to a RESTful resource without having to know the exact type of the record in question.
To find those templates, the wildcard path must be absolutely defined from app/views or paths otherwise added with +prepend_view_path+ or +append_view_path+.
We assume that the name of the module reflects the nesting (unless it can be proven that is not the case) and the path to the file that defines the constant.
We want to use the klass from this reflection, rather than just delegate straight to the source_reflection, because the source_reflection may be polymorphic.
When the Asset Pipeline is enabled, you can pass the name of your manifest as source, and include other JavaScript or CoffeeScript files inside the manifest.
Additionally, the digestor will automatically look through your template file for explicit and implicit dependencies, and include those as part of the digest.
Check for `if` and `case` statements where each branch is used for assignment to the same variable when using the return of the condition can be used instead.
If a hash's opening brace is on the line above the first element of the hash, then the closing brace should be on the line below the last element of the hash.
If you want your mailer to be able to process incoming messages, you'll need to implement a +receive+ method that accepts the raw email string as a parameter:
Note that the redirects are followed until the response is not a redirect--this means you may run into an infinite loop if your redirect loops back to itself.
Otherwise, go to the database only if none of the following are true: * target already loaded * owner is new record * target contains new or changed record(s)
Sneakers is being used in production for both I/O and CPU intensive workloads, and have achieved the goals of high-performance and 0-maintenance, as designed.
The hierarchy is defined as follows: Association - SingularAssociation - BelongsToAssociation - HasOneAssociation - CollectionAssociation - HasManyAssociation
The resulting code will be a Fixnum, for real HTTP codes, and it will be a String for the pseudo-HTTP codes, such as: :success, :missing, :redirect and :error
Therefore, once a value is added to the enum array, its position in the array must be maintained, and new values should only be added to the end of the array.
This is not supported if Active Record has to fallback to the previous implementation of eager loading and will raise ActiveRecord::EagerLoadPolymorphicError.
This method checks to see if the ActiveRecord object's state reflects the TransactionState, and rolls back or commits the Active Record object as appropriate.
User.transaction do User.create(username: 'Kotori') User.transaction(requires_new: true) do User.create(username: 'Nemu') raise ActiveRecord::Rollback end end
should delete created record as otherwise disable_referential_integrity will try to enable constraints after executed block and will fail (at least on Oracle)
* If either of these saves fail (due to one of the objects being invalid), an ActiveRecord::RecordNotSaved exception is raised and the assignment is cancelled.
By placing any splat expansions at the end of the list of `when` branches we will reduce the number of times that memory has to be allocated for the expansion.
For example, if you replace the +current_user.to_json+ in the example above with user input instead, the browser will happily eval() that string as JavaScript.
If you don't use a proxy, because you are hosted on e.g. Heroku without SSL, any client can claim to have any IP address by setting the X-Forwarded-For header.
In order to use streaming, you will need to use a Ruby version that supports fibers (fibers are supported since version 1.9.2 of the main Ruby implementation).
Note that this operation instantly fires update SQL without waiting for the save or update call on the parent object, unless the parent object is a new record.
So, using a block, you might do something as simple as limit the actions available on certain resources, passing standard resource options through the concern:
This is the same method seen in Railtie::Configurable, but this module is no longer required for all subclasses of Railtie so we provide the class method here.
We have to require the generated helper to show the problem because the test helpers just check for generated files and contents but do not actually load them.
For backwards compatibility we're overriding this behavior, but new apps will have an initializer that sets this to true, because the new behavior is preferred.
For each argument, if it is a multi-line hash without braces, then promote the hash elements to method arguments for the purpose of determining multi-line-ness.
I don't actually think it's possible to pass a Constraints object to this constructor, but there were multiple places that kept testing children of this object.
If a cop is disabled in a range that begins on the same line as the end of the previous range, it means that the cop was already disabled by an earlier comment.
If a file in the process of being loaded (parent.rb) triggers the load of another file (child.rb) the stack will ensure that child.rb handles the new constants.
Provides helper methods for ActionMailer::Base that can be used for easily formatting messages, accessing mailer or message instances, and the attachments list.
Returns a hidden input tag tailored for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
Since some of them reopen ActiveSupport::Deprecation its autoload would be triggered, resulting in a circular require warning for active_support/deprecation.rb.
The most common usage pattern for this method is probably in a migration, when just after creating a table you want to populate it with some default values, eg:
The most common way of defining these writers is either with +accepts_nested_attributes_for+ in a model definition or by defining a method with the proper name.
This error is raised when trying to destroy a parent instance in N:1 or 1:1 associations (has_many, has_one) when there is at least 1 child associated instance.
This gives better control over what you want to exclude and makes it easier to create a bare controller class, instead of listing the modules required manually.
This gives better control over what you want to exclude and makes it easier to create an API controller class, instead of listing the modules required manually.
if either the old or new template list is empty, we don't need to (and can't) compare modification times, and instead just check whether the lists are different
A NamedRouteCollection instance is a collection of named routes, and also maintains an anonymous module that can be used to install helpers for the named routes.
For all other controllers, we use these heuristics to decide whether to render a template, raise an error for a missing template, or respond with 204 No Content:
Given a container where the elements respond to first and last (such as a two-element array), the "lasts" serve as option values and the "firsts" as option text.
If you are using inheritance with ActiveRecord and don't want child classes to utilize the implied STI table name of the parent class, this will need to be true.
In order to use these methods to access fixtured data within your testcases, you must specify one of the following in your ActiveSupport::TestCase-derived class:
Receives a raw email, parses it into an email object, decodes it, instantiates a new mailer, and passes the email object to the mailer object's +receive+ method.
Setting this check to "always" and "when_needed" makes sense only for code that should support Ruby 1.9, since in 2.0+ utf-8 is the default source file encoding.
The exploded style works identically, but with the addition that it will also suggest constructing error objects when the exception is passed multiple arguments.
The upside of long-lived channel instances is that you can use instance variables to keep reference to objects that future subscriber requests can interact with.
This cop checks for redundant access modifiers, including those with no code, those which are repeated, and leading `public` modifiers in a class or module body.
Alternatively, extra spaces can be added to align the argument with something on a preceding or following line, if the AllowForAlignment config parameter is true.
Because CookieStore extends Rack::Session::Abstract::Persisted, many of the options described there can be used to customize the session cookie that is generated.
If a hash's opening brace is on the same line as the first element of the hash, then the closing brace should be on the same line as the last element of the hash.
If an array's opening brace is on the line above the first element of the array, then the closing brace should be on the line below the last element of the array.
It is one of the easiest ways to prevent the dreaded N+1 problem in which fetching 100 posts that each need to display their author triggers 101 database queries.
Nested transactions don't commit until all parent transactions commit, particularly, the fixtures transaction which is begun in setup and rolled back in teardown.
Returns an array of column objects where the primary id, all columns ending in "_id" or "_count", and columns used for single table inheritance have been removed.
This covers various different error types so we need to do additional work to classify the exception definitively as a ActiveRecord::PreparedStatementCacheExpired
This is used internally by Rails' own test suite, and is useful for testing extensions that have no way of knowing what the file system will look like at runtime.
Unfortunately this introduces a gotcha: if a +User+ model has a +category_id+ field, and in the form none category is selected no +category_id+ parameter is sent.
We also need to reset the runtime before each action because of queries in middleware or in cases we are streaming and it won't be cleaned up by the method below.
Converts Date to a Time (or DateTime if necessary) with the time portion set to the beginning of the day (0:00) and then subtracts the specified number of seconds.
If +secrets.secret_key_base+ and +secrets.secret_token+ (deprecated) are both set, legacy cookies signed with the old key generator will be transparently upgraded.
In addition to using the standard template helpers provided, creating custom helpers to extract complicated logic or reusable functionality is strongly encouraged.
Instead of editing this file, please use the migrations feature of Active Record to incrementally modify your database, and then regenerate this schema definition.
Instead of explicitly naming the location of a partial, you can also let PartialRenderer do the work and pick the proper path by checking `to_partial_path` method.
Returns an input of type "search" for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object_name+).
The Atom spec defines five elements (content rights title subtitle summary) which may directly contain xhtml content if type: 'xhtml' is specified as an attribute.
The exception has an +errors+ property that contains an array of AttributeAssignmentError objects, each corresponding to the error while assigning to an attribute.
These tests are just to surround the current behavior of the ARGVScrubber, they do not mean that the class *must* act this way, I just want to prevent regressions.
Alternatively, you can pass just the model object itself (if the first argument isn't a string or symbol +fields_for+ will realize that the name has been omitted) -
CREATE INDEX index_developers_on_name ON developers USING btree (name) -- PostgreSQL CREATE INDEX index_developers_on_name USING btree ON developers (name) -- MySQL
Currently, this cop completely ignores strings with invalid encoding If it could handle them and still report an offense when appropriate, that would be even better
However, if you want to place your generators at a different location, you can specify in your railtie a block which will load them during normal generators lookup:
If you want to replace any header which already exists, first set it to +nil+ in order to reset the value otherwise another field will be added for the same header.
In the following example, the looping on users will always be done when the three columns 'first_name', 'last_name' and 'full_name' exist, even when migrating down:
Interpolated strings that contain more than just interpolation will call `on_dstr` for the entire string and `on_str` for the non interpolated portion of the string
It is also possible the combination of additional connection overhead (DNS, SSL) and the overall browser connection limits may result in this solution being slower.
The array is flattened, and all items, including the supplied separator, are HTML escaped unless they are HTML safe, and the returned string is marked as HTML safe.
This reduces the cost of of hosting on a service like Heroku along with the memory footprint of having to maintain additional jobs if hosting on a dedicated server.
We can then redefine how certain data types may be handled in the schema dumper on the Adapter level by over-writing this code inside the database specific adapters
You can create a custom formatter by subclassing `RuboCop::Formatter::BaseFormatter` and overriding some methods, or by implementing all the methods by duck typing.
For example, If you wanted to create a +member+ named _joe_ and wanted to update the +posts+ at the same time, that would give an ActiveRecord::RecordNotFound error.
If the `else` part is actually an `elsif`, we check the `elsif` node in case it contains an `else` within, because that `else` should have the same alignment (base).
If you are using XHR requests other than GET or POST and redirecting after the request then some browsers will follow the redirect using the original request method.
If you want a gem to behave as an engine, you have to specify an +Engine+ for it somewhere inside your plugin's +lib+ folder (similar to how we specify a +Railtie+):
In the examples above, the object to be created or edited was represented by a symbol passed to +form_for+, and we noted that a string can also be used equivalently.
Returns a file upload input tag tailored for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
The "central auto-correction engine" can't handle intermediate states where the code has syntax errors, so it's important to fix the trailing whitespace in this cop.
The default argument is returned if the underlying implementation does not define the indexes method, as there's no way to determine the correct answer in that case.
This is a new Rails 5.0 default, so it is introduced as a configuration option to ensure that apps made on earlier versions of Rails are not affected when upgrading.
This means that, if your application currently relies on instance variables set in the template to be used in the layout, they won't work once you move to streaming.
To specialize the default behavior, you can pass a block that accepts the name or the full argument list for +link_to_unless+ (see the examples in +link_to_unless+).
We don't need strict fairness: if two connections become available at the same time, it's fine if two threads that were waiting acquire the connections out of order.
We need to recursively iterate over all `else` branches and consider all but the last `node` an `elsif` branch and consider the last `node` the actual `else` branch.
We track Thread objects, instead of just using counters, because we need exclusive locks to be reentrant, and we need to be able to upgrade share locks to exclusive.
You can also define your own unit-quantifier names if you want to use other decimal units (eg.: 1500 becomes "1.5 kilometers", 0.150 becomes "150 milliliters", etc).
All changes to models, including the destruction of those marked for destruction, are saved and destroyed automatically and atomically when the parent model is saved.
Although this command ignores most +options+ and the block if one is given, it can be helpful to provide these in a migration's +change+ method so it can be reverted.
Each mapping is represented as an array where the first item is the name of the entity attribute and the second item is the name of the attribute in the value object.
Exclude properties in .rubocop_todo.yml override default ones, as well as any custom excludes in .rubocop.yml, so in order to retain those excludes we must copy them.
If an array's opening brace is on the same line as the first element of the array, then the closing brace should be on the same line as the last element of the array.
If set to true, precision will mean the number of significant digits instead of the number of decimal digits (1234 with precision 2 becomes 1200, 1.23543 becomes 1.2)
If you want to use encoding other than Base64 then you will need to pass encoding type along with the pre-encoded content as Mail doesn't know how to decode the data:
MRI 2.0 accepts this case, but I have no idea why it does so and there's no convincing reason to conform to this behavior, so RuboCop does not mimic MRI in this case.
Note the subtle difference between the two: +assert_routing+ tests that a URL fits options while +assert_recognizes+ tests that a URL breaks into parameters properly.
Person.find_or_initialize_by(name: 'Spartacus', rating: 4) returns the first item or returns a new instance (requires you call .save to persist against the database).
True if the method name matches one of the five elements defined in the Atom spec as potentially containing XHTML content and if type: 'xhtml' is, in fact, specified.
We currently support NilClass, Fixnum, Float, String, TrueClass, FalseClass, Bignum, BigDecimal, and objects that can be represented as GlobalIDs (ex: Active Record).
Whether a one-to-one or one-to-many style form builder will be yielded depends on whether the normal reader method returns a _single_ object or an _array_ of objects.
def test_emails assert_enqueued_emails 0 ContactMailer.welcome.deliver_later assert_enqueued_emails 1 ContactMailer.welcome.deliver_later assert_enqueued_emails 2 end
Any user connecting from the 192.168.* range will be able to see this resource, where as any user connecting outside of this range will be told there is no such route.
By default, migrations will describe the actions they are taking, writing them to the console as they happen, along with benchmarks describing how long each step took.
If you do, Rails will not try to encode the String into the default_internal, passing you the unaltered bytes tagged with the assumed encoding (from default_external).
Missing routes keys may be filled in from the current request's parameters (e.g. +:controller+, +:action+, +:id+ and any other parameters that are placed in the path).
Parenthesize corrected expression if changing to modifier-if form would change the meaning of the parent expression (due to the low operator precedence of modifier-if)
Remember, usually you'll run many Action Cable servers, so you can't use this collection as a full list of all of the connections established against your application.
Returns +true+ if +self+ and +other_aggregation+ have the same +name+ attribute, +active_record+ attribute, and +other_aggregation+ has an options hash assigned to it.
Since cache entries in most instances will be serialized, the internals of this class are highly optimized using short instance variable names that are lazily defined.
So we need to require this upfront to ensure we don't get a false failure, but ideally we should just fix the BigDecimal core_ext to not change to_s without arguments.
This all happens inside a transaction, _if_ the Transactions module is included into ActiveRecord::Base after the AutosaveAssociation module, which it does by default.
This is a new Rails 5.0 default, so it is introduced as a configuration option to ensure that apps made with earlier versions of Rails are not affected when upgrading.
This will work with any template engine, as we process out the encoding comment before passing the source on to the template engine, leaving a blank line in its stead.
While it's strongly recommended that you use key-based cache expiration (see links in CacheHelper for more information), it is also possible to manually expire caches.
distance: centi: one: "centimeter" other: "centimeters" unit: one: "meter" other: "meters" thousand: one: "kilometer" other: "kilometers" billion: "gazillion-distance"
After configured, whenever a "sql.active_record" notification is published, it will properly dispatch the event (ActiveSupport::Notifications::Event) to the sql method.
An instance of this configuration object is available via ActionCable.server.config, which allows you to tweak Action Cable configuration in a Rails config initializer.
Based on the above example, the subscribers of this channel will get whatever data is put into the, let's say, `comments_for_45` broadcasting as soon as it's put there.
If an method call's opening brace is on the line above the first argument of the call, then the closing brace should be on the line below the last argument of the call.
If you hold a reference to a user record, but the name is changed while that reference is held, you may be sending stale data if you don't take precautions to avoid it.
Returns true if +comparison_object+ is the same exact object, or +comparison_object+ is of the same type and +self+ has an ID and it is equal to +comparison_object.id+.
Returns true if the +lock_optimistically+ flag is set to true (which it is, by default) and the table includes the +locking_column+ column (defaults to +lock_version+).
The cycle helpers need to store the cycles in a place that is guaranteed to be reset every time a page is rendered, so it uses an instance variable of ActionView::Base.
These callbacks are useful for interacting with other systems since you will be guaranteed that the callback is only executed when the database is in a permanent state.
This means that if a :lvar node is shown in AST, the variable is assumed to be already declared, even if we haven't seen any :lvasgn or :arg node before the :lvar node.
This prevents the parent object from validating successfully and saving, which then deletes the associated object, thus putting the parent object into an invalid state.
To be able to use single-table inheritance with another column name, or to use the column +type+ in your own model for something else, you can set +inheritance_column+:
CollectionAssociation class provides common methods to the collections defined by +has_and_belongs_to_many+, +has_many+ or +has_many+ with +:through association+ option.
Example: create_database 'charset_test', charset: 'latin1', collation: 'latin1_bin' create_database 'matt_development' create_database 'matt_development', charset: :big5
If an array is passed, then the first element of the array is treated as a template, and the remaining elements are inserted into the template to generate the condition.
Not all cases can reliably checked, due to Ruby's dynamic types, so we consider only cases when the first argument is an array literal or the second is a string literal.
Return a hash of the options given at invocation, minus the ones that have no effect on which offenses and disabled line ranges are found, and thus don't affect caching.
Some databases impose a limit on the number of ids in a list (in Oracle it's 1000) Make several smaller queries if necessary or make one query if the adapter supports it
This test checks that if we push a hash to an array (in-place modification) the cache does not get fooled, the hash is still wrapped as strong params, and not permitted.
:nodoc: The TextHelper module provides a set of methods for filtering, formatting and transforming strings, which can reduce the amount of inline Ruby code in your views.
After configured, whenever a "sql.active_record" notification is published, it will properly dispatch the event (ActiveSupport::Notifications::Event) to the +sql+ method.
Also test an edge case: If you have 11 results, and you set a limit of 3 and offset of 9, then you should find that there will be only 2 results, regardless of the limit.
In order to use any of the customized resolvers above in a Rails application, you just need to configure ActionController::Base.view_paths in an initializer, for example:
It also provides some hooks related with process_action, this allows an ORM like Active Record and/or DataMapper to plug in ActionController and show related information.
The +errors+ property of this exception contains an array of AttributeAssignmentError objects that should be inspected to determine which attributes triggered the errors.
The escaping performed in this method is identical to those performed in the Active Support JSON encoder when +ActiveSupport.escape_html_entities_in_json+ is set to true.
This method has the same semantics of +update+, except it does not modify the receiver but rather returns a new hash with indifferent access with the result of the merge.
we want resulting call to be parenthesized if arg already includes one or more sets of parens, don't add more or if method call already used parens, again, don't add more
CachingKeyGenerator is a wrapper around KeyGenerator which allows users to avoid re-executing the key generation process when it's called using the same salt and key_size.
If a method call's opening brace is on the same line as the first argument of the call, then the closing brace should be on the same line as the last argument of the call.
If you need to access this auto-generated method from other places (such as a model), then you can do that by including Rails.application.routes.url_helpers in your class:
In the above example posts with no approved comments are not returned at all, because the conditions apply to the SQL statement as a whole and not just to the association.
On some database systems, such as PostgreSQL, database errors inside a transaction cause the entire transaction to become unusable until it's restarted from the beginning.
Once the variable is captured by a block, we have no idea when, where and how many times the block would be invoked and it means we cannot track the usage of the variable.
That will ensure all the data transferred via HTTPS protocol and prevent the user from getting their session hijacked when accessing the site over unsecured HTTP protocol.
You can also specify a class option as the second parameter that'll raise an exception if a serialized object is retrieved as a descendant of a class not in the hierarchy.
always convert table names to downcase as in Oracle quoted table names are in uppercase ignore raw_sql_ that is used by Oracle adapter as alias for limit/offset subqueries
queue_classic assumes that you are already using PostgreSQL in your production environment and that adding another dependency (e.g. redis, beanstalkd, 0mq) is undesirable.
All of this power shouldn't fool you into thinking that you can pull out huge amounts of data with no performance penalty just because you've reduced the number of queries.
Developing a Rails extension does _not_ require implementing a railtie, but if you need to interact with the Rails framework during or after boot, then a railtie is needed.
For example, if the following templates exist: * signup_notification.text.erb * signup_notification.html.erb * signup_notification.xml.builder * signup_notification.yml.erb
For this purpose, you can use a helper called +provide+ that does the same as +content_for+ but tells the layout to stop searching for other entries and continue rendering.
In both instances, valid attribute keys are determined by the column names of the associated table -- hence you can't have attributes that aren't part of the table columns.
Normally they should be aligned with an if/unless/while/until/begin/def keyword, but there are special cases when they should follow the same rules as the alignment of end.
Returns a label tag tailored for labelling an input field for a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
The mapping that binds a given Active Record class to a certain database table will happen automatically in most common cases, but can be overwritten for the uncommon ones.
This method always returns a record, but if creation was attempted and failed due to validation errors it won't be persisted, you get what create returns in such situation.
We document the request and response methods here because albeit they are implemented in ActionController::Metal, the type of the returned objects is unknown at that level.
By default, if you don't specify the key in which the parameters would be wrapped to, +ParamsWrapper+ will actually try to determine if there's a model related to it or not.
If the +key+ argument provided is an array, or responds to +to_a+, then each of elements in the array will be turned into parameters/keys and concatenated into a single key.
Looping through a collection of records from the database (using the +all+ method, for example) is very inefficient since it will try to instantiate all the objects at once.
Notifier.welcome(User.first).deliver_later Notifier.welcome(User.first).deliver_later(wait: 1.hour) Notifier.welcome(User.first).deliver_later(wait_until: 10.hours.from_now)
Returns a new object of the collection type that has been instantiated with attributes, linked to this object and that has already been saved (if it passes the validations).
Returns an input tag of the "text" type tailored for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
Stub out the JSON.load call used by the cache mechanism, so we can test what happens when an offense message has ASCII-8BIT encoding and contains a non-7bit-ascii character.
Supposing you have an action that adds a new person, optionally creating their company (by name) if it does not already exist, without web-services, it might look like this:
The options version of redirect allows you to supply only the parts of the url which need to change, it also supports interpolation of the path similar to the first example.
This is useful when certain elements of an action change frequently or depend on complicated state while other parts rarely change or can be shared amongst multiple parties.
Used to test that assert_response includes the exception message in the failure message when an action raises and assert_response is expecting something other than an error.
When the record is created, a check is performed to make sure that no record exists in the database with the given value for the specified attribute (that maps to a column).
private Using a private method to encapsulate the permissible parameters is just a good pattern since you'll be able to reuse the same permit list between create and update.
Because you can instantiate multiple sessions and run them side-by-side, you can also mimic (to some limited extent) multiple simultaneous users interacting with your system.
INNER JOIN categories_posts posts_categories_join INNER JOIN posts posts_categories INNER JOIN categories_posts categories_posts_join INNER JOIN categories categories_posts_2
If the current I18n.config object responds to original_config, it means that it has a copy of the original I18n configuration and it's acting as proxy, which we need to skip.
If there are method calls chained to the right hand side of the assignment, we let rhs be the receiver of those method calls before we check if it's an if/unless/while/until.
If you are using a mounted engine and you need to use a polymorphic_url pointing at the engine's routes, pass in the engine's route proxy as the first argument to the method.
It makes sense to turn off this check on sites aimed at non-IP clients (like WAP devices), or behind proxies that set headers in an incorrect or confusing way (like AWS ELB).
Note that we don't actually need to serialize the jobs since we're performing them in-process, but we do so anyway for parity with other adapters and deployment environments.
Relative exclude paths in .rubocop.yml files are relative to that file, but in configuration files with other names they will be relative to whatever file inherits from them.
Returns true if the round/square/curly brackets of the given node are on different lines, and each item within is on its own line, and the closing bracket is on its own line.
SQLite 3.8.2 returns a newly formatted error message: UNIQUE constraint failed: *table_name*.*column_name* Older versions of SQLite return: column *column_name* is not unique
The remaining request parameters, the session (if one is available), and the full request with all the HTTP headers are made available to the action through accessor methods.
There's also a convenience method for rendering sub templates within the current controller that depends on a single object (we call this kind of sub templates for partials).
This doesn't work on MySQL (even when aliasing the tables), but MySQL allows using JOIN directly in an UPDATE statement, so in the MySQL adapters we redefine this to do that.
When style is `empty_lines`, if the body is empty, we don't enforce the presence OR absence of an empty line But if style is `no_empty_lines`, there must not be an empty line
You can make worker 1 handle all the records between id 0 and 10,000 and worker 2 handle from 10,000 and beyond (by setting the +:start+ and +:finish+ option on each worker).
Adding it is quite simple, you just need to include the module in a specific controller or in +ApplicationController+ in case you want it available in your entire application:
Although it's very un-Ruby, some people's AR-mapped tables have upper-case attributes, and when people want to alias those names to more sensible ones, everything goes *foof*.
Classes with no body are exempt from the check and so are namespace modules - modules that have nothing in their bodies except classes, other modules, or constant definitions.
It can either represent a real HTTP response (i.e. one that is meant to be sent back to the web browser) or a TestResponse (i.e. one that is generated from integration tests).
Returns +true+ if the two arrays contain the same number of elements and if each element is equal to the corresponding element in the +other+ array, otherwise returns +false+.
The ignore_default_scope flag is used to prevent an infinite recursion situation where a default scope references a scope which has a default scope which references a scope...
UpgradeLegacyEncryptedCookieJar is used by ActionDispatch::Session::CookieStore instead of EncryptedCookieJar if secrets.secret_token and secrets.secret_key_base are both set.
You _should_ always force the browser to use HTTPS when you're transferring sensitive information such as user authentication, account information, or credit card information.
:nodoc: In order to allow the Sass generators to pick up the default Rails CSS and transform it, we leave it in a standard location for the CSS stylesheet generators to handle.
When +transaction+ is finished and tries to release the savepoint it created earlier, a database error will occur because the savepoint has already been automatically released.
You can pass a second argument +scope+ as a callable (i.e. proc or lambda) to retrieve a specific record or customize the generated query when you access the associated object.
Zero precision with significant is a mistake (would always return zero), so we treat it as if significant was false (increases backwards compatibility for number_to_human_size)
For redirects within the same controller, you can even call follow_redirect and the redirect will be followed, triggering another action call which can then be asserted against.
GET       /admin/posts GET       /admin/posts/new POST      /admin/posts GET       /admin/posts/1 GET       /admin/posts/1/edit PATCH/PUT /admin/posts/1 DELETE    /admin/posts/1
Lastly, if the client wants XML, we render the created person as XML, but with a twist: we also include the person's company in the rendered XML, so you get something like this:
Returns an input tag of the "password" type tailored for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
The typical filter use case is to remove lengthy path information from the start of each line, and view file paths relevant to the app directory instead of the file system root.
has_many - Source reflection can be has_many, has_one, belongs_to or has_and_belongs_to_many - Through reflection can be has_many, has_one, belongs_to or has_and_belongs_to_many
(Note: including the IP address of the client in the nonce would appear to offer the server the ability to limit the reuse of the nonce to the same client that originally got it.
A thread can remove an element from the queue without waiting if and only if the number of currently available connections is strictly greater than the number of waiting threads.
Constants may only be regarded as 'new' once -- so if the block calls +new_constants_in+ again, then the constants defined within the inner call will not be reported in this one.
If the provided block does not run to completion, and instead raises an exception, any new constants are regarded as being only partially defined and will be removed immediately.
If the schema is not specified as part of +name+ then it will only find tables within the current schema search path (regardless of permissions to access tables in other schemas)
Include the default authenticity_token, which is only generated when its set to nil, but we needed the true value to override the default of no authenticity_token on data-remote.
Starting with the parent node and recursively for the parent node's children, check if the node is a HEREDOC and if the HEREDOC ends below or on the last line of the parent node.
The Rails core team has stated patches for the inflections library will not be accepted in order to avoid breaking legacy applications which may be relying on errant inflections.
This holds scopes as stack structure, and provides a way to add local variables to current scope and find local variables by considering variable visibility of the current scope.
This is especially useful in validation situations where the user might supply a string for an integer field and you want to display the original string back in an error message.
If you need to output JSON elsewhere in your HTML, you can just do something like this, as any unsafe characters (including quotation marks) will be automatically escaped for you:
Instead of declaring separate routes for your +index+, +show+, +new+, +edit+, +create+, +update+ and +destroy+ actions, a resourceful route declares them in a single line of code:
Note that this tolerance only matters if the exception was given as a string, otherwise a NameError will be raised by the interpreter itself when rescue_from CONSTANT is executed.
TODO: remove the following line as soon as the return value of callbacks is ignored, that is, returning `false` does not display a deprecation warning or halts the callback chain.
The bundled ActiveRecord::ConnectionAdapters distinguish unique index constraint errors from other types of database errors by throwing an ActiveRecord::RecordNotUnique exception.
The current object being rendered, as well as the object_counter, will be available as local variables inside the layout template under the same names as available in the partial.
Whether that is a problem or not depends on the logic of the application, but in the particular case in which rows have a UNIQUE constraint an exception may be raised, just retry:
All request parameters, whether they come from a query string in the URL or form data submitted through a POST request are available through the params method which returns a hash.
Cleanup callbacks will not be called until after the response_body lambda is evaluated, ensuring that it can refer to application models and other classes before they are unloaded.
Determine whether the request body contains form-data by checking the request Content-Type for one of the media-types: "application/x-www-form-urlencoded" or "multipart/form-data".
Returns a textarea opening and closing tag set tailored for accessing a specified attribute (identified by +method+) on an object assigned to the template (identified by +object+).
The +authenticate_or_request_with_http_digest+ block must return the user's password or the ha1 digest hash so the framework can appropriately hash to check the user's credentials.
The method can be used in several slightly different ways, depending on how much you wish to rely on Rails to infer automatically from the model how the form should be constructed.
This is the fastest way to update attributes because it goes straight to the database, but take into account that in consequence the regular update procedures are totally bypassed.
Unlike controllers from Action Pack, the mailer instance doesn't have any context about the incoming request, so you'll need to provide all of the details needed to generate a URL.
Using either of these alternate methods incurs a performance hit, as the fixtured data must be fully traversed in the database to create the fixture hash and/or instance variables.
Allows you to specify sensitive parameters which will be replaced from the request log by looking in the query string of the request and all sub-hashes of the params hash to filter.
FIXME: this needs to be refactored so specific database can add their own ignored SQL, or better yet, use a different notification for the queries instead examining the SQL content.
Here is a more advanced Token example where only Atom feeds and the XML API is protected by HTTP token authentication, the regular HTML interface is protected by a session approach:
If you pass any additional configuration options, they will be passed to the class and available as +options+, please refer to the class version of this method for more information.
If you want to validate that a child record is associated with a parent record, you can use the +validates_presence_of+ method and the +:inverse_of+ key as this example illustrates:
NOTE - these tests might not be meaningful, ripped as they were from the parental_control plugin which would guess the inverse rather than look for an explicit configuration option.
This allows the header of the HTML (which is usually in the layout) to be streamed back to client very quickly, allowing JavaScripts and stylesheets to be loaded earlier than usual.
This means routes are also reloaded if i18n is updated, which might not be necessary, but in order to be more precise we need some sort of reloaders dependency support, to be added.
When the cache exceeds the allotted size, a cleanup will occur which tries to prune the cache down to three quarters of the maximum size by removing the least recently used entries.
You can also specify the key in which the parameters should be wrapped to, and also the list of attributes it should wrap by using either +:include+ or +:exclude+ options like this:
* An associated record is deleted via record.destroy * Hence the callbacks run, and they find a belongs_to on the record with a :counter_cache options which points back at our owner.
If you decide to define multiple applications, then the first application that is initialized will be set to +Rails.application+, unless you override it with a different application.
It also executes some bootstrap initializers (check Rails::Application::Bootstrap) and finishing initializers, after all the others are executed (check Rails::Application::Finisher).
The delegations may vary depending on the klass of a relation, so we create a subclass of Relation for each different klass, and the delegations are compiled into that subclass only.
need to disable transactional tests, because otherwise the sqlite3 adapter (at least) chokes when we try and change the schema in the middle of a test (see test_increment_counter_*).
Also have in mind that exceptions thrown within a transaction block will be propagated (after triggering the ROLLBACK), so you should be ready to catch those in your application code.
ConnectionPool is completely thread-safe, and will ensure that a connection cannot be used by two threads at the same time, as long as ConnectionPool's contract is correctly followed.
It doesn't mean you won't have such features if you need them: they're all available for you to include in your application, they're just not part of the default API controller stack.
Note that setting the UUID primary key default value to +nil+ will require you to assure that you always provide a UUID value before saving a record (as primary keys cannot be +nil+).
Since we don't want the callbacks to get defined multiple times, there are guards that check if the save or validation methods have already been defined before actually defining them.
The +TemplateRenderer+ and +PartialRenderer+ objects are wrappers which do all the setup and logic necessary to render a view and a new object is created each time +render+ is called.
The view_paths array must be set on Base and not LayoutTest so that LayoutTest's inherited method has access to the view_paths array when looking for a layout to automatically assign.
This includes all public instance methods on a channel, less any internal methods (defined on Base), adding back in any methods that are internal, but still exist on the class itself.
You can think of a channel like a form of controller, but one that's capable of pushing content to the subscriber in addition to simply responding to the subscriber's direct requests.
You're then responsible for dealing with the conflict by rescuing the exception and either rolling back, merging, or otherwise apply the business logic needed to resolve the conflict.
Excluded files will be removed later by the caller, but as an optimization find_files removes the top level directories that are excluded in configuration in the normal way (dir/**/*).
For historical reasons, the 'media' attribute will always be present and defaults to "screen", so you must explicitly set it to "all" for the stylesheet(s) to apply to all media types.
Not all records have the same class, so group then preload group on the reflection itself so that if various subclass share the same association then we do not split them unnecessarily
The automatic guessing of the inverse association uses a heuristic based on the name of the class, so it may not work for all associations, especially the ones with non-standard names.
The reason for doing this is simple -- in `distance_of_time_to_words`, when we take the distance between our two Time objects in seconds and convert it to minutes, we round the number.
Unfortunately this introduces a gotcha: if an +Invoice+ model has a +paid+ flag, and in the form that edits a paid invoice the user unchecks its check box, no +paid+ parameter is sent.
When creating objects on the association, we must not do it within a scope (even though it would be convenient), because this would cause that scope to be applied to any callbacks etc.
Whenever the +render+ method is called on the base +Renderer+ class, a new renderer object of the correct type is created, and the +render+ method on that new object is called in turn.
You may use a type not in this list as long as it is supported by your database (for example, "polygon" in MySQL), but this will not be database agnostic and should usually be avoided.
DSL methods may evaluate a block in the context of a newly created class or module Assume that if a method definition is inside any block call which we can't identify, it could be a DSL
The new method will return nil if the node does not match If the node matches, and a block is provided, the new method will yield to the block (passing any captures as block arguments).
There are four types of callbacks accepted by the callback macros: Method references (symbol), callback objects, inline methods (using a proc), and inline eval methods (using a string).
This cop looks for inject / reduce calls where the passed in object is returned at the end and so could be replaced by each_with_object without the need to return the object at the end.
Additionally, you should take care to make sure you are not relying on the ability to decode signed cookies generated by your app in external applications or JavaScript before upgrading.
Log subscriber also has some helpers to deal with logging and automatically flushes all logs when the request finishes (via action_dispatch.callback notification) in a Rails environment.
Take into account that this does not include helpers defined in controllers with helper_method or other similar solutions, only helpers defined in the helpers directory will be included.
This can be an active or defined connection: if it is the latter, it will be opened and set as the active connection for the class it was defined for (not necessarily the current class).
This value can be specified as an option to the constructor (in which case all entries will be affected), or it can be supplied to the +fetch+ or +write+ method to effect just one entry.
- X-Forwarded-For will be a list of IPs, one per proxy, or blank - Client-Ip is propagated from the outermost proxy, or is blank - REMOTE_ADDR will be the IP that made the request to Rack
For example, a +DiscussionBoard+ may cache posts_count and comments_count to avoid running an SQL query to calculate the number of posts and comments there are, each time it is displayed.
If `verify_authenticity_token` was run (indicating that we have forgery protection enabled for this request) then also verify that we aren't serving an unauthorized cross-origin response.
Record is stale when it's being saved in another query after instantiation, for example, when two users edit the same wiki page and one starts editing and saves the page before the other.
Since the preloader for habtm gets raw row hashes from the database and then instantiates them, this test ensures that it only instantiates one actual object per record from the database.
When given a block, the value for duplicated keys will be determined by the result of invoking the block with the duplicated key, the value in the receiver, and the value in +other_hash+.
If an method definition's opening brace is on the line above the first parameter of the definition, then the closing brace should be on the line below the last parameter of the definition.
If you discover an incorrect inflection and require it for your application or wish to define rules for languages other than English, please correct or add them yourself (explained below).
It works basically as a command recorder, saving each command to be applied after initialization over the default middleware stack, so you can add, swap, or remove any middleware in Rails.
Skip this route unless a name has been provided or it is a standard Rails route since we can't determine whether an options hash passed to url_for matches a Rack application or a redirect.
You can pass a second argument +scope+ as a callable (i.e. proc or lambda) to retrieve a specific set of records or customize the generated query when you access the associated collection.
A typical use case is to make constant name resolution deterministic for constants with the same relative name in different namespaces whose evaluation would depend on load order otherwise.
In this case +last_modified+ will be set by calling +maximum(:updated_at)+ on the collection (the timestamp of the most recently updated record) and the +etag+ by passing the object itself.
Ruby 2.4 will change the behavior of `to_time` to preserve the timezone when converting to an instance of `Time` instead of the previous behavior of converting to the local system timezone.
The expected default behavior is an XMLHttpRequest in the background instead of the regular POST arrangement, but ultimately the behavior is the choice of the JavaScript driver implementor.
This is especially useful if you want to work with the ActiveRecord::Relation object instead of the array of records, or if you want multiple workers dealing with the same processing queue.
gem "rspec", group: :test gem "technoweenie-restful-authentication", lib: "restful-authentication", source: "http://gems.github.com/" gem "rails", "3.0", git: "git://github.com/rails/rails"
In this context +:kind+ and +:name+ have special meanings: +:kind+ refers to the kind of callback (before/after/around) and +:name+ refers to the method on which callbacks are being defined.
This should be a last resort because using, for example, MySQL specific terms will lock you to using that particular database engine or require you to change your call if you switch engines.
This should be implemented to return the values of the relevant key(s) on the owner, so that when stale_state is different from the value stored on the last find_target, the target is stale.
if the second_thread is not able to preempt the first_thread, they will temporarily (until either of them timeouts with ConnectionTimeoutError) deadlock and a join(2) timeout will be reached
+schema+ and +identifier+ exclude surrounding quotes (regardless of whether provided in +string+) +string+ supports the range of schema/table references understood by PostgreSQL, for example:
Expects a block that takes as arguments: +association+ - name of the association +records+     - the association record(s) to be serialized +opts+        - options for the association records
If a method definition's opening brace is on the same line as the first parameter of the definition, then the closing brace should be on the same line as the last parameter of the definition.
It relies on the fact that partials should follow the naming convention of being prefixed with an underscore -- as to separate them from regular templates that could be rendered on their own.
Log tags (+taggers+) can be an Array containing: methods that the +request+ object responds to, objects that respond to +to_s+ or Proc objects that accept an instance of the +request+ object.
Note that the usec for the time passed will be set to 0 to prevent rounding errors with external services, like MySQL (which will round instead of floor, leading to off-by-one-second errors).
Returns true if the "X-Requested-With" header contains "XMLHttpRequest" (case-insensitive), which may need to be manually added depending on the choice of JavaScript libraries and frameworks.
Since the argument is the object that the given block shall make calls on to build something based on the enumerable that each_with_object iterates over, an immutable argument makes no sense.
This includes all public instance methods on a controller, less any internal methods (see internal_methods), adding back in any methods that are internal, but still exist on the class itself.
When EnforcedStyle is 'strict' then the Date methods (today, current, yesterday, tomorrow) are prohibited and the usage of both 'to_time' and 'to_time_in_current_zone' is reported as warning.
You can now set or update attributes on the associated posts through an attribute hash for a member: include the key +:posts_attributes+ with an array of hashes of post attributes as a value.
'cur_node' is a Ruby expression which evaluates to an AST node, but we don't know how expensive it is to be safe, cache the node in a temp variable and then use the temp variable as 'cur_node'
Extends the module object with class/module and instance accessors for class/module attributes, just like the native attr* accessors for instance attributes, but does so on a per-thread basis.
If you call a complicated SQL query which spans multiple tables the columns specified by the SELECT will be attributes of the model, whether or not they are columns of the corresponding table.
In order for both of these features to be specified independently, both an object name (represented by either a symbol or string) and the object itself can be passed to the method separately -
The JSON literal is not numeric, but if the other end knows by contract that the data is supposed to be a BigDecimal, it still has the chance to post-process the string and get the real value.
This object serves as a container in which available responses can be stored by calling any of the dynamically generated, mime-type-specific methods such as +html+, +xml+ etc on the Collector.
WARNING: The instrumentation framework is designed for long-running subscribers, use this feature sparingly because it wipes some internal caches and that has a negative impact on performance.
You can manipulate objects and associations before they are saved to the database, but there is some special behavior you should be aware of, mostly involving the saving of associated objects.
You need to be careful with assumptions regarding the target: The proxy does not fetch records from the database until it needs them, but new ones created with +build+ are added to the target.
It is important to keep this file as light as possible the goal for tests that require this is to test booting up rails from an empty state, so anything added here could hide potential failures
Reloading is commonly used in test suites to test something is actually written to the database, or when some action modifies the corresponding row in the database but not the object in memory:
Secondly, the field values shown when the form is initially displayed are taken from the attributes of the object passed to +form_for+, regardless of whether the object is an instance variable.
To specialize the default behavior (i.e., show a login link rather than just the plaintext link text), you can pass a block that accepts the name or the full argument list for +link_to_unless+.
Action Mailer is nicely integrated with Active Job so you can generate and send emails in the background (example: outside of the request-response cycle, so the user doesn't have to wait on it):
Since autocorrect changes a number of lines, and not only the line where the reported offending range is, we avoid auto-correction if this cop has already found other offenses is the same range.
These methods can consist of both the migration specific methods like +add_column+ and +remove_column+, but may also contain regular Ruby code for generating data needed for the transformations.
+spec+ is a ConnectionSpecification object which describes database connection information (e.g. adapter, host name, username, password, etc), as well as the maximum size for this ConnectionPool.
Association methods are generated in a module that is included into the model class, which allows you to easily override with your own methods and call the original generated method with +super+.
For example, after_commit is a good spot to put in a hook to clearing a cache since clearing it from within a transaction could trigger the cache to be regenerated before the database is updated.
If the verb is not GET or POST, which are natively supported by HTML forms, the form will be set to POST and a hidden input called _method will carry the intended verb for the server to interpret.
Method references and callback objects are the recommended approaches, inline methods using a proc are sometimes appropriate (such as for creating mix-ins), and inline eval methods are deprecated.
Nobody should be using it directly, and subclasses (like ActionController::Base) are expected to provide their own +render+ method, since rendering means different things depending on the context.
Accepts a logger conforming to the interface of Log4r which is then passed on to any new database connections made and which can be retrieved on both a class and instance level by calling +logger+.
Invokes the public method whose name goes as first argument just like +public_send+ does, except that if the receiver does not respond to it the call returns +nil+ rather than raising an exception.
Que is a high-performance alternative to DelayedJob or QueueClassic that improves the reliability of your application by protecting your jobs with the same ACID guarantees as the rest of your data.
Returns the column attribute of the range, except if the range is on the first line and there's a byte order mark at the beginning of that line, in which case 1 is subtracted from the column value.
This will assign "weblog_standard" as the WeblogController's layout for all actions except for the +rss+ action, which will be rendered directly, without wrapping a layout around the rendered view.
Your primary database in the development environment is "my_application" but the Book model connects to a separate database called "library_db" (this can even be a database on a different machine).
Determines if one of the attributes passed in is the inheritance column, and if the inheritance column is attr accessible, it initializes an instance of the given subclass instead of the base class.
New objects can be instantiated as either empty (pass no construction parameter) or pre-set with attributes but not yet saved (pass a hash with key names matching the associated table column names).
You are free to leave your existing secret_token in place, not set the new secret_key_base, and ignore the deprecation warnings until you are reasonably sure that your upgrade is otherwise complete.
Book, ScaryBook and GoodBook will all use the same connection pool to "library_db" while Author, BankAccount, and any other models you create will use the default connection pool to "my_application".
For example, if you serve pages tailored depending on who's logged in at the moment, you may want to add the current user id to be part of the ETag to prevent unauthorized displaying of cached pages.
Mysql2Adapter doesn't have to free a result after using it, but we use this method to write stuff in an abstract way without concerning ourselves about whether it needs to be explicitly freed or not.
The parameter is called MinDigits (meaning the minimum number of digits for which an offense can be registered), but essentially it's a Max parameter (the maximum number of something that's allowed).
create a different, later thread, that will attempt to do a "group action", but because of the group action semantics it should be able to preempt the first_thread when a connection is made available
create string with range of Unicode's western characters with diacritics, excluding the division and multiplication signs which for some reason or other are floating in the middle of all the letters.
read a single pattern-matching expression from the token stream, return Ruby code which performs the corresponding matching operation on 'cur_node' (which is Ruby code which evaluates to an AST node)
